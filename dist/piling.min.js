!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("pixi.js"),require("redux")):"function"==typeof define&&define.amd?define(["exports","pixi.js","redux"],t):t((e=e||self).pilingJs={},e.PIXI,e.redux)}(this,(function(e,t,n){"use strict";function r(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}var i=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function s(e){r(a,i,o,s,u,"next",e)}function u(e){r(a,i,o,s,u,"throw",e)}s(void 0)}))}},o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function s(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var u=s((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n,r){var i=t&&t.prototype instanceof l?t:l,o=Object.create(i.prototype),a=new S(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return M()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=u(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var c={};function l(){}function f(){}function h(){}var p={};p[i]=function(){return this};var d=Object.getPrototypeOf,g=d&&d(d(k([])));g&&g!==t&&n.call(g,i)&&(p=g);var m=h.prototype=l.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function y(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,s){var c=u(e[i],e,o);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(f).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function k(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:M}}function M(){return{value:void 0,done:!0}}return f.prototype=m.constructor=h,h.constructor=f,h[a]=f.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},v(y.prototype),y.prototype[o]=function(){return this},e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(s(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},v(m),m[a]="Generator",m[i]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=k,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));var c=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r};var l=function(e){if(Array.isArray(e))return c(e)};var f=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var h=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}};var p=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var d=function(e){return l(e)||f(e)||h(e)||p()};var g=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var m=function(e){if(Array.isArray(e))return e};var v=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}};var y=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var b=function(e,t){return m(e)||v(e,t)||h(e,t)||y()},w="undefined"!=typeof Float32Array?Float32Array:Array;function x(){var e=new w(16);return w!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function S(e){var t=new w(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function k(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],p=t[11],d=t[12],g=t[13],m=t[14],v=t[15],y=n*s-r*a,b=n*u-i*a,w=n*c-o*a,x=r*u-i*s,S=r*c-o*s,k=i*c-o*u,M=l*g-f*d,E=l*m-h*d,O=l*v-p*d,A=f*m-h*g,P=f*v-p*g,j=h*v-p*m,C=y*j-b*P+w*A+x*O-S*E+k*M;return C?(C=1/C,e[0]=(s*j-u*P+c*A)*C,e[1]=(i*P-r*j-o*A)*C,e[2]=(g*k-m*S+v*x)*C,e[3]=(h*S-f*k-p*x)*C,e[4]=(u*O-a*j-c*E)*C,e[5]=(n*j-i*O+o*E)*C,e[6]=(m*w-d*k-v*b)*C,e[7]=(l*k-h*w+p*b)*C,e[8]=(a*P-s*O+c*M)*C,e[9]=(r*O-n*P-o*M)*C,e[10]=(d*S-g*w+v*y)*C,e[11]=(f*w-l*S-p*y)*C,e[12]=(s*E-a*A-u*M)*C,e[13]=(n*A-r*E+i*M)*C,e[14]=(g*b-d*x-m*y)*C,e[15]=(l*x-f*b+h*y)*C,e):null}function M(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],p=t[10],d=t[11],g=t[12],m=t[13],v=t[14],y=t[15],b=n[0],w=n[1],x=n[2],S=n[3];return e[0]=b*r+w*s+x*f+S*g,e[1]=b*i+w*u+x*h+S*m,e[2]=b*o+w*c+x*p+S*v,e[3]=b*a+w*l+x*d+S*y,b=n[4],w=n[5],x=n[6],S=n[7],e[4]=b*r+w*s+x*f+S*g,e[5]=b*i+w*u+x*h+S*m,e[6]=b*o+w*c+x*p+S*v,e[7]=b*a+w*l+x*d+S*y,b=n[8],w=n[9],x=n[10],S=n[11],e[8]=b*r+w*s+x*f+S*g,e[9]=b*i+w*u+x*h+S*m,e[10]=b*o+w*c+x*p+S*v,e[11]=b*a+w*l+x*d+S*y,b=n[12],w=n[13],x=n[14],S=n[15],e[12]=b*r+w*s+x*f+S*g,e[13]=b*i+w*u+x*h+S*m,e[14]=b*o+w*c+x*p+S*v,e[15]=b*a+w*l+x*d+S*y,e}function E(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function O(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var A,P;A=new w(4),w!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0),P=A;!function(){var e=function(){var e=new w(2);return w!=Float32Array&&(e[0]=0,e[1]=0),e}()}();const j=(e=[0,0],t=1,n=0,r=[0,0],i=[0,1/0])=>{const o=new Float32Array(16),a=new Float32Array(16),s=new Float32Array(16);let u=x(),c=[...r.slice(0,2),0,1];const l=[...i],f=()=>function(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,c,l),e}(o,u)[0],h=([e=0,t=0]=[],n=1,r=0)=>{u=x(),p([-e,-t]),g(r),d(1/n)},p=([e=0,t=0]=[])=>{o[0]=e,o[1]=t,o[2]=0;const n=E(a,o);M(u,n,u)},d=(e,t)=>{if(e<=0)return;const n=f(),r=n*e;if(1===(e=Math.max(l[0],Math.min(r,l[1]))/n))return;o[0]=e,o[1]=e,o[2]=1;const i=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(a,o),h=t?[...t,0]:c,p=E(o,h);M(u,p,M(u,i,M(u,k(s,p),u)))},g=e=>{const t=x();!function(e,t,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);c<1e-6||(a*=c=1/c,s*=c,u*=c,r=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=a*a*o+i,e[1]=s*a*o+u*r,e[2]=u*a*o-s*r,e[3]=0,e[4]=a*s*o-u*r,e[5]=s*s*o+i,e[6]=u*s*o+a*r,e[7]=0,e[8]=a*u*o+s*r,e[9]=s*u*o-a*r,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1)}(t,e,[0,0,1]),M(u,t,u)},m=e=>{!e||e.length<16||(u=e)};return h(e,t,n),{get translation(){return function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}(o,u).slice(0,2)},get target(){return O(o,c,k(s,u)).slice(0,2)},get scaling(){return f()},get scaleBounds(){return[...l]},get distance(){return 1/f()},get rotation(){return Math.acos(u[0])},get view(){return u},get viewCenter(){return c.slice(0,2)},lookAt:h,translate:p,pan:p,rotate:g,scale:d,zoom:d,reset:()=>{h(e,t,n)},set:(...e)=>(console.warn("Deprecated. Please use `setView()` instead."),m(...e)),setScaleBounds:e=>{l[0]=e[0],l[1]=e[1]},setView:m,setViewCenter:e=>{c=[...e.slice(0,2),0,1]}}},C=(e,{distance:t=1,target:n=[0,0],rotation:r=0,isNdc:i=!0,isFixed:o=!1,isPan:a=!0,panSpeed:s=1,isRotate:u=!0,rotateSpeed:c=1,isZoom:l=!0,zoomSpeed:f=1,viewCenter:h=null,scaleBounds:p=null,onKeyDown:d=(()=>{}),onKeyUp:g=(()=>{}),onMouseDown:m=(()=>{}),onMouseUp:v=(()=>{}),onMouseMove:y=(()=>{}),onWheel:b=(()=>{})}={})=>{let w=j(n,t,r,h,p),x=!1,S=0,k=0,M=0,E=0,O=!1,A=0,P=0,C=0,_=1,I=1,R=1,T=!1;const L=i?e=>e/_*2*R:e=>e,B=i?e=>e/I*2:e=>-e,N=i?e=>(e/_*2-1)*R:e=>e,D=i?e=>1-e/I*2:e=>e,z=()=>{const t=e.getBoundingClientRect();P=t.top,C=t.left,_=t.width,I=t.height,R=_/I},F=e=>{T=!1,g(e)},V=e=>{T=e.altKey,d(e)},U=e=>{O=!1,v(e)},Y=e=>{O=1===e.buttons,m(e)},X=e=>{M=S,E=k,S=e.clientX-C,k=e.clientY-P,y(e)},q=e=>{e.preventDefault();const t=1===e.deltaMode?12:1;A+=t*(e.deltaY||0),b(e)};return window.addEventListener("keydown",V,{passive:!0}),window.addEventListener("keyup",F,{passive:!0}),e.addEventListener("mousedown",Y,{passive:!0}),window.addEventListener("mouseup",U,{passive:!0}),window.addEventListener("mousemove",X,{passive:!0}),e.addEventListener("wheel",q,{passive:!1}),z(),w.config=({isFixed:e=null,isPan:t=null,isRotate:n=null,isZoom:r=null,panSpeed:i=null,rotateSpeed:h=null,zoomSpeed:p=null}={})=>{o=null!==e?e:o,a=null!==t?t:a,u=null!==n?n:u,l=null!==r?r:l,s=+i>0?i:s,c=+h>0?h:c,f=+p>0?p:f},w.dispose=()=>{w=void 0,window.removeEventListener("keydown",V),window.removeEventListener("keyup",F),e.removeEventListener("mousedown",Y),window.removeEventListener("mouseup",U),window.removeEventListener("mousemove",X),e.removeEventListener("wheel",q)},w.refresh=z,w.tick=()=>{if(o)return!1;if(x=!1,a&&O&&!T&&(w.pan([L(s*(S-M)),B(s*(E-k))]),x=!0),l&&A){const e=f*Math.exp(A/I),t=N(S),n=D(k);w.scale(1/e,[t,n]),x=!0}if(u&&O&&T){const e=_/2,t=I/2,n=M-e,r=t-E,i=S-e,o=t-k,a=function(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],a=n*n+r*r;a>0&&(a=1/Math.sqrt(a));var s=i*i+o*o;s>0&&(s=1/Math.sqrt(s));var u=(n*i+r*o)*a*s;return u>1?0:u<-1?Math.PI:Math.acos(u)}([n,r],[i,o]),s=n*o-i*r;w.rotate(c*a*Math.sign(s)),x=!0}return A=0,M=S,E=k,x},w},_=(()=>{try{return new window.BroadcastChannel("pub-sub-es")}catch(e){return{postMessage:()=>{}}}})(),I=e=>(t,n,r=1/0)=>(e[t]||(e[t]=[],e.__times__[t]=[]),e[t].push(n),e.__times__[t].push(+r||1/0),{event:t,handler:n}),R=e=>(t,n)=>{if("object"==typeof t&&(n=t.handler,t=t.event),!e[t])return;const r=e[t].indexOf(n);-1===r||r>=e[t].length||(e[t].splice(r,1),e.__times__[t].splice(r,1))},T=(e,t)=>(n,r,i)=>{if(!e[n])return;const o=R(e);if(e[n].forEach((t,i)=>{t(r),e.__times__[n][i]--,e.__times__[n][i]<1&&o(n,t)}),t&&!i)try{_.postMessage({event:n,news:r})}catch(e){if(!(e instanceof DOMException))throw e;console.warn(`Could not broadcast '${n}' globally. Payload is not clonable.`)}},L=e=>()=>{Object.keys(e).filter(e=>"_"!==e[0]).forEach(t=>{e[t]=void 0,e.__times__[t]=void 0,delete e[t],delete e.__times__[t]})},B=(e={__times__:{}})=>(e.__times__||(e.__times__={}),{publish:T(e),subscribe:I(e),unsubscribe:R(e),clear:L(e),stack:e}),N={__times__:{}},D={publish:T(N,!0),subscribe:I(N),unsubscribe:R(N),stack:N};_.onmessage=({data:{event:e,news:t}})=>D.publish(e,t,!0);const z=(e,t,n=window.requestAnimationFrame)=>{let r,i=!1;return(...o)=>{if(r=o,!i)return i=!0,n(()=>{const n=e(...r);i=!1,t&&t(n)})}};var F,V,U,Y,X,q,H,G,$,W,K,Z,Q,J,ee,te=s((function(e,t){e.exports=function(){function e(e,r,i,o,a){!function e(n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,c=Math.log(s),l=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*l*(s-l)/s)*(u-s/2<0?-1:1);e(n,r,Math.max(i,Math.floor(r-u*l/s+f)),Math.min(o,Math.floor(r+(s-u)*l/s+f)),a)}var h=n[r],p=i,d=o;for(t(n,i,r),a(n[o],h)>0&&t(n,i,o);p<d;){for(t(n,p,d),p++,d--;a(n[p],h)<0;)p++;for(;a(n[d],h)>0;)d--}0===a(n[i],h)?t(n,i,d):t(n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}(e,r,i||0,o||e.length-1,a||n)}function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function o(e,t){a(e,0,e.children.length,t,e)}function a(e,t,n,r,i){i||(i=d(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=t;o<n;o++){var a=e.children[o];s(i,e.leaf?r(a):a)}return i}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function u(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function l(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function h(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function d(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,n,r,i,o){for(var a=[n,r];a.length;)if(!((r=a.pop())-(n=a.pop())<=i)){var s=n+Math.ceil((r-n)/i/2)*i;e(t,s,n,r,o),a.push(n,s,s,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,n=[];if(!p(e,t))return n;for(var r=this.toBBox,i=[];t;){for(var o=0;o<t.children.length;o++){var a=t.children[o],s=t.leaf?r(a):a;p(e,s)&&(t.leaf?n.push(a):h(e,s)?this._all(a,n):i.push(a))}t=i.pop()}return n},r.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.children.length;r++){var i=t.children[r],o=t.leaf?this.toBBox(i):i;if(p(e,o)){if(t.leaf||h(e,o))return!0;n.push(i)}}t=n.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=d([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var n,r,o,a=this.data,s=this.toBBox(e),u=[],c=[];a||u.length;){if(a||(a=u.pop(),r=u[u.length-1],n=c.pop(),o=!0),a.leaf){var l=i(e,a.children,t);if(-1!==l)return a.children.splice(l,1),u.push(a),this._condense(u),this}o||a.leaf||!h(a,s)?r?(n++,a=r.children[n],o=!1):a=null:(u.push(a),c.push(n),n=0,r=a,a=a.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},r.prototype._build=function(e,t,n,r){var i,a=n-t+1,s=this._maxEntries;if(a<=s)return o(i=d(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),(i=d([])).leaf=!1,i.height=r;var u=Math.ceil(a/s),c=u*Math.ceil(Math.sqrt(s));g(e,t,n,c,this.compareMinX);for(var l=t;l<=n;l+=c){var f=Math.min(l+c-1,n);g(e,l,f,u,this.compareMinY);for(var h=l;h<=f;h+=u){var p=Math.min(h+u-1,f);i.children.push(this._build(e,h,p,r-1))}}return o(i,this.toBBox),i},r.prototype._chooseSubtree=function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var i=1/0,o=1/0,a=void 0,s=0;s<t.children.length;s++){var u=t.children[s],c=l(u),f=(h=e,p=u,(Math.max(p.maxX,h.maxX)-Math.min(p.minX,h.minX))*(Math.max(p.maxY,h.maxY)-Math.min(p.minY,h.minY))-c);f<o?(o=f,i=c<i?c:i,a=u):f===o&&c<i&&(i=c,a=u)}t=a||t.children[0]}var h,p;return t},r.prototype._insert=function(e,t,n){var r=n?e:this.toBBox(e),i=[],o=this._chooseSubtree(r,this.data,t,i);for(o.children.push(e),s(o,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)},r.prototype._split=function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var a=this._chooseSplitIndex(n,i,r),s=d(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,o(n,this.toBBox),o(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)},r.prototype._splitRoot=function(e,t){this.data=d([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,n){for(var r,i,o,s,u,c,f,h=1/0,p=1/0,d=t;d<=n-t;d++){var g=a(e,0,d,this.toBBox),m=a(e,d,n,this.toBBox),v=(i=g,o=m,s=Math.max(i.minX,o.minX),u=Math.max(i.minY,o.minY),c=Math.min(i.maxX,o.maxX),f=Math.min(i.maxY,o.maxY),Math.max(0,c-s)*Math.max(0,f-u)),y=l(g)+l(m);v<h?(h=v,r=d,p=y<p?y:p):v===h&&y<p&&(p=y,r=d)}return r||n-t},r.prototype._chooseSplitAxis=function(e,t,n){var r=e.leaf?this.compareMinX:u,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,n,r){e.children.sort(r);for(var i=this.toBBox,o=a(e,0,t,i),u=a(e,n-t,n,i),c=f(o)+f(u),l=t;l<n-t;l++){var h=e.children[l];s(o,e.leaf?i(h):h),c+=f(o)}for(var p=n-t-1;p>=t;p--){var d=e.children[p];s(u,e.leaf?i(d):d),c+=f(u)}return c},r.prototype._adjustParentBBoxes=function(e,t,n){for(var r=n;r>=0;r--)s(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},r}()})),ne=!1;function re(){if(!ne){ne=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),n=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(Z=/\b(iPhone|iP[ao]d)/.exec(e),Q=/\b(iP[ao]d)/.exec(e),W=/Android/i.exec(e),J=/FBAN\/\w+;/i.exec(e),ee=/Mobile/i.exec(e),K=!!/Win64/.exec(e),t){(F=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN)&&document&&document.documentMode&&(F=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(e);q=r?parseFloat(r[1])+4:F,V=t[2]?parseFloat(t[2]):NaN,U=t[3]?parseFloat(t[3]):NaN,(Y=t[4]?parseFloat(t[4]):NaN)?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),X=t&&t[1]?parseFloat(t[1]):NaN):X=NaN}else F=V=U=X=Y=NaN;if(n){if(n[1]){var i=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);H=!i||parseFloat(i[1].replace("_","."))}else H=!1;G=!!n[2],$=!!n[3]}else H=G=$=!1}}var ie,oe={ie:function(){return re()||F},ieCompatibilityMode:function(){return re()||q>F},ie64:function(){return oe.ie()&&K},firefox:function(){return re()||V},opera:function(){return re()||U},webkit:function(){return re()||Y},safari:function(){return oe.webkit()},chrome:function(){return re()||X},windows:function(){return re()||G},osx:function(){return re()||H},linux:function(){return re()||$},iphone:function(){return re()||Z},mobile:function(){return re()||Z||Q||W||ee},nativeApp:function(){return re()||J},android:function(){return re()||W},ipad:function(){return re()||Q}},ae=oe,se=!("undefined"==typeof window||!window.document||!window.document.createElement),ue={canUseDOM:se,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:se&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:se&&!!window.screen,isInWorker:!se};ue.canUseDOM&&(ie=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("",""))
/**
   * Checks if an event is supported in the current execution environment.
   *
   * NOTE: This will not work correctly for non-generic events such as `change`,
   * `reset`, `load`, `error`, and `select`.
   *
   * Borrows from Modernizr.
   *
   * @param {string} eventNameSuffix Event name, e.g. "click".
   * @param {?boolean} capture Check if the capture phase is supported.
   * @return {boolean} True if the event is supported.
   * @internal
   * @license Modernizr 3.0.0pre (Custom Build) | MIT
   */;var ce=function(e,t){if(!ue.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,r=n in document;if(!r){var i=document.createElement("div");i.setAttribute(n,"return;"),r="function"==typeof i[n]}return!r&&ie&&"wheel"===e&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r};function le(e){var t=0,n=0,r=0,i=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=10*t,i=10*n,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||i)&&e.deltaMode&&(1==e.deltaMode?(r*=40,i*=40):(r*=800,i*=800)),r&&!t&&(t=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:i}}le.getEventType=function(){return ae.firefox()?"DOMMouseScroll":ce("wheel")?"wheel":"mousewheel"};var fe=le,he="BATCHING_REDUCER.BATCH";function pe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he;return{type:t,meta:{batch:!0},payload:e}}const de=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,ge=e=>--e*e*e+1,me=(e,t,n)=>e*(1-(n=Math.min(1,Math.max(0,n))))+t*n,ve=(e,t,n)=>e.map((e,r)=>me(e,t[r],n)),ye=e=>e,be=(e,t,n=6)=>Math.abs(e-t)<10**-n,we=(e,t=ye)=>{const n=new Set,r=[];for(let i=0;i<e.length;i++){const o=t(e[i]);n.has(o)||(n.add(o),r.push(o))}return r},xe=Array.isArray,Se=e=>!!(e&&e.constructor&&e.call&&e.apply),ke=e=>!!e&&e.constructor===Object,Me=e=>Math.sqrt(e.reduce((e,t)=>e+t**2,0)),Ee=e=>e.reduce((e,t)=>t>e?t:e,-1/0),Oe=e=>{switch(e.length){case 0:return[];case 1:return e[0];default:return e.reduce((e,t)=>t.map((t,n)=>e[n]>t?e[n]:t),new Array(e[0].length).fill(-1/0))}},Ae=e=>Te(e)/e.length,Pe=e=>{switch(e.length){case 0:return[];case 1:return e[0];default:return e.reduce((t,n)=>n.map((n,r)=>t[r]+n/e.length),new Array(e[0].length).fill(0))}},je=e=>e[Math.floor(e.length/2)],Ce=je,_e=e=>e.reduce((e,t)=>t<e?t:e,1/0),Ie=e=>{switch(e.length){case 0:return[];case 1:return e[0];default:return e.reduce((e,t)=>t.map((t,n)=>e[n]<t?e[n]:t),new Array(e[0].length).fill(1/0))}},Re=e=>{const t=Me(e);return e.map(e=>e/t)},Te=e=>e.reduce((e,t)=>t?e+t:e,0),Le=e=>{switch(e.length){case 0:return[];case 1:return e[0];default:return e.reduce((e,t)=>t.map((t,n)=>e[n]+t),new Array(e[0].length).fill(0))}},Be="http://www.w3.org/2000/svg",Ne=(e,t)=>{if(e.namespaceURI===Be){if(!ze(e,t)){const n=e.getAttribute("class")||"";e.setAttribute("class",`${n} ${t}`)}}else e.classList?e.classList.add(t):ze(e,t)||(e.className+=" "+t)},De=e=>{const t=document.createElement("div");return t.insertAdjacentHTML("beforeend",e),t.firstChild},ze=(e,t)=>{if(e.namespaceURI===Be){const n=e.getAttribute("class");return n&&!!n.match(new RegExp(`(\\s|^)${t}(\\s|$)`))}return e.classList?e.classList.contains(t):!!e.className.match(new RegExp(`(\\s|^)${t}(\\s|$)`))},Fe=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},Ve=e=>{e.removeChild(e.lastChild)},Ue=(e,t)=>{const n=new RegExp(`(\\s|^)${t}(\\s|$)`);if(e.namespaceURI===Be){const t=e.getAttribute("class")||"";e.setAttribute("class",t.replace(n," "))}else e.classList?e.classList.remove(t):ze(e,t)&&(e.className=e.className.replace(n," "))},Ye=(e,...t)=>(t.forEach(t=>{const n=Object.keys(t).reduce((e,n)=>(e[n]=Object.getOwnPropertyDescriptor(t,n),e),{});Object.getOwnPropertySymbols(t).forEach(e=>{const r=Object.getOwnPropertyDescriptor(t,e);r.enumerable&&(n[e]=r)}),Object.defineProperties(e,n)}),e),Xe=e=>qe(void 0,e),qe=(e,t)=>{if(null===t||"object"!=typeof t)return t;if(t.constructor!==Object&&t.constructor!==Array)return t;if(t.constructor===Date||t.constructor===RegExp||t.constructor===Function||t.constructor===String||t.constructor===Number||t.constructor===Boolean)return new t.constructor(t);const n=e||new t.constructor;return Object.keys(t).forEach(e=>{const r=Object.getOwnPropertyDescriptor(t,e);void 0===n[e]&&(void 0===r.value?Object.defineProperty(n,e,r):n[e]=qe(void 0,t[e]))}),n},He=(e,t)=>{if(null===t||"object"!=typeof t)return t;if(t.constructor!==Object&&t.constructor!==Array)return new t.constructor(t);const n=new e.constructor;let r=!1;return Object.keys(t).forEach(i=>{const o=Object.getOwnPropertyDescriptor(t,i);void 0===e[i]?void 0===o.value?Object.defineProperty(n,i,o):n[i]=qe(void 0,t[i]):n[i]=He(e[i],t[i]),r=r||n[i]!==e[i]}),r=r||Object.keys(e).filter(e=>void 0===t[e]).length,r?n:e},Ge=e=>e.split(/(?=[A-Z])/).join("_").toUpperCase(),$e=e=>`${e[0].toUpperCase()}${e.substr(1)}`,We=e=>t=>Array.prototype.forEach.call(t,e),Ke=(...e)=>t=>e.reduce((e,t)=>t(e),t),Ze=e=>t=>Ye({__proto__:{constructor:e}},t),Qe=(e,t)=>n=>Ye(n,{[e](...e){return t.apply(this,e)}}),Je=(e,{initialValue:t,getter:n,setter:r,cloner:i=ye,transformer:o=ye,validator:a=(()=>!0)}={})=>s=>{let u=t;const c=n?()=>n():()=>i(u),l=r?e=>r(e):e=>{const t=o(e);u=a(t)?t:u};return Ye(s,{get[e](){return c()},["set"+$e(e)](e){l(e)}})},et=(e,t)=>n=>Ye(n,{get[e](){return t()}}),tt=(e,t)=>n=>Ye(n,{get[e](){return t}}),nt=(e,t,n,r)=>Math.abs(e-n)+Math.abs(t-r),rt=(e,t,n,r)=>Math.sqrt((e-n)**2+(t-r)**2),it=([e,t]=[],n=[])=>{let r,i,o,a,s=!1;for(let u=0,c=n.length-2;u<n.length;u+=2)r=n[u],i=n[u+1],o=n[c],a=n[c+1],i>t!=a>t&&e<(o-r)*(t-i)/(a-i)+r&&(s=!s),c=u;return s},ot=(e,t)=>new Map(function*(){yield*e,yield*t}()),at=e=>new Worker(window.URL.createObjectURL(new Blob([`(${e.toString()})()`],{type:"text/javascript"}))),st=()=>{},ut=(e,t)=>e-t,ct=(e,t)=>t-e,lt=(e,{getter:t=ye,comparator:n=ut,ignoreNull:r=!1}={})=>Object.entries(e).map(r?([e,n])=>null===t(n)?void 0:[e,t(n)]:([e,n])=>[e,t(n)]).sort((e,t)=>n(e[1],t[1])).reduce((e,t,n)=>t?(e[t[0]]=n,e):e,new e.constructor),ft=(e,t)=>{let n;const r=(...r)=>{clearTimeout(n),n=setTimeout(()=>{n=null,e(...r)},t)};return r.cancel=()=>{clearTimeout(n)},r.now=(...t)=>e(...t),r},ht=(e=1)=>new Promise(t=>{let n=0;const r=()=>requestAnimationFrame(()=>{n++,n<e?r():t()});r()}),pt=(e,t,n=null)=>{let r,i=0;n=null===n?t:n;const o=(...t)=>{clearTimeout(r),r=setTimeout(()=>{i>0&&(e(...t),i=0)},n)};let a=!1;const s=(...n)=>{a?(i++,o(...n)):(e(...n),o(...n),a=!0,i=0,setTimeout(()=>{a=!1},t))};return s.reset=()=>{a=!1},s.cancel=()=>{clearTimeout(r)},s.now=(...t)=>e(...t),s},dt=e=>new Promise(t=>setTimeout(t,e));var gt=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,r=t,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;e[t]=r<<i&255}}(gt);var mt=function(e){return!(e&e-1||!e)},vt=function(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1},yt=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1};var bt=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t},wt=function(e){return null!=e&&(xt(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&xt(e.slice(0,0))}(e)||!!e._isBuffer)};
/*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   */function xt(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var St="undefined"!=typeof Float64Array;function kt(e,t){return e[0]-t[0]}function Mt(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(kt);var r=new Array(n.length);for(e=0;e<r.length;++e)r[e]=n[e][1];return r}function Et(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var r="generic"===e;if(-1===t){var i="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(i)()}if(0===t){i="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",i)(Ot[e][0])}i=["'use strict'"];var o=bt(t),a=o.map((function(e){return"i"+e})),s="this.offset+"+o.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),u=o.map((function(e){return"b"+e})).join(","),c=o.map((function(e){return"c"+e})).join(",");i.push("function "+n+"(a,"+u+","+c+",d){this.data=a","this.shape=["+u+"]","this.stride=["+c+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+o.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+n+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+n+"_set("+a.join(",")+",v){"),r?i.push("return this.data.set("+s+",v)}"):i.push("return this.data["+s+"]=v}"),i.push("proto.get=function "+n+"_get("+a.join(",")+"){"),r?i.push("return this.data.get("+s+")}"):i.push("return this.data["+s+"]}"),i.push("proto.index=function "+n+"_index(",a.join(),"){return "+s+"}"),i.push("proto.hi=function "+n+"_hi("+a.join(",")+"){return new "+n+"(this.data,"+o.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+o.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var l=o.map((function(e){return"a"+e+"=this.shape["+e+"]"})),f=o.map((function(e){return"c"+e+"=this.stride["+e+"]"}));i.push("proto.lo=function "+n+"_lo("+a.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+f.join(","));for(var h=0;h<t;++h)i.push("if(typeof i"+h+"==='number'&&i"+h+">=0){d=i"+h+"|0;b+=c"+h+"*d;a"+h+"-=d}");i.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"c"+e})).join(",")+",b)}"),i.push("proto.step=function "+n+"_step("+a.join(",")+"){var "+o.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+o.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(h=0;h<t;++h)i.push("if(typeof i"+h+"==='number'){d=i"+h+"|0;if(d<0){c+=b"+h+"*(a"+h+"-1);a"+h+"=ceil(-a"+h+"/d)}else{a"+h+"=ceil(a"+h+"/d)}b"+h+"*=d}");i.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"b"+e})).join(",")+",c)}");var p=new Array(t),d=new Array(t);for(h=0;h<t;++h)p[h]="a[i"+h+"]",d[h]="b[i"+h+"]";i.push("proto.transpose=function "+n+"_transpose("+a+"){"+a.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+p.join(",")+","+d.join(",")+",this.offset)}"),i.push("proto.pick=function "+n+"_pick("+a+"){var a=[],b=[],c=this.offset");for(h=0;h<t;++h)i.push("if(typeof i"+h+"==='number'&&i"+h+">=0){c=(c+this.stride["+h+"]*i"+h+")|0}else{a.push(this.shape["+h+"]);b.push(this.stride["+h+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+o.map((function(e){return"shape["+e+"]"})).join(",")+","+o.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(Ot[e],Mt)}var Ot={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};var At=function(e,t,n,r){if(void 0===e)return(0,Ot.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var i=t.length;if(void 0===n){n=new Array(i);for(var o=i-1,a=1;o>=0;--o)n[o]=a,a*=t[o]}if(void 0===r){r=0;for(o=0;o<i;++o)n[o]<0&&(r-=(t[o]-1)*n[o])}for(var s=function(e){if(wt(e))return"buffer";if(St)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),u=Ot[s];u.length<=i+1;)u.push(Et(s,u.length-1));return(0,u[i+1])(e,t,n,r)};var Pt=function(e,t,n){return 0===e.length?e:t?(n||e.sort(t),function(e,t){for(var n=1,r=e.length,i=e[0],o=e[0],a=1;a<r;++a)if(o=i,t(i=e[a],o)){if(a===n){n++;continue}e[n++]=i}return e.length=n,e}(e,t)):(n||e.sort(),function(e){for(var t=1,n=e.length,r=e[0],i=e[0],o=1;o<n;++o,i=r)if(i=r,(r=e[o])!==i){if(o===t){t++;continue}e[t++]=r}return e.length=t,e}(e))};function jt(e,t,n){var r,i,o=e.length,a=t.arrayArgs.length,s=t.indexArgs.length>0,u=[],c=[],l=0,f=0;for(r=0;r<o;++r)c.push(["i",r,"=0"].join(""));for(i=0;i<a;++i)for(r=0;r<o;++r)f=l,l=e[r],0===r?c.push(["d",i,"s",r,"=t",i,"p",l].join("")):c.push(["d",i,"s",r,"=(t",i,"p",l,"-s",f,"*t",i,"p",f,")"].join(""));for(c.length>0&&u.push("var "+c.join(",")),r=o-1;r>=0;--r)l=e[r],u.push(["for(i",r,"=0;i",r,"<s",l,";++i",r,"){"].join(""));for(u.push(n),r=0;r<o;++r){for(f=l,l=e[r],i=0;i<a;++i)u.push(["p",i,"+=d",i,"s",r].join(""));s&&(r>0&&u.push(["index[",f,"]-=s",f].join("")),u.push(["++index[",l,"]"].join(""))),u.push("}")}return u.join("\n")}function Ct(e,t,n){for(var r=e.body,i=[],o=[],a=0;a<e.args.length;++a){var s=e.args[a];if(!(s.count<=0)){var u=new RegExp(s.name,"g"),c="",l=t.arrayArgs.indexOf(a);switch(t.argTypes[a]){case"offset":var f=t.offsetArgIndex.indexOf(a);l=t.offsetArgs[f].array,c="+q"+f;case"array":c="p"+l+c;var h="l"+a,p="a"+l;if(0===t.arrayBlockIndices[l])1===s.count?"generic"===n[l]?s.lvalue?(i.push(["var ",h,"=",p,".get(",c,")"].join("")),r=r.replace(u,h),o.push([p,".set(",c,",",h,")"].join(""))):r=r.replace(u,[p,".get(",c,")"].join("")):r=r.replace(u,[p,"[",c,"]"].join("")):"generic"===n[l]?(i.push(["var ",h,"=",p,".get(",c,")"].join("")),r=r.replace(u,h),s.lvalue&&o.push([p,".set(",c,",",h,")"].join(""))):(i.push(["var ",h,"=",p,"[",c,"]"].join("")),r=r.replace(u,h),s.lvalue&&o.push([p,"[",c,"]=",h].join("")));else{for(var d=[s.name],g=[c],m=0;m<Math.abs(t.arrayBlockIndices[l]);m++)d.push("\\s*\\[([^\\]]+)\\]"),g.push("$"+(m+1)+"*t"+l+"b"+m);if(u=new RegExp(d.join(""),"g"),c=g.join("+"),"generic"===n[l])throw new Error("cwise: Generic arrays not supported in combination with blocks!");r=r.replace(u,[p,"[",c,"]"].join(""))}break;case"scalar":r=r.replace(u,"Y"+t.scalarArgs.indexOf(a));break;case"index":r=r.replace(u,"index");break;case"shape":r=r.replace(u,"shape")}}}return[i.join("\n"),r,o.join("\n")].join("\n").trim()}function _t(e){for(var t=new Array(e.length),n=!0,r=0;r<e.length;++r){var i=e[r],o=i.match(/\d+/);o=o?o[0]:"",0===i.charAt(0)?t[r]="u"+i.charAt(1)+o:t[r]=i.charAt(0)+o,r>0&&(n=n&&t[r]===t[r-1])}return n?t[0]:t.join("")}var It=function(e,t){for(var n=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,r=new Array(e.arrayArgs.length),i=new Array(e.arrayArgs.length),o=0;o<e.arrayArgs.length;++o)i[o]=t[2*o],r[o]=t[2*o+1];var a=[],s=[],u=[],c=[],l=[];for(o=0;o<e.arrayArgs.length;++o){e.arrayBlockIndices[o]<0?(u.push(0),c.push(n),a.push(n),s.push(n+e.arrayBlockIndices[o])):(u.push(e.arrayBlockIndices[o]),c.push(e.arrayBlockIndices[o]+n),a.push(0),s.push(e.arrayBlockIndices[o]));for(var f=[],h=0;h<r[o].length;h++)u[o]<=r[o][h]&&r[o][h]<c[o]&&f.push(r[o][h]-u[o]);l.push(f)}var p=["SS"],d=["'use strict'"],g=[];for(h=0;h<n;++h)g.push(["s",h,"=SS[",h,"]"].join(""));for(o=0;o<e.arrayArgs.length;++o){p.push("a"+o),p.push("t"+o),p.push("p"+o);for(h=0;h<n;++h)g.push(["t",o,"p",h,"=t",o,"[",u[o]+h,"]"].join(""));for(h=0;h<Math.abs(e.arrayBlockIndices[o]);++h)g.push(["t",o,"b",h,"=t",o,"[",a[o]+h,"]"].join(""))}for(o=0;o<e.scalarArgs.length;++o)p.push("Y"+o);if(e.shapeArgs.length>0&&g.push("shape=SS.slice(0)"),e.indexArgs.length>0){var m=new Array(n);for(o=0;o<n;++o)m[o]="0";g.push(["index=[",m.join(","),"]"].join(""))}for(o=0;o<e.offsetArgs.length;++o){var v=e.offsetArgs[o],y=[];for(h=0;h<v.offset.length;++h)0!==v.offset[h]&&(1===v.offset[h]?y.push(["t",v.array,"p",h].join("")):y.push([v.offset[h],"*t",v.array,"p",h].join("")));0===y.length?g.push("q"+o+"=0"):g.push(["q",o,"=",y.join("+")].join(""))}var b=Pt([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((g=g.concat(b)).length>0&&d.push("var "+g.join(",")),o=0;o<e.arrayArgs.length;++o)d.push("p"+o+"|=0");e.pre.body.length>3&&d.push(Ct(e.pre,e,i));var w=Ct(e.body,e,i),x=function(e){for(var t=0,n=e[0].length;t<n;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}(l);x<n?d.push(function(e,t,n,r){for(var i=t.length,o=n.arrayArgs.length,a=n.blockSize,s=n.indexArgs.length>0,u=[],c=0;c<o;++c)u.push(["var offset",c,"=p",c].join(""));for(c=e;c<i;++c)u.push(["for(var j"+c+"=SS[",t[c],"]|0;j",c,">0;){"].join("")),u.push(["if(j",c,"<",a,"){"].join("")),u.push(["s",t[c],"=j",c].join("")),u.push(["j",c,"=0"].join("")),u.push(["}else{s",t[c],"=",a].join("")),u.push(["j",c,"-=",a,"}"].join("")),s&&u.push(["index[",t[c],"]=j",c].join(""));for(c=0;c<o;++c){for(var l=["offset"+c],f=e;f<i;++f)l.push(["j",f,"*t",c,"p",t[f]].join(""));u.push(["p",c,"=(",l.join("+"),")"].join(""))}for(u.push(jt(t,n,r)),c=e;c<i;++c)u.push("}");return u.join("\n")}(x,l[0],e,w)):d.push(jt(l[0],e,w)),e.post.body.length>3&&d.push(Ct(e.post,e,i)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+d.join("\n")+"\n----------");var S=[e.funcName||"unnamed","_cwise_loop_",r[0].join("s"),"m",x,_t(i)].join("");return new Function(["function ",S,"(",p.join(","),"){",d.join("\n"),"} return ",S].join(""))()};var Rt=function(e){var t=["'use strict'","var CACHED={}"],n=[],r=e.funcName+"_cwise_thunk";t.push(["return function ",r,"(",e.shimArgs.join(","),"){"].join(""));for(var i=[],o=[],a=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],s=[],u=[],c=0;c<e.arrayArgs.length;++c){var l=e.arrayArgs[c];n.push(["t",l,"=array",l,".dtype,","r",l,"=array",l,".order"].join("")),i.push("t"+l),i.push("r"+l),o.push("t"+l),o.push("r"+l+".join()"),a.push("array"+l+".data"),a.push("array"+l+".stride"),a.push("array"+l+".offset|0"),c>0&&(s.push("array"+e.arrayArgs[0]+".shape.length===array"+l+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[c]))),u.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+l+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[c])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+s.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),c=0;c<e.scalarArgs.length;++c)a.push("scalar"+e.scalarArgs[c]);return n.push(["type=[",o.join(","),"].join()"].join("")),n.push("proc=CACHED[type]"),t.push("var "+n.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",a.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(It.bind(void 0,e))};function Tt(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}var Lt=function(e){var t=new Tt;t.pre=e.pre,t.body=e.body,t.post=e.post;var n=e.args.slice(0);t.argTypes=n;for(var r=0;r<n.length;++r){var i=n[r];if("array"===i||"object"==typeof i&&i.blockIndices){if(t.argTypes[r]="array",t.arrayArgs.push(r),t.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),t.shimArgs.push("array"+r),r<t.pre.args.length&&t.pre.args[r].count>0)throw new Error("cwise: pre() block may not reference array args");if(r<t.post.args.length&&t.post.args[r].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)t.scalarArgs.push(r),t.shimArgs.push("scalar"+r);else if("index"===i){if(t.indexArgs.push(r),r<t.pre.args.length&&t.pre.args[r].count>0)throw new Error("cwise: pre() block may not reference array index");if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error("cwise: body() block may not write to array index");if(r<t.post.args.length&&t.post.args[r].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(t.shapeArgs.push(r),r<t.pre.args.length&&t.pre.args[r].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error("cwise: body() block may not write to array shape");if(r<t.post.args.length&&t.post.args[r].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+n[r]);t.argTypes[r]="offset",t.offsetArgs.push({array:i.array,offset:i.offset}),t.offsetArgIndex.push(r)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>n.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>n.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>n.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,Rt(t)},Bt=s((function(e,t){var n={body:"",args:[],thisVars:[],localVars:[]};function r(e){if(!e)return n;for(var t=0;t<e.args.length;++t){var r=e.args[t];e.args[t]=0===t?{name:r,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function i(e){for(var t=[],n=0;n<e.args.length;++n)t.push("a"+n);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return Lt({args:e.args,pre:r(e.pre),body:r(e.body),post:r(e.proc),funcName:e.funcName})}(e))}var o={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in o){var n=o[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a"+n+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a"+n+"=s"},rvalue:!0,funcName:e+"seq"})}}();var a={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in a){var n=a[e];t[e]=i({args:["array","array"],body:{args:["a","b"],body:"a="+n+"b"},funcName:e}),t[e+"eq"]=i({args:["array"],body:{args:["a"],body:"a="+n+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var s={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in s){var n=s[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a=a"+n+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+n+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<u.length;++e){var n=u[e];t[n]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:n}),t[n+"eq"]=i({args:["array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"})}}();var c=["max","min","atan2","pow"];!function(){for(var e=0;e<c.length;++e){var n=c[e];t[n]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n}),t[n+"s"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n+"s"}),t[n+"eq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"}),t[n+"seq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"seq"})}}();var l=["atan2","pow"];!function(){for(var e=0;e<l.length;++e){var n=l[e];t[n+"op"]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"op"}),t[n+"ops"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"ops"}),t[n+"opeq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opeq"}),t[n+"opseq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opseq"})}}(),t.any=Lt({args:["array"],pre:n,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=Lt({args:["array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=Lt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=Lt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=Lt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=Lt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=Lt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=Lt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=Lt({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=Lt({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=Lt({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=Lt({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=i({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=i({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=i({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=Lt({args:["array","array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})})),Nt=s((function(e,t){!function(e){var t,n,r,i,o,a,s,u,c,l,f,h,p,d,g,m,v,y;function b(e,t){if(!e)throw new Error("ASSERT: "+t)}function w(e){return e>=48&&e<=57}function x(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function S(e){return"01234567".indexOf(e)>=0}function k(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function M(e){return 10===e||13===e||8232===e||8233===e}function E(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&s.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function O(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&s.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function A(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function P(e){return"eval"===e||"arguments"===e}function j(e,t,n,r,i){var o;b("number"==typeof n,"Comment must have valid position"),v.lastCommentStart>=n||(v.lastCommentStart=n,o={type:e,value:t},y.range&&(o.range=[n,r]),y.loc&&(o.loc=i),y.comments.push(o),y.attachComment&&(y.leadingComments.push(o),y.trailingComments.push(o)))}function C(e){var t,n,r,i;for(t=f-e,n={start:{line:h,column:f-p-e}};f<d;)if(r=c.charCodeAt(f),++f,M(r))return y.comments&&(i=c.slice(t+e,f-1),n.end={line:h,column:f-p-1},j("Line",i,t,f-1,n)),13===r&&10===c.charCodeAt(f)&&++f,++h,void(p=f);y.comments&&(i=c.slice(t+e,f),n.end={line:h,column:f-p},j("Line",i,t,f,n))}function _(){var e,t,n,r;for(y.comments&&(e=f-2,t={start:{line:h,column:f-p-2}});f<d;)if(M(n=c.charCodeAt(f)))13===n&&10===c.charCodeAt(f+1)&&++f,++h,++f,p=f,f>=d&&G({},a.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===c.charCodeAt(f+1))return++f,++f,void(y.comments&&(r=c.slice(e+2,f-2),t.end={line:h,column:f-p},j("Block",r,e,f,t)));++f}else++f;G({},a.UnexpectedToken,"ILLEGAL")}function I(){var e,t;for(t=0===f;f<d;)if(k(e=c.charCodeAt(f)))++f;else if(M(e))++f,13===e&&10===c.charCodeAt(f)&&++f,++h,p=f,t=!0;else if(47===e)if(47===(e=c.charCodeAt(f+1)))++f,++f,C(2),t=!0;else{if(42!==e)break;++f,++f,_()}else if(t&&45===e){if(45!==c.charCodeAt(f+1)||62!==c.charCodeAt(f+2))break;f+=3,C(3)}else{if(60!==e)break;if("!--"!==c.slice(f+1,f+4))break;++f,++f,++f,++f,C(4)}}function R(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t){if(!(f<d&&x(c[f])))return"";r=c[f++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())}return String.fromCharCode(i)}function T(){var e,t;for(e=c.charCodeAt(f++),t=String.fromCharCode(e),92===e&&(117!==c.charCodeAt(f)&&G({},a.UnexpectedToken,"ILLEGAL"),++f,(e=R("u"))&&"\\"!==e&&E(e.charCodeAt(0))||G({},a.UnexpectedToken,"ILLEGAL"),t=e);f<d&&O(e=c.charCodeAt(f));)++f,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==c.charCodeAt(f)&&G({},a.UnexpectedToken,"ILLEGAL"),++f,(e=R("u"))&&"\\"!==e&&O(e.charCodeAt(0))||G({},a.UnexpectedToken,"ILLEGAL"),t+=e);return t}function L(){var e,n;return e=f,{type:1===(n=92===c.charCodeAt(f)?T():function(){var e,t;for(e=f++;f<d;){if(92===(t=c.charCodeAt(f)))return f=e,T();if(!O(t))break;++f}return c.slice(e,f)}()).length?t.Identifier:function(e){if(l&&A(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}(n)?t.Keyword:"null"===n?t.NullLiteral:"true"===n||"false"===n?t.BooleanLiteral:t.Identifier,value:n,lineNumber:h,lineStart:p,start:e,end:f}}function B(){var e,n,r,i,o=f,s=c.charCodeAt(f),u=c[f];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++f,y.tokenize&&(40===s?y.openParenToken=y.tokens.length:123===s&&(y.openCurlyToken=y.tokens.length)),{type:t.Punctuator,value:String.fromCharCode(s),lineNumber:h,lineStart:p,start:o,end:f};default:if(61===(e=c.charCodeAt(f+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return f+=2,{type:t.Punctuator,value:String.fromCharCode(s)+String.fromCharCode(e),lineNumber:h,lineStart:p,start:o,end:f};case 33:case 61:return f+=2,61===c.charCodeAt(f)&&++f,{type:t.Punctuator,value:c.slice(o,f),lineNumber:h,lineStart:p,start:o,end:f}}}return">>>="===(i=c.substr(f,4))?{type:t.Punctuator,value:i,lineNumber:h,lineStart:p,start:o,end:f+=4}:">>>"===(r=i.substr(0,3))||"<<="===r||">>="===r?{type:t.Punctuator,value:r,lineNumber:h,lineStart:p,start:o,end:f+=3}:u===(n=r.substr(0,2))[1]&&"+-<>&|".indexOf(u)>=0||"=>"===n?{type:t.Punctuator,value:n,lineNumber:h,lineStart:p,start:o,end:f+=2}:"<>=!+-*%&|^/".indexOf(u)>=0?(++f,{type:t.Punctuator,value:u,lineNumber:h,lineStart:p,start:o,end:f}):void G({},a.UnexpectedToken,"ILLEGAL")}function N(){var e,n,r;if(b(w((r=c[f]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),n=f,e="","."!==r){if(e=c[f++],r=c[f],"0"===e){if("x"===r||"X"===r)return++f,function(e){for(var n="";f<d&&x(c[f]);)n+=c[f++];return 0===n.length&&G({},a.UnexpectedToken,"ILLEGAL"),E(c.charCodeAt(f))&&G({},a.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt("0x"+n,16),lineNumber:h,lineStart:p,start:e,end:f}}(n);if(S(r)&&function(){var e,t;for(e=f+1;e<d;++e){if("8"===(t=c[e])||"9"===t)return!1;if(!S(t))return!0}return!0}())return function(e){for(var n="0"+c[f++];f<d&&S(c[f]);)n+=c[f++];return(E(c.charCodeAt(f))||w(c.charCodeAt(f)))&&G({},a.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:h,lineStart:p,start:e,end:f}}(n)}for(;w(c.charCodeAt(f));)e+=c[f++];r=c[f]}if("."===r){for(e+=c[f++];w(c.charCodeAt(f));)e+=c[f++];r=c[f]}if("e"===r||"E"===r)if(e+=c[f++],"+"!==(r=c[f])&&"-"!==r||(e+=c[f++]),w(c.charCodeAt(f)))for(;w(c.charCodeAt(f));)e+=c[f++];else G({},a.UnexpectedToken,"ILLEGAL");return E(c.charCodeAt(f))&&G({},a.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseFloat(e),lineNumber:h,lineStart:p,start:n,end:f}}function D(){var e,n,r,i;return m=null,I(),e=f,n=function(){var e,t,n,r;for(b("/"===(e=c[f]),"Regular expression literal must start with a slash"),t=c[f++],n=!1,r=!1;f<d;)if(t+=e=c[f++],"\\"===e)M((e=c[f++]).charCodeAt(0))&&G({},a.UnterminatedRegExp),t+=e;else if(M(e.charCodeAt(0)))G({},a.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||G({},a.UnterminatedRegExp),{value:t.substr(1,t.length-2),literal:t}}(),r=function(){var e,t,n,r;for(t="",n="";f<d&&O((e=c[f]).charCodeAt(0));)if(++f,"\\"===e&&f<d)if("u"===(e=c[f])){if(r=++f,e=R("u"))for(n+=e,t+="\\u";r<f;++r)t+=c[r];else f=r,n+="u",t+="\\u";$({},a.UnexpectedToken,"ILLEGAL")}else t+="\\",$({},a.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}(),i=function(e,t){var n;try{n=new RegExp(e,t)}catch(e){G({},a.InvalidRegExp)}return n}(n.value,r.value),y.tokenize?{type:t.RegularExpression,value:i,lineNumber:h,lineStart:p,start:e,end:f}:{literal:n.literal+r.literal,value:i,start:e,end:f}}function z(){var e,t,n,r;return I(),e=f,t={start:{line:h,column:f-p}},n=D(),t.end={line:h,column:f-p},y.tokenize||(y.tokens.length>0&&(r=y.tokens[y.tokens.length-1]).range[0]===e&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||y.tokens.pop()),y.tokens.push({type:"RegularExpression",value:n.literal,range:[e,f],loc:t})),n}function F(){var e;return I(),f>=d?{type:t.EOF,lineNumber:h,lineStart:p,start:f,end:f}:E(e=c.charCodeAt(f))?L():40===e||41===e||59===e?B():39===e||34===e?function(){var e,n,r,i,o,s,u,l,g="",m=!1;for(u=h,l=p,b("'"===(e=c[f])||'"'===e,"String literal must starts with a quote"),n=f,++f;f<d;){if((r=c[f++])===e){e="";break}if("\\"===r)if((r=c[f++])&&M(r.charCodeAt(0)))++h,"\r"===r&&"\n"===c[f]&&++f,p=f;else switch(r){case"u":case"x":s=f,(o=R(r))?g+=o:(f=s,g+=r);break;case"n":g+="\n";break;case"r":g+="\r";break;case"t":g+="\t";break;case"b":g+="\b";break;case"f":g+="\f";break;case"v":g+="\v";break;default:S(r)?(0!==(i="01234567".indexOf(r))&&(m=!0),f<d&&S(c[f])&&(m=!0,i=8*i+"01234567".indexOf(c[f++]),"0123".indexOf(r)>=0&&f<d&&S(c[f])&&(i=8*i+"01234567".indexOf(c[f++]))),g+=String.fromCharCode(i)):g+=r}else{if(M(r.charCodeAt(0)))break;g+=r}}return""!==e&&G({},a.UnexpectedToken,"ILLEGAL"),{type:t.StringLiteral,value:g,octal:m,startLineNumber:u,startLineStart:l,lineNumber:h,lineStart:p,start:n,end:f}}():46===e?w(c.charCodeAt(f+1))?N():B():w(e)?N():y.tokenize&&47===e?function(){var e,t;if(!(e=y.tokens[y.tokens.length-1]))return z();if("Punctuator"===e.type){if("]"===e.value)return B();if(")"===e.value)return!(t=y.tokens[y.openParenToken-1])||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?B():z();if("}"===e.value){if(y.tokens[y.openCurlyToken-3]&&"Keyword"===y.tokens[y.openCurlyToken-3].type){if(!(t=y.tokens[y.openCurlyToken-4]))return B()}else{if(!y.tokens[y.openCurlyToken-4]||"Keyword"!==y.tokens[y.openCurlyToken-4].type)return B();if(!(t=y.tokens[y.openCurlyToken-5]))return z()}return r.indexOf(t.value)>=0?B():z()}return z()}return"Keyword"===e.type&&"this"!==e.value?z():B()}():B()}function V(){var e,r,i;return I(),e={start:{line:h,column:f-p}},r=F(),e.end={line:h,column:f-p},r.type!==t.EOF&&(i=c.slice(r.start,r.end),y.tokens.push({type:n[r.type],value:i,range:[r.start,r.end],loc:e})),r}function U(){var e;return f=(e=m).end,h=e.lineNumber,p=e.lineStart,m=void 0!==y.tokens?V():F(),f=e.end,h=e.lineNumber,p=e.lineStart,e}function Y(){var e,t,n;e=f,t=h,n=p,m=void 0!==y.tokens?V():F(),f=e,h=t,p=n}function X(e,t){this.line=e,this.column=t}function q(e,t,n,r){this.start=new X(e,t),this.end=new X(n,r)}function H(){var e,t,n,r;return e=f,t=h,n=p,I(),r=h!==t,f=e,h=t,p=n,r}function G(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(function(e,t){return b(t<r.length,"Message reference must be in range"),r[t]}));throw"number"==typeof e.lineNumber?((n=new Error("Line "+e.lineNumber+": "+i)).index=e.start,n.lineNumber=e.lineNumber,n.column=e.start-p+1):((n=new Error("Line "+h+": "+i)).index=f,n.lineNumber=h,n.column=f-p+1),n.description=i,n}function $(){try{G.apply(null,arguments)}catch(e){if(!y.errors)throw e;y.errors.push(e)}}function W(e){if(e.type===t.EOF&&G(e,a.UnexpectedEOS),e.type===t.NumericLiteral&&G(e,a.UnexpectedNumber),e.type===t.StringLiteral&&G(e,a.UnexpectedString),e.type===t.Identifier&&G(e,a.UnexpectedIdentifier),e.type===t.Keyword){if(function(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}(e.value))G(e,a.UnexpectedReserved);else if(l&&A(e.value))return void $(e,a.StrictReservedWord);G(e,a.UnexpectedToken,e.value)}G(e,a.UnexpectedToken,e.value)}function K(e){var n=U();n.type===t.Punctuator&&n.value===e||W(n)}function Z(e){var n=U();n.type===t.Keyword&&n.value===e||W(n)}function Q(e){return m.type===t.Punctuator&&m.value===e}function J(e){return m.type===t.Keyword&&m.value===e}function ee(){var e,n=f,r=h,i=p,o=m;if(59===c.charCodeAt(f)||Q(";"))U();else{if(e=h,I(),h!==e)return f=n,h=r,p=i,void(m=o);m.type===t.EOF||Q("}")||W(m)}}function te(e){return e.type===i.Identifier||e.type===i.MemberExpression}function ne(e,t){var n,r,i;return n=l,i=m,r=Ee(),t&&l&&P(e[0].name)&&$(t,a.StrictParamName),l=n,g.markEnd(g.createFunctionExpression(null,e,[],r),i)}function re(){var e,n;return n=m,(e=U()).type===t.StringLiteral||e.type===t.NumericLiteral?(l&&e.octal&&$(e,a.StrictOctalLiteral),g.markEnd(g.createLiteral(e),n)):g.markEnd(g.createIdentifier(e.value),n)}function ie(){var e,n,r,i,o,s;return s=m,(e=m).type===t.Identifier?(r=re(),"get"!==e.value||Q(":")?"set"!==e.value||Q(":")?(K(":"),i=ge(),g.markEnd(g.createProperty("init",r,i),s)):(n=re(),K("("),(e=m).type!==t.Identifier?(K(")"),$(e,a.UnexpectedToken,e.value),i=ne([])):(o=[ye()],K(")"),i=ne(o,e)),g.markEnd(g.createProperty("set",n,i),s)):(n=re(),K("("),K(")"),i=ne([]),g.markEnd(g.createProperty("get",n,i),s))):e.type!==t.EOF&&e.type!==t.Punctuator?(n=re(),K(":"),i=ge(),g.markEnd(g.createProperty("init",n,i),s)):void W(e)}function oe(){var e,n,r,s;if(Q("("))return function(){var e;return K("("),e=me(),K(")"),e}();if(Q("["))return function(){var e,t=[];for(e=m,K("[");!Q("]");)Q(",")?(U(),t.push(null)):(t.push(ge()),Q("]")||K(","));return U(),g.markEnd(g.createArrayExpression(t),e)}();if(Q("{"))return function(){var e,t,n,r,s,u=[],c={},f=String;for(s=m,K("{");!Q("}");)t=(e=ie()).key.type===i.Identifier?e.key.name:f(e.key.value),r="init"===e.kind?o.Data:"get"===e.kind?o.Get:o.Set,n="$"+t,Object.prototype.hasOwnProperty.call(c,n)?(c[n]===o.Data?l&&r===o.Data?$({},a.StrictDuplicateProperty):r!==o.Data&&$({},a.AccessorDataProperty):r===o.Data?$({},a.AccessorDataProperty):c[n]&r&&$({},a.AccessorGetSet),c[n]|=r):c[n]=r,u.push(e),Q("}")||K(",");return K("}"),g.markEnd(g.createObjectExpression(u),s)}();if(e=m.type,s=m,e===t.Identifier)r=g.createIdentifier(U().value);else if(e===t.StringLiteral||e===t.NumericLiteral)l&&m.octal&&$(m,a.StrictOctalLiteral),r=g.createLiteral(U());else if(e===t.Keyword){if(J("function"))return function(){var e,t,n,r,i,o,s,u,c,f=null;return c=m,Z("function"),Q("(")||(e=m,f=ye(),l?P(e.value)&&$(e,a.StrictFunctionName):P(e.value)?(n=e,r=a.StrictFunctionName):A(e.value)&&(n=e,r=a.StrictReservedWord)),i=Oe(n),o=i.params,t=i.stricted,n=i.firstRestricted,i.message&&(r=i.message),u=l,s=Ee(),l&&n&&G(n,r),l&&t&&$(t,r),l=u,g.markEnd(g.createFunctionExpression(f,o,[],s),c)}();J("this")?(U(),r=g.createThisExpression()):W(U())}else e===t.BooleanLiteral?((n=U()).value="true"===n.value,r=g.createLiteral(n)):e===t.NullLiteral?((n=U()).value=null,r=g.createLiteral(n)):Q("/")||Q("/=")?(r=void 0!==y.tokens?g.createLiteral(z()):g.createLiteral(D()),Y()):W(U());return g.markEnd(r,s)}function ae(){var e=[];if(K("("),!Q(")"))for(;f<d&&(e.push(ge()),!Q(")"));)K(",");return K(")"),e}function se(){var e,n;return n=m,function(e){return e.type===t.Identifier||e.type===t.Keyword||e.type===t.BooleanLiteral||e.type===t.NullLiteral}(e=U())||W(e),g.markEnd(g.createIdentifier(e.value),n)}function ue(){return K("."),se()}function ce(){var e;return K("["),e=me(),K("]"),e}function le(){var e,t,n;return n=m,Z("new"),e=function(){var e,t,n;for(b(v.allowIn,"callee of new expression always allow in keyword."),n=m,e=J("new")?le():oe();Q(".")||Q("[");)Q("[")?(t=ce(),e=g.createMemberExpression("[",e,t)):(t=ue(),e=g.createMemberExpression(".",e,t)),g.markEnd(e,n);return e}(),t=Q("(")?ae():[],g.markEnd(g.createNewExpression(e,t),n)}function fe(){var e,n,r=m;return e=function(){var e,t,n,r,i=v.allowIn;for(r=m,v.allowIn=!0,e=J("new")?le():oe();;){if(Q("."))n=ue(),e=g.createMemberExpression(".",e,n);else if(Q("("))t=ae(),e=g.createCallExpression(e,t);else{if(!Q("["))break;n=ce(),e=g.createMemberExpression("[",e,n)}g.markEnd(e,r)}return v.allowIn=i,e}(),m.type===t.Punctuator&&(!Q("++")&&!Q("--")||H()||(l&&e.type===i.Identifier&&P(e.name)&&$({},a.StrictLHSPostfix),te(e)||$({},a.InvalidLHSInAssignment),n=U(),e=g.markEnd(g.createPostfixExpression(n.value,e),r))),e}function he(){var e,n,r;return m.type!==t.Punctuator&&m.type!==t.Keyword?n=fe():Q("++")||Q("--")?(r=m,e=U(),n=he(),l&&n.type===i.Identifier&&P(n.name)&&$({},a.StrictLHSPrefix),te(n)||$({},a.InvalidLHSInAssignment),n=g.createUnaryExpression(e.value,n),n=g.markEnd(n,r)):Q("+")||Q("-")||Q("~")||Q("!")?(r=m,e=U(),n=he(),n=g.createUnaryExpression(e.value,n),n=g.markEnd(n,r)):J("delete")||J("void")||J("typeof")?(r=m,e=U(),n=he(),n=g.createUnaryExpression(e.value,n),n=g.markEnd(n,r),l&&"delete"===n.operator&&n.argument.type===i.Identifier&&$({},a.StrictDelete)):n=fe(),n}function pe(e,n){var r=0;if(e.type!==t.Punctuator&&e.type!==t.Keyword)return 0;switch(e.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=n?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function de(){var e,t,n,r,i;return i=m,e=function(){var e,t,n,r,i,o,a,s,u,c;if(e=m,u=he(),0===(i=pe(r=m,v.allowIn)))return u;for(r.prec=i,U(),t=[e,m],o=[u,r,a=he()];(i=pe(m,v.allowIn))>0;){for(;o.length>2&&i<=o[o.length-2].prec;)a=o.pop(),s=o.pop().value,u=o.pop(),n=g.createBinaryExpression(s,u,a),t.pop(),e=t[t.length-1],g.markEnd(n,e),o.push(n);(r=U()).prec=i,o.push(r),t.push(m),n=he(),o.push(n)}for(n=o[c=o.length-1],t.pop();c>1;)n=g.createBinaryExpression(o[c-1].value,o[c-2],n),c-=2,e=t.pop(),g.markEnd(n,e);return n}(),Q("?")&&(U(),t=v.allowIn,v.allowIn=!0,n=ge(),v.allowIn=t,K(":"),r=ge(),e=g.createConditionalExpression(e,n,r),g.markEnd(e,i)),e}function ge(){var e,n,r,o,s,u;return e=m,s=m,o=n=de(),m.type!==t.Punctuator||"="!==(u=m.value)&&"*="!==u&&"/="!==u&&"%="!==u&&"+="!==u&&"-="!==u&&"<<="!==u&&">>="!==u&&">>>="!==u&&"&="!==u&&"^="!==u&&"|="!==u||(te(n)||$({},a.InvalidLHSInAssignment),l&&n.type===i.Identifier&&P(n.name)&&$(e,a.StrictLHSAssignment),e=U(),r=ge(),o=g.markEnd(g.createAssignmentExpression(e.value,n,r),s)),o}function me(){var e,t=m;if(e=ge(),Q(",")){for(e=g.createSequenceExpression([e]);f<d&&Q(",");)U(),e.expressions.push(ge());g.markEnd(e,t)}return e}function ve(){var e,t;return t=m,K("{"),e=function(){for(var e,t=[];f<d&&!Q("}")&&void 0!==(e=Pe());)t.push(e);return t}(),K("}"),g.markEnd(g.createBlockStatement(e),t)}function ye(){var e,n;return n=m,(e=U()).type!==t.Identifier&&W(e),g.markEnd(g.createIdentifier(e.value),n)}function be(e){var t,n,r=null;return n=m,t=ye(),l&&P(t.name)&&$({},a.StrictVarName),"const"===e?(K("="),r=ge()):Q("=")&&(U(),r=ge()),g.markEnd(g.createVariableDeclarator(t,r),n)}function we(e){var t=[];do{if(t.push(be(e)),!Q(","))break;U()}while(f<d);return t}function xe(){var e,t,n,r,i,o,s,u,c,l,f=v.allowIn;return e=t=n=null,Z("for"),K("("),Q(";")?U():(J("var")||J("let")?(v.allowIn=!1,l=m,u=U(),c=we(),e=g.markEnd(g.createVariableDeclaration(c,u.value),l),v.allowIn=f,1===e.declarations.length&&J("in")&&(U(),r=e,i=me(),e=null)):(v.allowIn=!1,e=me(),v.allowIn=f,J("in")&&(te(e)||$({},a.InvalidLHSInForIn),U(),r=e,i=me(),e=null)),void 0===r&&K(";")),void 0===r&&(Q(";")||(t=me()),K(";"),Q(")")||(n=me())),K(")"),s=v.inIteration,v.inIteration=!0,o=Me(),v.inIteration=s,void 0===r?g.createForStatement(e,t,n,o):g.createForInStatement(r,i,o)}function Se(){var e,t,n,r=[];for(n=m,J("default")?(U(),e=null):(Z("case"),e=me()),K(":");f<d&&!(Q("}")||J("default")||J("case"));)t=Me(),r.push(t);return g.markEnd(g.createSwitchCase(e,r),n)}function ke(){var e,t,n,r,i=[],o=null;return Z("try"),e=ve(),J("catch")&&i.push((r=m,Z("catch"),K("("),Q(")")&&W(m),t=ye(),l&&P(t.name)&&$({},a.StrictCatchVariable),K(")"),n=ve(),g.markEnd(g.createCatchClause(t,n),r))),J("finally")&&(U(),o=ve()),0!==i.length||o||G({},a.NoCatchOrFinally),g.createTryStatement(e,[],i,o)}function Me(){var e,n,r,o,s,u,h,p,y,b=m.type;if(b===t.EOF&&W(m),b===t.Punctuator&&"{"===m.value)return ve();if(o=m,b===t.Punctuator)switch(m.value){case";":return g.markEnd((K(";"),g.createEmptyStatement()),o);case"(":return g.markEnd(function(){var e=me();return ee(),g.createExpressionStatement(e)}(),o)}if(b===t.Keyword)switch(m.value){case"break":return g.markEnd(function(){var e,n=null;return Z("break"),59===c.charCodeAt(f)?(U(),v.inIteration||v.inSwitch||G({},a.IllegalBreak),g.createBreakStatement(null)):H()?(v.inIteration||v.inSwitch||G({},a.IllegalBreak),g.createBreakStatement(null)):(m.type===t.Identifier&&(e="$"+(n=ye()).name,Object.prototype.hasOwnProperty.call(v.labelSet,e)||G({},a.UnknownLabel,n.name)),ee(),null!==n||v.inIteration||v.inSwitch||G({},a.IllegalBreak),g.createBreakStatement(n))}(),o);case"continue":return g.markEnd(function(){var e,n=null;return Z("continue"),59===c.charCodeAt(f)?(U(),v.inIteration||G({},a.IllegalContinue),g.createContinueStatement(null)):H()?(v.inIteration||G({},a.IllegalContinue),g.createContinueStatement(null)):(m.type===t.Identifier&&(e="$"+(n=ye()).name,Object.prototype.hasOwnProperty.call(v.labelSet,e)||G({},a.UnknownLabel,n.name)),ee(),null!==n||v.inIteration||G({},a.IllegalContinue),g.createContinueStatement(n))}(),o);case"debugger":return g.markEnd((Z("debugger"),ee(),g.createDebuggerStatement()),o);case"do":return g.markEnd((Z("do"),y=v.inIteration,v.inIteration=!0,h=Me(),v.inIteration=y,Z("while"),K("("),p=me(),K(")"),Q(";")&&U(),g.createDoWhileStatement(h,p)),o);case"for":return g.markEnd(xe(),o);case"function":return g.markEnd(Ae(),o);case"if":return g.markEnd(function(){var e,t,n;return Z("if"),K("("),e=me(),K(")"),t=Me(),J("else")?(U(),n=Me()):n=null,g.createIfStatement(e,t,n)}(),o);case"return":return g.markEnd((u=null,Z("return"),v.inFunctionBody||$({},a.IllegalReturn),32===c.charCodeAt(f)&&E(c.charCodeAt(f+1))?(u=me(),ee(),g.createReturnStatement(u)):H()?g.createReturnStatement(null):(Q(";")||Q("}")||m.type===t.EOF||(u=me()),ee(),g.createReturnStatement(u))),o);case"switch":return g.markEnd(function(){var e,t,n,r,i;if(Z("switch"),K("("),e=me(),K(")"),K("{"),t=[],Q("}"))return U(),g.createSwitchStatement(e,t);for(r=v.inSwitch,v.inSwitch=!0,i=!1;f<d&&!Q("}");)null===(n=Se()).test&&(i&&G({},a.MultipleDefaultsInSwitch),i=!0),t.push(n);return v.inSwitch=r,K("}"),g.createSwitchStatement(e,t)}(),o);case"throw":return g.markEnd(function(){var e;return Z("throw"),H()&&G({},a.NewlineAfterThrow),e=me(),ee(),g.createThrowStatement(e)}(),o);case"try":return g.markEnd(ke(),o);case"var":return g.markEnd((Z("var"),s=we(),ee(),g.createVariableDeclaration(s,"var")),o);case"while":return g.markEnd(function(){var e,t,n;return Z("while"),K("("),e=me(),K(")"),n=v.inIteration,v.inIteration=!0,t=Me(),v.inIteration=n,g.createWhileStatement(e,t)}(),o);case"with":return g.markEnd(function(){var e,t;return l&&(I(),$({},a.StrictModeWith)),Z("with"),K("("),e=me(),K(")"),t=Me(),g.createWithStatement(e,t)}(),o)}return(e=me()).type===i.Identifier&&Q(":")?(U(),r="$"+e.name,Object.prototype.hasOwnProperty.call(v.labelSet,r)&&G({},a.Redeclaration,"Label",e.name),v.labelSet[r]=!0,n=Me(),delete v.labelSet[r],g.markEnd(g.createLabeledStatement(e,n),o)):(ee(),g.markEnd(g.createExpressionStatement(e),o))}function Ee(){var e,n,r,o,s,u,h,p,y=[];for(p=m,K("{");f<d&&m.type===t.StringLiteral&&(n=m,e=Pe(),y.push(e),e.expression.type===i.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(l=!0,r&&$(r,a.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(o=v.labelSet,s=v.inIteration,u=v.inSwitch,h=v.inFunctionBody,v.labelSet={},v.inIteration=!1,v.inSwitch=!1,v.inFunctionBody=!0;f<d&&!Q("}")&&void 0!==(e=Pe());)y.push(e);return K("}"),v.labelSet=o,v.inIteration=s,v.inSwitch=u,v.inFunctionBody=h,g.markEnd(g.createBlockStatement(y),p)}function Oe(e){var t,n,r,i,o,s,u=[];if(K("("),!Q(")"))for(i={};f<d&&(n=m,t=ye(),o="$"+n.value,l?(P(n.value)&&(r=n,s=a.StrictParamName),Object.prototype.hasOwnProperty.call(i,o)&&(r=n,s=a.StrictParamDupe)):e||(P(n.value)?(e=n,s=a.StrictParamName):A(n.value)?(e=n,s=a.StrictReservedWord):Object.prototype.hasOwnProperty.call(i,o)&&(e=n,s=a.StrictParamDupe)),u.push(t),i[o]=!0,!Q(")"));)K(",");return K(")"),{params:u,stricted:r,firstRestricted:e,message:s}}function Ae(){var e,t,n,r,i,o,s,u,c,f;return f=m,Z("function"),r=m,e=ye(),l?P(r.value)&&$(r,a.StrictFunctionName):P(r.value)?(s=r,u=a.StrictFunctionName):A(r.value)&&(s=r,u=a.StrictReservedWord),t=(o=Oe(s)).params,i=o.stricted,s=o.firstRestricted,o.message&&(u=o.message),c=l,n=Ee(),l&&s&&G(s,u),l&&i&&$(i,u),l=c,g.markEnd(g.createFunctionDeclaration(e,t,[],n),f)}function Pe(){if(m.type===t.Keyword)switch(m.value){case"const":case"let":return e=m.value,r=m,Z(e),n=we(e),ee(),g.markEnd(g.createVariableDeclaration(n,e),r);case"function":return Ae();default:return Me()}var e,n,r;if(m.type!==t.EOF)return Me()}function je(){var e,n;return I(),Y(),n=m,l=!1,e=function(){for(var e,n,r,o=[];f<d&&(n=m).type===t.StringLiteral&&(e=Pe(),o.push(e),e.expression.type===i.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(l=!0,r&&$(r,a.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(;f<d&&void 0!==(e=Pe());)o.push(e);return o}(),g.markEnd(g.createProgram(e),n)}function Ce(){var e,t,n,r=[];for(e=0;e<y.tokens.length;++e)n={type:(t=y.tokens[e]).type,value:t.value},y.range&&(n.range=t.range),y.loc&&(n.loc=t.loc),r.push(n);y.tokens=r}(n={})[(t={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).BooleanLiteral]="Boolean",n[t.EOF]="<end>",n[t.Identifier]="Identifier",n[t.Keyword]="Keyword",n[t.NullLiteral]="Null",n[t.NumericLiteral]="Numeric",n[t.Punctuator]="Punctuator",n[t.StringLiteral]="String",n[t.RegularExpression]="RegularExpression",r=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],i={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},o={Data:1,Get:2,Set:4},a={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},s={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")},u={name:"SyntaxTree",processComment:function(e){var t,n;if(!(e.type===i.Program&&e.body.length>0)){for(y.trailingComments.length>0?y.trailingComments[0].range[0]>=e.range[1]?(n=y.trailingComments,y.trailingComments=[]):y.trailingComments.length=0:y.bottomRightStack.length>0&&y.bottomRightStack[y.bottomRightStack.length-1].trailingComments&&y.bottomRightStack[y.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(n=y.bottomRightStack[y.bottomRightStack.length-1].trailingComments,delete y.bottomRightStack[y.bottomRightStack.length-1].trailingComments);y.bottomRightStack.length>0&&y.bottomRightStack[y.bottomRightStack.length-1].range[0]>=e.range[0];)t=y.bottomRightStack.pop();t?t.leadingComments&&t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=t.leadingComments,delete t.leadingComments):y.leadingComments.length>0&&y.leadingComments[y.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=y.leadingComments,y.leadingComments=[]),n&&(e.trailingComments=n),y.bottomRightStack.push(e)}},markEnd:function(e,t){return y.range&&(e.range=[t.start,f]),y.loc&&(e.loc=new q(void 0===t.startLineNumber?t.lineNumber:t.startLineNumber,t.start-(void 0===t.startLineStart?t.lineStart:t.startLineStart),h,f-p),this.postProcess(e)),y.attachComment&&this.processComment(e),e},postProcess:function(e){return y.source&&(e.loc.source=y.source),e},createArrayExpression:function(e){return{type:i.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,n){return{type:i.AssignmentExpression,operator:e,left:t,right:n}},createBinaryExpression:function(e,t,n){return{type:"||"===e||"&&"===e?i.LogicalExpression:i.BinaryExpression,operator:e,left:t,right:n}},createBlockStatement:function(e){return{type:i.BlockStatement,body:e}},createBreakStatement:function(e){return{type:i.BreakStatement,label:e}},createCallExpression:function(e,t){return{type:i.CallExpression,callee:e,arguments:t}},createCatchClause:function(e,t){return{type:i.CatchClause,param:e,body:t}},createConditionalExpression:function(e,t,n){return{type:i.ConditionalExpression,test:e,consequent:t,alternate:n}},createContinueStatement:function(e){return{type:i.ContinueStatement,label:e}},createDebuggerStatement:function(){return{type:i.DebuggerStatement}},createDoWhileStatement:function(e,t){return{type:i.DoWhileStatement,body:e,test:t}},createEmptyStatement:function(){return{type:i.EmptyStatement}},createExpressionStatement:function(e){return{type:i.ExpressionStatement,expression:e}},createForStatement:function(e,t,n,r){return{type:i.ForStatement,init:e,test:t,update:n,body:r}},createForInStatement:function(e,t,n){return{type:i.ForInStatement,left:e,right:t,body:n,each:!1}},createFunctionDeclaration:function(e,t,n,r){return{type:i.FunctionDeclaration,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(e,t,n,r){return{type:i.FunctionExpression,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:i.Identifier,name:e}},createIfStatement:function(e,t,n){return{type:i.IfStatement,test:e,consequent:t,alternate:n}},createLabeledStatement:function(e,t){return{type:i.LabeledStatement,label:e,body:t}},createLiteral:function(e){return{type:i.Literal,value:e.value,raw:c.slice(e.start,e.end)}},createMemberExpression:function(e,t,n){return{type:i.MemberExpression,computed:"["===e,object:t,property:n}},createNewExpression:function(e,t){return{type:i.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:i.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:i.UpdateExpression,operator:e,argument:t,prefix:!1}},createProgram:function(e){return{type:i.Program,body:e}},createProperty:function(e,t,n){return{type:i.Property,key:t,value:n,kind:e}},createReturnStatement:function(e){return{type:i.ReturnStatement,argument:e}},createSequenceExpression:function(e){return{type:i.SequenceExpression,expressions:e}},createSwitchCase:function(e,t){return{type:i.SwitchCase,test:e,consequent:t}},createSwitchStatement:function(e,t){return{type:i.SwitchStatement,discriminant:e,cases:t}},createThisExpression:function(){return{type:i.ThisExpression}},createThrowStatement:function(e){return{type:i.ThrowStatement,argument:e}},createTryStatement:function(e,t,n,r){return{type:i.TryStatement,block:e,guardedHandlers:t,handlers:n,finalizer:r}},createUnaryExpression:function(e,t){return"++"===e||"--"===e?{type:i.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:i.UnaryExpression,operator:e,argument:t,prefix:!0}},createVariableDeclaration:function(e,t){return{type:i.VariableDeclaration,declarations:e,kind:t}},createVariableDeclarator:function(e,t){return{type:i.VariableDeclarator,id:e,init:t}},createWhileStatement:function(e,t){return{type:i.WhileStatement,test:e,body:t}},createWithStatement:function(e,t){return{type:i.WithStatement,object:e,body:t}}},e.version="1.2.5",e.tokenize=function(e,n){var r;"string"==typeof e||e instanceof String||(e=String(e)),g=u,f=0,h=(c=e).length>0?1:0,p=0,d=c.length,m=null,v={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},y={},(n=n||{}).tokens=!0,y.tokens=[],y.tokenize=!0,y.openParenToken=-1,y.openCurlyToken=-1,y.range="boolean"==typeof n.range&&n.range,y.loc="boolean"==typeof n.loc&&n.loc,"boolean"==typeof n.comment&&n.comment&&(y.comments=[]),"boolean"==typeof n.tolerant&&n.tolerant&&(y.errors=[]);try{if(Y(),m.type===t.EOF)return y.tokens;for(U();m.type!==t.EOF;)try{U()}catch(e){if(y.errors){y.errors.push(e);break}throw e}Ce(),r=y.tokens,void 0!==y.comments&&(r.comments=y.comments),void 0!==y.errors&&(r.errors=y.errors)}catch(e){throw e}finally{y={}}return r},e.parse=function(e,t){var n,r;r=String,"string"==typeof e||e instanceof String||(e=r(e)),g=u,f=0,h=(c=e).length>0?1:0,p=0,d=c.length,m=null,v={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},y={},void 0!==t&&(y.range="boolean"==typeof t.range&&t.range,y.loc="boolean"==typeof t.loc&&t.loc,y.attachComment="boolean"==typeof t.attachComment&&t.attachComment,y.loc&&null!==t.source&&void 0!==t.source&&(y.source=r(t.source)),"boolean"==typeof t.tokens&&t.tokens&&(y.tokens=[]),"boolean"==typeof t.comment&&t.comment&&(y.comments=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(y.errors=[]),y.attachComment&&(y.range=!0,y.comments=[],y.bottomRightStack=[],y.trailingComments=[],y.leadingComments=[]));try{n=je(),void 0!==y.comments&&(n.comments=y.comments),void 0!==y.tokens&&(Ce(),n.tokens=y.tokens),void 0!==y.errors&&(n.errors=y.errors)}catch(e){throw e}finally{y={}}return n},e.Syntax=function(){var e,t={};for(e in"function"==typeof Object.create&&(t=Object.create(null)),i)i.hasOwnProperty(e)&&(t[e]=i[e]);return"function"==typeof Object.freeze&&Object.freeze(t),t}()}(t)})),Dt=0;function zt(e,t,n){this.name=e,this.lvalue=t,this.rvalue=n,this.count=0}function Ft(e,t,n,r){this.body=e,this.args=t,this.thisVars=n,this.localVars=r}var Vt=function(e){for(var t=["(",e,")()"].join(""),n=Nt.parse(t,{range:!0}),r="_inline_"+Dt+++"_",i=function(e){for(var t=e.body[0].expression.callee.params,n=new Array(t.length),r=0;r<t.length;++r)n[r]=t[r].name;return n}(n),a=new Array(i.length),s=0;s<i.length;++s)a[s]=new zt([r,"arg",s,"_"].join(""),!1,!1);for(var u=new Array(t.length),c=(s=0,t.length);s<c;++s)u[s]=t.charAt(s);var l,f=[],h=[];function p(e,t){for(var n=e.range[0],r=e.range[1],i=n+1;i<r;++i)u[i]="";u[n]=t}return function e(t,n){if(t.parent=n,"MemberExpression"===t.type)t.computed?(e(t.object,t),e(t.property,t)):"ThisExpression"===t.object.type?p(t,(b=t.property.name,w="this_"+b.replace(/\_/g,"__"),h.push(w),w)):e(t.object,t);else{if("ThisExpression"===t.type)throw new Error("cwise-parser: Computed this is not allowed");if("Identifier"===t.type){var s=t.name,u=i.indexOf(s);if(u>=0){var c=a[u],l=function(e){return"AssignmentExpression"===e.parent.type&&e.parent.left===e?"="===e.parent.operator?1:3:"UpdateExpression"===e.parent.type?3:2}(t);1&l&&(c.lvalue=!0),2&l&&(c.rvalue=!0),++c.count,p(t,c.name)}else(function(e){if("eval"===e)throw new Error("cwise-parser: eval() not allowed");return"undefined"!=typeof window?e in window:void 0!==o?e in o:"undefined"!=typeof self&&e in self})(s)||p(t,function(e){var t=r+e.replace(/\_/g,"__");return f.push(t),t}(s))}else if("Literal"===t.type)"string"==typeof t.value&&p(t,"'"+t.value.replace(/\_/g,"\\_").replace(/\'/g,"'")+"'");else{if("WithStatement"===t.type)throw new Error("cwise-parser: with() statements not allowed");for(var d=Object.keys(t),g=0,m=d.length;g<m;++g)if("parent"!==d[g]){var v=t[d[g]];if(v)if(v instanceof Array)for(var y=0;y<v.length;++y)v[y]&&"string"==typeof v[y].type&&e(v[y],t);else"string"==typeof v.type&&e(v,t)}}}var b,w}(n.body[0].expression.callee.body,void 0),Pt(f),Pt(h),new Ft((l=n.body[0].expression.callee.body,u.slice(l.range[0],l.range[1]).join("")),a,h,f)},Ut=["args","body"],Yt=["pre","post","printCode","funcName","blockSize"];var Xt=function(e){for(var t in e)Ut.indexOf(t)<0&&Yt.indexOf(t)<0&&console.warn("cwise: Unknown argument '"+t+"' passed to expression compiler");for(var n=0;n<Ut.length;++n)if(!e[Ut[n]])throw new Error("cwise: Missing argument: "+Ut[n]);return Lt({args:e.args,pre:Vt(e.pre||function(){}),body:Vt(e.body),post:Vt(e.post||function(){}),debug:!!e.printCode,funcName:e.funcName||e.body.name||"cwise",blockSize:e.blockSize||64})};for(var qt={add:function(e,t,n,r,i,o){Bt.add(e,n,i),Bt.add(t,r,o)},addeq:function(e,t,n,r){Bt.addeq(e,n),Bt.addeq(t,r)},adds:function(e,t,n,r,i,o){Bt.adds(e,n,i),Bt.adds(e,r,o)},addseq:function(e,t,n,r){Bt.addseq(e,n),Bt.addseq(t,r)},sub:function(e,t,n,r,i,o){Bt.sub(e,n,i),Bt.sub(t,r,o)},subeq:function(e,t,n,r){Bt.subeq(e,n),Bt.subeq(t,r)},subs:function(e,t,n,r,i,o){Bt.subs(e,n,i),Bt.subs(t,r,o)},subseq:function(e,t,n,r){Bt.subseq(e,n),Bt.subseq(t,r)},neg:function(e,t,n,r){Bt.neg(e,n),Bt.neg(t,r)},negeq:function(e,t){Bt.negeq(e),Bt.negeq(t)},conj:function(e,t,n,r){Bt.assign(e,n),Bt.neg(t,r)},conjeq:function(e,t){Bt.negeq(t)},mul:Xt({args:["array","array","array","array","array","array"],body:function(e,t,n,r,i,o){}}),muleq:Xt({args:["array","array","array","array"],body:function(e,t,n,r){}}),muls:Xt({args:["array","array","array","array","scalar","scalar"],pre:function(e,t,n,r,i,o){this.u=i+o,this.v=o-i},body:function(e,t,n,r,i,o){var a=n,s=i*(a+r);this.u,this.v}}),mulseq:Xt({args:["array","array","scalar","scalar"],pre:function(e,t,n,r){this.u=n+r,this.v=r-n},body:function(e,t,n,r){var i=e,o=n*(i+t);e=o-t*this.u,t=o+i*this.v}}),div:Xt({args:["array","array","array","array","array","array"],body:function(e,t,n,r,i,o){}}),diveq:Xt({args:["array","array","array","array"],body:function(e,t,n,r){}}),divs:Xt({args:["array","array","array","array","scalar","scalar"],pre:function(e,t,n,r,i,o){var a=i*i+o*o;i/=a,o/=-a,this.c=i,this.u=i+o,this.v=o-i},body:function(e,t,n,r,i,o){var a=n,s=r,u=this.c*(a+s);this.u,this.v}}),divseq:Xt({args:["array","array","scalar","scalar"],pre:function(e,t,n,r){var i=n*n+r*r;n/=i,r/=-i,this.c=n,this.u=n+r,this.v=r-n},body:function(e,t,n,r){var i=e,o=t,a=this.c*(i+o);e=a-o*this.u,t=a+i*this.v}}),recip:Xt({args:["array","array","array","array"],body:function(e,t,n,r){}}),recipeq:Xt({args:["array","array"],body:function(e,t){}}),exp:Xt({args:["array","array","array","array"],pre:function(){this.exp=Math.exp,this.cos=Math.cos,this.sin=Math.sin},body:function(e,t,n,r){var i=this.exp(n);this.cos(r),this.sin(r)}}),expeq:Xt({args:["array","array"],pre:function(){this.exp=Math.exp,this.cos=Math.cos,this.sin=Math.sin},body:function(e,t){var n=this.exp(e),r=out_ir;e=n*this.cos(r),this.sin(r)}}),mag:Xt({args:["array","array","array"],body:function(e,t,n){}}),abs:Xt({args:["array","array","array"],pre:function(){this.sqrt=Math.sqrt},body:function(e,t,n){this.sqrt(t*t+n*n)}}),arg:Bt.atan2},Ht=function(e){var t=tn(e),n=t[0],r=t[1];return 3*(n+r)/4-r},Gt=function(e){var t,n,r=tn(e),i=r[0],o=r[1],a=new Zt(function(e,t,n){return 3*(t+n)/4-n}(0,i,o)),s=0,u=o>0?i-4:i;for(n=0;n<u;n+=4)t=Kt[e.charCodeAt(n)]<<18|Kt[e.charCodeAt(n+1)]<<12|Kt[e.charCodeAt(n+2)]<<6|Kt[e.charCodeAt(n+3)],a[s++]=t>>16&255,a[s++]=t>>8&255,a[s++]=255&t;2===o&&(t=Kt[e.charCodeAt(n)]<<2|Kt[e.charCodeAt(n+1)]>>4,a[s++]=255&t);1===o&&(t=Kt[e.charCodeAt(n)]<<10|Kt[e.charCodeAt(n+1)]<<4|Kt[e.charCodeAt(n+2)]>>2,a[s++]=t>>8&255,a[s++]=255&t);return a},$t=function(e){for(var t,n=e.length,r=n%3,i=[],o=0,a=n-r;o<a;o+=16383)i.push(nn(e,o,o+16383>a?a:o+16383));1===r?(t=e[n-1],i.push(Wt[t>>2]+Wt[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(Wt[t>>10]+Wt[t>>4&63]+Wt[t<<2&63]+"="));return i.join("")},Wt=[],Kt=[],Zt="undefined"!=typeof Uint8Array?Uint8Array:Array,Qt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Jt=0,en=Qt.length;Jt<en;++Jt)Wt[Jt]=Qt[Jt],Kt[Qt.charCodeAt(Jt)]=Jt;function tn(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function nn(e,t,n){for(var r,i,o=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(Wt[(i=r)>>18&63]+Wt[i>>12&63]+Wt[i>>6&63]+Wt[63&i]);return o.join("")}Kt["-".charCodeAt(0)]=62,Kt["_".charCodeAt(0)]=63;var rn={byteLength:Ht,toByteArray:Gt,fromByteArray:$t},on=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,f=n?i-1:0,h=n?-1:1,p=e[t+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+f],f+=h,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=c}return(p?-1:1)*a*Math.pow(2,o-r)},an=function(e,t,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[n+p]=255&a,p+=d,a/=256,c-=8);e[n+p-d]|=128*g},sn={}.toString,un=Array.isArray||function(e){return"[object Array]"==sn.call(e)},cn=s((function(e,t){function n(){return i.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function r(e,t){if(n()<t)throw new RangeError("Invalid typed array length");return i.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=i.prototype:(null===e&&(e=new i(t)),e.length=t),e}function i(e,t,n){if(!(i.TYPED_ARRAY_SUPPORT||this instanceof i))return new i(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return a(this,e,t,n)}function a(e,t,n,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);i.TYPED_ARRAY_SUPPORT?(e=t).__proto__=i.prototype:e=c(e,t);return e}(e,t,n,o):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!i.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|f(t,n),a=(e=r(e,o)).write(t,n);a!==o&&(e=e.slice(0,a));return e}(e,t,n):function(e,t){if(i.isBuffer(t)){var n=0|l(t.length);return 0===(e=r(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(o=t.length)!=o?r(e,0):c(e,t);if("Buffer"===t.type&&un(t.data))return c(e,t.data)}var o;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(s(t),e=r(e,t<0?0:0|l(t)),!i.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function c(e,t){var n=t.length<0?0:0|l(t.length);e=r(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function l(e){if(e>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|e}function f(e,t){if(i.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return D(e).length;default:if(r)return N(e).length;t=(""+t).toLowerCase(),r=!0}}function h(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return M(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function p(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function d(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=i.from(t,r)),i.isBuffer(t))return 0===t.length?-1:g(e,t,n,r,o);if("number"==typeof t)return t&=255,i.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):g(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function g(e,t,n,r,i){var o,a=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,n/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(e,o+h)!==c(t,h)){f=!1;break}if(f)return o}return-1}function m(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function v(e,t,n,r){return z(N(t,e.length-n),e,n,r)}function y(e,t,n,r){return z(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n,r){return y(e,t,n,r)}function w(e,t,n,r){return z(D(t),e,n,r)}function x(e,t,n,r){return z(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?rn.fromByteArray(e):rn.fromByteArray(e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,u,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=i,t.SlowBuffer=function(e){+e!=e&&(e=0);return i.alloc(+e)},t.INSPECT_MAX_BYTES=50,i.TYPED_ARRAY_SUPPORT=void 0!==o.TYPED_ARRAY_SUPPORT?o.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=n(),i.poolSize=8192,i._augment=function(e){return e.__proto__=i.prototype,e},i.from=function(e,t,n){return a(null,e,t,n)},i.TYPED_ARRAY_SUPPORT&&(i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0})),i.alloc=function(e,t,n){return function(e,t,n,i){return s(t),t<=0?r(e,t):void 0!==n?"string"==typeof i?r(e,t).fill(n,i):r(e,t).fill(n):r(e,t)}(null,e,t,n)},i.allocUnsafe=function(e){return u(null,e)},i.allocUnsafeSlow=function(e){return u(null,e)},i.isBuffer=function(e){return!(null==e||!e._isBuffer)},i.compare=function(e,t){if(!i.isBuffer(e)||!i.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,o=0,a=Math.min(n,r);o<a;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(e,t){if(!un(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return i.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=i.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var a=e[n];if(!i.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,o),o+=a.length}return r},i.byteLength=f,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},i.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},i.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},i.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?k(this,0,e):h.apply(this,arguments)},i.prototype.equals=function(e){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===i.compare(this,e)},i.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},i.prototype.compare=function(e,t,n,r,o){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(o>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),u=Math.min(a,s),c=this.slice(r,o),l=e.slice(t,n),f=0;f<u;++f)if(c[f]!==l[f]){a=c[f],s=l[f];break}return a<s?-1:s<a?1:0},i.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},i.prototype.indexOf=function(e,t,n){return d(this,e,t,n,!0)},i.prototype.lastIndexOf=function(e,t,n){return d(this,e,t,n,!1)},i.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return m(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":return y(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function M(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function O(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=B(e[o]);return i}function A(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function j(e,t,n,r,o,a){if(!i.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function C(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function _(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function I(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function R(e,t,n,r,i){return i||I(e,0,n,4),an(e,t,n,r,23,4),n+4}function T(e,t,n,r,i){return i||I(e,0,n,8),an(e,t,n,r,52,8),n+8}i.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),i.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=i.prototype;else{var o=t-e;n=new i(o,void 0);for(var a=0;a<o;++a)n[a]=this[a+e]}return n},i.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},i.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},i.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},i.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},i.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},i.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},i.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},i.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},i.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},i.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},i.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},i.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),on(this,e,!0,23,4)},i.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),on(this,e,!1,23,4)},i.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),on(this,e,!0,52,8)},i.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),on(this,e,!1,52,8)},i.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||j(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},i.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||j(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},i.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,1,255,0),i.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},i.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,65535,0),i.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):C(this,e,t,!0),t+2},i.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,65535,0),i.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):C(this,e,t,!1),t+2},i.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,4294967295,0),i.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):_(this,e,t,!0),t+4},i.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,4294967295,0),i.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):_(this,e,t,!1),t+4},i.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);j(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},i.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);j(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},i.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,1,127,-128),i.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},i.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,32767,-32768),i.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):C(this,e,t,!0),t+2},i.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,32767,-32768),i.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):C(this,e,t,!1),t+2},i.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,2147483647,-2147483648),i.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):_(this,e,t,!0),t+4},i.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),i.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):_(this,e,t,!1),t+4},i.prototype.writeFloatLE=function(e,t,n){return R(this,e,t,!0,n)},i.prototype.writeFloatBE=function(e,t,n){return R(this,e,t,!1,n)},i.prototype.writeDoubleLE=function(e,t,n){return T(this,e,t,!0,n)},i.prototype.writeDoubleBE=function(e,t,n){return T(this,e,t,!1,n)},i.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o,a=r-n;if(this===e&&n<t&&t<r)for(o=a-1;o>=0;--o)e[o+t]=this[o+n];else if(a<1e3||!i.TYPED_ARRAY_SUPPORT)for(o=0;o<a;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},i.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!i.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var s=i.isBuffer(e)?e:N(new i(e,r).toString()),u=s.length;for(a=0;a<n-t;++a)this[a+t]=s[a%u]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function N(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function D(e){return rn.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}));var ln=function(e,t){switch(void 0===t&&(t=0),typeof e){case"number":if(e>0)return function(e,t){var n,r;for(n=new Array(e),r=0;r<e;++r)n[r]=t;return n}(0|e,t);break;case"object":if("number"==typeof e.length)return function e(t,n,r){var i=0|t[r];if(i<=0)return[];var o,a=new Array(i);if(r===t.length-1)for(o=0;o<i;++o)a[o]=n;else for(o=0;o<i;++o)a[o]=e(t,n,r+1);return a}(e,t,0)}return[]},fn=s((function(e,t){o.__TYPEDARRAY_POOL||(o.__TYPEDARRAY_POOL={UINT8:ln([32,0]),UINT16:ln([32,0]),UINT32:ln([32,0]),INT8:ln([32,0]),INT16:ln([32,0]),INT32:ln([32,0]),FLOAT:ln([32,0]),DOUBLE:ln([32,0]),DATA:ln([32,0]),UINT8C:ln([32,0]),BUFFER:ln([32,0])});var n="undefined"!=typeof Uint8ClampedArray,r=o.__TYPEDARRAY_POOL;r.UINT8C||(r.UINT8C=ln([32,0])),r.BUFFER||(r.BUFFER=ln([32,0]));var i=r.DATA,a=r.BUFFER;function s(e){if(e){var t=e.length||e.byteLength,n=vt(t);i[n].push(e)}}function u(e){e=yt(e);var t=vt(e),n=i[t];return n.length>0?n.pop():new ArrayBuffer(e)}function c(e){return new Uint8Array(u(e),0,e)}function l(e){return new Uint16Array(u(2*e),0,e)}function f(e){return new Uint32Array(u(4*e),0,e)}function h(e){return new Int8Array(u(e),0,e)}function p(e){return new Int16Array(u(2*e),0,e)}function d(e){return new Int32Array(u(4*e),0,e)}function g(e){return new Float32Array(u(4*e),0,e)}function m(e){return new Float64Array(u(8*e),0,e)}function v(e){return n?new Uint8ClampedArray(u(e),0,e):c(e)}function y(e){return new DataView(u(e),0,e)}function b(e){e=yt(e);var t=vt(e),n=a[t];return n.length>0?n.pop():new cn.Buffer(e)}t.free=function(e){if(cn.Buffer.isBuffer(e))a[vt(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,n=0|vt(t);i[n].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){s(e.buffer)},t.freeArrayBuffer=s,t.freeBuffer=function(e){a[vt(e.length)].push(e)},t.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return u(e);switch(t){case"uint8":return c(e);case"uint16":return l(e);case"uint32":return f(e);case"int8":return h(e);case"int16":return p(e);case"int32":return d(e);case"float":case"float32":return g(e);case"double":case"float64":return m(e);case"uint8_clamped":return v(e);case"buffer":return b(e);case"data":case"dataview":return y(e);default:return null}return null},t.mallocArrayBuffer=u,t.mallocUint8=c,t.mallocUint16=l,t.mallocUint32=f,t.mallocInt8=h,t.mallocInt16=p,t.mallocInt32=d,t.mallocFloat32=t.mallocFloat=g,t.mallocFloat64=t.mallocDouble=m,t.mallocUint8Clamped=v,t.mallocDataView=y,t.mallocBuffer=b,t.clearCache=function(){for(var e=0;e<32;++e)r.UINT8[e].length=0,r.UINT16[e].length=0,r.UINT32[e].length=0,r.INT8[e].length=0,r.INT16[e].length=0,r.INT32[e].length=0,r.FLOAT[e].length=0,r.DOUBLE[e].length=0,r.UINT8C[e].length=0,i[e].length=0,a[e].length=0}}));var hn=function(e,t,n,r,i,o,a){e|=0,t|=0,i|=0,o|=0,mt(n|=0)?dn(e,t,n,r,i,o):function(e,t,n,r,i,o,a){e|=0,t|=0,i|=0,o|=0,a|=0;var s,u,c,l,f,h,p,d,g,m=yt(2*(n|=0)+1),v=a,y=v+n,b=y+n,w=b+m,x=w+m,S=x+m,k=-e*Math.PI/n;for(g=0;g<n;++g)u=k*(g*g%(2*n)),l=Math.cos(u),f=Math.sin(u),r[x+(m-g)]=r[x+g]=r[v+g]=l,r[S+(m-g)]=r[S+g]=r[y+g]=f;for(g=n;g<=m-n;++g)r[x+g]=0;for(g=n;g<=m-n;++g)r[S+g]=0;dn(1,1,m,r,x,S),k=e<0?1/n:1;for(s=0;s<t;++s){for(g=0;g<n;++g)u=r[i+g],c=r[o+g],l=r[v+g],f=-r[y+g],h=l*(u+c),p=u*(f-l),d=c*(l+f),r[b+g]=h-d,r[w+g]=h+p;for(g=n;g<m;++g)r[b+g]=0;for(g=n;g<m;++g)r[w+g]=0;for(dn(1,1,m,r,b,w),g=0;g<m;++g)u=r[b+g],c=r[w+g],l=r[x+g],f=r[S+g],h=l*(u+c),p=u*(f-l),d=c*(l+f),r[b+g]=h-d,r[w+g]=h+p;for(dn(-1,1,m,r,b,w),g=0;g<n;++g)u=r[b+g],c=r[w+g],l=r[v+g],f=-r[y+g],h=l*(u+c),p=u*(f-l),d=c*(l+f),r[i+g]=k*(h-d),r[o+g]=k*(h+p);i+=n,o+=n}}(e,t,n,r,i,o,a)};var pn=function(e){return mt(e)?0:2*e+4*yt(2*e+1)};function dn(e,t,n,r,i,o){var a,s,u,c,l,f,h,p,d,g,m,v,y,b,w,x,S,k,M,E,O,A,P,j;for(e|=0,t|=0,i|=0,o|=0,s=vt(a=n|=0),k=0;k<t;++k){for(h=a>>1,l=0,u=0;u<a-1;u++){for(u<l&&(y=r[i+u],r[i+u]=r[i+l],r[i+l]=y,y=r[o+u],r[o+u]=r[o+l],r[o+l]=y),f=h;f<=l;)l-=f,f>>=1;l+=f}for(m=-1,v=0,g=1,p=0;p<s;p++){for(d=g,g<<=1,x=1,S=0,l=0;l<d;l++){for(u=l;u<a;u+=g)M=r[i+(c=u+d)],E=r[o+c],O=r[i+u],A=r[o+u],b=(P=x*(M+E))-E*(x+S),w=P+(j=M*(S-x)),r[i+c]=O-b,r[o+c]=A-w,r[i+u]+=b,r[o+u]+=w;j=x*(v-m),x=(P=m*(x+S))-S*(m+v),S=P+j}v=Math.sqrt((1-m)/2),e<0&&(v=-v),m=Math.sqrt((1+m)/2)}if(e<0){var C=1/a;for(u=0;u<a;u++)r[i+u]*=C,r[o+u]*=C}i+=n,o+=n}}hn.scratchMemory=pn;var gn=function(e,t,n){var r,i,o=t.shape,a=o.length,s=1,u=new Array(a),c=0;for(r=a-1;r>=0;--r)if(u[r]=s,s*=o[r],c=Math.max(c,hn.scratchMemory(o[r])),t.shape[r]!==n.shape[r])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var l,f=4*s+c;l="array"===t.dtype||"float64"===t.dtype||"custom"===t.dtype?fn.mallocDouble(f):fn.mallocFloat(f);var h,p,d,g,m=At(l,o.slice(0),u,0),v=At(l,o.slice(0),u.slice(0),s),y=At(l,o.slice(0),u.slice(0),2*s),b=At(l,o.slice(0),u.slice(0),3*s),w=4*s;for(Bt.assign(m,t),Bt.assign(v,n),r=a-1;r>=0&&(hn(e,s/o[r],o[r],l,m.offset,v.offset,w),0!==r);--r){for(p=1,d=y.stride,g=b.stride,i=r-1;i<a;++i)g[i]=d[i]=p,p*=o[i];for(i=r-2;i>=0;--i)g[i]=d[i]=p,p*=o[i];Bt.assign(y,m),Bt.assign(b,v),h=m,m=y,y=h,h=v,v=b,b=h}Bt.assign(t,m),Bt.assign(n,v),fn.free(l)},mn=s((function(e){var t=Xt({args:["array","array","array","array"],body:function(e,t,n,r){}});function n(e,n,r,i,o,a,s,u){if(r.shape.length!==o.shape.length||e.shape.length!==r.shape.length)throw new Error("ndarray-convolve: Dimension mismatch");var c,l=r.shape.length,f=1,h=new Array(l),p=new Array(l);if(u)for(c=l-1;c>=0;--c)p[c]=r.shape[c],h[c]=f,f*=p[c];else for(c=l-1;c>=0;--c)p[c]=yt(r.shape[c]+o.shape[c]-1),h[c]=f,f*=p[c];var d=fn.mallocDouble(f),g=At(d,p,h,0);Bt.assigns(g,0),Bt.assign(g.hi.apply(g,r.shape),r);var m=fn.mallocDouble(f),v=At(m,p,h,0);Bt.assigns(v,0),i&&Bt.assign(v.hi.apply(v,i.shape),i),gn(1,g,v);var y=fn.mallocDouble(f),b=At(y,p,h,0);Bt.assigns(b,0),Bt.assign(b.hi.apply(b,o.shape),o);var w=fn.mallocDouble(f),x=At(w,p,h,0);Bt.assigns(x,0),a&&Bt.assign(x.hi.apply(v,a.shape),a),gn(1,b,x),s?t(g,v,b,x):qt.muleq(g,v,b,x),gn(-1,g,v);var S,k,M=new Array(l),E=new Array(l),O=!1;for(c=0;c<l;++c)e.shape[c]>p[c]&&(O=!0),E[c]=u?0:Math.max(0,Math.min(p[c]-e.shape[c],Math.floor(o.shape[c]/2))),M[c]=Math.min(e.shape[c],p[c]-E[c]);O&&Bt.assign(e,0),S=(S=g.lo.apply(g,E)).hi.apply(S,M),Bt.assign(e.hi.apply(e,M),S),n&&(O&&Bt.assign(n,0),k=(k=v.lo.apply(v,E)).hi.apply(k,M),Bt.assign(n.hi.apply(n,M),k)),fn.freeDouble(d),fn.freeDouble(m),fn.freeDouble(y),fn.freeDouble(w)}e.exports=function(e,t,r,i,o,a){if(2===arguments.length)n(e,void 0,e,void 0,t,void 0,!1,!1);else if(3===arguments.length)n(e,void 0,t,void 0,r,void 0,!1,!1);else if(4===arguments.length)n(e,t,e,t,r,i,!1,!1);else{if(6!==arguments.length)throw new Error("ndarray-convolve: Invalid arguments for convolve");n(e,t,r,i,o,a,!1,!1)}return e},e.exports.wrap=function(e,t,r,i,o,a){if(2===arguments.length)n(e,void 0,e,void 0,t,void 0,!1,!0);else if(3===arguments.length)n(e,void 0,t,void 0,r,void 0,!1,!0);else if(4===arguments.length)n(e,t,e,t,r,i,!1,!0);else{if(6!==arguments.length)throw new Error("ndarray-convolve: Invalid arguments for convolve");n(e,t,r,i,o,a,!1,!0)}return e},e.exports.correlate=function(e,t,r,i,o,a){if(2===arguments.length)n(e,void 0,e,void 0,t,void 0,!0,!1);else if(3===arguments.length)n(e,void 0,t,void 0,r,void 0,!0,!1);else if(4===arguments.length)n(e,t,e,t,r,i,!0,!1);else{if(6!==arguments.length)throw new Error("ndarray-convolve: Invalid arguments for correlate");n(e,t,r,i,o,a,!0,!1)}return e},e.exports.correlate.wrap=function(e,t,r,i,o,a){if(2===arguments.length)n(e,void 0,e,void 0,t,void 0,!0,!0);else if(3===arguments.length)n(e,void 0,t,void 0,r,void 0,!0,!0);else if(4===arguments.length)n(e,t,e,t,r,i,!0,!0);else{if(6!==arguments.length)throw new Error("ndarray-convolve: Invalid arguments for correlate");n(e,t,r,i,o,a,!0,!0)}return e}})),vn=function(e,t){var n=new Set,r=[],i=!1,o=function(){r.forEach((function(e){return e.onDone()})),r=[]},a=pt((function(){var e=r.slice(0,100);r.splice(0,100),e.forEach((function(e){return e.onDone()}))}),50),s=z((function(){i=!0,n.forEach((function(e){e.update()&&r.push(e)})),e(),r.forEach((function(e){return n.delete(e)})),a()}),(function(){n.size?s():(o(),i&&t.publish("animationEnd"),i=!1)}));return{add:function(e){n.add(e),e.register(),s()},addBatch:function(e){e.forEach((function(e){n.add(e),e.register()})),s()},cancel:function(e){n.delete(e)}}},yn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return Ye(e,{clone:function(){return e.constructor.apply(e,t)}})}},bn=function(e){var n;return e.isSprite?((n=new t.Sprite(e.texture)).interactive=e.interactive,n.x=e.x,n.y=e.y,n.anchor=e.anchor,n.width=e.width,n.height=e.height,n.angle=e.angle):e instanceof t.Mesh&&((n=new t.Mesh(e.geometry,e.shader,e.state)).interactive=e.interactive,n.x=e.x,n.y=e.y,n.anchor=e.anchor,n.width=e.width,n.height=e.height,n.angle=e.angle),n},wn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if("string"==typeof e||e instanceof String){if("#"===e[0])return[parseInt(e.substr(1),16),t];if("rgb"===e.substring(0,3)){var n=e.match(/(\d+),\s*(\d+),\s*(\d+),?\s*([\d.]+)?/);return[n.slice(1,4).map((function(e,t){return+e<<8*(2-t)})).reduce((function(e,t){return t+e}),0),Number.isNaN(+n[4])?1:+n[4]]}return[e.match(/(\d+),\s*(\d+),\s*(\d+)/).slice(1).map((function(e,t){return+e<<8*(2-t)})).reduce((function(e,t){return t+e}),0),t]}return[parseInt(e,10),t]};var xn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function Sn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var kn=function(e,t,n){return t&&Sn(e.prototype,t),n&&Sn(e,n),e},Mn=s((function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(n,r)}e.exports=t}));var En=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mn(e,t)},On=s((function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t}));var An=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var Pn=function(e,t){return!t||"object"!==On(t)&&"function"!=typeof t?An(e):t},jn=s((function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t}));function Cn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=jn(e);if(t){var i=jn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Pn(this,n)}}var _n=function(e){En(n,e);var t=Cn(n);function n(e,r){var i;xn(this,n);var o=r||{},a=o.width,s=o.height,u=o.internalFormat,c=o.format,l=o.type;if(!(a&&s&&u&&c&&l))throw new Error("CustomBufferResource width, height, internalFormat, format, or type invalid");return(i=t.call(this,a,s)).data=e,i.internalFormat=u,i.format=c,i.type=l,i}return kn(n,[{key:"upload",value:function(e,t,n){var r=e.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1===t.alphaMode),n.width=t.width,n.height=t.height,r.texImage2D(t.target,0,r[this.internalFormat],t.width,t.height,0,r[this.format],r[this.type],this.data),!0}}]),n}(t.resources.Resource),In=function(e,t){switch(t){case"Infinity":return 1/0;case"-Infinity":return-1/0;default:return t}},Rn=function(e){return JSON.parse(e,In)},Tn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===e?t:e},Ln=function(e){for(var t=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<e.length;o+=2)t=e[o]<t?e[o]:t,n=e[o]>n?e[o]:n,r=e[o+1]<r?e[o+1]:r,i=e[o+1]>i?e[o+1]:i;return{minX:t,minY:r,maxX:n,maxY:i}},Bn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Se(e)?e(t,t.id,n):e},Nn=function(e,t){return Se(e)?e(t):e},Dn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e=new Set(e);var n=[],r=t.filter((function(t){return e.has(t)?(e.delete(t),!0):(n.push(t),!1)})),i=Array.from(e);return[i,n,r]},zn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=1,n=Math.log10(t),r=10,i=Math.log10(r),o=i-n,a=0,s=1,u=1,c=function(t){return Math.min(s,Math.max(a,s-(i-e(t))/o*u))};return c.domain=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(0===a.length)return[t,r];var s=b(a,2),u=s[0],l=s[1];return t=u,n=e(u),r=l,i=e(l),o=i-n||1,c},c.range=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(0===e.length)return[a,s];var t=b(e,2),n=t[0],r=t[1];return u=(s=r)-(a=n),c},c},Fn=["left","center","right"],Vn=["top","center","bottom"],Un=16777215,Yn=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Xn={passive:!1},qn={passive:!0},Hn="inherit",Gn={property:function(e,t){return t},isCustom:!0},$n=["auto","panZoom","scroll"],Wn=["#E69F00","#56B4E9","#009E73","#F0E442","#0072B2","#D55E00","#CC79A7"],Kn={color:"#808080"},Zn=function(e){var t=["top","left"],n=xe(e)?e[1]:e,r=xe(e)?e[0]:e;return Vn.indexOf(r)>=0&&(t[0]=r),Fn.indexOf(n)>=0&&(t[1]=n),t},Qn=function(e){var n,r=e;return r instanceof t.Texture||r instanceof t.Graphics||r instanceof t.Mesh||(r=ke(n=e)&&n.data&&(n.data.constructor===Float32Array||n.data.constructor===Uint8Array)&&n.shape?t.Texture.fromBuffer(e.data,e.shape[0],e.shape[1]):t.Texture.from(e)),r},Jn=function(e,t){return[e,t,0,1]},er=function(e,t){switch(t){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return t}},tr=function(e){return JSON.stringify(e,er)},nr=function(e){return we(e).join("-")},rr=function(e){return Math.pow(2,e)},ir=t.BatchPluginFactory.create({fragment:"\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = vec4(color.rgb + (1.0 - color.rgb) * vColor.rgb * color.w, color.w);\n}\n"});t.Renderer.registerPlugin("brighten-tint",ir);var or=t.BatchPluginFactory.create({fragment:"\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = vColor * vec4(color.a - color.rgb, color.a);\n}\n"});t.Renderer.registerPlugin("invert",or);var ar=function(e){return function(t){var n=0;return Ye(t,{brightness:function(t){if(n=t,0===t)e.tint=16777215,e.pluginName="batch";else{var r=parseInt(255*(t<0?1+t:t),10);e.tint=Te(new Array(3).fill().map((function(e,t){return r<<8*(2-t)}))),e.pluginName=t<0?"batch":"brighten-tint"}},invert:function(t){e.pluginName=t?"invert":"batch"},tint:function(t){if(0==+n){var r=null==t?16777215:wn(t,null)[0];e.tint=r}}})}},sr=function(e){return function(t){return Ye(t,{destroy:function(){e.destroy({baseTexture:!0,children:!0,texture:!0})}})}},ur=function(e,t,n){return function(r){return Ye(r,{scale:function(e){r.scaleFactor=e,r.scaleX(e),r.scaleY(e)},scaleX:function(n){r.scaleXFactor=n,e.width=t*n},scaleY:function(t){r.scaleYFactor=t,e.height=n*t}})}},cr=function(e,t,n){return function(r){return Ye(r,{get aspectRatio(){return e.width/e.height},get height(){return e.height},get center(){return[e.width/2,e.height/2]},get originalHeight(){return n},get size(){return Math.max(e.width,e.height)},get width(){return e.width},get originalWidth(){return t}})}},lr=function e(n){var r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.anchor,s=void 0===a?[.5,.5]:a,u=Qn(n);u instanceof t.Texture?(i=(r=new t.Sprite(u)).anchor).set.apply(i,d(s)):r=u;return Ke(Ze(e),tt("displayObject",r),tt("sprite",r),yn(u,{anchor:s}),ar(r),ur(r,u.width,u.height),cr(r,u.width,u.height),sr(r))({})},fr=function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.backgroundFactory,o=r.fontSize,a=void 0===o?8:o,s=r.darkMode,u=void 0!==s&&s,c=r.onDestroy,l=void 0===c?st:c,f=new t.Container,h=n;if(!(n instanceof t.Texture)){var p=new t.Text(n,{fontFamily:"sans-serif",fontSize:a*window.devicePixelRatio,fill:16777215,align:"center"});p.updateText(),h=p.texture}var d,g=lr(h);i&&(d=i.create(),f.addChild(d)),f.addChild(g.displayObject),g.displayObject.width/=window.devicePixelRatio,g.displayObject.height/=window.devicePixelRatio;var m=!1,v=function(){return function(e){return Ye(e,{destroy:function(){m||(m=!0,l())}})}},y=function(e){g.invert(e),i.setColor(e?[1,1,1,1]:[0,0,0,1])};return y(u),Ke(Ze(e),tt("displayObject",f),tt("background",d),tt("image",g),yn(h,{backgroundFactory:i,fontSize:a,darkMode:u,onDestroy:l}),v())({setDarkMode:y})},hr=[0,0,0,1],pr=[0,0],dr=[.5,.5],gr="precision mediump float;\n// From PIXI\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\n\nattribute vec2 aVertexPosition;\n\nvarying vec2 vTexPos;\n\nvoid main() {\n  gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n  vTexPos = aVertexPosition;\n}\n",mr="precision mediump float;\nfloat udRoundBox(vec2 p, vec2 b, float r) {\n  return length(max(abs(p) - b, 0.0)) - r;\n}\n\nuniform vec2 uRectPos;\nuniform vec2 uRectSize;\nuniform vec4 uColor;\nuniform float uRounding;\nuniform float uSize;\n\nvarying vec2 vTexPos;\n\nvoid main() {\n  float texel = 1.0 / uSize;\n  float dist = udRoundBox(vTexPos - uRectPos, uRectSize, uRounding);\n\n  gl_FragColor = vec4(uColor.rgb, uColor.a * max(0.0, 1.0 - (dist * uSize * 2.0)));\n}",vr=new t.Geometry;vr.addAttribute("aVertexPosition",[-1,-1,1,-1,1,1,-1,1],2),vr.addIndex([0,1,2,0,3,2]);var yr,br=new t.State,wr=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.color,i=void 0===r?hr:r,o=n.rounding,a=void 0===o?.5:o,s=n.size,u=void 0===s?1:s,c={uColor:i,uRounding:a,uRectPos:pr,uRectSize:dr,uSize:u},l=new t.UniformGroup(c),f=t.Shader.from(gr,mr,l),h=function(){var e=new t.Mesh(vr,f,br);return e.width=c.uSize/window.devicePixelRatio,e.height=c.uSize/window.devicePixelRatio,e},p=h(),d=function(e){c.uColor=e},g=function(){p.destroy(),c={}},m=function(e){c.uSize=e*window.devicePixelRatio};return Ke(Ze(e))({create:h,destroy:g,setColor:d,setSize:m})},xr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fontSize,n=void 0===t?8:t,r=new Map,i={},o=wr({size:n*window.devicePixelRatio*1.5}),a=function(e){return function(){i[e]=Math.max(0,i[e]-1),0===i[e]&&(r.get(e).image.destroy(),r.delete(e),delete i[e])}},s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t.darkMode;if(r.has(e))return++i[e],r.get(e).clone();var u=fr(e,{backgroundFactory:o,darkMode:s,fontSize:n,onDestroy:a(e)});return i[e]=1,r.set(e,u),u},u=function(){r.forEach((function(e){return e.destroy()})),r.clear(),i={}};return{clear:u,create:s,destroy:u}},Sr=function(){var e=document.createElement("style");document.head.appendChild(e);var t=e.sheet;return{addRule:function(e){var n=t.length;return t.insertRule(e,n),n},destroy:function(){document.head.removeChild(e)},removeRule:function(e){t.deleteRule(e)}}},kr="pilingjs-breadcrumbs-button",Mr=[".".concat(kr," {\n  position: relative;\n  display: flex;\n  align-items: center;\n  line-height: 1em;\n  height: 2em;\n  margin-right: -0.25em;\n  padding: 0 0.5em 0 1em;\n  border-radius: 0 0.25em 0.25em 0;\n  text-color: black;\n  box-shadow: inset 0 0 0 1px #ccc;\n  background: white;\n}"),".pilingjs-darkmode .".concat(kr," {\n  text-color: white;\n  box-shadow: inset 0 0 0 1px #333;\n  background: black;\n}"),"li:first-child .".concat(kr," {\n  padding: 0.5em;\n  border-radius: 0.25em;\n}"),".".concat(kr,":focus {\n  outline: none;\n}"),".".concat(kr,".").concat(kr,"-right-arrow {\n  position: relative;\n  display: block;\n  border-radius: 0;\n  border-left-color: #ccc;\n  background: #ccc;\n}"),".pilingjs-darkmode .".concat(kr,".").concat(kr,"-right-arrow {\n  border-left-color: #333;\n  background: #333;\n}"),".".concat(kr,".").concat(kr,"-right-arrow:hover, .pilingjs-darkmode .").concat(kr,".").concat(kr,"-right-arrow:hover {\n  color: black;\n  border-left-color: #ff7ff6;\n  box-shadow: inset 0 0 0 1px #ff7ff6;\n  background: #ff7ff6;\n}"),".".concat(kr,".").concat(kr,"-right-arrow:after {\n  left: 100%;\n  top: 50%;\n  border: solid transparent;\n  content: '';\n  height: 0;\n  width: 0;\n  position: absolute;\n  pointer-events: none;\n  border-color: rgba(0, 0, 0, 0);\n  border-left-color: inherit;\n  border-width: 0.5em;\n  margin-top: -0.5em;\n}")],Er=function e(t){var n=t.element,r=t.store,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=(i.darkMode,i.maxDepth),a=void 0===o?2:o,s=i.onEnter,u=void 0===s?st:s,c=i.onLeave,l=void 0===c?st:c,f=[],h=a,p=document.createElement("nav");p.className="pilingjs-breadcrumbs",p.style.position="absolute",p.style.top=0,p.style.left=0;var g=document.createElement("ol");g.className="pilingjs-breadcrumbs-list",g.style.display="flex",g.style.margin=0,g.style.padding=0,g.style.listStyle="none",p.appendChild(g);var m=Sr();Mr.forEach(m.addRule);var v=[],y=[],b=[],w=function(){We((function(e,t,n){t+1===n.length?(e.style.zIndex=1,e.className="".concat(kr)):(e.style.zIndex=n.length-t,e.className="".concat(kr," ").concat(kr,"-right-arrow"))}))(g.querySelectorAll("button"))},x=function(){return b[b.length-1]},S=function(e){var t=r.state.piles;return e.flatMap((function(e){return t[e].items})).sort().join("-")},k=function(e){var t=r.export(),n=new Set;return e.forEach((function(e){t.piles[e].items.forEach((function(e){return n.add(e)}))})),Object.keys(t.piles).filter((function(e){return!n.has(e)})).forEach((function(e){t.piles[e].items=[]})),t},M=function(e){return Object.values(e.piles).filter((function(e){return e.items.length})).reduce((function(e,t){return e+t.items.length}),0)},E=function(e,t){var n=0===t?"Root":"".concat(t,". Level"),r=M(e);return"<li><button><span><strong>".concat(n,"</strong> (").concat(r,")</span></button></li>")},O=function(e){return function(){if(0!==e){for(var t=v.length;v.length>e+1;)Ve(g),b.pop(),v.pop();t>e&&j()}else C()}},A=function(e,t){var n=E(e,t),r=De(n);r.querySelector("button").addEventListener("click",O(t)),g.appendChild(r),w()},P=function(e){var t=S(e),i=x();if(f=e,v.length>=h)console.warn("Not allowed! You reached the maximum depth (".concat(h,")"));else if(t!==i){var o=r.export();v=[].concat(d(v),[o]);var a=n.getBoundingClientRect(),s=a.width,c=a.height;y=[].concat(d(y),[{width:s,height:c}]),1===v.length&&A(o,0);var l=k(e);r.import(l),b=[].concat(d(b),[t]),A(l,v.length),u()}else console.warn("Not allowed! You're already on this level.")},j=function(){if(v.length)if(1!==v.length){Ve(g),w(),b.pop();var e=v.pop();r.import(e);var t=y.pop();l(t)}else C();else console.warn("Not allowed! You're already on the root level.")},C=function(){v.length?(Fe(g),r.import(v[0]),l(y[0]),b=[],v=[],y=[]):console.warn("Not allowed! You're already on the root level.")},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.darkMode,e.maxDepth),n=void 0===t?null:t;h=Tn(n,h),w()},I=function(){m.destroy()};return w(),Ke(tt("nav",p),et("currSourcePileIds",(function(){return f})),et("prevStates",(function(){return v})),et("stateIds",(function(){return b})),et("size",(function(){return v.length})),Ze(e))({destroy:I,enter:P,leave:j,leaveAll:C,set:_})},Or='/*! skmeans 2020-01-29 */\n"use strict";\n\n!function e(i, f, s) {\n  function u(n, r) {\n    if (!f[n]) {\n      if (!i[n]) {\n        var t = "function" == typeof require && require;\n        if (!r && t) return t(n, !0);\n        if (v) return v(n, !0);\n        var o = new Error("Cannot find module \'" + n + "\'");\n        throw o.code = "MODULE_NOT_FOUND", o;\n      }\n\n      var a = f[n] = {\n        exports: {}\n      };\n      i[n][0].call(a.exports, function (r) {\n        return u(i[n][1][r] || r);\n      }, a, a.exports, e, i, f, s);\n    }\n\n    return f[n].exports;\n  }\n\n  for (var v = "function" == typeof require && require, r = 0; r < s.length; r++) u(s[r]);\n\n  return u;\n}({\n  1: [function (n, t, o) {\n    (function () {\n      this.skmeans;\n      var r = n("./main.js");\n      void 0 !== o && (void 0 !== t && t.exports && (o = t.exports = r), o.skmeans = r), "undefined" != typeof window && (window.skmeans = r);\n    }).call(this);\n  }, {\n    "./main.js": 4\n  }],\n  2: [function (r, n, t) {\n    n.exports = {\n      eudist: function (r, n) {\n        for (var t = r.length, o = 0, a = 0; a < t; a++) {\n          var e = (r[a] || 0) - (n[a] || 0);\n          o += e * e;\n        }\n\n        return o;\n      },\n      mandist: function (r, n) {\n        for (var t = r.length, o = 0, a = 0, e = 0; e < t; e++) o += 0 <= (a = (r[e] || 0) - (n[e] || 0)) ? a : -a;\n\n        return o;\n      },\n      dist: function (r, n, t) {\n        var o = Math.abs(r - n);\n        return t ? o : o * o;\n      }\n    };\n  }, {}],\n  3: [function (r, n, t) {\n    var o = r("./distance.js"),\n        j = o.eudist,\n        w = o.dist;\n    n.exports = {\n      kmrand: function (r, n) {\n        for (var t = {}, o = [], a = n << 2, e = r.length, i = 0 < r[0].length; o.length < n && 0 < a--;) {\n          var f = r[Math.floor(Math.random() * e)],\n              s = i ? f.join("_") : "".concat(f);\n          t[s] || (t[s] = !0, o.push(f));\n        }\n\n        if (o.length < n) throw new Error("Error initializating clusters");\n        return o;\n      },\n      kmpp: function (r, n, t) {\n        var o = t || (r[0].length ? j : w),\n            a = [],\n            e = r.length,\n            i = 0 < r[0].length,\n            f = r[Math.floor(Math.random() * e)];\n        i ? f.join("_") : "".concat(f);\n\n        for (a.push(f); a.length < n;) {\n          for (var s = [], u = a.length, v = 0, c = [], h = 0; h < e; h++) {\n            for (var d = 1 / 0, l = 0; l < u; l++) {\n              var p = o(r[h], a[l]);\n              p <= d && (d = p);\n            }\n\n            s[h] = d;\n          }\n\n          for (var m = 0; m < e; m++) v += s[m];\n\n          for (var g = 0; g < e; g++) c[g] = {\n            i: g,\n            v: r[g],\n            pr: s[g] / v,\n            cs: 0\n          };\n\n          c.sort(function (r, n) {\n            return r.pr - n.pr;\n          }), c[0].cs = c[0].pr;\n\n          for (var k = 1; k < e; k++) c[k].cs = c[k - 1].cs + c[k].pr;\n\n          for (var x = Math.random(), M = 0; M < e - 1 && c[M++].cs < x;);\n\n          a.push(c[M - 1].v);\n        }\n\n        return a;\n      }\n    };\n  }, {\n    "./distance.js": 2\n  }],\n  4: [function (r, n, t) {\n    var o = r("./distance.js"),\n        a = r("./kinit.js"),\n        H = o.eudist,\n        I = (o.mandist, o.dist, a.kmrand),\n        J = a.kmpp;\n\n    function K(r, n, t) {\n      t = t || [];\n\n      for (var o = 0; o < r; o++) t[o] = n;\n\n      return t;\n    }\n\n    function P(r, n) {\n      for (var t = Array.isArray(r), o = this.centroids, a = o.length, e = 1 / 0, i = 0, f = 0; f < a; f++) {\n        var s = n ? n(r, o[f]) : t ? H(r, o[f]) : Math.abs(r - o[f]);\n        s <= e && (e = s, i = f);\n      }\n\n      return {\n        idx: i,\n        centroid: o[i]\n      };\n    }\n\n    n.exports = function (r, n, t, o, a) {\n      var e = [],\n          i = [],\n          f = [],\n          s = [],\n          u = !1,\n          v = o || 1e4,\n          c = r.length,\n          h = r[0].length,\n          d = 0 < h,\n          l = [];\n      if (t) e = "kmrand" == t ? I(r, n) : "kmpp" == t ? J(r, n, a) : t;else for (var p = {}, m = 0; e.length < n;) {\n        var g = Math.floor(Math.random() * c);\n        p[g] || (p[g] = !0, e[m++] = r[g]);\n      }\n\n      do {\n        K(n, 0, l);\n\n        for (var k = 0; k < c; k++) {\n          for (var x = 1 / 0, M = 0, j = 0; j < n; j++) (s = a ? a(r[k], e[j]) : d ? H(r[k], e[j]) : Math.abs(r[k] - e[j])) <= x && (x = s, M = j);\n\n          l[f[k] = M]++;\n        }\n\n        var w = [];\n        if (i = [], d) for (var b = 0; b < n; b++) w[b] = K(h, 0, w[b]), i[b] = e[b];else for (var y = 0; y < n; y++) w[y] = 0, i[y] = e[y];\n\n        if (d) {\n          for (var q = 0; q < n; q++) e[q] = [];\n\n          for (var E = 0; E < c; E++) for (var _ = w[f[E]], O = r[E], A = 0; A < h; A++) _[A] += O[A];\n\n          u = !0;\n\n          for (var D = 0; D < n; D++) {\n            for (var N = e[D], U = w[D], z = i[D], C = l[D], F = 0; F < h; F++) N[F] = U[F] / C || 0;\n\n            if (u) for (var L = 0; L < h; L++) if (z[L] != N[L]) {\n              u = !1;\n              break;\n            }\n          }\n        } else {\n          for (var T = 0; T < c; T++) w[f[T]] += r[T];\n\n          for (var B = 0; B < n; B++) e[B] = w[B] / l[B] || 0;\n\n          u = !0;\n\n          for (var G = 0; G < n; G++) if (i[G] != e[G]) {\n            u = !1;\n            break;\n          }\n        }\n\n        u = u || --v <= 0;\n      } while (!u);\n\n      return {\n        it: (o || 1e4) - v,\n        k: n,\n        idxs: f,\n        centroids: e,\n        test: P\n      };\n    };\n  }, {\n    "./distance.js": 2,\n    "./kinit.js": 3\n  }]\n}, {}, [1]);',Ar=function(){var e=function(e){return{error:new Error(e)}},t=function(e){return e};self.onmessage=function(n){var r,i=n.data,o=i.initialization,a=i.k,s=i.maxIterations,u=i.items,c=i.scripts;try{c.forEach((function(e){importScripts(e)}))}catch(t){return void self.postMessage(e("Failed to import skmeans: ".concat(t)))}try{r=u.map(self.valueGetter||t)}catch(t){return void self.postMessage(e("Failed to load features: ".concat(t)))}if(r.length<=a)self.postMessage(e("Need at least ".concat(a," items!")));else try{var l=self.skmeans(r,a,o||"kmpp",s||1e3*Math.log10(r.length),self.distanceFunction||null),f=self.postProcessing&&self.postProcessing(l,r,u);self.postMessage({centroids:l.centroids,labels:l.idxs,postProcessing:f})}catch(t){self.postMessage(e("Failed to run k-means++: ".concat(t)))}}},Pr=function(e){return window.URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},jr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.distanceFunction,r=void 0===n?null:n,i=t.initialization,o=void 0===i?"kmpp":i,a=t.maxIterations,s=void 0===a?null:a,u=t.valueGetter,c=void 0===u?null:u,l=t.postProcessing,f=void 0===l?null:l,h=[Pr(Or.replace(/window/g,"self"))];return c&&h.push(Pr("(() => { self.valueGetter = ".concat(c.toString(),"; })();"))),r&&h.push(Pr("(() => { self.distanceFunction = ".concat(r.toString(),"; })();"))),f&&h.push(Pr("(() => { self.postProcessing = ".concat(f.toString(),"; })();"))),function(t){return new Promise((function(n,r){var i=at(Ar);i.onmessage=function(e){e.data.error?r(e.data.error):n(e.data),i.terminate()},i.postMessage({initialization:o,k:e,maxIterations:s,items:t,scripts:h})}))}},Cr=Object.prototype.toString,_r=function(e){var t=Cr.call(e),n="[object Arguments]"===t;return n||(n="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===Cr.call(e.callee)),n};if(!Object.keys){var Ir=Object.prototype.hasOwnProperty,Rr=Object.prototype.toString,Tr=_r,Lr=Object.prototype.propertyIsEnumerable,Br=!Lr.call({toString:null},"toString"),Nr=Lr.call((function(){}),"prototype"),Dr=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],zr=function(e){var t=e.constructor;return t&&t.prototype===e},Fr={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Vr=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!Fr["$"+e]&&Ir.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{zr(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();yr=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===Rr.call(e),r=Tr(e),i=t&&"[object String]"===Rr.call(e),o=[];if(!t&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var a=Nr&&n;if(i&&e.length>0&&!Ir.call(e,0))for(var s=0;s<e.length;++s)o.push(String(s));if(r&&e.length>0)for(var u=0;u<e.length;++u)o.push(String(u));else for(var c in e)a&&"prototype"===c||!Ir.call(e,c)||o.push(String(c));if(Br)for(var l=function(e){if("undefined"==typeof window||!Vr)return zr(e);try{return zr(e)}catch(e){return!1}}(e),f=0;f<Dr.length;++f)l&&"constructor"===Dr[f]||!Ir.call(e,Dr[f])||o.push(Dr[f]);return o}}var Ur=yr,Yr=Array.prototype.slice,Xr=Object.keys,qr=Xr?function(e){return Xr(e)}:Ur,Hr=Object.keys;qr.shim=function(){Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return _r(e)?Hr(Yr.call(e)):Hr(e)}):Object.keys=qr;return Object.keys||qr};var Gr=qr,$r="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,Wr=Object.prototype.toString,Kr=function(e){return!($r&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===Wr.call(e)},Zr=function(e){return!!Kr(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==Wr.call(e)&&"[object Function]"===Wr.call(e.callee)},Qr=function(){return Kr(arguments)}();Kr.isLegacyArguments=Zr;var Jr=Qr?Kr:Zr,ei=function(e){return e!=e},ti=function(e,t){return 0===e&&0===t?1/e==1/t:e===t||!(!ei(e)||!ei(t))},ni="Function.prototype.bind called on incompatible ",ri=Array.prototype.slice,ii=Object.prototype.toString,oi=(Function.prototype.bind||function(e){var t=this;if("function"!=typeof t||"[object Function]"!==ii.call(t))throw new TypeError(ni+t);for(var n,r=ri.call(arguments,1),i=function(){if(this instanceof n){var i=t.apply(this,r.concat(ri.call(arguments)));return Object(i)===i?i:this}return t.apply(e,r.concat(ri.call(arguments)))},o=Math.max(0,t.length-r.length),a=[],s=0;s<o;s++)a.push("$"+s);if(n=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")(i),t.prototype){var u=function(){};u.prototype=t.prototype,n.prototype=new u,u.prototype=null}return n}).call(Function.call,Object.prototype.hasOwnProperty),ai=RegExp.prototype.exec,si=Object.getOwnPropertyDescriptor,ui=Object.prototype.toString,ci="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,li=function(e){if(!e||"object"!=typeof e)return!1;if(!ci)return"[object RegExp]"===ui.call(e);var t=si(e,"lastIndex");return!(!t||!oi(t,"value"))&&function(e){try{var t=e.lastIndex;return e.lastIndex=0,ai.call(e),!0}catch(e){return!1}finally{e.lastIndex=t}}(e)},fi="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),hi=Object.prototype.toString,pi=Array.prototype.concat,di=Object.defineProperty,gi=di&&function(){var e={};try{for(var t in di(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}(),mi=function(e,t,n,r){var i;(!(t in e)||"function"==typeof(i=r)&&"[object Function]"===hi.call(i)&&r())&&(gi?di(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n)},vi=function(e,t){var n=arguments.length>2?arguments[2]:{},r=Gr(t);fi&&(r=pi.call(r,Object.getOwnPropertySymbols(t)));for(var i=0;i<r.length;i+=1)mi(e,r[i],t[r[i]],n[r[i]])};vi.supportsDescriptors=!!gi;var yi=vi,bi=Object,wi=TypeError,xi=function(){if(null!=this&&this!==bi(this))throw new wi("RegExp.prototype.flags getter called on non-object");var e="";return this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.sticky&&(e+="y"),e},Si=yi.supportsDescriptors,ki=Object.getOwnPropertyDescriptor,Mi=TypeError,Ei=function(){if(!Si)throw new Mi("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");if("gim"===/a/gim.flags){var e=ki(RegExp.prototype,"flags");if(e&&"function"==typeof e.get&&"boolean"==typeof/a/.dotAll)return e.get}return xi},Oi=yi.supportsDescriptors,Ai=Object.getOwnPropertyDescriptor,Pi=Object.defineProperty,ji=TypeError,Ci=Object.getPrototypeOf,_i=/a/,Ii=Function.call.bind(xi);yi(Ii,{getPolyfill:Ei,implementation:xi,shim:function(){if(!Oi||!Ci)throw new ji("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=Ei(),t=Ci(_i),n=Ai(t,"flags");return n&&n.get===e||Pi(t,"flags",{configurable:!0,enumerable:!1,get:e}),e}});var Ri=Ii,Ti=Date.prototype.getDay,Li=Object.prototype.toString,Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,Ni=function(e){return"object"==typeof e&&null!==e&&(Bi?function(e){try{return Ti.call(e),!0}catch(e){return!1}}(e):"[object Date]"===Li.call(e))},Di=Date.prototype.getTime;function zi(e,t,n){var r=n||{};return!!(r.strict?ti(e,t):e===t)||(!e||!t||"object"!=typeof e&&"object"!=typeof t?r.strict?ti(e,t):e==t:function(e,t,n){var r,i;if(typeof e!=typeof t)return!1;if(Fi(e)||Fi(t))return!1;if(e.prototype!==t.prototype)return!1;if(Jr(e)!==Jr(t))return!1;var o=li(e),a=li(t);if(o!==a)return!1;if(o||a)return e.source===t.source&&Ri(e)===Ri(t);if(Ni(e)&&Ni(t))return Di.call(e)===Di.call(t);var s=Vi(e),u=Vi(t);if(s!==u)return!1;if(s||u){if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if(typeof e!=typeof t)return!1;try{var c=Gr(e),l=Gr(t)}catch(e){return!1}if(c.length!==l.length)return!1;for(c.sort(),l.sort(),r=c.length-1;r>=0;r--)if(c[r]!=l[r])return!1;for(r=c.length-1;r>=0;r--)if(i=c[r],!zi(e[i],t[i],n))return!1;return!0}(e,t,r))}function Fi(e){return null==e}function Vi(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}var Ui=zi;function Yi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yi(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qi=function(e,t){switch(On(e)){case"object":return Ui(e,t)?t:Xe(e);default:return e}},Hi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n="SET_".concat(Ge(e));return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,i=arguments.length>1?arguments[1]:void 0;switch(i.type){case n:return qi(i.payload[e],r);default:return r}}},Gi=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=new Set(t);var r="SET_".concat(Ge(e));return function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case r:return t.has(o.payload[e])?qi(o.payload[e],i):i;default:return i}}},$i=function(e){var t="SET_".concat(Ge(e));return function(n){return{type:t,payload:g({},e,n)}}},Wi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return[Hi(e,t),$i(e)]},Ki=function(e,t){return{type:"OVERWRITE",payload:{newState:e,debug:t}}},Zi=function(e,t){return{type:"SOFT_OVERWRITE",payload:{newState:e,debug:t}}},Qi=Wi("arrangementType"),Ji=b(Qi,2),eo=Ji[0],to=Ji[1],no=Wi("arrangementObjective"),ro=b(no,2),io=ro[0],oo=ro[1],ao=Wi("arrangeOnGrouping",!1),so=b(ao,2),uo=so[0],co=so[1],lo=Wi("arrangementOptions",{}),fo=b(lo,2),ho=fo[0],po=fo[1],go=Wi("groupingType"),mo=b(go,2),vo=mo[0],yo=mo[1],bo=Wi("groupingObjective"),wo=b(bo,2),xo=wo[0],So=wo[1],ko=Wi("groupingOptions",{}),Mo=b(ko,2),Eo=Mo[0],Oo=Mo[1],Ao=Wi("splittingType"),Po=b(Ao,2),jo=Po[0],Co=Po[1],_o=Wi("splittingObjective"),Io=b(_o,2),Ro=Io[0],To=Io[1],Lo=Wi("splittingOptions",{}),Bo=b(Lo,2),No=Bo[0],Do=Bo[1],zo=Wi("backgroundColor",0),Fo=b(zo,2),Vo=Fo[0],Uo=Fo[1],Yo=Wi("darkMode",!1),Xo=b(Yo,2),qo=Xo[0],Ho=Xo[1],Go=Wi("dimensionalityReducer"),$o=b(Go,2),Wo=$o[0],Ko=$o[1],Zo=Wi("gridColor",7895160),Qo=b(Zo,2),Jo=Qo[0],ea=Qo[1],ta=Wi("gridOpacity",1),na=b(ta,2),ra=na[0],ia=na[1],oa=Wi("showGrid",!1),aa=b(oa,2),sa=aa[0],ua=aa[1],ca=Wi("popupBackgroundOpacity",.85),la=b(ca,2),fa=la[0],ha=la[1],pa=Wi("lassoFillColor"),da=b(pa,2),ga=da[0],ma=da[1],va=Wi("lassoFillOpacity",.15),ya=b(va,2),ba=ya[0],wa=ya[1],xa=Wi("lassoShowStartIndicator",!0),Sa=b(xa,2),ka=Sa[0],Ma=Sa[1],Ea=Wi("lassoStartIndicatorOpacity",.1),Oa=b(Ea,2),Aa=Oa[0],Pa=Oa[1],ja=Wi("lassoStrokeColor"),Ca=b(ja,2),_a=Ca[0],Ia=Ca[1],Ra=Wi("lassoStrokeOpacity",.8),Ta=b(Ra,2),La=Ta[0],Ba=Ta[1],Na=Wi("lassoStrokeSize",1),Da=b(Na,2),za=Da[0],Fa=Da[1],Va=Wi("itemRenderer"),Ua=b(Va,2),Ya=Ua[0],Xa=Ua[1],qa=Wi("previewRenderer"),Ha=b(qa,2),Ga=Ha[0],$a=Ha[1],Wa=Wi("coverRenderer"),Ka=b(Wa,2),Za=Ka[0],Qa=Ka[1],Ja=Wi("previewAggregator"),es=b(Ja,2),ts=es[0],ns=es[1],rs=Wi("coverAggregator"),is=b(rs,2),os=is[0],as=is[1],ss=Wi("orderer",(function(e){return function(t){return[Math.floor(t/e),t%e]}})),us=b(ss,2),cs=us[0],ls=us[1],fs=Wi("itemSize"),hs=b(fs,2),ps=hs[0],ds=hs[1],gs=Wi("itemSizeRange",[.5,1]),ms=b(gs,2),vs=ms[0],ys=ms[1],bs=Wi("columns",10),ws=b(bs,2),xs=ws[0],Ss=ws[1],ks=Wi("rowHeight"),Ms=b(ks,2),Es=Ms[0],Os=Ms[1],As=Wi("cellAspectRatio",1),Ps=b(As,2),js=Ps[0],Cs=Ps[1],_s=Wi("cellPadding",12),Is=b(_s,2),Rs=Is[0],Ts=Is[1],Ls=Wi("cellSize"),Bs=b(Ls,2),Ns=Bs[0],Ds=Bs[1],zs=Wi("pileCoverScale",1),Fs=b(zs,2),Vs=Fs[0],Us=Fs[1],Ys=Wi("pileCoverInvert",!1),Xs=b(Ys,2),qs=Xs[0],Hs=Xs[1],Gs=Wi("pileItemBrightness",0),$s=b(Gs,2),Ws=$s[0],Ks=$s[1],Zs=Wi("pileItemInvert",!1),Qs=b(Zs,2),Js=Qs[0],eu=Qs[1],tu=Wi("pileItemOffset",[5,5]),nu=b(tu,2),ru=nu[0],iu=nu[1],ou=Wi("pileItemOpacity",1),au=b(ou,2),su=au[0],uu=au[1],cu=Wi("pileOrderItems"),lu=b(cu,2),fu=lu[0],hu=lu[1],pu=Wi("pileItemRotation",0),du=b(pu,2),gu=du[0],mu=du[1],vu=Wi("pileItemTint",16777215),yu=b(vu,2),bu=yu[0],wu=yu[1],xu=Wi("focusedPiles",[]),Su=b(xu,2),ku=Su[0],Mu=Su[1],Eu=Wi("magnifiedPiles",[]),Ou=b(Eu,2),Au=Ou[0],Pu=Ou[1],ju=Wi("depileMethod","originalPos"),Cu=b(ju,2),_u=Cu[0],Iu=Cu[1],Ru=Wi("depiledPile",[]),Tu=b(Ru,2),Lu=Tu[0],Bu=Tu[1],Nu=Wi("temporaryDepiledPiles",[]),Du=b(Nu,2),zu=Du[0],Fu=Du[1],Vu=Wi("tempDepileDirection","horizontal"),Uu=b(Vu,2),Yu=Uu[0],Xu=Uu[1],qu=Wi("tempDepileOneDNum",6),Hu=b(qu,2),Gu=Hu[0],$u=Hu[1],Wu=Wi("easing",de),Ku=b(Wu,2),Zu=Ku[0],Qu=Ku[1],Ju=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return[Gi(e,t,n),$i(e)]}("navigationMode",$n,"auto"),ec=b(Ju,2),tc=ec[0],nc=ec[1],rc=Wi("previewItemOffset"),ic=b(rc,2),oc=ic[0],ac=ic[1],sc=Wi("previewAlignment","top"),uc=b(sc,2),cc=uc[0],lc=uc[1],fc=Wi("previewPadding",2),hc=b(fc,2),pc=hc[0],dc=hc[1],gc=Wi("previewScaling",[1,1]),mc=b(gc,2),vc=mc[0],yc=mc[1],bc=Wi("previewScaleToCover",[!1,!1]),wc=b(bc,2),xc=wc[0],Sc=wc[1],kc=Wi("previewSpacing",2),Mc=b(kc,2),Ec=Mc[0],Oc=Mc[1],Ac=Wi("previewOffset",2),Pc=b(Ac,2),jc=Pc[0],Cc=Pc[1],_c=Wi("previewBackgroundColor","inherit"),Ic=b(_c,2),Rc=Ic[0],Tc=Ic[1],Lc=Wi("previewBackgroundOpacity","inherit"),Bc=b(Lc,2),Nc=Bc[0],Dc=Bc[1],zc=Wi("previewBorderColor"),Fc=b(zc,2),Vc=Fc[0],Uc=Fc[1],Yc=Wi("previewBorderOpacity",.85),Xc=b(Yc,2),qc=Xc[0],Hc=Xc[1],Gc=Wi("pileBackgroundColor"),$c=b(Gc,2),Wc=$c[0],Kc=$c[1],Zc=Wi("pileBackgroundOpacity",0),Qc=b(Zc,2),Jc=Qc[0],el=Qc[1],tl=Wi("pileBackgroundColorHover"),nl=b(tl,2),rl=nl[0],il=nl[1],ol=Wi("pileBackgroundOpacityHover",.85),al=b(ol,2),sl=al[0],ul=al[1],cl=Wi("pileBackgroundColorFocus"),ll=b(cl,2),fl=ll[0],hl=ll[1],pl=Wi("pileBackgroundOpacityFocus"),dl=b(pl,2),gl=dl[0],ml=dl[1],vl=Wi("pileBackgroundColorActive"),yl=b(vl,2),bl=yl[0],wl=yl[1],xl=Wi("pileBackgroundOpacityActive"),Sl=b(xl,2),kl=Sl[0],Ml=Sl[1],El=Wi("pileBorderColor",8421504),Ol=b(El,2),Al=Ol[0],Pl=Ol[1],jl=Wi("pileBorderOpacity",1),Cl=b(jl,2),_l=Cl[0],Il=Cl[1],Rl=Wi("pileBorderColorHover",8421504),Tl=b(Rl,2),Ll=Tl[0],Bl=Tl[1],Nl=Wi("pileBorderOpacityHover",1),Dl=b(Nl,2),zl=Dl[0],Fl=Dl[1],Vl=Wi("pileBorderColorFocus",15656034),Ul=b(Vl,2),Yl=Ul[0],Xl=Ul[1],ql=Wi("pileBorderOpacityFocus",1),Hl=b(ql,2),Gl=Hl[0],$l=Hl[1],Wl=Wi("pileBorderColorActive",16754138),Kl=b(Wl,2),Zl=Kl[0],Ql=Kl[1],Jl=Wi("pileBorderOpacityActive",1),ef=b(Jl,2),tf=ef[0],nf=ef[1],rf=Wi("pileBorderSize",0),of=b(rf,2),af=of[0],sf=of[1],uf=Wi("pileCellAlignment","topLeft"),cf=b(uf,2),lf=cf[0],ff=cf[1],hf=Wi("pileContextMenuItems",[]),pf=b(hf,2),df=pf[0],gf=pf[1],mf=Wi("pileSizeBadge",!1),vf=b(mf,2),yf=vf[0],bf=vf[1],wf=Wi("pileSizeBadgeAlign",["top","right"]),xf=b(wf,2),Sf=xf[0],kf=xf[1],Mf=Wi("pileVisibilityItems",!0),Ef=b(Mf,2),Of=Ef[0],Af=Ef[1],Pf=Wi("pileOpacity",1),jf=b(Pf,2),Cf=jf[0],_f=jf[1],If=Wi("pileScale",1),Rf=b(If,2),Tf=Rf[0],Lf=Rf[1],Bf=Wi("zoomScale",1),Nf=b(Bf,2),Df=Nf[0],zf=Nf[1],Ff=Wi("pileLabel"),Vf=b(Ff,2),Uf=Vf[0],Yf=Vf[1],Xf=Wi("pileLabelColor"),qf=b(Xf,2),Hf=qf[0],Gf=qf[1],$f=Wi("pileLabelText",!1),Wf=b($f,2),Kf=Wf[0],Zf=Wf[1],Qf=Wi("pileLabelTextMapping",!1),Jf=b(Qf,2),eh=Jf[0],th=Jf[1],nh=Wi("pileLabelTextColor",0),rh=b(nh,2),ih=rh[0],oh=rh[1],ah=Wi("pileLabelTextOpacity",1),sh=b(ah,2),uh=sh[0],ch=sh[1],lh=Wi("pileLabelTextDropShadow",{}),fh=b(lh,2),hh=fh[0],ph=fh[1],dh=Wi("pileLabelAlign","bottom"),gh=b(dh,2),mh=gh[0],vh=gh[1],yh=Wi("pileLabelStackAlign","horizontal"),bh=b(yh,2),wh=bh[0],xh=bh[1],Sh=Wi("pileLabelFontSize",7),kh=b(Sh,2),Mh=kh[0],Eh=kh[1],Oh=Wi("pileLabelHeight",2),Ah=b(Oh,2),Ph=Ah[0],jh=Ah[1],Ch=Wi("pileLabelSizeTransform"),_h=b(Ch,2),Ih=_h[0],Rh=_h[1],Th=Wi("projector"),Lh=b(Th,2),Bh=Lh[0],Nh=Lh[1],Dh=Wi("zoomBounds",[-1/0,1/0]),zh=b(Dh,2),Fh=zh[0],Vh=zh[1],Uh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ITEMS":var n=!!t.payload.items.length&&void 0!==t.payload.items[0].id;return t.payload.items.reduce((function(e,t,r){var i=n?t.id:r;return e[i]=Xi({id:i,index:r},t),e}),{});default:return e}},Yh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_PILES":return Object.entries(t.payload.piles).reduce((function(e,t,n){var r=b(t,2),i=r[0],o=r[1];return e[i]=Xi(Xi({},o),{},{id:i,index:Number.isNaN(+o.index)?n:+o.index}),e}),{});case"INIT_PILES":var n=!!t.payload.newItems.length&&void 0!==t.payload.newItems[0].id,r=t.payload.newItems.reduce((function(e,t,n){var r=void 0===t.id?n.toString():t.id;return e.add(r),e}),new Set);return t.payload.newItems.reduce((function(t,i,o){var a=n?i.id:o.toString(),s=e[a],u=Xi({id:a,index:o,items:[a],x:null,y:null},s);if(s)if(s.items.length)u.items=s.items.filter((function(e){return r.has(e)}));else if(r.has(a)){Object.values(e).filter((function(e){return e.items.includes(a)&&r.has(e.id)})).length||(u.items=[a])}return t[a]=u,t}),{});case"MERGE_PILES":var i,o=Xi({},e);i=void 0===t.payload.targetPileId&&isNaN(t.payload.pileIds[0])?t.payload.pileIds[0]:void 0!==t.payload.targetPileId?t.payload.targetPileId:Math.min.apply([],t.payload.pileIds).toString();var a=t.payload.pileIds.filter((function(e){return e!==i})),s=b(t.payload.targetPos,2),u=s[0],c=s[1];return o[i]=Xi(Xi({},o[i]),{},{items:d(o[i].items),x:u,y:c}),a.forEach((function(e){var t;(t=o[i].items).push.apply(t,d(o[e].items)),o[e]=Xi(Xi({},o[e]),{},{items:[],x:null,y:null})})),o;case"MOVE_PILES":var l=Xi({},e);return t.payload.movingPiles.forEach((function(e){var t=e.id,n=e.x,r=e.y;l[t]=Xi(Xi({},l[t]),{},{x:n,y:r})})),l;case"SCATTER_PILES":var f=t.payload.piles.filter((function(e){return e.items.length>1}));if(!f.length)return e;var h=Xi({},e);return f.forEach((function(e){e.items.forEach((function(t){h[t]=Xi(Xi({},h[t]),{},{items:[t],x:e.x,y:e.y})}))})),h;case"SPLIT_PILES":if(!Object.values(t.payload.piles).length)return e;var p=Xi({},e);return Object.entries(t.payload.piles).filter((function(e){return e[1].length>1})).forEach((function(e){var t=b(e,2),n=t[0];t[1].forEach((function(e,t){p[e[0]]=Xi(Xi({},p[e[0]]),{},{x:p[n].x+50*t,y:p[n].y,items:d(e)})}))})),p;default:return e}},Xh=Wi("showSpatialIndex",!1),qh=b(Xh,2),Hh=qh[0],Gh=qh[1],$h=function(){var e,t=null,r={arrangementObjective:io,arrangementOptions:ho,arrangementType:eo,arrangeOnGrouping:uo,backgroundColor:Vo,coverRenderer:Za,cellAspectRatio:js,cellPadding:Rs,cellSize:Ns,columns:xs,coverAggregator:os,depiledPile:Lu,depileMethod:_u,dimensionalityReducer:Wo,easing:Zu,focusedPiles:ku,gridColor:Jo,gridOpacity:ra,groupingObjective:xo,groupingOptions:Eo,groupingType:vo,darkMode:qo,popupBackgroundOpacity:fa,itemRenderer:Ya,items:Uh,itemSize:ps,itemSizeRange:vs,lassoFillColor:ga,lassoFillOpacity:ba,lassoShowStartIndicator:ka,lassoStartIndicatorOpacity:Aa,lassoStrokeColor:_a,lassoStrokeOpacity:La,lassoStrokeSize:za,magnifiedPiles:Au,navigationMode:tc,orderer:cs,pileBackgroundColor:Wc,pileBackgroundColorActive:bl,pileBackgroundColorFocus:fl,pileBackgroundColorHover:rl,pileBackgroundOpacity:Jc,pileBackgroundOpacityActive:kl,pileBackgroundOpacityFocus:gl,pileBackgroundOpacityHover:sl,pileBorderColor:Al,pileBorderColorActive:Zl,pileBorderColorFocus:Yl,pileBorderColorHover:Ll,pileBorderOpacity:_l,pileBorderOpacityActive:tf,pileBorderOpacityFocus:Gl,pileBorderOpacityHover:zl,pileBorderSize:af,pileCellAlignment:lf,pileContextMenuItems:df,pileCoverInvert:qs,pileCoverScale:Vs,pileItemOffset:ru,pileItemBrightness:Ws,pileItemInvert:Js,pileItemOpacity:su,pileOrderItems:fu,pileItemRotation:gu,pileItemTint:bu,pileLabel:Uf,pileLabelAlign:mh,pileLabelColor:Hf,pileLabelFontSize:Mh,pileLabelHeight:Ph,pileLabelStackAlign:wh,pileLabelSizeTransform:Ih,pileLabelText:Kf,pileLabelTextColor:ih,pileLabelTextMapping:eh,pileLabelTextOpacity:uh,pileLabelTextStyle:hh,pileOpacity:Cf,piles:Yh,pileScale:Tf,pileSizeBadge:yf,pileSizeBadgeAlign:Sf,pileVisibilityItems:Of,previewAggregator:ts,previewAlignment:cc,previewBackgroundColor:Rc,previewBackgroundOpacity:Nc,previewBorderColor:Vc,previewBorderOpacity:qc,previewItemOffset:oc,previewOffset:jc,previewPadding:pc,previewRenderer:Ga,previewScaleToCover:xc,previewScaling:vc,previewSpacing:Ec,projector:Bh,rowHeight:Es,splittingObjective:Ro,splittingOptions:No,splittingType:jo,showGrid:sa,showSpatialIndex:Hh,tempDepileDirection:Yu,tempDepileOneDNum:Gu,temporaryDepiledPiles:zu,zoomBounds:Fh,zoomScale:Df},i=n.combineReducers(r),o=function(e){var t=Object.keys(e).reduce((function(e,t){return void 0===r[t]&&e.push('"'.concat(t,'"')),e}),[]).join(", ");t&&console.warn("The following state properties are not understood and will not imported: ".concat(t))},a=n.createStore((e=function(e,n){return t=n,"RESET"===n.type?e=void 0:"OVERWRITE"===n.type?(n.payload.debug&&o(n.payload.newState),e=n.payload.newState):"SOFT_OVERWRITE"===n.type&&(n.payload.debug&&o(n.payload.newState),e=He(e,n.payload.newState)),i(e,n)},function t(n,r){return r&&r.meta&&r.meta.batch?r.payload.reduce(t,n):e(n,r)}));a.lastAction=function(){return t},Object.defineProperty(a,"lastAction",{get:function(){return t}});return Ke(tt("reduxStore",a),et("lastAction",(function(){return t})),et("state",a.getState),Qe("dispatch",a.dispatch),Qe("subscribe",a.subscribe))({export:function(){var e=Xe(a.getState());return e.version="0.10.0",e},import:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.overwriteState,r=void 0!==n&&n,i=t.debug,o=void 0!==i&&i;"0.10.0"!==e.version&&console.warn('The version of the imported state "'.concat(e.version,'" doesn\'t match the library version "').concat("0.10.0",'". Use at your own risk!')),e.version&&delete e.version,r?a.dispatch(Ki(e,o)):a.dispatch(Zi(e,o))},reset:function(){a.dispatch({type:"RESET",payload:{}})}})},Wh={initPiles:function(e){return{type:"INIT_PILES",payload:{newItems:e}}},mergePiles:function(e,t,n){return{type:"MERGE_PILES",payload:{pileIds:e,targetPos:t,targetPileId:n}}},movePiles:function(e){return{type:"MOVE_PILES",payload:{movingPiles:e}}},scatterPiles:function(e){return{type:"SCATTER_PILES",payload:{piles:e}}},setPiles:function(e){return{type:"SET_PILES",payload:{piles:e}}},setCoverRenderer:Qa,setArrangementObjective:oo,setArrangeOnGrouping:co,setArrangementOptions:po,setArrangementType:to,setBackgroundColor:Uo,setCellAspectRatio:Cs,setCellPadding:Ts,setCellSize:Ds,setColumns:Ss,setCoverAggregator:as,setDepiledPile:Bu,setDepileMethod:Iu,setDimensionalityReducer:Ko,setEasing:Qu,setFocusedPiles:Mu,setGridColor:ea,setGridOpacity:ia,setGroupingObjective:So,setGroupingOptions:Oo,setGroupingType:yo,setDarkMode:Ho,setPopupBackgroundOpacity:ha,setItemRenderer:Xa,setItems:function(e){return{type:"SET_ITEMS",payload:{items:e}}},setItemSize:ds,setItemSizeRange:ys,setLassoFillColor:ma,setLassoFillOpacity:wa,setLassoShowStartIndicator:Ma,setLassoStartIndicatorOpacity:Pa,setLassoStrokeColor:Ia,setLassoStrokeOpacity:Ba,setLassoStrokeSize:Fa,setMagnifiedPiles:Pu,setNavigationMode:nc,setOrderer:ls,setPileBackgroundColor:Kc,setPileBackgroundColorActive:wl,setPileBackgroundColorFocus:hl,setPileBackgroundColorHover:il,setPileBackgroundOpacity:el,setPileBackgroundOpacityActive:Ml,setPileBackgroundOpacityFocus:ml,setPileBackgroundOpacityHover:ul,setPileBorderColor:Pl,setPileBorderColorActive:Ql,setPileBorderColorFocus:Xl,setPileBorderColorHover:Bl,setPileBorderOpacity:Il,setPileBorderOpacityActive:nf,setPileBorderOpacityFocus:$l,setPileBorderOpacityHover:Fl,setPileBorderSize:sf,setPileCellAlignment:ff,setPileContextMenuItems:gf,setPileCoverInvert:Hs,setPileCoverScale:Us,setPileItemOffset:iu,setPileOrderItems:hu,setPileItemBrightness:Ks,setPileItemInvert:eu,setPileItemOpacity:uu,setPileItemRotation:mu,setPileItemTint:wu,setPileLabel:Yf,setPileLabelAlign:vh,setPileLabelColor:Gf,setPileLabelFontSize:Eh,setPileLabelHeight:jh,setPileLabelStackAlign:xh,setPileLabelSizeTransform:Rh,setPileLabelText:Zf,setPileLabelTextColor:oh,setPileLabelTextMapping:th,setPileLabelTextOpacity:ch,setPileLabelTextStyle:ph,setPileVisibilityItems:Af,setPileOpacity:_f,setPileScale:Lf,setPileSizeBadge:bf,setPileSizeBadgeAlign:kf,setPreviewAggregator:ns,setPreviewAlignment:lc,setPreviewBackgroundColor:Tc,setPreviewBackgroundOpacity:Dc,setPreviewBorderColor:Uc,setPreviewBorderOpacity:Hc,setPreviewItemOffset:ac,setPreviewOffset:Cc,setPreviewPadding:dc,setPreviewRenderer:$a,setPreviewScaleToCover:Sc,setPreviewScaling:yc,setPreviewSpacing:Oc,setProjector:Nh,setRowHeight:Os,setSplittingObjective:To,setSplittingOptions:Do,setSplittingType:Co,setShowGrid:ua,setShowSpatialIndex:Gh,setTempDepileDirection:Xu,setTempDepileOneDNum:$u,setTemporaryDepiledPiles:Fu,setZoomBounds:Vh,setZoomScale:zf,splitPiles:function(e){return{type:"SPLIT_PILES",payload:{piles:e}}}},Kh=function(e){var t=e.background,n=e.backgroundColor,r=e.backgroundOpacity;return function(e){return Ye(e,{get backgroundColor(){return t.tint},setBackgroundColor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;t.tint=e},get backgroundOpacity(){return t.alpha},setBackgroundOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;t.alpha=e},rescaleBackground:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=e.width+e.padding*n,i=e.height+e.padding*n;t.x=-r/2,t.y=-i/2,t.width=r,t.height=i}})}},Zh=function(e){return function(t){var n=e;return Ye(t,{get padding(){return n},setPadding:function(e){n=Number.isNaN(+e)?+e:n}})}},Qh=function e(n){var r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.anchor,s=void 0===a?[.5,.5]:a,u=o.backgroundColor,c=void 0===u?65280:u,l=o.backgroundOpacity,f=void 0===l?.2:l,h=o.padding,p=void 0===h?0:h,g=new t.Container,m=new t.Sprite(t.Texture.WHITE),v=Qn(n);v instanceof t.Texture?(i=(r=new t.Sprite(v)).anchor).set.apply(i,d(s)):r=v;return g.addChild(m),g.addChild(r),Ke(tt("displayObject",g),tt("sprite",r),ar(r),ur(r,v.width,v.height),cr(r,v.width,v.height),Zh(p),Kh({background:m,backgroundColor:c,backgroundOpacity:f}),sr(r),Ze(e))({})};var Jh=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i};var ep=function(e,t){if(null==e)return{};var n,r,i=Jh(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i};function tp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function np(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tp(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rp=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.minX,r=void 0===n?0:n,i=t.minY,o=void 0===i?0:i,a=t.maxX,s=void 0===a?1:a,u=t.maxY,c=void 0===u?1:u,l=ep(t,["minX","minY","maxX","maxY"]);return Ke.apply(void 0,[tt("minX",r),tt("minY",o),tt("maxX",s),tt("maxY",c),tt("width",s-r),tt("height",c-o),tt("cX",r+(s-r)/2),tt("cY",o+(c-o)/2)].concat(d(Object.entries(np(np({},e),l)).map((function(e){var t=b(e,2),n=t[0],r=t[1];return tt(n,r)})))))({})}},ip=function(){var e,t,n,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=i.duration,a=void 0===o?250:o,s=i.delay,u=void 0===s?0:s,c=i.interpolator,l=i.easing,f=void 0===l?de:l,h=i.endValue,p=i.getter,d=i.setter,g=i.onDone,m=void 0===g?st:g,v=h,y=function(){e=p(),(r=null!==e)||console.warn("Invalid start value for animation: ".concat(e))},b=function(){u?setTimeout(y,u):y()},w=function(){return!!r&&(t||(t=performance.now()),(n=performance.now()-t)>=a?(d(v),!0):(d(c(e,v,f(n/a))),!1))},x=function(e){f=e},S=function(e){v=e};return{get dt(){return n},get duration(){return a},onDone:m,register:b,update:w,updateEndValue:S,setEasing:x}},op=function(e){var t=e.name,n=e.pubSub,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.duration,o=r.delay,a=r.eps,s=void 0===a?1e-6:a;return function(e){var r,a=function(){return e[t]},u=function(n){e["set".concat($e(t))](n)};return Ye(e,g({},"animate".concat($e(t)),(function(e){if(Math.abs(e-a())<s)u(e);else{var t=i;r&&(n.publish("cancelAnimation",r),r.dt<r.duration&&(t=r.dt)),r=ip({delay:o,duration:t,interpolator:me,endValue:e,getter:a,setter:u}),n.publish("startAnimation",r)}})))}},ap=function e(n){var r=n.image,i=n.item,o=n.pubSub,a=new t.Container;a.__pilingjs__item=i;var s=function(e){r=e,a.removeChildren(),a.addChild(r.displayObject)};return function(e){return e.displayObject.addChild(e.image.displayObject),e.enableInteractivity(),e}(Ke(tt("displayObject",a),et("x",(function(){return a.x})),et("y",(function(){return a.y})),tt("id",i.id),et("image",(function(){return r})),tt("item",i),function(e){var t=e.name,n=e.pubSub,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.initialValue,o=r.getter,a=r.setter,s=r.cloner,u=r.transformer,c=r.validator,l=r.duration,f=r.delay;return function(e){return Ke(Je(t,{initialValue:i,getter:o,setter:a,cloner:s,transformer:u,validator:c}),op({name:t,pubSub:n},{duration:l,delay:f}))(e)}}({name:"opacity",pubSub:o},{getter:function(){return a.alpha},setter:function(e){a.alpha=e}}),function(e){return function(t){return Ye(t,{destroy:function(){return e.destroy()}})}}(a),(function(e){return Ye(e,{moveTo:function(t,n){Number.isNaN(+t)||Number.isNaN(+n)||(e.displayObject.x=t,e.displayObject.y=n)}})}),function(e){return function(t){return Ye(t,{pointerOverHandler:function(){e.publish("itemOver",{item:t})},pointerOutHandler:function(){e.publish("itemOut",{item:t})},disableInteractivity:function(){t.displayObject.interactive=!1,t.displayObject.buttonMode=!1,t.displayObject.off("pointerover",t.pointerOverHandler),t.displayObject.off("pointerout",t.pointerOutHandler)},enableInteractivity:function(){t.displayObject.interactive=!0,t.displayObject.buttonMode=!0,t.displayObject.on("pointerover",t.pointerOverHandler),t.displayObject.on("pointerout",t.pointerOutHandler)}})}}(o),(function(e){return Ye(e,{replaceImage:s})}),Ze(e))({}))},sp=Symbol("Normal"),up=Symbol("Hover"),cp=Symbol("Focus"),lp=Symbol("Active"),fp=new Map;fp.set(sp,""),fp.set(up,"Hover"),fp.set(cp,"Focus"),fp.set(lp,"Active");var hp=function(e){switch(e){case"left":return 0;case"right":return 1;default:return.5}},pp=function(e){switch(e){case"top":return 0;case"bottom":return 1;default:return.5}},dp=function(e){var n,r,i,o,a,s,u,c,l,f,h,p,g,m=e.render,v=e.id,y=e.pubSub,w=e.store,x=e.badgeFactory,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},k=S.x,M=void 0===k?0:k,E=S.y,O=void 0===E?0:E,A=[],P=new Map,j=new Map,C=new Map,_=new Map,I=new Set,R=new t.Container,T=new t.Graphics,L=new t.Container,B=new t.Container,N=new t.Container,D=new t.Container,z=new t.Container,F=new t.Container,V=new t.Container,U=new t.Container,Y=rp({id:v}),X=Y(),q=Y(),H=!1,G=!1,$=!1,W=!1,K=!1,Z=-1,Q=[0,0],J=sp,ee=1,te=1,ne=1,re=[],ie=function(){u&&u.destroy(),R.destroy(),re.forEach((function(e){y.unsubscribe(e)}))},oe=function(e){var t=bn(e.item.image.displayObject);return n?(t.x=z.x,t.y=z.y):(t.x=e.displayObject.x,t.y=e.displayObject.y),t.angle=e.displayObject.angle,t},ae=function(e){var t=e.item;if(H&&!R.isDragging){var n=oe(t);if(F.addChild(n),z.visible=!1,i=t.id,dt(t)){var r=w.state,o=r.previewBorderColor,a=r.previewBorderOpacity,s=r.items,u=A.indexOf(t),c=Bn(o,s[t.id],u),l=Bn(a,s[t.id],u);t.image.setBackgroundColor(ue(c)),t.image.setBackgroundOpacity(l),t.image.rescaleBackground(!0),U.addChild(t.displayObject)}m()}},se=function(){var e=w.state,t=e.pileBackgroundColor,n=e.piles,r=e.darkMode,i=Nn(t,n[v]);return null!==i?i:r?0:Un},ue=function(e){return null!==e?e:w.state.darkMode?Un:0},ce=function(e){var t=e.item;if(H){for(z.visible=!0;F.children.length;)F.removeChildAt(0);if(dt(t)){var n=w.state,r=n.previewBackgroundColor,i=n.previewBackgroundOpacity,o=n.pileBackgroundOpacity,a=n.items,s=n.piles,u=A.indexOf(t),c=se(),l=r===Hn?c:Bn(r,a[t.id],u),f=i===Hn?Nn(o,s[v]):Bn(i,a[t.id],u);t.image.setBackgroundColor(l),t.image.setBackgroundOpacity(f),D.addChild(t.displayObject)}m()}},le={drawCall:-1},fe=0,he=function(){if(le.drawCall===fe)return le;var e=T.getBounds(),t=L.getBounds();return le={drawCall:fe,x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}},pe=function(){if(!$){var e=w.state,t=e.darkMode,n=e.piles,i=e.pileSizeBadgeAlign,o=Se(i)?i(n[v]):i,a=b(o,2),c=a[0],l=a[1],f=hp(l),h=pp(c),p=A.length,d=p!==s,g=u;d&&(g=x.create(p,{darkMode:t}),void 0!==s&&(R.removeChild(u.displayObject),u.destroy()));var y=function(){var e=he();g.displayObject.x=e.x-we+(e.width+2*we)*f,g.displayObject.y=e.y-we+(e.height+2*we)*h,d&&R.addChild(g.displayObject),u=g,s=p,m()};N.children.length||z.children.length?y():r&&r.then(y)}},de=!1,ye=function(e){(de=e)?pe():u&&(R.removeChild(u.displayObject),u.destroy(),s=void 0)},we=0,xe=function(e){we=+e,r?(Ee(),r.then((function(){Ee()}))):Ee()},ke=function(){switch(J){case up:case cp:return we||1;case lp:return we||2;case sp:default:return we}},Me=function(){var e=w.state,t=e.pileBackgroundOpacityHover,n=e.piles,r=Nn(w.state["pileBackgroundOpacity".concat(fp.get(J)||"")],n[v]);return null===r&&(r=Nn(t,n[v])),r},Ee=function e(){++fe;var t=ke(),n=Me();if(t||n)if($)qe.set("drawBorder",(function(){e()}));else{T.clear();var r=he(),i=w.state,o=Math.ceil(t/2),a=Nn(i["pileBackgroundColor".concat(fp.get(J)||"")],i.piles[v]);null===a&&(a=se()),T.beginFill(a,n),T.drawRect(r.x-o,r.y-o,r.width+2*o,r.height+2*o),T.endFill();var s=i["pileBorderColor".concat(fp.get(J)||"")],u=Nn(i["pileBorderOpacity".concat(fp.get(J)||"")],i.piles[v]);s=Se(s)?wn(s(i.piles[v]))[0]:s,T.lineStyle(t,s,u),T.drawRect(r.x-o,r.y-o,r.width+2*o,r.height+2*o),de&&pe(),m()}else T.clear()},Oe=function(){J=sp,Ee()},Ae=function(){J!==up&&(J=up,Ee())},Pe=function(){J!==cp&&(J=cp,Ee())},je=function(){J!==lp&&(J=lp,Ee())},Ce=!1,_e=function(e){Ce=!0,y.publish("pileEnter",{target:w.state.piles[v],event:e}),H?G?je():Pe():Ae(),o||(o=y.subscribe("itemOver",ae),re.push(o)),a||(a=y.subscribe("itemOut",ce),re.push(a))},Ie=function(e){R.isDragging||(Ce=!1,y.publish("pileLeave",{target:w.state.piles[v],event:e}),H||Oe(),o&&(y.unsubscribe(o),o=void 0),a&&(y.unsubscribe(a),a=void 0),F.removeChildren(),m())},Re=function(e){2!==e.data.button&&(R.draggingMouseOffset=[e.data.getLocalPosition(R.parent).x-R.x,e.data.getLocalPosition(R.parent).y-R.y],R.alpha=1,R.isDragging=!0,R.beforeDragX=R.x,R.beforeDragY=R.y,c=!1,y.publish("pileDragStart",{target:w.state.piles[v],event:e}))},Te=function(e){2!==e.data.button&&R.isDragging&&(R.alpha=1,R.isDragging=!1,R.draggingMouseOffset=null,c&&y.publish("pileDragEnd",{target:w.state.piles[v],event:e}))},Le=function(e){if(2!==e.data.button&&R.isDragging){c=!0,y.publish("pileDragMove",{target:w.state.piles[v],event:e});var t=e.data.getLocalPosition(R.parent),n=t.x,r=t.y;n-=R.draggingMouseOffset[0],r-=R.draggingMouseOffset[1],ke()%2==1&&(n=Math.floor(n)+.5,r=Math.floor(r)+.5),K?h.updateEndValue([n,r]):(R.x=n,R.y=r),G?je():Ae(),m()}},Be=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,o=0,a=0;if(r){if(!z.children.length)return q;e=z.getBounds(!i)}else if(e=N.getBounds(!i),A.length>1){var s=A[0].displayObject.getBounds(!i);o=e.x-s.x,a=e.y-s.y}return Y({localXOffset:o,localYOffset:a,minX:e.x-t,minY:e.y-n,maxX:e.x+e.width-t,maxY:e.y+e.height-n})},Ne=function(e,t,n){q=Be(e,t,n)},De=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=B.getBounds(!n);return Y({minX:r.x-e,minY:r.y-t,maxX:r.x+r.width-e,maxY:r.y+r.height-t})},ze=function(e,t,n){X=De(e,t,n)},Fe=function(e,t,n){Ne(e,t,n),ze(e,t,n)},Ve=function(){return R.alpha},Ue=function(e){R.alpha=e},Ye=function(e){var t=Math.abs(e-Ve());if(t<.01)Ue(e);else{var n=250*ge(t);l&&(y.publish("cancelAnimation",l),l.dt<l.duration&&(n=l.dt)),l=ip({duration:n,delay:0,interpolator:me,endValue:e,getter:Ve,setter:Ue}),y.publish("startAnimation",l)}},Xe=function(e){N.visible=e,D.visible=e},qe=new Map,He=function(e,t,n,r,i,o){var a=e.tmpTargetScale||e.scale.x;e.tmpTargetScale=void 0,delete e.tmpTargetScale;var s=ip({duration:250,interpolator:ve,endValue:[t,n,a,r],getter:function(){return[e.x,e.y,e.scale.x,e.angle]},setter:function(t){e.x=t[0],e.y=t[1],e.scale.x=t[2],e.scale.y=t[2],e.angle=t[3]},onDone:function(){e.tmpTargetScale=void 0,o&&($=!1,Ee(),_t(),qe.forEach((function(e){e()})),qe.clear(),y.publish("updatePileBounds",{id:v}),It&&Tt())}});i.add(s)},Ge=function(e){var t=new Map;e.forEach((function(e,n){t.set(e.toString(),n)}));var n=function(e){return function(n,r){var i=e.get(n),o=e.get(r);return t.get(i)-t.get(o)}};N.children.sort(n(C)),D.children.sort(n(_)),A.sort((function(e,n){return t.get(e.id)-t.get(n.id)}))},$e=function(e,t){var n=w.state,i=n.piles,o=n.previewScaleToCover,a=i[v],s=Se(o)?o(a):o,u=b(s,2),c=u[0],l=u[1],f=function(t){if(!0===c){var n=t.width/e.width;e.scale.x*=n,"auto"===l&&(e.scale.y*=n)}else if(!0===l){var r=t.height/e.height;e.scale.y*=r,"auto"===c&&(e.scale.x*=r)}else!0===c&&!0===l&&(e.scale.x*=t.width/e.width,e.scale.y*=t.height/e.height)};t?f(t):r?r.then(f):f(he())},We=function(e){var t=w.state,n=t.piles,i=t.previewAlignment,o=t.previewItemOffset,a=t.previewOffset,s=t.previewSpacing,u=n[v];r.then((function(t){var n=Se(i)?i(u):i,r=Se(a)?a(u):a,c=Se(s)?s(u):s;r=null!==r?r:c/2;var l=c/2,f=t.width/2,h=t.height/2;$=D.children.length>0;var p=[0,0],g=[0,0];D.children.forEach((function(i,a){var s,c=i.__pilingjs__item,m=w.state.items[c.id];if($e(i,t),Se(o))(s=o(m,a,u))[0]=s[0]*t.scaleFactor-f,s[1]=s[1]*t.scaleFactor-h;else{switch(n){case"left":s=[(0===a)*(-f-r)+p[0]-g[0]/2-i.width/2-l,0];break;case"right":s=[(0===a)*(f+r)+p[0]+g[0]/2+i.width/2+l,0];break;case"bottom":s=[0,(0===a)*(h+r)+p[1]+g[1]/2+i.height/2+l];break;default:case"top":s=[0,(0===a)*(-h-r)+p[1]-g[1]/2-i.height/2-l]}p=d(s),g=[i.width,i.height]}c.preview.setBackgroundOpacity(0),He(i,s[0],s[1],0,e,a===D.children.length-1)}))}))},Ke=function(e,t){var n=t.all,i=void 0!==n&&n,o=w.state,a=o.piles,s=o.pileItemOffset,u=o.pileItemRotation,c=a[v];if(r&&D.children.length)We(e);else if(N.children.length>1)if(i)$=!0,N.children.forEach((function(t,n){var r=t.__pilingjs__item,i=P.get(r.id),o=w.state.items[r.id],a=A.indexOf(i),l=Se(s)?s(o,a,c):s.map((function(e){return e*a})),f=Se(u)?u(o,a,c):u;He(t,l[0],l[1],f,e,n===N.children.length-1)}));else if(I.size){$=!0;var l=0;I.forEach((function(t){l++;var n=t.item,r=t.displayObject,i=Qe();if(r.tmpTargetScale=r.scale.x,!Number.isNaN(+n.tmpRelScale)){var o=n.tmpRelScale/i;r.scale.x*=o,r.scale.y=r.scale.x,delete n.tmpRelScale}Number.isNaN(+n.tmpAbsX)||Number.isNaN(+n.tmpAbsY)||(t.moveTo((t.x+n.tmpAbsX-R.x)/i,(t.y+n.tmpAbsY-R.y)/i),delete n.tmpAbsX,delete n.tmpAbsY);var a=w.state.items[n.id],f=A.indexOf(t),h=Se(s)?s(a,f,c):s.map((function(e){return e*f})),p=Se(u)?u(a,f,c):u;He(r,h[0],h[1],p,e,l===I.size)}))}else It&&Tt();else It&&Tt();I.clear()},Ze=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee;L.scale.x=e*te,L.scale.y=e*te},Qe=function(){return L.scale.x/te},Je=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.isMagnification,r=void 0!==n&&n;r||(ee=e),Ze(e)},et=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.isMagnification,r=void 0!==n&&n,i=t.onDone,o=void 0===i?st:i,a=be(Qe(),e*te,9),s=function(){Ee(),_t(),a||y.publish("updatePileBounds",{id:v,forceUpdate:!0}),o()},u=function(){Je(e,{isMagnification:r}),s()};if(be(Qe(),e*te,3))u();else{r||(ee=e);var c=Math.max(X.width,X.height),l=Math.abs(e/Qe()*c-c);if(l<2)u();else{W=!0;var h=250*ge(Math.min(l,50)/50);f&&(y.publish("cancelAnimation",f),f.dt<f.duration&&(h=f.dt)),f=ip({duration:h,delay:0,interpolator:me,endValue:e,getter:Qe,setter:function(e){Je(e,{isMagnification:r}),Ee()},onDone:function(){W=!1,qe.forEach((function(e){return e()})),qe.clear(),s()}}),y.publish("startAnimation",f)}}},tt=function(e){var t=Math.log(Math.abs(e)+1),n=-Math.sign(e)*t,r=Qe(),i=Math.min(Math.max(1,r*(1+.075*n)),3*ee);return ne=i/ee,Je(i,{isMagnification:!0}),r!==i},nt=function(){ne=3,et(3*ee,{isMagnification:!0})},it=function(){ne=1,et(ee,{isMagnification:!0})},at=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.easing,i=n.onDone,o=void 0===i?st:i,a=rt(e,t,R.x,R.y);if(a<3)return lt(e,t),a>1e-9&&y.publish("updatePileBounds",{id:v}),o(),null;K=!0;var s=250*ge(Math.min(a,250)/250);return h&&(y.publish("cancelAnimation",h),h.dt<h.duration&&(s=h.dt)),ip({duration:s,delay:0,easing:r,interpolator:ve,endValue:[e,t],getter:function(){return[R.x,R.y]},setter:function(e){return lt(e[0],e[1])},onDone:function(){K=!1,y.publish("updatePileBounds",{id:v}),o()}})},ut=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.easing,i=n.onDone,o=void 0===i?st:i;return new Promise((function(n){Nt(),(h=at(e,t,{easing:r,onDone:function(){n(w.state.piles[v]),Dt(),o()}}))&&y.publish("startAnimation",h)}))},ct=function(){var e=A[0].item.image;e.scaleFactor!==Z&&(Z=e.scaleFactor,Q=e.center)},lt=function(e,t){return R.x=Math.round(e),R.y=Math.round(t),Math.hypot(R.x-e,R.y-t)>1e-9},ft=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e){var t=ht(e);if(pt(t)){var n=t.item.image;t.replaceImage(n)}else if(dt(t)){var r=t.item.preview;r?t.replaceImage(r):mt(t.item)}}else P.forEach((function(e){e.replaceImage(e.item.image)})),j.forEach((function(e){e.item.preview?e.replaceImage(e.item.preview):mt(e.item)}))},ht=function(e){return P.get(e)||j.get(e)},pt=function(e){return P.has(e.id)},dt=function(e){return j.has(e.id)},gt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.asPreview,r=void 0===n?null:n;return!1===r?pt(e):!0===r?dt(e):pt(e)||dt(e)},mt=function(e){if(!gt(e,{asPreview:!1})){var t=ht(e.id),n=ap({image:e.image,item:e,pubSub:y}),r=A.indexOf(t);A.splice(r,1,n),_.delete(j.get(e.id).displayObject),C.set(n.displayObject,e.id),j.delete(e.id),P.set(e.id,n),D.removeChildAt(D.getChildIndex(t.displayObject)),N.addChild(n.displayObject)}},vt=function(e){if(!gt(e,{asPreview:!0})&&e.preview){var t=ht(e.id),n=ap({image:e.preview,item:e,pubSub:y}),r=A.indexOf(t);A.splice(r,1,n),C.delete(P.get(e.id).displayObject),_.set(n.displayObject,e.id),P.delete(e.id),j.set(e.id,n),N.removeChildAt(N.getChildIndex(t.displayObject)),$e(n.displayObject),D.addChild(n.displayObject)}},yt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.asPreview,r=void 0!==n&&n;!0===r?vt(e):mt(e)},bt=function(e){var t=ap({image:e.image,item:e,pubSub:y});A.push(t)>1&&I.add(t),P.set(t.id,t),C.set(t.displayObject,t.id),N.addChild(t.displayObject)},wt=function(e){if(e.preview){var t=ap({image:e.preview,item:e,pubSub:y});A.push(t),I.add(t),j.set(t.id,t),_.set(t.displayObject,t.id),$e(t.displayObject),D.addChild(t.displayObject)}},xt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.asPreview,r=void 0!==n&&n;gt(e)?gt(e,{asPreview:!r})&&yt(e,{asPreview:r}):(r?wt(e):bt(e),1===A.length&&ct())},St=function(e){var t=ht(e.id),n=A.indexOf(t);n>=0&&A.splice(n,1),gt(e,{asPreview:!1})&&(N.removeChildAt(N.getChildIndex(t.displayObject)),C.delete(t.displayObject)),gt(e,{asPreview:!0})&&(D.removeChildAt(D.getChildIndex(t.displayObject)),_.delete(t.displayObject)),P.delete(e.id),j.delete(e.id)},kt=function(){N.removeChildren(),D.removeChildren(),A.splice(0,A.length),P.clear(),j.clear(),C.clear(),_.clear()},Mt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.asPreview,r=void 0!==n&&n,i=t.shouldDrawPlaceholder,o=void 0!==i&&i;o&&Rt();var a=ot(P,j);e.forEach((function(e){gt(e)?(a.delete(e.id),yt(e,{asPreview:r})):xt(e,{asPreview:r})})),a.forEach((function(e){St(e)}))},Et=function(e){e?(r=e).then((function(e){for(n=e;z.children.length;)z.removeChildAt(0);z.addChild(n.displayObject),y.publish("updatePileBounds",{id:v,forceUpdate:!0}),Ee()})):Ot()},Ot=function(){if(n){for(;z.children.length;)z.removeChildAt(0);n=void 0,r=void 0}},At=[],Pt=[],jt=[],Ct=[],_t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pt,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jt,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ct;if(e.length){if(At=e,Pt=n,jt=r,Ct=i,!$&&!W){p?(p.clear(),p.removeChildren()):(p=new t.Graphics,R.addChild(p));var o=w.state,a=o.pileLabelHeight,s=o.pileLabelAlign,u=o.pileLabelFontSize,c=o.pileLabelStackAlign,l=o.pileLabelText,f=o.pileLabelTextOpacity,h=o.piles,g=Nn(s,h[v]),y=Nn(u,h[v]),b=Nn(c,h[v]),x=Nn(a,h[v]),S=he(),k=Se(l)?l(h[v]):l,M=S.width/e.length,E=jt.length?Math.max(k*(y+1),x):x,O="top"===g?S.y-E:S.y+S.height,A=1+-2*(O<0);if(e.forEach((function(e,t){var r,o,a=O+A,s=E;switch(b){case"vertical":M=S.width*i[t],o=-S.width/2,a+=(s+1)*t*A;break;case"horizontal":default:o=M*t-S.width/2,s=E*i[t],"top"===g&&(a+=E-s)}var u=n[t];(r=p).beginFill.apply(r,d(u)),p.drawRect(o,a,M,s),p.endFill()})),k){var P=S.width/jt.length;jt.forEach((function(e,n){var r=new t.Sprite(e);switch(r.y=O+A,b){case"vertical":r.anchor.set(0,0),r.x=-S.width/2+2,r.y+=(E+1)*n*A;break;case"horizontal":default:r.anchor.set(.5,0),r.x=P*n-S.width/2+P/2}r.width/=2*window.devicePixelRatio,r.height/=2*window.devicePixelRatio,r.alpha=f,p.addChild(r)}))}m()}}else p&&(At=[],Pt=[],jt=[],p.clear(),p.removeChildren(),m())},It=!1,Rt=function(){g||(g=new t.Graphics,L.addChild(g));var e=q.width/ee/te,n=q.height/ee/te,r=e/12,i=w.state.darkMode?16777215:0;g.lineStyle(0).beginFill(i,1).drawCircle(-e/4,0,r).drawCircle(0,0,r).drawCircle(e/4,0,r).endFill(),g.beginFill(i,.1).drawRect(-e/2,-n/2,e,n).endFill(),It=!0,m()},Tt=function(){g.clear(),It=!1,m()},Lt=function(e){te=e,Ze()},Bt=!1,Nt=function(){Bt&&(A.forEach((function(e){return e.disableInteractivity()})),R.interactive=!1,R.buttonMode=!1,V.interactive=!1,R.off("pointerover",_e).off("pointerout",Ie).off("pointerdown",Re).off("pointerup",Te).off("pointerupoutside",Te).off("pointermove",Le),Bt=!1)},Dt=function(){Bt||(A.forEach((function(e){return e.enableInteractivity()})),R.interactive=!0,R.buttonMode=!0,V.interactive=!0,R.on("pointerover",_e).on("pointerout",Ie).on("pointerdown",Re).on("pointerup",Te).on("pointerupoutside",Te).on("pointermove",Le),Bt=!0)},zt=function(){R.addChild(B),B.addChild(T),B.addChild(L),L.addChild(N),L.addChild(D),L.addChild(z),L.addChild(F),L.addChild(V),L.addChild(U),R.x=M,R.y=O,Dt()};return zt(),{get anchorBox(){return q},get baseScale(){return ee},get bBox(){return X},get cover(){return n},get graphics(){return R},get contentContainer(){return L},get height(){return B.height},get isFocus(){return H},set isFocus(e){H=!!e},get isHover(){return Ce},get isInteractive(){return Bt},get isMagnified(){return ne>1},get isTempDepiled(){return G},set isTempDepiled(e){G=!!e},get normalItemContainer(){return N},get offset(){return[(Q[0]-q.localXOffset)*ee,(Q[1]-q.localYOffset)*ee]},get previewItemContainer(){return D},get previewItemId(){return i},get items(){return[].concat(A)},get magnification(){return ne},get size(){return A.length},get tempDepileContainer(){return V},get width(){return B.width},get x(){return R.x},get y(){return R.y},id:v,animateMoveTo:ut,animateOpacity:Ye,animateScale:et,blur:Oe,disableInteractivity:Nt,enableInteractivity:Dt,hover:Ae,focus:Pe,active:je,addItem:xt,animatePositionItems:He,calcBBox:De,destroy:ie,drawBorder:Ee,drawPlaceholder:Rt,drawSizeBadge:pe,getMoveToTweener:at,getItemById:ht,hasItem:gt,itemOverHandler:ae,itemOutHandler:ce,magnifyByWheel:tt,magnify:nt,moveTo:lt,positionItems:Ke,removeAllItems:kt,removePlaceholder:Tt,setBorderSize:xe,setItems:Mt,drawLabel:_t,setCover:Et,setScale:Je,setOpacity:Ue,setVisibilityItems:Xe,setItemOrder:Ge,setZoomScale:Lt,showSizeBadge:ye,updateBounds:Fe,updateOffset:ct,replaceItemsImage:ft,unmagnify:it}};function gp(e,t,n){var r=n[0],i=n[1];if(Math.abs(t)<1e-6)return e<0;var o=e/t;if(t>0){if(o>i)return 0;o>r&&(n[0]=o)}else{if(o<r)return 0;o<i&&(n[1]=o)}return 1}function mp(e,t,n,r,i){var o=e[0],a=e[1],s=t[0]-o,u=t[1]-a;if(void 0===r||void 0===i?(r=e,i=t):(r[0]=e[0],r[1]=e[1],i[0]=t[0],i[1]=t[1]),Math.abs(s)<1e-6&&Math.abs(u)<1e-6&&o>=n[0]&&o<=n[2]&&a>=n[1]&&a<=n[3])return 1;var c=[0,1];if(gp(n[0]-o,s,c)&&gp(o-n[2],-s,c)&&gp(n[1]-a,u,c)&&gp(a-n[3],-u,c)){var l=c[0],f=c[1];return f<1&&(i[0]=o+f*s,i[1]=a+f*u),l>0&&(r[0]+=l*s,r[1]+=l*u),1}return 0}function vp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vp(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bp=function(e){var t=e.width,n=e.height,r=e.orderer,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.cellSize,a=void 0===o?null:o,s=i.columns,u=void 0===s?10:s,c=i.rowHeight,l=void 0===c?null:c,f=i.cellAspectRatio,h=void 0===f?1:f,p=i.pileCellAlignment,g=void 0===p?"topLeft":p,m=i.cellPadding,v=void 0===m?0:m,y=u;+a||+u||(y=10);var w=t/y,x=w-2*v,S=null;+a&&(w=a+2*v,y=Math.floor(t/w),x=a),+l?h=w/l:(+h||(h=1),l=w/h),S=l-2*v;var k=w/2,M=l/2,E=Me([k,M]),O=Math.ceil(n/l),A=function(e,t){return e*y+t},P=r(y),j=function(e,t){return[Math.floor(t/l),Math.floor(e/w)]},C=function(e,t,n,r,i){var o=e*l+v,a=t*w+v;if(!n||!r)return[a,o];switch(a+=i[0],o+=i[1],g){case"topRight":return[a+x-n,o];case"bottomLeft":return[a,o+S-r];case"bottomRight":return[a+x-n,o+S-r];case"center":return[a+(x-n)/2,o+(S-r)/2];case"topLeft":default:return[a,o]}},_=function(e,t,n,r){return C.apply(void 0,d(P(e)).concat([t,n,r]))},I=function(e,r){return[e*t,r*n]},R=function(e){var t="minX",n="minY";switch(g){case"topRight":t="maxX";break;case"bottomLeft":n="maxY";break;case"bottomRight":t="maxX",n="maxY";break;case"center":t="cX",n="cY"}return[e.anchorBox[t],e.anchorBox[n]]},T=function(e){var t=[],n=[],r=new Map;e.forEach((function(e){var t=R(e),n=b(t,2),i=n[0],o=n[1];r.set(e.id,yp(yp({id:e.id},e.anchorBox),{},{x:i,y:o,offset:e.offset}))}));var i=function(e){var r,i,o=(e.minY+1)/l,a=(e.minX+1)/w,s=(e.maxY-1)/l,u=(e.maxX-1)/w;switch(g){case"topRight":i=Math.floor(u);break;case"bottomLeft":r=Math.floor(s);break;case"bottomRight":r=Math.floor(s),i=Math.floor(u);break;case"center":r=Math.floor(o+(s-o)/2),i=Math.floor(a+(u-a)/2);break;case"topLeft":default:r=Math.floor(o),i=Math.floor(a)}var c=A(r,i);return t[c]||(t[c]=new Set),1===t[c].size&&n.push(c),t[c].add(e.id),[r,i]};r.forEach((function(e){var t=i(e),n=b(t,2),o=n[0],a=n[1];r.set(e.id,yp(yp({},e),{},{i:o,j:a}))}));for(var o=function(){var e=n.shift(),o=C.apply(void 0,d(P(e))),a=[o[0],o[1],o[0]+w,o[1]+l];o[0]+=k,o[1]+=M;var s=new Set(t[e]),u=nt,c=e-y,f=c<0||t[c]&&t[c].size,h=e-1,p=h<0||e%y==0||t[h]&&t[h].size,g=e+1,m=g%y==0||t[g]&&t[g].size,v=function(e){return e},x=function(e){return e};f&&(o[1]-=M,x=function(e){return Math.max(0,e)}),p&&(o[0]-=k,v=function(e){return Math.max(0,e)}),m&&(o[0]+=k,v=p?function(){return 0}:function(e){return Math.min(0,e)}),p&&m&&(x=function(){return f?1:-1},f&&(u=function(e,t,n,r){return Math.abs(t-r)})),f&&p&&m&&(x=function(){return f?1:-1});var S=1/0,O=void 0;s.forEach((function(e){var t=r.get(e),n=u(t.x,t.y,o[0],o[1]);n<S&&(O=e,S=n)})),s.forEach((function(n){n!==O&&t[e].delete(n)})),s.forEach((function(e){if(e!==O){var t=r.get(e),n=[t.x-r.get(O).x,t.y-r.get(O).y];n[0]+=(Math.sign(n[0])||1)*Math.random(),n[1]+=(Math.sign(n[1])||1)*Math.random(),n=Re([v(n[0]),x(n[1])]);var o=[t.x+E*n[0],t.y+E*n[1]],s=[].concat(o);mp([t.x,t.y],s,a),s[0]+=.1*Math.sign(n[0]),s[1]+=.1*Math.sign(n[1]);var u=s[0]-t.x,c=s[1]-t.y;t.minX+=u,t.minY+=c,t.maxX+=u,t.maxY+=c,t.cX+=u,t.cY+=c,t.x+=u,t.y+=c;var l=i(t),f=b(l,2),h=f[0],p=f[1];r.set(e,yp(yp({},t),{},{i:h,j:p}))}}))};n.length;)o();return Array.from(r.entries(),(function(e){var t=b(e,2),n=t[0],i=t[1],o=i.i,a=i.j,s=C(o,a,r.get(n).width,r.get(n).height,r.get(n).offset),u=b(s,2);return{id:n,x:u[0],y:u[1]}}))};return{get numRows(){return O},set numRows(e){Number.isNaN(+e)||(O=e)},numColumns:y,columnWidth:w,rowHeight:l,cellWidth:x,cellHeight:S,cellAspectRatio:h,cellPadding:v,width:t,height:n,align:T,getPilePosByCellAlignment:R,ijToXy:C,ijToIdx:A,idxToIj:P,idxToXy:_,uvToXy:I,xyToIj:j}},wp=function e(t){var n=t.id,r=t.image,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.preview,a=void 0===o?null:o,s=i.originalPosition,u=void 0===s?[0,0]:s,c=function(){return function(e){return Ye(e,{destroy:function(){r&&r.destroy(),a&&a.destroy()}})}},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r.destroy(),r=e,a&&(a.destroy(),a=null),a=t},f=function(){return function(e){return Ye(e,{replaceImage:l})}};return Ke(tt("id",n),et("image",(function(){return r})),et("preview",(function(){return a})),Je("originalPosition",{initialValue:u,cloner:function(e){return d(e)}}),c(),f(),Ze(e))({})},xp=s((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){const n=RegExp(e,"g");return e=>{if("string"!=typeof e)throw new TypeError("expected an argument of type string, but got ".concat(typeof styleObj));return e.match(n)?e.replace(n,t):e}};t.default=n})),Sp=s((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.snakeToKebab=t.camelToKebab=void 0;var n,r=(n=xp)&&n.__esModule?n:{default:n};const i=(0,r.default)(/[A-Z]/,e=>"-".concat(e.toLowerCase()));t.camelToKebab=i;const o=(0,r.default)(/_/,()=>"-");t.snakeToKebab=o})),kp=s((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t=Sp.camelToKebab){if(!e||"object"!=typeof e||Array.isArray(e))throw new TypeError("expected an argument of type object, but got ".concat(typeof e));return Object.keys(e).map(n=>"".concat(t(n),": ").concat(e[n],";")).join("\n")};t.default=n})),Mp=a(s((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createParser",{enumerable:!0,get:function(){return r.default}}),t.parsers=t.default=void 0;var n=o(kp),r=o(xp),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(Sp);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.parsers=i;var s=n.default;t.default=s,e.exports=n.default,e.exports.createParser=r.default,e.exports.parsers=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({},i)}))),Ep={root:{position:"absolute",zIndex:2,display:"none"},ul:{listStyle:"none",padding:0,margin:0,borderRadius:"0.25rem",backgroundColor:"white",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.25), 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 2px 6px 0 rgba(0, 0, 0, 0.075)"},button:{width:"100%",height:"1.5rem",margin:0,padding:"0.25rem 0.5rem",fontSize:"0.85rem",color:"black",border:"none",backgroundColor:"transparent",cursor:"pointer",outline:"none",whiteSpace:"nowrap"},"button:hover":{backgroundColor:"#ff7ff6"},"button:active":{backgroundColor:"#dd33ff"},"button.inactive":{cursor:"default",opacity:.3,backgroundColor:"transparent !important"},"li:first-child > button":{borderRadius:"0.25rem 0.25rem 0 0"},"li:last-child > button":{borderRadius:"0 0 0.25rem 0.25rem"}},Op='<ul id="piling-js-context-menu-list">\n  <li>\n    <button id="depile-button">Depile All</button>\n  </li>\n  <li>\n    <button id="extract-button">Extract This Item</button>\n  </li>\n  <li>\n    <button id="temp-depile-button">Temp. Depile</button>\n  </li>\n  <li>\n    <button id="browse-separately">Browse Separately</button>\n  </li>\n  <li>\n    <button id="grid-button">Show Grid</button>\n  </li>\n  <li>\n    <button id="align-button">Align by Grid</button>\n  </li>\n  <li>\n    <button id="magnify-button">Magnify</button>\n  </li>\n</ul>',Ap=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.template,n=void 0===t?Op:t,r=e.styles,i=void 0===r?Ep:r,o=e.customItems,a=void 0===o?[]:o,s=document.createElement("nav");s.id="piling-js-context-menu";var u=document.createElement("style");u.setAttribute("type","text/css");var c="";Object.entries(i).forEach((function(e){var t=b(e,2),n=t[0],r=t[1],i="root"===n?"":" ".concat(n);c+="#piling-js-context-menu".concat(i," { ").concat(Mp(r)," }\n")})),u.textContent=c,s.appendChild(u),s.insertAdjacentHTML("beforeend",n);var l=s.querySelector("#piling-js-context-menu-list");return a.forEach((function(e,t){var n=document.createElement("li"),r=document.createElement("button");r.textContent=e.label,e.id?r.id=e.id:r.id="piling-js-context-menu-custom-item-".concat(t),n.appendChild(r),l.appendChild(n)})),s},Pp=function(){return De('<svg class="pilingjs-spinner" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg" width="40" height="40">\n  <circle\n    class="pilingjs-spinner-circle"\n    cx="20"\n    cy="20"\n    r="18"\n    stroke-width="4"\n    fill="none"\n    stroke="black" />\n  <g class="pilingjs-spinner-block-offset" transform="translate(20, 20)">\n    <g class="pilingjs-spinner-blocks">\n      <animateTransform\n        attributeName="transform"\n        attributeType="XML"\n        dur="1.5s"\n        from="0"\n        repeatCount="indefinite"\n        to="360"z\n        type="rotate" />\n      <path\n        class="pilingjs-spinner-block-one"\n        d="M0-20c1.104,0,2,0.896,2,2s-0.896,2-2,2V0l-4,21h25v-42H0V-20z"\n        fill="white">\n        <animateTransform\n          attributeName="transform"\n          attributeType="XML"\n          calcMode="spline"\n          dur="1.5s"\n          from="0"\n          values="0; 360"\n          keyTimes="0; 1"\n          keySplines="0.2 0.2 0.15 1"\n          repeatCount="indefinite"\n          to="360"\n          type="rotate" />\n      </path>\n      <path\n        class="pilingjs-spinner-block-two"\n        d="M0-20c-1.104,0-2,0.896-2,2s0.896,2,2,2V0l4,21h-25v-42H0V-20z"\n        fill="white">\n        <animateTransform\n          attributeName="transform"\n          attributeType="XML"\n          calcMode="spline"\n          dur="1.5s"\n          from="0"\n          values="0; 360"\n          keyTimes="0; 1"\n          keySplines="0.1 0.15 0.8 0.8"\n          repeatCount="indefinite"\n          to="360"\n          type="rotate" />\n      </path>\n    </g>\n  </g>\n</svg>\n')},jp=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=Pp(),r=function(){var e=t?"white":"black",r=t?"black":"white";n.querySelector(".pilingjs-spinner-circle").setAttribute("stroke",e),n.querySelector(".pilingjs-spinner-block-one").setAttribute("fill",r),n.querySelector(".pilingjs-spinner-block-two").setAttribute("fill",r)},i=function(e){var n=e.darkMode;t=Tn(void 0===n?null:n,t),r()};return r(),Ke(tt("element",n),Ze(e))({set:i})},Cp=function(){var e=document.createElement("fake-element"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"oTransitionEnd",transition:"transitionEnd"};for(var n in t)if(void 0!==e.style[n])return t[n];return"transitionEnd"}(),_p=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.backgroundOpacity,r=void 0===n?.85:n,o=t.isDarkMode,a=void 0!==o&&o,s=r,c=a,l=function(){return c?"black":"white"},f=function(){return c?"white":"black"},h=function(){return c?"rgba(0, 0, 0, ".concat(s,")"):"rgba(255, 255, 255, ".concat(s,")")},p=document.createElement("div");p.className="pilingjs-popup-background",p.style.position="absolute",p.style.top=0,p.style.left=0,p.style.zIndex=-1,p.style.display="flex",p.style.flexDirection="column",p.style.justifyContent="center",p.style.width="100%",p.style.height="0px",p.style.background=h(),p.style.opacity=0,p.style.transition="opacity 250ms ".concat("cubic-bezier(0.645, 0.045, 0.355, 1)");var d=document.createElement("div");p.className="pilingjs-popup-wrapper",d.style.position="relative",d.style.display="flex",d.style.margin="2rem",d.style.maxHeight="100%",p.appendChild(d);var g=document.createElement("div");p.className="pilingjs-popup-window",g.style.position="relative",g.style.minwidth="4rem",g.style.maxWidth="100%",g.style.maxHeight="100%",g.style.margin="2rem auto",g.style.color=l(),g.style.borderRadius="0.5rem",g.style.background=f(),g.style.transform="scale(0)",g.style.transition="transform 250ms ".concat("cubic-bezier(0.645, 0.045, 0.355, 1)"),d.appendChild(g);var m=document.createElement("div");p.className="pilingjs-popup-content",m.style.position="relative",m.style.display="flex",m.style.flexDirection="column",m.style.alignItems="center",m.style.padding="1rem",m.style.maxHeight="calc(100vh - 4rem)",m.style.overflow="auto",g.appendChild(m);var v=document.createElement("div");p.className="pilingjs-popup-icon",m.appendChild(v);var y=jp(!c);v.appendChild(y.element);var b=document.createElement("p");b.style.margin="0",m.appendChild(b);var w=!1,x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=void 0===t?null:t,r=e.showSpinner,i=void 0===r||r;return new Promise((function(e){p.addEventListener(Cp,e,{once:!0}),w=!0,p.style.zIndex=99,p.style.height="100%",p.style.opacity=1,g.style.transform="scale(1)",v.style.display=i?"block":"none",v.style.margin=n?"0 0 0.5rem 0":"0",b.textContent=n}))},S=function(){return new Promise((function(e){w=!1,p.addEventListener(Cp,i(u.mark((function t(){return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return p.style.zIndex=-1,p.style.height="0px",b.textContent=null,t.next=5,ht();case 5:e();case 6:case"end":return t.stop()}}),t)}))),{once:!0}),p.style.opacity=0,g.style.transform="scale(0)"}))},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.backgroundOpacity,n=void 0===t?null:t,r=e.darkMode,i=void 0===r?null:r;s=Tn(n,s),c=Tn(i,c),g.style.color=l(),g.style.background=f(),p.style.background=h(),y.set({darkMode:!c})},M=function(){return function(e){return Ye(e,{close:S,open:x,set:k})}};return Ke(et("isOpen",(function(){return w})),tt("element",p),M(),Ze(e))({})},Ip=document.createElement("style");document.head.appendChild(Ip);var Rp=Ip.sheet,Tp=function(e){var t=Rp.length;return Rp.insertRule(e,t),t},Lp=function(e){Rp.deleteRule(e)},Bp="".concat(2500,"ms ease scaleInFadeOut 0s 1 normal backwards"),Np=function(e,t){return"\n@keyframes scaleInFadeOut {\n  0% {\n    opacity: ".concat(e,";\n    transform: translate(-50%,-50%) scale(").concat(t,");\n  }\n  10% {\n    opacity: 1;\n    transform: translate(-50%,-50%) scale(1);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0.9);\n  }\n}\n")},Dp=null,zp="".concat(250,"ms ease fadeScaleOut 0s 1 normal backwards"),Fp=function(e,t){return"\n@keyframes fadeScaleOut {\n  0% {\n    opacity: ".concat(e,";\n    transform: translate(-50%,-50%) scale(").concat(t,");\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0);\n  }\n}\n")},Vp=null,Up=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.fillColor,o=void 0===r?null:r,a=n.fillOpacity,s=void 0===a?.15:a,c=n.isShowStartIndicator,l=void 0===c||c,f=n.isDarkMode,h=void 0!==f&&f,p=n.onDraw,g=void 0===p?ye:p,m=n.onStart,v=void 0===m?ye:m,y=n.startIndicatorOpacity,w=void 0===y?.1:y,x=n.strokeColor,S=void 0===x?null:x,k=n.strokeOpacity,M=void 0===k?.8:k,E=n.strokeSize,O=void 0===E?1:E,A=o,P=s,j=l,C=h,_=w,I=S,R=M,T=O,L=g,B=v,N=new t.Container,D=new t.Container,z=new t.Graphics,F=new t.Graphics;N.addChild(z),D.addChild(F);var V=function(){return A||C?16777215:0},U=function(){return A||C?16777215:0},Y=function(){return C?"rgba(255, 255, 255, ".concat(_,")"):"rgba(0, 0, 0, ".concat(_,")")},X=document.createElement("div");X.id="lasso-start-indicator",X.style.position="absolute",X.style.zIndex=1,X.style.width="4rem",X.style.height="4rem",X.style.borderRadius="4rem",X.style.opacity=.5,X.style.transform="translate(-50%,-50%) scale(0)";var q,H=!1,G=!1,$=[],W=[],K=function(){H=!1},Z=function(e){var t=e.target.parentElement;if(t){var n=t.getBoundingClientRect();ne([e.clientX-n.left,e.clientY-n.top])}},Q=function(){H=!0,G=!0,se(),B()},J=function(){re()};window.addEventListener("mouseup",K);var ee=function(){X.style.opacity=.5,X.style.transform="translate(-50%,-50%) scale(0)"},te=function(){var e=getComputedStyle(X),t=+e.opacity,n=e.transform.match(/([0-9.-]+)+/g);return{opacity:t,scale:n?+n[0]:1}},ne=function(){var e=i(u.mark((function e(t){var n,r,i,o,a,s;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=b(t,2),r=n[0],i=n[1],e.next=3,dt(0);case 3:if(!H){e.next=5;break}return e.abrupt("return");case 5:return o=.5,a=0,j&&(s=te(),o=s.opacity,a=s.scale,X.style.opacity=o,X.style.transform="translate(-50%,-50%) scale(".concat(a,")")),X.style.animation="none",e.next=11,ht(2);case 11:return X.style.top="".concat(i,"px"),X.style.left="".concat(r,"px"),null!==Dp&&Lp(Dp),Dp=Tp(Np(o,a)),X.style.animation=Bp,e.next=18,ht();case 18:ee();case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=function(){var e=i(u.mark((function e(){var t,n,r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=te(),n=t.opacity,r=t.scale,X.style.opacity=n,X.style.transform="translate(-50%,-50%) scale(".concat(r,")"),X.style.animation="none",e.next=6,ht(2);case 6:return null!==Vp&&Lp(Vp),Vp=Tp(Fp(n,r)),X.style.animation=zp,e.next=11,ht();case 11:ee();case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ie=function(){z.clear(),F.clear(),$.length&&(z.lineStyle(T,U(),R),z.moveTo.apply(z,d($[0])),$.forEach((function(e){z.lineTo.apply(z,d(e)),z.moveTo.apply(z,d(e))})),F.beginFill(V(),P),F.drawPolygon(W)),L()},oe=function(e){q?rt(e[0],e[1],q[0],q[1])>2&&($.push(e),W.push(e[0],e[1]),q=e,$.length>1&&ie()):(G||(G=!0,B()),$=[e],W=[e[0],e[1]],q=e)},ae=pt(oe,10,10),se=function(){$=[],W=[],q=void 0,ie()},ue=function(){G=!1;var e=d($);return ae.cancel(),se(),e},ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fillColor,n=void 0===t?null:t,r=e.fillOpacity,i=void 0===r?null:r,o=e.onDraw,a=void 0===o?null:o,s=e.onStart,u=void 0===s?null:s,c=e.showStartIndicator,l=void 0===c?null:c,f=e.startIndicatorOpacity,h=void 0===f?null:f,p=e.strokeColor,d=void 0===p?null:p,g=e.strokeOpacity,m=void 0===g?null:g,v=e.strokeSize,y=void 0===v?null:v,b=e.darkMode,w=void 0===b?null:b;A=Tn(n,A),P=Tn(i,P),L=Tn(a,L),B=Tn(u,B),C=Tn(w,C),j=Tn(l,j),_=Tn(h,_),I=Tn(d,I),R=Tn(m,R),T=Tn(y,T),X.style.background=Y(),j?(X.addEventListener("click",Z),X.addEventListener("mousedown",Q),X.addEventListener("mouseleave",J)):(X.removeEventListener("mousedown",Q),X.removeEventListener("mouseleave",J))},le=function(){window.removeEventListener("mouseup",K),X.removeEventListener("click",Z),X.removeEventListener("mousedown",Q),X.removeEventListener("mouseleave",J)},fe=function(){return function(e){return Ye(e,{clear:se,destroy:le,end:ue,extend:oe,extendDb:ae,set:ce,showStartIndicator:ne})}};return ce({fillColor:A,fillOpacity:P,isShowStartIndicator:j,isDarkMode:C,onDraw:L,onStart:B,startIndicatorOpacity:_,strokeColor:I,strokeOpacity:R,strokeSize:T}),Ke(tt("startIndicator",X),tt("fillContainer",D),tt("lineContainer",N),fe(),Ze(e))({})};function Yp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yp(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qp(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Hp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hp(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Hp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Gp,$p=(Gp=2,(e,t)=>{const n=t.minX-e.minX,r=t.minX-e.maxX,i=t.maxX-e.minX,o=t.maxX-e.maxX,a=n<0&&i>0||r<0&&o>0||n>0&&r<0||i>0&&o<0,s=t.minY-e.minY,u=t.minY-e.maxY,c=t.maxY-e.minY,l=t.maxY-e.maxY,f=s<0&&c>0||u<0&&l>0||s>0&&u<0||c>0&&l<0;if(a&&f)return 0;const h=Math.min(Math.abs(s),Math.abs(u),Math.abs(c),Math.abs(l));if(a)return h;const p=Math.min(Math.abs(n),Math.abs(r),Math.abs(i),Math.abs(o));return f?p:(p**Gp+h**Gp)**(1/Gp)}),Wp=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement("div");r.className="pilingjs-scroll-container";var o=document.createElement("div");o.className="pilingjs-scroll-element";var a=document.createElement("canvas");a.className="pilingjs-canvas";var s,c,l,f,h,p=B(),m=$h(),v=xr(),y=m.state,w=Un,x=!1,M=new Float32Array(16),E=new Map,A=e.getBoundingClientRect(),P=A.width,j=A.height,_=!1,I=new t.Renderer({width:P,height:j,view:a,antialias:!0,transparent:!0,resolution:window.devicePixelRatio,autoDensity:!0,preserveDrawingBuffer:!1,legacy:!1,powerPreference:"high-performance"}),R=!0,T=null,L=!1,N=Promise.resolve(),D=new t.Container,F=new t.Container;D.addChild(F);var V=new t.Graphics,U=new t.Graphics,Y=new t.Sprite(t.Texture.WHITE);D.addChild(Y),F.mask=Y;var X=function(e,t){return function(n){if(Se(n))return[Wh[e](n)];var r=wn(n,null),i=b(r,2),o=i[0],a=i[1],s=[Wh[e](o)];return null!==a&&s.push(Wh[t](a)),s}},q={center:{get:function(){return h.target},set:function(e){h.lookAt(e,h.scaling,h.rotation)},noAction:!0},gridColor:{set:X("setGridColor","setGridOpacity")},items:{get:function(){return Object.values(y.items)},set:function(e){return[Wh.setItems(e),Wh.initPiles(e)]},batchActions:!0},lassoFillColor:{set:X("setLassoFillColor","setLassoFillOpacity")},lassoStrokeColor:{set:X("setLassoStrokeColor","setLassoStrokeOpacity")},layout:{get:function(){return{cellAspectRatio:be.cellAspectRatio,cellHeight:be.cellHeight,cellPadding:be.cellPadding,cellSize:be.cellSize,cellWidth:be.cellWidth,columnWidth:be.columnWidth,height:be.height,itemSize:be.itemSize,numColumns:be.numColumns,numRows:be.numRows,rowHeight:be.rowHeight,width:be.width}}},pileBorderColor:{set:X("setPileBorderColor","setPileBorderOpacity")},pileBorderColorHover:{set:X("setPileBorderColorHover","setPileBorderOpacityHover")},pileBorderColorFocus:{set:X("setPileBorderColorFocus","setPileBorderOpacityFocus")},pileBorderColorActive:{set:X("setPileBorderColorActive","setPileBorderOpacityActive")},pileBackgroundColor:{set:X("setPileBackgroundColor","setPileBackgroundOpacity")},pileBackgroundColorHover:{set:X("setPileBackgroundColorHover","setPileBackgroundOpacityHover")},pileBackgroundColorFocus:{set:X("setPileBackgroundColorFocus","setPileBackgroundOpacityFocus")},pileBackgroundColorActive:{set:X("setPileBackgroundColorActive","setPileBackgroundOpacityActive")},pileLabel:{set:function(e){var t=ki(e);return[Wh.setPileLabel(t)]}},pileLabelSizeTransform:{set:function(e){var t=Mi(e);return[Wh.setPileLabelSizeTransform(t)]}},pileLabelTextColor:{set:X("setPileLabelTextColor","setPileLabelTextOpacity")},pileSizeBadgeAlign:{set:function(e){return[Wh.setPileSizeBadgeAlign(Se(e)?e:Zn(e))]}},previewBackgroundColor:{set:X("setPreviewBackgroundColor","setPreviewBackgroundOpacity")},previewBorderColor:{set:X("setPreviewBorderColor","setPreviewBorderOpacity")},renderer:{get:function(){return y.itemRenderer},set:function(e){return[Wh.setItemRenderer(e)]}},rowHeight:!0,scale:{get:function(){return h.scaling},set:function(e){h.scale(e,[I.width/2,I.height/2])},noAction:!0}},H=function(e){return q[e]&&q[e].get?q[e].get():void 0!==y[e]?y[e]:void console.warn('Unknown property "'.concat(e,'"'))},G=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=q[e],i=[];if(r?r.set?i=r.set(t):console.warn('Property "'.concat(e,'" is not settable')):void 0!==y[e]?i=[Wh["set".concat($e(e))](t)]:console.warn('Unknown property "'.concat(e,'"')),n||r&&r.noAction)return i;r&&r.batchActions?m.dispatch(pe(i)):i.forEach((function(e){return m.dispatch(e)}))},$=function(e){return e.items?new Promise((function(e){p.subscribe("itemUpdate",e,1)})):Promise.resolve()},W=function(e,t){if("string"==typeof e||e instanceof String){var n=$(g({},e,t));return G(e,t),n}var r=$(e);return m.dispatch(pe(Object.entries(e).flatMap((function(e){var t=b(e,2),n=t[0],r=t[1];return G(n,r,!0)})))),r},K=function(){I.render(D),p.publish("render")},Z=z(K),Q=vn(K,p),J=new Map,ee=new Map,ne=new t.Container,re=new t.Container,ie=new t.Sprite(t.Texture.WHITE);ie.alpha=0;var oe=function(){ne.children.length&&(re.addChild(ne.getChildAt(0)),ne.removeChildren())},ae=function(e){oe(),ne.addChild(e)},se=_p(),ue=!1,ce=function(){ue&&(F.interactive=!1,F.interactiveChildren=!1,ee.forEach((function(e){e.disableInteractivity()})),ue=!1)},le=function(){ue||(F.interactive=!0,F.interactiveChildren=!0,ee.forEach((function(e){e.enableInteractivity()})),ue=!0)},he=!1,de=!1,me=Up({onStart:function(){ce(),de=!0,he=!0},onDraw:function(){Z()}});F.addChild(V),F.addChild(U),F.addChild(me.fillContainer),F.addChild(re),F.addChild(ie),F.addChild(ne),F.addChild(me.lineContainer);var be,xe,Me,Re=new te,Be=function(e,t){if(m.state.showSpatialIndex&&(U.clear(),U.beginFill(65280,.5),Re.all().forEach((function(e){U.drawRect(e.minX,e.minY,e.width,e.height)})),U.endFill(),e&&(U.beginFill(16711680,1),U.drawRect(e[0]-1,e[1]-1,3,3),U.endFill()),t)){U.lineStyle(1,16711680,1),U.moveTo(t[0],t[1]);for(var n=0;n<t.length;n+=2)U.lineTo(t[n],t[n+1]),U.moveTo(t[n],t[n+1])}},De=function(){Re.clear();var e=[];ee&&(ee.forEach((function(t){t.updateBounds.apply(t,d(Fe()).concat([!0])),e.push(t.bBox)})),Re.load(e),Be())},ze=function(e){var t=ee.get(e);Re.remove(t.bBox,(function(e,t){return e.id===t.id})),Be()},Fe=function(){return T?h.translation:[0,F.y]},Ve=function(e){var t;return(t=ee.get(e)).calcBBox.apply(t,d(Fe()))},Ye=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.forceUpdate,r=void 0!==n&&n,i=ee.get(e);Re.remove(i.bBox,(function(e,t){return e.id===t.id})),i.updateBounds.apply(i,d(Fe()).concat([r])),Re.insert(i.bBox),Be(),p.publish("pileBoundsUpdate",e)},Xe=function(e){var t=e.id,n=e.forceUpdate;return Ye(t,{forceUpdate:n})},qe=function(){E.forEach((function(e,t){Ot(ee.get(t),e[0],e[1])})),Z()},He=function(){var e=m.state.zoomScale,t=Se(e)?e(h.scaling):e;ee.forEach((function(e){e.setZoomScale(t),e.drawBorder()})),Z()},Ge=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];h.tick(),qe(),He(),L=!0,e&&Wt(),p.publish("zoom",h)},We=1,Ke=function(){if(h){var e=m.state,t=e.groupingType,n=e.groupingObjective,r=e.groupingOptions,i=e.splittingType,o=e.splittingObjective,a=e.splittingOptions,s=h.scaling,u=s/We;t&&u<1&&mr(t,n,r),i&&u>1&&Ir(i,o,a),We=s}},Ze=ft(Ke,250),Qe=function(){L&&(L=!1,h.tick(),qe(),p.publish("zoom",h))},Je=function(){var e=a.getBoundingClientRect().height,t=Math.round(be.rowHeight)*(be.numRows+3);o.style.height="".concat(Math.max(0,t-e),"px"),m.state.showGrid&&at()},et=function(){return!1!==T&&(ot(),T=!1,c=ye,l=ye,f=ye,F.y=0,r.style.overflowY="auto",r.scrollTop=0,r.addEventListener("scroll",Ki,qn),window.addEventListener("mousedown",Ui,qn),window.addEventListener("mouseup",Yi,qn),window.addEventListener("mousemove",Xi,qn),a.addEventListener("wheel",Wi,Xn),!0)},tt=function(){!1===T&&(F.y=0,r.style.overflowY="hidden",r.scrollTop=0,r.removeEventListener("scroll",Ki),window.removeEventListener("mousedown",Ui),window.removeEventListener("mouseup",Yi),window.removeEventListener("mousemove",Xi),a.removeEventListener("wheel",Wi))},nt=function(){return!0!==T&&(tt(),T=!0,c=qt,l=Ht,f=Gt,(h=C(a,{isNdc:!1,onMouseDown:Ui,onMouseUp:Yi,onMouseMove:Xi,onWheel:Wi,viewCenter:[P/2,j/2],scaleBounds:m.state.zoomBounds.map(rr)})).setView(S(Yn)),!0)},ot=function(){!0===T&&(h.dispose(),h=void 0)},at=function(){var e=o.getBoundingClientRect().height+a.getBoundingClientRect().height,t=a.getBoundingClientRect().width,n=Math.ceil(t/be.columnWidth),r=Math.ceil(e/be.rowHeight),i=m.state,s=i.gridColor,u=i.gridOpacity;V.clear(),V.lineStyle(1,s,u);for(var c=1;c<n;c++)V.moveTo(c*be.columnWidth,0),V.lineTo(c*be.columnWidth,e);for(var l=1;l<r;l++)V.moveTo(0,l*be.rowHeight),V.lineTo(t,l*be.rowHeight)},st=function(){V.clear()},pt=function(){var e=m.state.orderer;be=bp({width:P,height:j,orderer:e},m.state),Je()},dt=function(){var e=m.state.orderer,t=be;be=bp({width:P,height:j,orderer:e},m.state),_t(t),Je(),m.state.showGrid&&at()},gt=function(e){var t=e.width,n=e.height;p.subscribe("animationEnd",(function(){be.width===t&&be.height===n||(be=bp({width:t,height:n,orderer:m.state.orderer},m.state),dt())}),1)},mt=Er({element:a,pubSub:p,store:m},{onLeave:gt}),vt=function(){var e=i(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se.open(t);case 2:T?h.config({isFixed:!0}):r.style.overflowY="hidden";case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),yt=function(){se.close(),T?h.config({isFixed:!1}):r.style.overflowY="auto"},bt=function(){var e=m.state,t=e.darkMode,n=e.haltBackgroundOpacity;se.set({backgroundOpacity:n,darkMode:t})},wt=function(){var e=m.state.darkMode;mt.set({darkMode:e})},xt=function(){var e=m.state,t=e.darkMode,n=e.lassoFillColor,r=e.lassoFillOpacity,i=e.lassoShowStartIndicator,o=e.lassoStartIndicatorOpacity,a=e.lassoStrokeColor,s=e.lassoStrokeOpacity,u=e.lassoStrokeSize;me.set({fillColor:n,fillOpacity:r,showStartIndicator:i,startIndicatorOpacity:o,strokeColor:a,strokeOpacity:s,strokeSize:u,darkMode:t})},St=zn(),kt=zn(),Mt=function(e){return e.aspectRatio>be.cellAspectRatio?St(e.originalWidth)/e.originalWidth:kt(e.originalHeight)/e.originalHeight},Et=function(){if(J.size){var e=1/0,t=0,n=1/0,r=0;J.forEach((function(i){var o=i.image.originalWidth,a=i.image.originalHeight;o>t&&(t=o),o<e&&(e=o),a>r&&(r=a),a<n&&(n=a)}));var i,o,a=m.state,s=a.itemSizeRange,u=a.itemSize,c=a.piles,l=a.previewScaling,f=u||be.cellWidth,h=u||be.cellHeight;s[0]>0&&s[0]<=1&&s[1]>0&&s[1]<=1?(i=[f*s[0],f*s[1]],o=[h*s[0],h*s[1]]):(i=[0,f],o=[0,h]),St=zn().domain([e,t]).range(i),kt=zn().domain([n,r]).range(o),Object.values(c).forEach((function(e){var t=Se(l)?l(e):l;e.items.forEach((function(e){var n=J.get(e);if(n){var r=Mt(n.image);if(n.image.scale(r),n.preview){var i=r*t[0]-1+1,o=r*t[1]-1+1;n.preview.scaleX(i),n.preview.scaleY(o),n.preview.rescaleBackground()}}}))})),ee.forEach((function(e){if(e.cover){var t=Mt(e.cover);e.cover.scale(t)}e.updateOffset(),e.drawBorder()}))}},Ot=function(e,t,n){return e.moveTo.apply(e,d(c([t,n])))},Pt=function(e,t,n){Ot(e,t,n)&&Ye(e.id)},jt=function(e,t,n,r){return e.getMoveToTweener.apply(e,d(c([t,n])).concat([r]))},Ct=function(e,t,n,r){return e.animateMoveTo.apply(e,d(c([t,n])).concat([r]))},_t=function(e){var t=m.state,n=t.arrangementType,r=t.items;if(Et(),null!==n||T)$t();else{var i=[];be.numRows=Math.ceil(J.size/be.numColumns),ee.forEach((function(t){var n=e.getPilePosByCellAlignment(t),r=e.xyToIj(n[0],n[1]),o=b(r,2),a=o[0],s=o[1];t.updateOffset(),Ye(t.id,{forceUpdate:!0});var u=e.ijToIdx(a,s),c=be.idxToXy(u,t.anchorBox.width,t.anchorBox.height,t.offset),l=b(c,2),f=l[0],h=l[1];i.push({id:t.id,x:f,y:h})})),ee.forEach((function(e){e.cover&&Kt(e.id)})),m.dispatch(Wh.movePiles(i)),J.forEach((function(e){e.setOriginalPosition(be.idxToXy(r[e.id].index,e.image.width,e.image.height,e.image.center))}))}De(),m.state.focusedPiles.filter((function(e){return ee.has(e)})).forEach((function(e){ee.get(e).focus()})),Je(),Z()},It=function(e){var t=Nn(m.state.pileBackgroundColor,e);return null!==t?t:w},Rt=function(e){var t=m.state,n=t.itemRenderer,r=t.previewBackgroundColor,o=t.previewBackgroundOpacity,a=t.pileBackgroundOpacity,s=t.previewAggregator,c=t.previewRenderer,l=t.previewPadding,f=t.piles,h=Object.values(e),p=n(h.map((function(e){return e.src}))).then((function(e){return e.map(lr)})),d=function(e,t){if(null===e)return null;var n=h[t],i=f[n.id],s=It(i),u={backgroundColor:r===Hn?s:Bn(r,n),backgroundOpacity:o===Hn?Nn(a,i):Bn(o,n),padding:Bn(l,n)};return Qh(e,u)},g=c?s||function(){var e=i(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.map((function(e){return e.src})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}():null;return[p,g?Promise.resolve(g(h)).then((function(e){return new Promise((function(t){var n=[];c(e.filter((function(e){return null!==e}))).then((function(r){var i=0;e.forEach((function(e){null===e?n.push(null):n.push(r[i++])})),t(n)}))}))})).then((function(e){return e.map(d)})):Promise.resolve([])]},Tt=function(){var e=i(u.mark((function e(){var t,n,r,i,o=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:null,n=m.state,r=n.items,i=n.piles,t||(t=r),e.next=5,vt();case 5:return e.abrupt("return",Promise.all(Rt(t)).then((function(e){var n=b(e,2),r=n[0],o=n[1],a=Object.keys(t);r.forEach((function(e,t){var n=a[t],r=o[n];J.has(n)&&J.get(n).replaceImage(e,r)})),a.forEach((function(e){if(ee.has(e)){var t=ee.get(e),n=i[e];t.replaceItemsImage(),t.blur(),Qt(n,e),Zt(n,e),oe()}else Object.values(i).forEach((function(t){if(t.items.includes(e)){var n=ee.get(t.id);n.replaceItemsImage(e),n.blur()}}))})),ee.forEach((function(e){nn(i[e.id],e)})),Et(),Z(),yt()})));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Lt=function(){var e=i(u.mark((function e(t){var n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=Object.keys(t)).length){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,vt();case 5:return e.abrupt("return",Promise.all(Rt(t)).then((function(e){var t=b(e,2),r=t[0],i=t[1],o=m.state.piles;r.forEach((function(e,t){var r=i[t],o=n[t],a=wp({id:o,image:e,pubSub:p},{preview:r});J.set(o,a)})),r.forEach((function(e,t){var r=n[t],i=o[r];i.items.length&&Vn(r,i)})),Et(),Z(),yt()})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Bt=function(e){return null===e.x||null===e.y},Nt=function(e){var t=ee.get(e),n=be.idxToXy(Nr[0][e],t.width,t.height,t.offset);return Promise.resolve(n)},Dt=function(e){return Promise.resolve(Vr.map((function(t,n){return t(Br[e][n])})))},zt=new Map,Ft=0,Vt=function(){var e=i(u.mark((function e(t){var n,r,i,o,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.state.dimensionalityReducer,!zt.has(t)||Yr!==Ft){e.next=3;break}return e.abrupt("return",zt.get(t));case 3:return Ft=Yr,e.next=6,r.transform([Br[t].flat()]);case 6:return i=e.sent,o=(n=be).uvToXy.apply(n,d(i[0])),1!==(a=ee.get(t)).size||zt.has(t)||a.items[0].item.setOriginalPosition(o),zt.set(t,o),e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ut=function(e,t){var n=m.state,r=n.arrangementObjective,i=n.arrangementOptions,o=n.dimensionalityReducer;return r.length>2||i.forceDimReduction?o?Vt(e):Promise.resolve([t.x,t.y]):r.length>1?Dt(e):r.length?Nt(e):(console.warn("Can't arrange pile by data. No arrangement objective available."),Promise.resolve([t.x,t.y]))},Yt=function(e,t){if(t.isCustom)return t.property(e,e.index);var n=m.state.items;return t.aggregator(e.items.map((function(e){return t.property(n[e])})))},Xt=function(){var e=i(u.mark((function e(t,n){var r,i,o,a,s,c,l,f,h,p,g,v,y;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=m.state,o=i.arrangementType,a=i.arrangementObjective,s=i.piles,c=i.projector,l=ee.get(t),f=s[t],h=Bt(f),g=n||h?a||Gn:a,v=function(e,t){return be.ijToXy(e,t,l.width,l.height,l.offset)},"data"!==(p=n||h?o||"index":o)){e.next=9;break}return e.abrupt("return",Ut(t,f));case 9:y=p&&Yt(f,g),e.t0=p,e.next="index"===e.t0?13:"ij"===e.t0?14:"xy"===e.t0?15:"uv"===e.t0?16:"custom"===e.t0?17:19;break;case 13:return e.abrupt("return",v.apply(void 0,d(be.idxToIj(y))));case 14:return e.abrupt("return",v.apply(void 0,d(y)));case 15:return e.abrupt("return",y);case 16:return e.abrupt("return",(r=be).uvToXy.apply(r,d(y)));case 17:if(!c){e.next=19;break}return e.abrupt("return",c(y));case 19:return e.abrupt("return",Promise.resolve([f.x,f.y]));case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),qt=function(e){var t=Jn(e[0],e[1]);return O(t,t,h.view),t.slice(0,2)},Ht=function(e){var t=Jn(e[0],e[1]);return O(t,t,k(M,h.view)),t.slice(0,2)},Gt=function(e){return[e[0]-h.translation[0],e[1]-h.translation[1]]},$t=function(){var e=i(u.mark((function e(){var t,n,r,i,o,a,s,c,l,f,h,p,g,v,y,w,x,S,k,M=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=M.length>0&&void 0!==M[0]?M[0]:[],n=M.length>1&&void 0!==M[1]?M[1]:{},r=n.immideate,i=void 0!==r&&r,o=m.state,a=o.arrangeOnGrouping,s=o.arrangementType,c=o.items,(l=!t.length)&&(t=Object.keys(m.state.piles)),0!==Object.keys(c).length){e.next=10;break}return De(),Je(),Z(),e.abrupt("return");case 10:if(f=[],(h=t.filter((function(e){return ee.has(e)})).map((function(e){return ee.get(e)}))).length){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,N;case 16:p=qp(h),e.prev=17,p.s();case 19:if((g=p.n()).done){e.next=32;break}return v=g.value,e.next=23,Xt(v.id,R);case 23:y=e.sent,E.set(v.id,y),w=b(y,2),x=w[0],S=w[1],(i||R)&&Pt(v,x,S),f.push({id:v.id,x:x,y:S}),be.numRows=Math.max(be.numRows,Math.ceil(S/be.rowHeight)),(R||Bt(v)||s&&!a)&&J.get(v.id).setOriginalPosition([x,S]);case 30:e.next=19;break;case 32:e.next=37;break;case 34:e.prev=34,e.t0=e.catch(17),p.e(e.t0);case 37:return e.prev=37,p.f(),e.finish(37);case 40:R=!1,k=a?[]:Gr(),m.dispatch(pe([Wh.movePiles(f)].concat(d(k)))),l&&De(),Je(),Z();case 46:case"end":return e.stop()}}),e,null,[[17,34,37,40]])})));return function(){return e.apply(this,arguments)}}(),Wt=ft($t,100),Kt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.all,r=void 0!==n&&n,i=m.state,o=i.piles,a=i.pileOrderItems,s=ee.get(e);if(s){if(Se(a)){var u=o[e];s.setItemOrder(a(u))}s.positionItems(Q,{all:r})}},Zt=function(e,t){var n=m.state,r=n.items,i=n.pileItemBrightness,o=n.pileItemInvert,a=n.pileItemOpacity,s=n.pileItemTint;ee.get(t).items.forEach((function(t,n){var u=r[t.id];t.animateOpacity(Se(a)?a(u,n,e):a),t.image.invert(Se(o)?o(u,n,e):o),o||(t.image.brightness(Se(i)?i(u,n,e):i),i||t.image.tint(Se(s)?s(u,n,e):s))}))},Qt=function(e,t){var n=ee.get(t);if(n){var r=m.state,i=r.pileOpacity,o=r.pileBorderSize,a=r.pileScale,s=r.pileSizeBadge,u=r.pileVisibilityItems;n.animateOpacity(Se(i)?i(e):i),n.animateScale(Se(a)?a(e):a),n.setBorderSize(Se(o)?o(e):o),n.showSizeBadge(Se(s)?s(e):s),n.setVisibilityItems(Se(u)?u(e):u),Z()}},Jt=function(e){var t=lr(e);return t.scale(Mt(t)),t},en=function(e){var t=m.state,n=t.previewRenderer,r=t.previewScaling;if(n){var i=Se(r)?r(e):r;e.items.forEach((function(e){var t=J.get(e);if(t.preview){var n=Mt(t.image),r=n*i[0]-1+1,o=n*i[1]-1+1;t.preview.scaleX(r),t.preview.scaleY(o)}}))}},tn=function(e,t){var n=m.state,r=n.items,i=n.coverRenderer,o=n.coverAggregator,a=n.pileCoverInvert,s=n.pileCoverScale,u=n.previewAggregator,c=n.previewRenderer,l=[],f=[];if(e.items.forEach((function(e){l.push(r[e]),f.push(J.get(e))})),t.setItems(f,{asPreview:!(!u&&!c),shouldDrawPlaceholder:!0}),!i)return t.setCover(null),void Kt(t.id,{all:!0});var h=Promise.resolve(o(l)).then((function(e){return i([e])})).then((function(t){var n=b(t,1)[0],r=Jt(n);r.invert(Se(a)?a(e):a);var i=Se(s)?s(e):s;return r.scale(r.scaleFactor*i),r}));t.setCover(h),h.then((function(){Kt(t.id),Ye(t.id),Z()}))},nn=function(e,t){1===e.items.length?(t.setCover(null),Kt(t.id),t.setItems([J.get(e.items[0])])):(en(e),tn(e,t))},rn=function(){var e=m.state,t=e.arrangementObjective,n=e.arrangementOptions;return t&&(t.length>2||n.forceDimReduction)},on=function(e,t){if(ee.has(t)){var n=ee.get(t);if(0===e.items.length)$n(t);else{zt.delete(t);var r=e.items.map((function(e){return J.get(e)}));m.state.coverAggregator?nn(e,n):(m.state.previewRenderer&&en(e),n.setItems(r),Kt(t)),1===r.length&&rn()&&zt.set(t,r[0].originalPosition),Ye(t,{forceUpdate:!0}),Zt(e,t)}}else Vn(t,e)},an=function(e,t){var n=ee.get(t);return n?(E.set(t,[e.x,e.y]),Promise.all([Ct(n,e.x,e.y),new Promise((function(e){p.subscribe("pileBoundsUpdate",(function(n){n===t&&(p.unsubscribe("pileBoundsUpdate",this),e())}))}))])):Promise.resolve()},sn=function(e){var t=At(new Uint16Array(new Array(be.numColumns*be.numRows).fill(0)),[be.numRows,be.olNum]);s=t,ee.forEach((function(t){if(t.id!==e){var n=Math.floor(t.bBox.minX/be.columnWidth),r=Math.floor(t.bBox.minY/be.rowHeight),i=Math.floor(t.bBox.maxX/be.columnWidth),o=Math.floor(t.bBox.maxY/be.rowHeight);s.set(r,n,1),s.set(r,i,1),s.set(o,n,1),s.set(o,i,1)}}))},un=function(e,t){var n,r=1/0;t[0]-1>=0&&e.get(t[0]-1,t[1])<r&&(r=e.get(t[0]-1,t[1]),n=[t[0]-1,t[1]]),t[1]-1>=0&&e.get(t[0],t[1]-1)<r&&(r=e.get(t[0],t[1]-1),n=[t[0],t[1]-1]),t[0]+1<e.shape[0]&&e.get(t[0]+1,t[1])<r&&(r=e.get(t[0]+1,t[1]),n=[t[0]+1,t[1]]),t[1]+1<e.shape[1]&&e.get(t[0],t[1]+1)<r&&(r=e.get(t[0],t[1]+1),n=[t[0],t[1]+1]);var i=e.data.length;if(e.set(t[0],t[1],i),r===e.data.length)for(var o=0;o<e.shape[0];o++)for(var a=0;a<e.shape[1];a++)e.get(o,a)<r&&e.get(o,a)>0&&(r=e.get(o,a)),n=[o,a];return n},cn=function(e,t,n,r){if(-1===e.get(t,n)){var i=rt(t,n,r[0],r[1]);e.set(t,n,i)}},ln=function(e,t,n,r){for(var i,o=d(n),a=0;!i&&a<e.data.length;)t.get(o[0],o[1])<1&&(i=o),i||(o[0]-1>=0&&cn(e,o[0]-1,o[1],n),o[1]-1>=0&&cn(e,o[0],o[1]-1,n),o[0]+1<e.shape[0]&&cn(e,o[0]+1,o[1],n),o[1]+1<e.shape[1]&&cn(e,o[0],o[1]+1,n),o=un(e,o),a++);return i||(i=[t.shape[0]+1,Math.floor(r/2)],be.numRows+=r,Je()),i},fn=function(e,t){var n=At(new Float32Array(new Array(e*t).fill(1)),[t,e]),r=At(new Float32Array((be.numRows-t+1)*(be.numColumns-e+1)),[be.numRows-t+1,be.olNum-e+1]);return mn(r,s,n),r},hn=function(e,t,n){var r=fn(t,n),i=At(new Float32Array(new Array((be.numRows-n+1)*(be.numColumns-t+1)).fill(-1)),[be.numRows-n+1,be.numColumns-t+1]),o=ln(i,r,e,n);return{depilePos:o,distance:rt(o[0],o[1],e[0],e[1])}},pn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new Promise((function(r){var i=m.state.easing,o=[],a=ee.get(e);a.blur(),a.drawBorder();var s=t.map((function(e){return ee.get(e)})).filter(ye),u=0,l=function(){++u===s.length&&(o.forEach((function(e){Ye(e.id)})),m.dispatch(Wh.movePiles(o)),r())};Q.addBatch(s.map((function(e,t){var r=e.getItemById(e.id);o.push({id:e.id,x:r.item.originalPosition[0],y:r.item.originalPosition[1]});var a=n.length>0?n[t]:c(r.item.originalPosition),s=rt.apply(void 0,d(a).concat([e.x,e.y])),u=250*ge(Math.min(s,250)/250);return ip({duration:u,easing:i,interpolator:ve,endValue:[].concat(d(n.length>0?n[t]:c(r.item.originalPosition)),[0]),getter:function(){return[e.x,e.y,r.displayObject.angle]},setter:function(t){e.moveTo(t[0],t[1]),r.displayObject.angle=t[2]},onDone:l})})))}))},dn=function(e){var t=ee.get(e).size;if(1!==t){sn(e);var n,r,i,o=ee.get(e).bBox,a=Math.floor((o.minX+o.maxX)/(2*be.columnWidth)),s=[Math.floor((o.minY+o.maxY)/(2*be.rowHeight)),a],u=Math.ceil(Math.sqrt(t)),c=Math.ceil(t/u);if(u!==c){var l=hn(s,u,c),f=hn(s,c,u);n=l.distance>f.distance?f.depilePos:l.depilePos,i=l.distance>f.distance?c:u,r=l.distance>f.distance?u:c}else n=hn(s,u,c).depilePos,i=u,r=c;for(var h=m.state.piles,p=[],g=d(h[e].items),v=[],y=0;y<g.length;y++){var b=Math.floor(y/i)+n[0]-Math.floor((r-1)/2),w=y%i+n[1]-Math.floor((i-1)/2);v.push([w*be.columnWidth,b*be.rowHeight])}var x={items:g,x:h[e].x,y:h[e].y};p.push(x),m.dispatch(Wh.scatterPiles(p)),pn(e,g,v),m.dispatch(Wh.setDepiledPile([]))}},gn=function(e){var t=m.state.piles,n=d(t[e].items),r={items:n,x:t[e].x,y:t[e].y};m.dispatch(Wh.scatterPiles([r])),Ci(),m.state.arrangementType||pn(e,n)},yn=function(e,t){var n=m.state.piles[e].items.filter((function(e){return!t.includes(e)})),r=g({},e,[n,t]);m.dispatch(Wh.splitPiles(r))},xn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.onDone,o=void 0===i?ye:i;Q.add(ip({interpolator:ve,endValue:[t,n],getter:function(){return[e.x,e.y]},setter:function(t){e.x=t[0],e.y=t[1]},onDone:function(){o()}}))},Sn=function(){ie.tint=m.state.darkMode?0:16777215,ie.width=P,ie.height=j,ie.alpha=.9},kn=function(){ie.alpha=0},Mn=function(e){var t=m.state.piles;e.forEach((function(e){var t=ee.get(e);oe(),kn();var n=function(){t.tempDepileContainer.removeChildren(),t.isTempDepiled=!1,t.focus(),m.dispatch(Wh.setFocusedPiles([t.id])),Ye(e)};t.tempDepileContainer.children.forEach((function(e,r){var i=r===t.tempDepileContainer.children.length-1?{onDone:n}:void 0;xn(e,-t.tempDepileContainer.x,-t.tempDepileContainer.y,i)}))})),p.publish("pileInactive",{targets:e.map((function(e){return t[e]}))}),Z()},En=function(e){var t=e.pile,n=e.tempDepileDirection,r=e.items,i=function(){t.isTempDepiled=!0,m.dispatch(Wh.setFocusedPiles([])),m.dispatch(Wh.setFocusedPiles([t.id]))},o=h?h.scaling:1,a=function(e){return e?{onDone:i}:void 0};if("horizontal"===n){t.tempDepileContainer.x=t.bBox.width/o,t.tempDepileContainer.y=0,t.tempDepileContainer.interactive=!0;var s=0;r.forEach((function(e,n){var i=bn(J.get(e).image.sprite);i.x=-t.tempDepileContainer.x,t.tempDepileContainer.addChild(i);var o=a(n===r.length-1);xn(i,5*n+s,0,o),s+=i.width}))}else if("vertical"===n){t.tempDepileContainer.x=0,t.tempDepileContainer.x=t.bBox.height/o,t.tempDepileContainer.interactive=!0;var u=0;r.forEach((function(e,n){var i=bn(J.get(e).image.sprite);i.y=-t.tempDepileContainer.y,t.tempDepileContainer.addChild(i);var o=a(n===r.length-1);xn(i,0,5*n+u,o),u+=i.height}))}},On=function(e){var t=e.pile,n=e.items,r=e.orderer,i=h?h.scaling:1;t.tempDepileContainer.x=t.bBox.width/i,t.tempDepileContainer.y=0;var o=Math.ceil(Math.sqrt(n.length)),a=function(){t.isTempDepiled=!0,m.dispatch(Wh.setFocusedPiles([])),m.dispatch(Wh.setFocusedPiles([t.id]))},s=r(o);n.forEach((function(e,r){var i=bn(J.get(e).image.sprite);i.x=-t.tempDepileContainer.x,t.tempDepileContainer.addChild(i);var o=s(r),u=b(o,2),c=u[0],l=u[1],f=c*(be.cellWidth+6),h=l*(be.cellHeight+6),p=r===n.length-1?{onDone:a}:void 0;xn(i,f,h,p)}))},An=function(e){var t=m.state,n=t.piles,r=t.tempDepileDirection,i=t.tempDepileOneDNum,o=t.orderer;e.forEach((function(e){var t=ee.get(e);ae(t.graphics),Sn(),t.enableInteractivity();var a=d(n[e].items);a.length<i?En({pile:t,tempDepileDirection:r,items:a}):On({pile:t,items:a,orderer:o}),Ye(e)})),p.publish("pileActive",{targets:e.map((function(e){return n[e]}))}),Z()},Pn=function(e){var t=a.getBoundingClientRect();return[e.clientX-t.left,e.clientY-t.top-F.y]},jn=function(e){var t=Ln(e),n=Re.search(t),r=[];return n.forEach((function(t){(it([t.minX,t.minY],e)||it([t.minX,t.maxY],e)||it([t.maxX,t.minY],e)||it([t.maxX,t.maxY],e))&&r.push(t.id)})),r},Cn=function(){var e=i(u.mark((function e(){var t,n,r,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Promise.resolve(),de=!1,n=me.end(),r=n.flatMap(f),Be([r.length-2,r.length-1],r),m.state.temporaryDepiledPiles.length||(i=jn(r),Ai(i),i.length>1&&(m.dispatch(Wh.setFocusedPiles([])),t=_n([i]))),e.next=8,t;case 8:le();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_n=function(e,t){var n=function(e){return function(t,n){return t+n/e}},r=function(){return function(e,t){return Math.min(e,t)}},i=function(){return function(e,t){return Math.max(e,t)}},o={x:n,y:n},a={x:0,y:0};switch(t){case"top":o.y=r,a.y=1/0;break;case"bottom":o.y=i,a.y=-1/0;break;case"left":o.x=r,a.x=1/0;break;case"right":o.x=i,a.x=-1/0}return Promise.all(e.map((function(e){return new Promise((function(t,n){var r=m.state,i=r.easing,s=r.piles,u=a.x,c=a.y,l=o.x(e.length),f=o.y(e.length);e.forEach((function(e){u=l(u,s[e].x),c=f(c,s[e].y)}));var h=function(){++p===e.length&&(Ye(e[0]),t(Wh.mergePiles(e,[u,c])))},p=0;Q.addBatch(e.map((function(e){return ee.get(e)||n(new Error("Pile #".concat(e," not ready"))),jt(ee.get(e),u,c,{easing:i,onDone:h})})).filter((function(e){return null===e&&h(),e})))}))}))).then((function(e){m.dispatch(pe(e))}))},In=function(e,t){var n=ee.get(e);n.magnifyByWheel(t)&&(Ye(e,{forceUpdate:!0}),n.drawBorder()),Z()},Tn=function(e){J.has(e)&&J.get(e).destroy(),J.delete(e),$n(e)},Fn=function(e){return Object.keys(e).forEach(Tn),Promise.resolve()},Vn=function(e,t){var n=c([t.x,t.y]),r=b(n,2),i=r[0],o=r[1],a=t.items.length?t.items.map((function(e){return J.get(e)})):[J.get(e)],s=dp({render:Z,id:e,pubSub:p,store:m,badgeFactory:v},{x:i,y:o});ee.set(e,s),m.state.coverAggregator?nn(t,s):(m.state.previewRenderer&&en(t),s.setItems(a),Kt(e)),re.addChild(s.graphics),Ye(e,{forceUpdate:!0}),Zt(t,e),E.set(e,[t.x,t.y])},$n=function(e){ee.has(e)&&(ee.get(e).destroy(),ze(e)),ee.delete(e),E.delete(e),delete Br[e]},Qn=function(e){var t=e.bBoxifier,n=e.absComparator,r=e.relComparator;return function(){var e=i(u.mark((function e(i){var o,a,s,c,l,f,h,p,d,v,y,w,x,S=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=S.length>1&&void 0!==S[1]?S[1]:{},a=o.conditions,s=void 0===a?[]:a,c=o.centerAggregator,l=void 0===c?Pe:c,f=m.state.piles,h=new Map,p={},d={},v=function(e,t,n){if(!p[e.id]){p[e.id]=g({},e.id,!0),h.set(e.id,[e.id,1]);var i=e.maxX-e.minX,o=e.maxY-e.minY;d[e.id]={w:i,h:o,c:[[e.minX+i/2,e.minY+o/2]]}}if(p[e.id][t.id])return!1;p[e.id][t.id]=!0,h.set(t.id,[e.id,r(n,e)[0]]);var a=t.maxX-t.minX,s=t.maxY-t.minY;return d[e.id].w=Math.max(d[e.id].w,a),d[e.id].h=Math.max(d[e.id].h,s),d[e.id].c.push([t.minX+a/2,t.minY+s/2]),!0},y=function(e){var o=Re.search(t(e,i)),a=0;return 1===o.length||o.forEach((function(t){if(t.id!==e.id){var o=n(e,t,i),u=b(o,2),c=u[0];if(u[1]&&s.every((function(n){return n(f[e.id],f[t.id])}))){if(h.has(t.id)&&(!p[e.id]||!p[e.id][t.id])){var l=h.get(t.id),d=b(l,2),g=d[0],m=d[1];if(!r(c,e,m)[1])return;delete p[g][t.id]}a+=v(e,t,c)}}})),a},Re.all().forEach((function(e){h.has(e.id)||y(e)})),w=!1;!w;)x=Object.keys(p).reduce((function(e,t){var n=d[t],r=n.w,i=n.h,o=n.c,a=l(o),s=b(a,2),u=s[0],c=s[1];return e+y({id:t,minX:u-r/2,maxX:u+r/2,minY:c-i/2,maxY:c+i/2})}),0),w=0===x;return e.abrupt("return",Object.values(p).map(Object.keys));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},er=function(e,t,n){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),o=(Math.min(e.maxX,t.maxX)-r)*(Math.min(e.maxY,t.maxY)-i);return[o,o>=n]},ir=function(e,t,n){var r=e/((t.maxX-t.minX)*(t.maxY-t.minY));return[r,void 0!==n&&r>n]},or=Qn({bBoxifier:ye,absComparator:er,relComparator:ir}),ar=function(e,t){return{minX:e.minX-t,minY:e.minY-t,maxX:e.maxX+t,maxY:e.maxY+t}},sr=function(e,t,n){var r=$p(e,t);return[r,r<n]},ur=function(e,t,n){return[e,void 0===n&&e<n]},cr=Qn({bBoxifier:ar,absComparator:sr,relComparator:ur}),fr=function(){var e=i(u.mark((function e(t){var n,r,i,o;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m.state,r=n.orderer,i=n.piles,o=t?bp({width:P,height:j,orderer:r},t):be,e.abrupt("return",Object.entries(i).reduce((function(e,t){var n=b(t,2),r=n[0],i=n[1];if(!i.items.length)return e;var a=o.xyToIj(i.x,i.y),s=o.ijToIdx.apply(o,d(a));return e[s]||(e[s]=[]),e[s].push(r),e}),[]));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),hr=function(){var e=i(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.entries(m.state.piles).reduce((function(e,t){var n=b(t,2),r=n[0],i=n[1];if(i.items.length){var o=be.xyToIj(i.x,i.y);e[o[1]]||(e[o[1]]=[]),e[o[1]].push(r)}return e}),[]));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pr=function(){var e=i(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.entries(m.state.piles).reduce((function(e,t){var n=b(t,2),r=n[0],i=n[1];if(i.items.length){var o=be.xyToIj(i.x,i.y);e[o[0]]||(e[o[0]]=[]),e[o[0]].push(r)}return e}),[]));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),dr=function(){var e=i(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.values(Object.entries(m.state.piles).reduce((function(e,n){var r=b(n,2),i=r[0],o=r[1];if(!o.items.length)return e;var a=t.map((function(e){return e.aggregator(o.items.map((function(t,n){return e.property(m.state.items[t],t,n,J.get(t))})))})).join("|");return e[a]?e[a].push(i):e[a]=[i],e}),{})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),gr=function(){var e=i(u.mark((function e(t){var n,r,i,o,a,s,c,l=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:{},r=Object.entries(m.state.piles).reduce((function(e,n){var r=b(n,2),i=r[0],o=r[1];return o.items.length?(e.push({id:i,data:t.flatMap((function(e){return e.aggregator(o.items.map((function(t,n){return e.property(m.state.items[t],t,n,J.get(t))})))}))}),e):e}),[]),(i=n.clusterer)||(o=n.clustererOptions||{},a=o.k,o.valueGetter=function(e){return e.data},a||(a=Math.max(2,Math.ceil(Math.sqrt(r.length/2)))),i=jr(a,o)),e.next=6,i(r);case 6:return s=e.sent,c=s.labels,e.abrupt("return",Object.values(Array.from(c).reduce((function(e,t,n){return-1===t||(e[t]||(e[t]=[]),e[t].push(r[n].id)),e}),{})));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),mr=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i="mean";switch(e){case"overlap":t=or(n,r);break;case"distance":t=cr(n,r);break;case"grid":t=fr(n);break;case"column":i=n,t=hr(n);break;case"row":i=n,t=pr(n);break;case"category":t=dr(n);break;case"cluster":t=gr(n,r);break;default:t=Promise.reject(new Error("Unknown group by type: ".concat(e)))}return t.then((function(e){return m.dispatch(Wh.setFocusedPiles([])),Ai(e.flatMap(ye)),_n(e.filter((function(e){return e.length>1})),i)}))},vr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=yi(e,t),i=mr(e,r,n);return"distance"!==e&&"overlap"!==e||!n.onZoom||(delete n.onZoom,m.dispatch(pe([].concat(d(G("groupingObjective",r,!0)),d(G("groupingOptions",n,!0)),d(G("groupingType",e,!0)))))),i},yr=function(e,t){var n="uv"===t?function(e){return e*P}:ye,r="uv"===t?function(e){return e*j}:ye,i=new te,o=new Map,a=e.map((function(e){var t=Gt(c([n(e.cX),r(e.cY)])),i=b(t,2),a=i[0],s=i[1],u={id:e.id,minX:a-e.width/2,maxX:a+e.width/2,minY:s-e.height/2,maxY:s+e.height/2};return o.set(e.id,u),u}));return i.load(a),[i,o]},br=function(e){var t=e.toBBox,n=e.compare,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.coordType,a=void 0===o?"uv":o;return function(){var e=i(u.mark((function e(r){var i,o,s,c,l,f,h,p,g,v,y,w,x,S,k=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=k.length>1&&void 0!==k[1]?k[1]:{},o=i.conditions,s=void 0===o?[]:o,c=m.state.piles,l=yr(r.basedOn,a),f=b(l,2),h=f[0],p=f[1],g={},v=function(e,t,r){var i=-1,o=1/0;return e.forEach((function(e,a){var s={minX:e.centroid[0]-e.width/2,maxX:e.centroid[0]+e.width/2,minY:e.centroid[1]-e.height/2,maxY:e.centroid[1]+e.height/2},u=n(s,t,r),c=b(u,2),l=c[0],f=c[1];l&&f<o&&(o=f,i=a)})),i},y=function(e){g[e.id]={keep:[e.id],split:[]}},w=function(e,t){g[e.id].keep.push(t.id)},x=function(e,t){var n=t.maxX-t.minX,i=t.maxY-t.minY,o=[t.minX+n/2,t.minY+i/2];if(g[e.id].split.length){var a=v(g[e.id].split,t,r.threshold);if(-1===a)g[e.id].split.push({centroid:o,width:n,height:i,items:[t.id]});else{var s=g[e.id].split[a],u=s.items.length,c=u+1,l=[s.centroid[0]*u/c+o[0]/c,s.centroid[1]*u/c+o[1]/c];s.centroid=l,s.items.push(t.id)}}else g[e.id].split.push({centroid:o,width:n,height:i,items:[t.id]})},S=function(e){if(!(c[e.id].items.length<2)){var i=h.search(t(e,r.threshold)),o=new Set;o.add(e.id),y(e),i.forEach((function(t){-1!==c[e.id].items.indexOf(t.id)&&(t.id!==e.id&&(n(e,t,r.threshold)[0]&&s.every((function(n){return n(c[e.id],c[t.id])}))?w(e,t):x(e,t),o.add(t.id)))})),c[e.id].items.forEach((function(t){if(!o.has(t)){var n=p.get(t);t===e.id?w(e,n):x(e,n)}}))}},Re.all().forEach(S),Object.keys(g).forEach((function(e){var t=[];g[e].keep.length&&t.push(g[e].keep),g[e].split.length&&t.push.apply(t,d(g[e].split.map((function(e){return e.items})))),t.length>1?g[e]=t:delete g[e]})),e.abrupt("return",g);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},wr=function(e,t,n){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),o=(Math.min(e.maxX,t.maxX)-r)*(Math.min(e.maxY,t.maxY)-i);return[o>=n,o]},Sr=br({toBBox:ye,compare:wr}),kr=function(e,t){return{minX:e.minX-t,minY:e.minY-t,maxX:e.maxX+t,maxY:e.maxY+t}},Mr=function(e,t,n){var r=$p(e,t);return[r<n,r]},Or=br({toBBox:kr,compare:Mr}),Ar=function(){var e=i(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.entries(m.state.piles).filter((function(e){return e[1].items.length>1})).reduce((function(e,n){var r=b(n,2),i=r[0],o=r[1].items.reduce((function(e,n,r){var i=t.map((function(e){return e(m.state.items[n],n,r,J.get(n))})).join("|");return e[i]?e[i].push(n):e[i]=[n],e}),{});return Object.keys(o).length>1&&(e[i]=Object.values(o)),e}),{}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pr=function(){var e=i(u.mark((function e(t){var n,r,i,o,a,s,c,l,f=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:{},r=new Map,i=Object.entries(m.state.items).map((function(e,n){var i=b(e,2),o=i[0],a=i[1];return r.set(o,n),{id:o,data:t.flatMap((function(e){return e.property(a,o,0,J.get(o))}))}})),(o=n.clusterer)||(a=n.clustererOptions||{},s=a.k,a.valueGetter=function(e){return e.data},s||(s=Math.max(2,Math.ceil(Math.sqrt(i.length/2)))),o=jr(s,a)),e.next=7,o(i);case 7:return c=e.sent,l=c.labels,e.abrupt("return",Object.entries(m.state.piles).reduce((function(e,t){var n=b(t,2),i=n[0],o=n[1];if(!o.items.length)return e;var a=o.items.reduce((function(e,t){var n=l[r.get(t)];return e[n]?e[n].push(t):e[n]=[t],e}),{});return Object.keys(a).length>1&&(e[i]=Object.values(a)),e}),{}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Cr=!1,_r=Promise.resolve(),Ir=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Cr)return _r;switch(Cr=!0,e){case"overlap":n=Sr(t,r);break;case"distance":n=Or(t,r);break;case"category":n=Ar(t);break;case"cluster":n=Pr(t,r)}return(_r=n.then((function(e){return Object.keys(e).length?(m.dispatch(pe([Wh.setFocusedPiles([]),Wh.splitPiles(e)])),Promise.all(Object.entries(e).filter((function(e){return e[1].length>1})).map((function(e){var t=b(e,2),n=t[0],r=t[1].map((function(e){return e[0]}));return pn(n,r)})))):Promise.resolve()}))).then((function(){Cr=!1})),_r},Rr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Si(e,t),i=Ir(e,r,n);return"distance"!==e&&"overlap"!==e||!n.onZoom||(delete n.onZoom,m.dispatch(pe([].concat(d(G("splittingObjective",r,!0)),d(G("splittingOptions",n,!0)),d(G("splittingType",e,!0)))))),i},Tr=function(){return Rr("category","id")},Lr=function(){var e=m.state,t=e.arrangementType,n=e.arrangementObjective,r=e.arrangementOptions,i=!1;switch(e.navigationMode){case"panZoom":i=nt();break;case"scroll":i=et();break;case"auto":default:switch(t){case"data":i=n.length>1||r.forceDimReduction?nt():et();break;case"xy":case"uv":i=nt();break;case"index":case"ij":i=et()}}i&&(qe(),Je())},Br={},Nr=[],Dr=[],zr=[],Fr=function(e){var t=m.state,n=t.arrangementObjective,r=t.arrangementOptions,i=t.items,o=t.piles,a=e.length>=ee.size;n.forEach((function(t,s){var u=void 0===Dr[s]||a?1/0:Dr[s],c=void 0===zr[s]||a?-1/0:zr[s],l=a;if(!a&&Nr[s]&&n.length<3&&!r.forceDimReduction){var f=0,h=ee.size,p=!1,d=!1;if(e.forEach((function(e){var t=Nr[s][e];t===f&&(f++,p=!0,l=!0),t===h&&(h--,d=!0,l=!0)})),p){var g=Object.entries(Nr[s]).find((function(e){return e[1]===f})),m=b(g,1)[0];u=Br[m][s]}if(d){var v=Object.entries(Nr[s]).find((function(e){return e[1]===h})),y=b(v,1)[0];c=Br[y][s]}}e.forEach((function(e){var r=o[e].items.map((function(e,n){return t.property(i[e],e,n,J.get(e))})),a=t.aggregator(r);a<u&&(u=a,l=!0),a>c&&(c=a,l=!0),Br[e]||(Br[e]=[]),Br[e][s]=Number.isNaN(a)?null:a,Br[e].splice(n.length)})),Nr[s]=lt(Br,{getter:function(e){return e[s]},comparator:t.inverse?ct:ut,ignoreNull:!0}),l&&(Dr[s]=u,zr[s]=c)})),Nr.splice(n.length),Dr.splice(n.length),zr.splice(n.length)},Vr=[],Ur=function(){var e=m.state.arrangementObjective,t=[P,j];return Vr=e.map((function(e,n){var r=Vr[n],i=Dr[n],o=zr[n];if(r){var a=r.domain(),s=b(a,2),u=s[0],c=s[1];if(i===u&&o===c)return Vr[n]}var l=e.inverted?[o,i]:[i,o],f=Ae(St.range()),h=Ae(St.range());return e.scale().domain(l).range([f/2,t[n]-h/2])})),Promise.resolve()},Yr=0,Xr=function(){var e=i(u.mark((function e(t){var n,r,i,o,a,s,c;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.state,r=n.arrangementObjective,i=n.arrangementOptions,o=n.dimensionalityReducer,a=n.items,o){e.next=4;break}return console.warn("No dimensionality reducer provided. Unable to arrange piles by multiple dimensions."),e.abrupt("return",Promise.resolve());case 4:if(!Yr||t||i.runDimReductionOnPiles){e.next=6;break}return e.abrupt("return",Promise.resolve());case 6:return vt(),e.next=9,ht();case 9:return s=!0===i.runDimReductionOnPiles?Object.values(Br).filter((function(e){return null!==e[0]})):Object.entries(a).map((function(e){var t=b(e,2),n=t[0],i=t[1];return r.flatMap((function(e){return e.property(i,n,0,J.get(n))}))})),c=o.fit(s),zt.clear(),c.then((function(){Yr++,yt()})),e.abrupt("return",c);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),qr=function(e,t){var n=m.state,r=n.arrangementObjective,i=n.arrangementOptions;return Fr(e),r.length>2||i.forceDimReduction?Xr(t):r.length>1?Ur():Promise.resolve()},Hr=function(){var e=i(u.mark((function e(t,n){var r,i,o,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.state,i=r.arrangementType,o=r.piles,a=t.length?t:Object.keys(o),"data"!==i){e.next=6;break}return N=qr(a,n),e.next=6,N;case 6:Lr();case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Gr=function(){return null===m.state.arrangementType?[]:[].concat(d(G("arrangeOnGrouping",!1,!0)),d(G("arrangementOptions",{},!0)),d(G("arrangementObjective",null,!0)),d(G("arrangementType",null,!0)))},$r=new Map,Wr=new Map,Kr=function(){var e=m.state,n=e.items,r=e.piles,i=e.pileLabel,o=e.pileLabelColor,a=e.pileLabelText,s=e.pileLabelTextMapping,u=e.pileLabelTextColor,c=e.pileLabelFontSize,l=e.pileLabelTextStyle;$r.forEach((function(e){e.pixiText&&e.pixiText.destroy()})),$r.clear(),Wr.clear();var f=new Set;Object.values(n).forEach((function(e){var t=i.flatMap((function(t){return t(e)})).join("-");Wr.set(e.id,t),!f.has(t)&&t&&($r.set(t,{text:t,index:f.size}),f.add(t))})),$r.forEach((function(e){var n;if(null!==o)if(Se(o))n=wn(o(e.text,$r));else{var i=o;Array.isArray(o)||(i=[o]);var f=i.length;n=wn(i[e.index%f])}else{var h=Wn.length;n=wn(Wn[e.index%h])}if(e.color=n,Se(a)?Object.values(r).some((function(e){return a(e)})):a){var p=e.text;Se(s)?p=s(e.text,$r):Array.isArray(a)&&(p=a[e.index]);var d=new t.Text(p,Xp({fill:u,fontSize:2*c*window.devicePixelRatio,align:"center"},l||{}));d.updateText(),e.texture=d.texture,e.pixiText=d}}))},Zr=function(e,t){var n=m.state.pileLabelSizeTransform,r=e.reduce((function(e,t){return e[t]=+!n,e}),{});return n?(t.forEach((function(e){r[e]++})),n(Object.values(r),Object.keys(r))):Object.values(r)},Qr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=ee.get(t);if(r)if(m.state.pileLabel){var i=m.state,o=i.pileLabel,a=i.items;Wr.size&&!n||Kr();var s=e.items.flatMap((function(e){return o.map((function(t){return t(a[e])})).join("-")})).filter((function(e){return e.length})),u=we(s);u.sort((function(e,t){return($r.get(e.toString()).index||1/0)-($r.get(t.toString()).index||1/0)}));var c=u.length>1?Zr(u,s):[1],l=u.reduce((function(e,t){var n=t&&t.toString&&$r.get(t.toString())||Kn;return e[0].push(n.text),e[1].push(n.color),e[2].push(n.texture),e}),[[],[],[]]);r.drawLabel.apply(r,d(l).concat([c]))}else r.drawLabel([])},Jr=[],ei=[],ti=0,ni=function(e){if(e.length){Jr.push.apply(Jr,d(e));var t=++ti;Promise.all(Jr).then((function(){if(t===ti)return Promise.all(ei.map((function(e){return e()})))})).then((function(){ei.splice(0,ei.length),Jr.splice(0,Jr.length),I.textureGC.run(),p.publish("itemUpdate")}))}},ri=function(){if(!_){var t,n,r=m.state,o=new Set,a=[],s=[];if(y.items!==r.items&&y.itemRenderer){var c=Xp({},y.items),l={},f={},h={};Object.entries(r.items).forEach((function(e){var t=b(e,2),n=t[0],i=t[1];y.items[n]?i.src!==y.items[n].src&&(f[n]=i,Object.values(r.piles).forEach((function(e){e.items.length>1&&e.items.includes(n)&&(h[e.id]=e)}))):l[n]=i,delete c[n]}));var d=Object.keys(l).length,g=Object.keys(f).length,S=Object.keys(c).length,k=Object.keys(h).length;d&&a.push(Lt(l)),g&&a.push(Tt(f)),S&&a.push(Fn(c)),k&&a.push(Object.entries(h).forEach((function(e){var t=b(e,2),n=t[0],r=t[1],i=ee.get(n);i.cover&&tn(r,i),Qr(r,n)}))),(d||S)&&(o.add("grid"),o.add("layout"))}if(!Object.values(r.items).length||y.itemRenderer===r.itemRenderer&&y.previewRenderer===r.previewRenderer&&y.coverRenderer===r.coverRenderer&&y.previewAggregator===r.previewAggregator&&y.coverAggregator===r.coverAggregator||(J.size?a.push(Tt()):a.push(Lt(r.items))),y.itemSizeRange!==r.itemSizeRange&&o.add("layout"),y.piles!==r.piles&&Object.keys(y.piles).length){var M={},E=[];Object.entries(r.piles).forEach((function(e){var t=b(e,2),n=t[0],r=t[1];y.piles[n]&&r!==y.piles[n]&&(M[n]=r)})),Object.entries(M).forEach((function(e){var t=b(e,2),n=t[0],r=t[1],i=r.items.length!==y.piles[n].items.length,o=(r.x!==y.piles[n].x||r.y!==y.piles[n].y)&&0!==r.items.length;i&&(on(r,n),s.push(n)),o&&E.push(an(r,n)),(i||o)&&(Qt(r,n),Qr(r,n))})),E.length?(x=!1,Promise.all(E).then((function(e){p.publish("pilesPositionEnd",{targets:e})}))):x&&(x=!1,p.publish("pilesPositionEnd",{targets:E}))}if(!ee.size||y.pileLabel===r.pileLabel&&y.pileLabelColor===r.pileLabelColor&&y.pileLabelText===r.pileLabelText&&y.pileLabelAlign===r.pileLabelAlign&&y.pileLabelFontSize===r.pileLabelFontSize&&y.pileLabelHeight===r.pileLabelHeight&&y.pileLabelStackAlign===r.pileLabelStackAlign||Object.entries(r.piles).filter((function(e){return e[1].items.length})).forEach((function(e,t){var n=b(e,2),r=n[0],i=n[1];Qr(i,r,!t)})),!ee.size||y.pileItemOpacity===r.pileItemOpacity&&y.pileItemBrightness===r.pileItemBrightness&&y.pileItemInvert===r.pileItemInvert&&y.pileItemTint===r.pileItemTint||Object.entries(r.piles).forEach((function(e){var t=b(e,2),n=t[0],r=t[1];Zt(r,n)})),!ee.size||y.pileOpacity===r.pileOpacity&&y.pileBorderSize===r.pileBorderSize&&y.pileScale===r.pileScale&&y.pileSizeBadge===r.pileSizeBadge&&y.pileSizeBadgeAlign===r.pileSizeBadgeAlign&&y.pileVisibilityItems===r.pileVisibilityItems||(Object.entries(r.piles).forEach((function(e){var t=b(e,2),n=t[0],r=t[1];Qt(r,n)})),!1===r.pileSizeBadge&&v.clear()),y.orderer!==r.orderer&&o.add("layout"),y.itemSize===r.itemSize&&y.columns===r.columns&&y.rowHeight===r.rowHeight&&y.cellAspectRatio===r.cellAspectRatio&&y.cellPadding===r.cellPadding&&y.cellSize===r.cellSize&&y.orderer===r.orderer&&y.pileCellAlignment===r.pileCellAlignment||(o.add("grid"),o.add("layout")),y.itemSize===r.itemSize&&y.pileItemOffset===r.pileItemOffset&&y.pileItemRotation===r.pileItemRotation&&y.previewPadding===r.previewPadding&&y.previewSpacing===r.previewSpacing&&y.previewScaleToCover===r.previewScaleToCover&&y.previewOffset===r.previewOffset&&y.previewItemOffset===r.previewItemOffset||o.add("positionItems"),ee.size&&y.previewScaling!==r.previewScaling&&Object.values(r.piles).forEach((function(e){en(e)})),y.tempDepileDirection===r.tempDepileDirection&&y.tempDepileOneDNum===r.tempDepileOneDNum||o.add("layout"),y.temporaryDepiledPiles!==r.temporaryDepiledPiles&&(y.temporaryDepiledPiles.length&&Mn(y.temporaryDepiledPiles),r.temporaryDepiledPiles.length?(ee.forEach((function(e){e.disableInteractivity()})),An(r.temporaryDepiledPiles)):ee.forEach((function(e){e.enableInteractivity()})),Z()),y.focusedPiles!==r.focusedPiles){var O=Dn(y.focusedPiles,r.focusedPiles),A=b(O,2),P=A[0],j=A[1];P.filter((function(e){return ee.has(e)})).forEach((function(e){var t=ee.get(e);t.isTempDepiled||(t.blur(),t.isFocus=!1)})),j.filter((function(e){return ee.has(e)})).forEach((function(e){var t=ee.get(e);t.isTempDepiled?t.active():t.focus(),t.isFocus=!0}));var C=m.state.piles;j.length&&p.publish("pileFocus",{targets:j.map((function(e){return C[e]}))}),P.length&&p.publish("pileBlur",{targets:P.map((function(e){return C[e]}))}),Z()}if(y.magnifiedPiles!==r.magnifiedPiles&&(y.magnifiedPiles.map((function(e){return ee.get(e)})).filter((function(e){return e})).forEach((function(e){e.unmagnify(),delete e.magnifiedByWheel,Ye(e.id),oe()})),r.magnifiedPiles.map((function(e){return ee.get(e)})).filter((function(e){return e})).forEach((function(e){e.magnifiedByWheel||e.magnify(),ae(e.graphics)})),Z()),y.depileMethod!==r.depileMethod&&o.add("layout"),y.depiledPile!==r.depiledPile&&0!==r.depiledPile.length&&dn(r.depiledPile[0]),y.showGrid!==r.showGrid&&(r.showGrid?at():st()),Object.keys(r.items).length&&r.arrangementType&&(y.arrangementType!==r.arrangementType||y.arrangementObjective!==r.arrangementObjective||a.length||s.length||r.arrangementObjective.length>2&&y.dimensionalityReducer!==r.dimensionalityReducer)){o.add("layout");var I=(t=[].concat(s),n=y.arrangementObjective!==r.arrangementObjective,i(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Hr(t,n));case 1:case"end":return e.stop()}}),e)}))));a.length?ei.push(I):I()}if(y.navigationMode!==r.navigationMode&&o.add("navigation"),y.darkMode===r.darkMode&&y.haltBackgroundOpacity===r.haltBackgroundOpacity||bt(),y.darkMode!==r.darkMode&&(wt(),r.darkMode?(w=0,Ne(e,"pilingjs-darkmode")):(w=Un,Ue(e,"pilingjs-darkmode"))),y.darkMode===r.darkMode&&y.lassoFillColor===r.lassoFillColor&&y.lassoFillOpacity===r.lassoFillOpacity&&y.lassoShowStartIndicator===r.lassoShowStartIndicator&&y.lassoStartIndicatorOpacity===r.lassoStartIndicatorOpacity&&y.lassoStrokeColor===r.lassoStrokeColor&&y.lassoStrokeOpacity===r.lassoStrokeOpacity&&y.lassoStrokeSize===r.lassoStrokeSize||xt(),y=r,p.publish("update",{action:m.lastAction}),o.has("grid")&&dt(),o.has("layout")||a.length>0||s.length>0){var R=function(e){return i(u.mark((function t(){return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",$t(e));case 1:case"end":return t.stop()}}),t)})))}(y.arrangeOnGrouping?[]:[].concat(s));a.length?ei.push(R):R()}o.has("navigation")&&Lr(),o.has("positionItems")&&Object.values(y.piles).filter((function(e){return e.items.length>1})).forEach((function(e){Kt(e.id,{all:!0})})),ni(a)}},ii=function(){ee.forEach((function(e){e&&e.blur()}))},oi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.serialize,n=void 0!==t&&t;return n?tr(m.export()):m.export()},ai=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.deserialize,i=void 0!==r&&r,o=n.overwriteState,a=void 0!==o&&o,s=n.debug,u=void 0!==s&&s;R=!1;var c=new Promise((function(e){t=p.subscribe("update",(function(t){t.action.type.indexOf("OVERWRITE")>=0&&e()}))}));return m.import(i?Rn(e):e,{overwriteState:a,debug:u}),ii(),c.then((function(){p.unsubscribe(t)})),c},si=function(e){return Se(e)?e:function(t){return t[e]}},ui=function(e){if(Se(e.aggregator))return e.aggregator;switch(e.aggregator){case"max":return e.propertyIsVector?Oe:Ee;case"median":return e.propertyIsVector?Ce:je;case"min":return e.propertyIsVector?Ie:_e;case"sum":return e.propertyIsVector?Le:Te;case"mean":default:return e.propertyIsVector?Pe:Ae}},ci=function(e){if(Se(e))return e;switch(e){case"linear":default:return zn}},li=function(e){Array.isArray(e)||(e=[e]);var t=[];return e.forEach((function(e){var n={};e.constructor!==Object?(n.property=si(e),n.aggregator=e.propertyIsVector?Pe:Ae,n.scale=zn,n.inverse=!1):(n.property=si(e.property),n.aggregator=ui(e),n.scale=ci(e.scale),n.inverse=!!e.inverse),t.push(n)})),t},fi=function(e,t){var n={};return e.constructor!==Object?(n.property=si(e),n.isCustom=Se(e),n.aggregator=t?Pe:Ae):(n.property=si(e.property),n.aggregator=ui(e)),n},hi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t;switch(e){case"data":r=li(t);break;case"xy":case"ij":case"uv":case"custom":r=fi(t,!0);break;case"index":r=fi(t)}var i=!!n.onGrouping;return delete n.onGrouping,x=!0,m.dispatch(pe([].concat(d(G("arrangeOnGrouping",i,!0)),d(G("arrangementOptions",n,!0)),d(G("arrangementObjective",r,!0)),d(G("arrangementType",e,!0))))),new Promise((function(e){p.subscribe("pilesPositionEnd",e,1)}))},pi=function(e){return e||1},di=function(e){return e||1},gi=function(e){var t=null;return ke(e)?t=Xp(Xp({},t),e):+e&&(t.columns={columns:+e,cellAspectRatio:be.cellAspectRatio}),t},mi=function(e){return(Array.isArray(e)?e:[e]).map((function(t){var n={};return ke(e)?(n.property=si(t.property),n.aggregator=Se(t.aggregator)?t.aggregator:nr):(n.property=si(t),n.aggregator=nr),n}))},vi=function(e){return(Array.isArray(e)?e:[e]).map((function(t){var n={};return t.constructor!==Object?(n.property=si(t),n.aggregator=e.propertyIsVector?Pe:Ae):(n.property=si(t.property),n.aggregator=ui(t)),n}))},yi=function(e,t){switch(e){case"overlap":return di(t);case"grid":return gi(t);case"distance":return pi(t);case"category":return mi(t);case"cluster":return vi(t);default:return t}},bi=function(){var e=m.state.piles,t=Re.all().reduce((function(e,t){var n=t.maxX-t.minX,r=t.maxY-t.minY;return e[t.id]={cX:(t.minX+n/2)/P,cY:(t.minY+n/2)/j,width:n,height:r,id:t.id},e}),{});return Object.entries(e).forEach((function(e){var n=b(e,2),r=n[0];n[1].items.forEach((function(e){t[e]||(t[e]=Xp(Xp({},t[r]),{},{id:e}))}))})),Object.values(t)},wi=function(e){var t={};if(ke(e)?(t.threshold=e.threshold,e.basedOn&&(t.basedOn=si(e.basedOn))):Array.isArray(e)?(t.threshold=e[0],e.length>1&&(t.basedOn=si(e[1]))):t.threshold=e,t.basedOn){var n=m.state,r=n.items,i=n.piles;t.basedOn=Object.values(i).flatMap((function(e){return e.items.map((function(e,n){var i=J.get(e),o=t.basedOn(r[e],e,n,i),a=b(o,2);return{id:e,cX:a[0],cY:a[1],width:i.image.width,height:i.image.height}}))}))}else t.basedOn=bi();return t},xi=function(e){return(Array.isArray(e)?e:[e]).map((function(e){return si(e)}))},Si=function(e,t){switch(e){case"overlap":case"distance":return wi(t);case"category":case"cluster":return xi(t);default:return t}},ki=function(e){return null===e?null:(Array.isArray(e)?e:[e]).map((function(e){return si(e)}))},Mi=function(e){if(Se(e))return e;switch(e){case"histogram":return function(e){var t=Object.values(e),n=Ee(t);return t.map((function(e){return e/n}))};default:return function(e){return e.map((function(){return 1}))}}},Ei=!1,Oi=function(e,t){if(!Ei){Ei=!0;var n=m.state.piles,r=n[e].x,i=n[e].y,o=function(){++a===t.length&&(Ei=!1,m.dispatch(Wh.mergePiles([e].concat(d(t)),[r,i],e)))},a=0;Q.addBatch(t.map((function(e){return jt(ee.get(e),r,i,{onDone:o})})))}},Ai=function(e){var t=m.state.piles;e.filter((function(e){return ee.has(e)&&1===ee.get(e).size})).forEach((function(e){J.get(e).setOriginalPosition([t[e].x,t[e].y])}))},Pi=function(e){var t=e.target;xe=!1,Ye(t.id);var n=ee.get(t.id),r=n.graphics;if(!n.isTempDepiled){if(n.x!==r.beforeDragX||n.y!==r.beforeDragY){var i=Ve(t.id),o=Re.search(i).filter((function(e){return e.id!==t.id}));if(1===o.length){if(!n.isTempDepiled){var a=o[0].id,s=ee.get(a),u=m.state.piles[a];if(xe=!s.isTempDepiled){n.items.forEach((function(e){e.item.tmpAbsX=r.x,e.item.tmpAbsY=r.y,e.item.tmpRelScale=n.scale})),Ai([a,t.id]);var c=m.state,f=c.previewAggregator,h=c.previewRenderer;f||h?Oi(a,[t.id]):m.dispatch(Wh.mergePiles([t.id,a],[u.x,u.y],a))}}}else{var p=l([n.x,n.y]),d=b(p,2),g=d[0],v=d[1];m.dispatch(Wh.movePiles([{id:t.id,x:g,y:v}]))}}xe||oe(),Ci()}},ji=[],Ci=function(){ji.map((function(e){return ee.get(e.id)})).filter(ye).forEach((function(e){e.blur()})),ji=[]},_i=function(e){if(!m.state.temporaryDepiledPiles.length){var t=Re.search(Ve(e)).filter((function(t){return t.id!==e}));Ci(),t.map((function(e){return ee.get(e.id)})).filter(ye).forEach((function(e){e.hover()})),ji=d(t)}},Ii=function(e){var t=e.target,n=e.event,r=ee.get(t.id);if(r&&r.isMagnified){var i=n.data.getLocalPosition(r.graphics.parent);r.graphics.draggingMouseOffset[0]/=r.magnification,r.graphics.draggingMouseOffset[1]/=r.magnification,Ct(r,i.x-r.graphics.draggingMouseOffset[0],i.y-r.graphics.draggingMouseOffset[1])}m.dispatch(Wh.setMagnifiedPiles([])),ae(r.graphics)},Ri=function(e){var t=e.target;_i(t.id)},Ti=function(e){var t=e.target,n=ee.get(t.id);ae(n.graphics)},Li=function(e){var t=e.target,n=ee.get(t.id);n&&n.isTempDepiled||oe()},Bi=function(t){t.style.display="none",e.removeChild(t)},Ni=function(e,t){return function(){"cloestPos"===m.state.depileMethod?m.dispatch(Wh.setDepiledPile([t])):gn(t),m.dispatch(Wh.setFocusedPiles([])),Bi(e)}},Di=function(e,t){return function(){var n=m.state,r=n.piles,i=n.temporaryDepiledPiles;if(r[t].items.length>1){var o=d(i);o=o.includes(t)?o.filter((function(e){return e!==t})):[t],m.dispatch(Wh.setTemporaryDepiledPiles(d(o)))}Bi(e)}},zi=function(e){return function(){var t=m.state.showGrid;m.dispatch(Wh.setShowGrid(!t)),Bi(e),Z()}},Fi=function(e,t){return function(){ee.get(t).isMagnified?m.dispatch(Wh.setMagnifiedPiles([])):m.dispatch(Wh.setMagnifiedPiles([t])),Bi(e)}},Vi=[0,0],Ui=function(e){if(0===e.button){Z(),Vi=Pn(e);var t=f(Vi);he=!Re.collides({minX:t[0],minY:t[1],maxX:t[0]+1,maxY:t[1]+1}),Be(t)}},Yi=function(){he&&(he=!1,de?Cn():T&&Qe())},Xi=function(e){he&&(e.shiftKey||de?me.extendDb(Pn(e)):T&&Ge(!1))},qi=!1,Hi=function(t){if(qi)qi=!1;else{qi=!0,setTimeout((function(){qi=!1}),300);var n=e.querySelector("#piling-js-context-menu"),r=!!n;r&&e.removeChild(n);var i=Pn(t);if(i[0]===Vi[0]&&i[1]===Vi[1]){var o=f(i),a=Re.search({minX:o[0],minY:o[1],maxX:o[0]+1,maxY:o[1]+1});if(0!==a.length)if(t.shiftKey){var s=m.state.focusedPiles,u=a[0].id;s.includes(u)?Gi(u):m.dispatch(Wh.setFocusedPiles([].concat(d(s),[u])))}else if(t.altKey){var c=m.state.depileMethod;if("originalPos"===c)gn(a[0].id);else if("cloestPos"===c)m.dispatch(Wh.setDepiledPile([a[0].id]));else if("hoveredOne"===c){var l=ee.get(a[0].id),h=l.previewItemId;yn(l.id,[h]);var p=J.get(h);l.itemOutHandler({item:p})}m.dispatch(Wh.setFocusedPiles([]))}else a.forEach((function(e){ee.get(e.id).isHover&&m.dispatch(Wh.setFocusedPiles([e.id]))}));else{var g=m.state,v=g.focusedPiles,y=g.magnifiedPiles;v.length&&m.dispatch(Wh.setFocusedPiles([])),y.length&&m.dispatch(Wh.setMagnifiedPiles([])),r||v.length||y.length||me.showStartIndicator(Vi)}}}},Gi=function(e){var t=m.state.focusedPiles.filter((function(t){return t!==e}));t.length&&(m.dispatch(Wh.setFocusedPiles([e])),Oi(e,t))},$i=function(e){var t=Pn(e),n=f(t),r=m.state,i=r.temporaryDepiledPiles,o=r.piles,a=Re.search({minX:n[0],minY:n[1],maxX:n[0]+1,maxY:n[1]+1});if(0===a.length||i.length)m.dispatch(Wh.setTemporaryDepiledPiles([])),m.dispatch(Wh.setFocusedPiles([]));else{var s=a[0].id;if(e.shiftKey)Gi(s);else if(o[s].items.length>1){var u=d(i);u=u.includes(s)?u.filter((function(e){return e!==s})):[s],m.dispatch(Wh.setTemporaryDepiledPiles(d(u)))}}},Wi=function(e){if(e.altKey){var t=Pn(e),n=f(t),r=Re.search({minX:n[0],minY:n[1],maxX:n[0]+1,maxY:n[1]+1});if(0!==r.length){var i=ee.get(r[0].id);e.preventDefault(),i.isMagnified?(i.magnifiedByWheel=!0,m.dispatch(Wh.setMagnifiedPiles([i.id]))):(delete i.magnifiedByWheel,m.dispatch(Wh.setMagnifiedPiles([]))),In(r[0].id,fe(e).pixelY)}}else T&&(Ge(),Ze())},Ki=function(){F.y=-r.scrollTop,Z()},Zi=function(){var t=e.getBoundingClientRect(),n=t.width,r=t.height;P=n,j=r,I.resize(P,j),h&&h.setViewCenter([P/2,j/2]),Y.width=n,Y.height=r,dt(),p.publish("resize",{width:n,height:r})},Qi=ft(Zi,500),Ji=function(){var e=be.align(ee),t=[];e.filter((function(e){var t=e.id,n=e.x,r=e.y,i=ee.get(t),o=rt(n,r,i.x,i.y);return!(o<3)||(Ot(i,n,r),o>1e-9&&Ye(i.id),!1)})).forEach((function(n,r,i){var o=n.id,a=n.x,s=n.y,u=ee.get(o),c=rt(a,s,u.x,u.y);t.push(ip({duration:Math.max(125,250*ge(Math.min(c,250)/250)),interpolator:ve,endValue:[a,s],getter:function(){return[u.x,u.y]},setter:function(e){Ot(u,e[0],e[1])},onDone:function(){Ye(u.id),r===i.length-1&&(m.dispatch(Wh.movePiles(e)),De(),Je(),Z())}}))})),Q.addBatch(t)},eo=function(){var t=e.querySelector("#piling-js-context-menu");t&&e.removeChild(t)},to=function(){Ji(),eo()},no=function(e,t){return function(){mt.enter([t]),gn(t),Bi(e)}},ro=function(t){eo();var n=Pn(t),r=f(n);if(!t.altKey){var i=m.state,o=i.pileContextMenuItems,s=i.showGrid;t.preventDefault();var u=Re.search({minX:r[0],minY:r[1],maxX:r[0]+1,maxY:r[1]+1}),c=u.length>0,l=Ap({customItems:o.filter((function(e){return e.label&&e.callback}))});e.appendChild(l);var h=l.querySelector("#depile-button"),p=l.querySelector("#temp-depile-button"),d=l.querySelector("#browse-separately"),g=l.querySelector("#grid-button"),v=l.querySelector("#align-button"),y=l.querySelector("#magnify-button"),b=l.querySelector("#extract-button");if(c){var w;g.style.display="none",v.style.display="none",u.forEach((function(e){ee.get(e.id).isHover&&(w=ee.get(e.id))})),w&&1===w.size?(h.setAttribute("disabled",""),h.setAttribute("class","inactive"),p.setAttribute("disabled",""),p.setAttribute("class","inactive"),d.setAttribute("disabled",""),d.setAttribute("class","inactive")):w.isTempDepiled&&(h.setAttribute("disabled",""),h.setAttribute("class","inactive"),y.setAttribute("disabled",""),y.setAttribute("class","inactive"),d.setAttribute("disabled",""),d.setAttribute("class","inactive"),p.innerHTML="Close Temp. Depile"),w.isMagnified&&(y.innerHTML="Unmagnify"),l.style.display="block";var x=l.getBoundingClientRect().width;l.style.left="".concat(w.x-x,"px"),l.style.top="".concat(n[1]+F.y-10,"px"),mt.size<1?b.addEventListener("click",(function(){yn(w.id,[ee.get(w.id).previewItemId]),Bi(l)}),qn):(w.size>1&&(b.innerHTML="Extract This Pile"),b.addEventListener("click",(function(){var e=w.items.map((function(e){return e.id})),t=mt.currSourcePileIds[0];mt.leave(),yn(t,e)}),qn)),h.addEventListener("click",Ni(l,w.id),qn),p.addEventListener("click",Di(l,w.id),qn),d.addEventListener("click",no(l,w.id),qn),y.addEventListener("click",Fi(l,w.id),qn),o.forEach((function(e,t){(e.id?l.querySelector("#".concat(e.id)):l.querySelector("#piling-js-context-menu-custom-item-".concat(t))).addEventListener("click",(function(){e.callback(Xp({id:w.id},m.state.piles[w.id])),e.keepOpen||eo()}),{once:!e.keepOpen,passive:!0})}))}else{h.style.display="none",p.style.display="none",d.style.display="none",y.style.display="none",b.style.display="none",s&&(g.innerHTML="Hide Grid"),l.style.display="block";var S=l.getBoundingClientRect().width;n[0]>a.getBoundingClientRect().width-S?l.style.left="".concat(n[0]-S,"px"):l.style.left="".concat(n[0],"px"),l.style.top="".concat(n[1]+F.y,"px"),g.addEventListener("click",zi(l),qn),v.addEventListener("click",to,qn),o.forEach((function(e,t){(e.id?l.querySelector("#".concat(e.id)):l.querySelector("#piling-js-context-menu-custom-item-".concat(t))).addEventListener("click",(function(){e.callback(),e.keepOpen||eo()}),{once:!e.keepOpen,passive:!0})}))}}},io=function(e){e.setEasing(m.state.easing),Q.add(e)},oo=function(e){Q.cancel(e)},ao=function(){window.addEventListener("resize",Qi,qn),window.addEventListener("orientationchange",Qi,qn),a.addEventListener("contextmenu",ro,Xn),a.addEventListener("click",Hi,qn),a.addEventListener("dblclick",$i,qn),p.subscribe("pileDragStart",Ii),p.subscribe("pileDragMove",Ri),p.subscribe("pileDragEnd",Pi),p.subscribe("pileEnter",Ti),p.subscribe("pileLeave",Li),p.subscribe("startAnimation",io),p.subscribe("cancelAnimation",oo),p.subscribe("updatePileBounds",Xe),Me=m.subscribe(ri),e.appendChild(r),e.appendChild(mt.nav),e.appendChild(se.element),Ne(e,"pilingjs"),m.state.darkMode&&Ne(e,"pilingjs-darkmode"),e.style.overflow="hidden",r.appendChild(a),r.appendChild(o),r.appendChild(me.startIndicator),r.style.position="absolute",r.style.overflowX="hidden",r.style.top=0,r.style.right=0,r.style.bottom=0,r.style.left=0,a.style.position="sticky",a.style.display="block",a.style.top="0px",a.style.left="0px",Zi(),pt(),et(),le();var t=W(n);return!n.piles&&n.items&&m.dispatch(Wh.initPiles(n.items)),t},so=function(){for(_=!0,window.removeEventListener("mousedown",Ui),window.removeEventListener("mouseup",Yi),window.removeEventListener("mousemove",Xi),window.removeEventListener("resize",Qi),window.removeEventListener("orientationchange",Qi),r.removeEventListener("scroll",Ki),a.removeEventListener("contextmenu",ro),a.removeEventListener("click",Hi),a.removeEventListener("dblclick",$i),a.removeEventListener("wheel",Wi),m.reset(),D.destroy(!0),D=null,I.destroy(!0),I=null,me.destroy(),v.destroy(),Me&&(Me(),Me=void 0);e.firstChild;)e.firstChild.remove();p.clear()},uo=ao();return{get renderer(){return I},get version(){return"0.10.0"},arrangeBy:hi,destroy:so,exportState:oi,get:H,groupBy:vr,halt:vt,importState:ai,render:Z,resume:yt,set:W,splitAll:Tr,splitBy:Rr,subscribe:p.subscribe,unsubscribe:p.unsubscribe,whenInit:uo}},Kp=function(){self.onmessage=function(e){var t=e.data.src,n=Object.assign({},t);try{for(var r=new Float32Array(t.shape[0]),i=0;i<t.shape[0];i++)for(var o=0;o<t.shape[1];o++)r[o]+=t.data[i*t.shape[0]+o]/t.shape[1];n.data=r,n.shape=[t.shape[0],1]}catch(e){self.postMessage({error:e})}self.postMessage({newSrc:n},[n.data.buffer])}},Zp=function(){var e=function(e,t,n){for(var r=t.length,i=0;i<r;i++)for(var o=0;o<n;o++)e[o]+=Math.max(0,t[i].src.data[o])/r},t=function(t,n,r){var i=new Float32Array(t.length);e(i,n);for(var o=n.length,a=0;a<o;a++)for(var s=0;s<r;s++)t[s]+=Math.pow(n[a].src.data[s]-i[s],2)/o};self.onmessage=function(n){var r,i,o={};n.data.items.length||self.postMessage({error:new Error("No sources provided")});try{o.shape=n.data.items[0].src.shape,o.dtype=n.data.items[0].src.dtype,i=n.data.items[0].src.data.length,r=new Float32Array(i)}catch(e){self.postMessage({error:e})}try{switch(n.data.aggregator){case"variance":t(r,n.data.items,i);break;case"std":!function(e,n,r){t(e,n,r);for(var i=0;i<r;i++)e[i]=Math.sqrt(e[i])}(r,n.data.items,i);break;case"mean":default:e(r,n.data.items,i)}o.data=r}catch(e){self.postMessage({error:e})}self.postMessage({newSrc:o},[o.data.buffer])}},Qp=function(){var e=function(e){return{error:new Error(e)}},t=function(e){return e},n=function(e,t,n,r){return e.filter((function(e){return n(e.datum,t.datum)<=r}))};self.onmessage=function(r){var i,o=r.data,a=o.minPoints,s=o.items,u=o.scripts;try{u.forEach((function(e){importScripts(e)}))}catch(t){self.postMessage(e("Failed to import skmeans: ".concat(t)))}try{i=s.map(self.valueGetter||t)}catch(t){self.postMessage(e("Failed to load features: ".concat(t)))}var c,l,f=self.distanceFunction?self.distanceFunction:(c=i[0].length,l=Array(c).fill().map((function(e,t){return"s += (v[".concat(t,"] - w[").concat(t,"]) ** 2;")})).join(" "),new Function("v","w","let s = 0; ".concat(l," return Math.sqrt(s);"))),h=r.data.maxDistance;try{if(null===h)h=.1*i.reduce((function(e,t){return t.map((function(t,n){return[Math.min(t,e[n][0]),Math.max(t,e[n][1])]}))}),Array(i.length).fill().map((function(){return[1/0,-1/0]}))).reduce((function(e,t){return Math.min(e,t[1]-t[0])}),1/0)}catch(t){self.postMessage(e("Failed to determine max distance: ".concat(t)))}try{var p=function(e,t,r,i){var o,a=0,s=0,u=e.map((function(e,t){return{idx:t,datum:e,label:-1}}));return u.forEach((function(e){if(-1===e.label)if((s=n(u,e,t,r)).length<i)e.label=0;else for(a+=1,e.label=a,o=s.filter((function(t){return t.idx!==e.idx}));o.length;){var c=o.pop();0===c.label&&(c.label=a),-1===c.label&&(c.label=a,(s=n(u,c,t,r)).length>=i&&(o=o.concat(s)))}})),u.map((function(e){return e.label-1}))}(i,f,h,a||2),d=self.postProcessing&&self.postProcessing(p,i,s);self.postMessage({labels:p,postProcessing:d}),self.postMessage({labels:p})}catch(t){self.postMessage(e("Failed to run dbscan: ".concat(t)))}}},Jp='!function (t, r) {\n  if ("object" == typeof exports && "object" == typeof module) module.exports = r();else if ("function" == typeof define && define.amd) define([], r);else {\n    var e = r();\n\n    for (var n in e) ("object" == typeof exports ? exports : t)[n] = e[n];\n  }\n}(window, function () {\n  return function (t) {\n    var r = {};\n\n    function e(n) {\n      if (r[n]) return r[n].exports;\n      var i = r[n] = {\n        i: n,\n        l: !1,\n        exports: {}\n      };\n      return t[n].call(i.exports, i, i.exports, e), i.l = !0, i.exports;\n    }\n\n    return e.m = t, e.c = r, e.d = function (t, r, n) {\n      e.o(t, r) || Object.defineProperty(t, r, {\n        enumerable: !0,\n        get: n\n      });\n    }, e.r = function (t) {\n      "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, {\n        value: "Module"\n      }), Object.defineProperty(t, "__esModule", {\n        value: !0\n      });\n    }, e.t = function (t, r) {\n      if (1 & r && (t = e(t)), 8 & r) return t;\n      if (4 & r && "object" == typeof t && t && t.__esModule) return t;\n      var n = Object.create(null);\n      if (e.r(n), Object.defineProperty(n, "default", {\n        enumerable: !0,\n        value: t\n      }), 2 & r && "string" != typeof t) for (var i in t) e.d(n, i, function (r) {\n        return t[r];\n      }.bind(null, i));\n      return n;\n    }, e.n = function (t) {\n      var r = t && t.__esModule ? function () {\n        return t.default;\n      } : function () {\n        return t;\n      };\n      return e.d(r, "a", r), r;\n    }, e.o = function (t, r) {\n      return Object.prototype.hasOwnProperty.call(t, r);\n    }, e.p = "", e(e.s = 5);\n  }([function (t, r, e) {\n    "use strict";\n\n    const n = Object.prototype.toString;\n\n    t.exports = function (t) {\n      return n.call(t).endsWith("Array]");\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = this && this.__values || function (t) {\n      var r = "function" == typeof Symbol && t[Symbol.iterator],\n          e = 0;\n      return r ? r.call(t) : {\n        next: function () {\n          return t && e >= t.length && (t = void 0), {\n            value: t && t[e++],\n            done: !t\n          };\n        }\n      };\n    };\n\n    function i(t, r) {\n      return Math.floor(r() * t);\n    }\n\n    function o(t) {\n      for (var r = [], e = 0; e < t; e++) r.push(void 0);\n\n      return r;\n    }\n\n    function s(t, r) {\n      return o(t).map(function () {\n        return r;\n      });\n    }\n\n    function a(t) {\n      return s(t, 0);\n    }\n\n    function h(t) {\n      return t.reduce(function (t, r) {\n        return t + r;\n      });\n    }\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    }), r.tauRandInt = i, r.tauRand = function (t) {\n      return t();\n    }, r.norm = function (t) {\n      var r,\n          e,\n          i = 0;\n\n      try {\n        for (var o = n(t), s = o.next(); !s.done; s = o.next()) {\n          var a = s.value;\n          i += Math.pow(a, 2);\n        }\n      } catch (t) {\n        r = {\n          error: t\n        };\n      } finally {\n        try {\n          s && !s.done && (e = o.return) && e.call(o);\n        } finally {\n          if (r) throw r.error;\n        }\n      }\n\n      return Math.sqrt(i);\n    }, r.empty = o, r.range = function (t) {\n      return o(t).map(function (t, r) {\n        return r;\n      });\n    }, r.filled = s, r.zeros = a, r.ones = function (t) {\n      return s(t, 1);\n    }, r.linear = function (t, r, e) {\n      return o(e).map(function (n, i) {\n        return t + i * ((r - t) / (e - 1));\n      });\n    }, r.sum = h, r.mean = function (t) {\n      return h(t) / t.length;\n    }, r.max = function (t) {\n      for (var r = 0, e = 0; e < t.length; e++) r = t[e] > r ? t[e] : r;\n\n      return r;\n    }, r.max2d = function (t) {\n      for (var r = 0, e = 0; e < t.length; e++) for (var n = 0; n < t[e].length; n++) r = t[e][n] > r ? t[e][n] : r;\n\n      return r;\n    }, r.rejectionSample = function (t, r, e) {\n      for (var n = a(t), o = 0; o < t; o++) for (var s = !0; s;) {\n        for (var h = i(r, e), u = !1, l = 0; l < o; l++) if (h === n[l]) {\n          u = !0;\n          break;\n        }\n\n        u || (s = !1), n[o] = h;\n      }\n\n      return n;\n    }, r.reshape2d = function (t, r, e) {\n      var n = [],\n          i = 0;\n      if (t.length !== r * e) throw new Error("Array dimensions must match input length.");\n\n      for (var o = 0; o < r; o++) {\n        for (var s = [], a = 0; a < e; a++) s.push(t[i]), i += 1;\n\n        n.push(s);\n      }\n\n      return n;\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = this && this.__importStar || function (t) {\n      if (t && t.__esModule) return t;\n      var r = {};\n      if (null != t) for (var e in t) Object.hasOwnProperty.call(t, e) && (r[e] = t[e]);\n      return r.default = t, r;\n    };\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n    var i = n(e(1));\n\n    function o(t, r) {\n      var e = function (e) {\n        return i.empty(t).map(function () {\n          return i.filled(r, e);\n        });\n      },\n          n = [];\n\n      return n.push(e(-1)), n.push(e(1 / 0)), n.push(e(0)), n;\n    }\n\n    function s(t, r, e, n, i) {\n      r = Math.floor(r);\n      var o = t[0][r],\n          s = t[1][r];\n      t[2][r];\n      if (e >= s[0]) return 0;\n\n      for (var h = 0; h < o.length; h++) if (n === o[h]) return 0;\n\n      return a(t, r, e, n, i);\n    }\n\n    function a(t, r, e, n, i) {\n      var o = t[0][r],\n          s = t[1][r],\n          a = t[2][r];\n      if (e >= s[0]) return 0;\n      s[0] = e, o[0] = n, a[0] = i;\n\n      for (var h = 0, u = 0;;) {\n        var l = 2 * h + 1,\n            c = l + 1,\n            f = t[0][0].length;\n        if (l >= f) break;\n\n        if (c >= f) {\n          if (!(s[l] > e)) break;\n          u = l;\n        } else if (s[l] >= s[c]) {\n          if (!(e < s[l])) break;\n          u = l;\n        } else {\n          if (!(e < s[c])) break;\n          u = c;\n        }\n\n        s[h] = s[u], o[h] = o[u], a[h] = a[u], h = u;\n      }\n\n      return s[h] = e, o[h] = n, a[h] = i, 1;\n    }\n\n    function h(t, r, e, n) {\n      for (; 2 * n + 1 < e;) {\n        var i = 2 * n + 1,\n            o = i + 1,\n            s = n;\n        if (t[s] < t[i] && (s = i), o < e && t[s] < t[o] && (s = o), s === n) break;\n        var a = t[n];\n        t[n] = t[s], t[s] = a;\n        var h = r[n];\n        r[n] = r[s], r[s] = h, n = s;\n      }\n    }\n\n    r.makeHeap = o, r.rejectionSample = function (t, r, e) {\n      for (var n = i.zeros(t), o = 0; o < t; o++) {\n        for (var s = !0, a = 0; s;) {\n          a = i.tauRandInt(r, e);\n\n          for (var h = !1, u = 0; u < o; u++) if (a === n[u]) {\n            h = !0;\n            break;\n          }\n\n          h || (s = !1);\n        }\n\n        n[o] = a;\n      }\n\n      return n;\n    }, r.heapPush = s, r.uncheckedHeapPush = a, r.buildCandidates = function (t, r, e, n, a) {\n      for (var h = o(r, n), u = 0; u < r; u++) for (var l = 0; l < e; l++) if (!(t[0][u][l] < 0)) {\n        var c = t[0][u][l],\n            f = t[2][u][l],\n            m = i.tauRand(a);\n        s(h, u, m, c, f), s(h, c, m, u, f), t[2][u][l] = 0;\n      }\n\n      return h;\n    }, r.deheapSort = function (t) {\n      for (var r = t[0], e = t[1], n = 0; n < r.length; n++) for (var i = r[n], o = e[n], s = 0; s < i.length - 1; s++) {\n        var a = i.length - s - 1,\n            u = o.length - s - 1,\n            l = i[0];\n        i[0] = i[a], i[a] = l;\n        var c = o[0];\n        o[0] = o[u], o[u] = c, h(o, i, u, 0);\n      }\n\n      return {\n        indices: r,\n        weights: e\n      };\n    }, r.smallestFlagged = function (t, r) {\n      for (var e = t[0][r], n = t[1][r], i = t[2][r], o = 1 / 0, s = -1, a = 0; a > e.length; a++) 1 === i[a] && n[a] < o && (o = n[a], s = a);\n\n      return s >= 0 ? (i[s] = 0, Math.floor(e[s])) : -1;\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    var n,\n        i = this && this.__read || function (t, r) {\n      var e = "function" == typeof Symbol && t[Symbol.iterator];\n      if (!e) return t;\n      var n,\n          i,\n          o = e.call(t),\n          s = [];\n\n      try {\n        for (; (void 0 === r || r-- > 0) && !(n = o.next()).done;) s.push(n.value);\n      } catch (t) {\n        i = {\n          error: t\n        };\n      } finally {\n        try {\n          n && !n.done && (e = o.return) && e.call(o);\n        } finally {\n          if (i) throw i.error;\n        }\n      }\n\n      return s;\n    },\n        o = this && this.__values || function (t) {\n      var r = "function" == typeof Symbol && t[Symbol.iterator],\n          e = 0;\n      return r ? r.call(t) : {\n        next: function () {\n          return t && e >= t.length && (t = void 0), {\n            value: t && t[e++],\n            done: !t\n          };\n        }\n      };\n    },\n        s = this && this.__importStar || function (t) {\n      if (t && t.__esModule) return t;\n      var r = {};\n      if (null != t) for (var e in t) Object.hasOwnProperty.call(t, e) && (r[e] = t[e]);\n      return r.default = t, r;\n    };\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n\n    var a = s(e(1)),\n        h = function () {\n      function t(t, r, e, n) {\n        if (this.entries = new Map(), this.nRows = 0, this.nCols = 0, t.length !== r.length || t.length !== e.length) throw new Error("rows, cols and values arrays must all have the same length");\n        this.nRows = n[0], this.nCols = n[1];\n\n        for (var i = 0; i < e.length; i++) {\n          var o = t[i],\n              s = r[i];\n          this.checkDims(o, s);\n          var a = this.makeKey(o, s);\n          this.entries.set(a, {\n            value: e[i],\n            row: o,\n            col: s\n          });\n        }\n      }\n\n      return t.prototype.makeKey = function (t, r) {\n        return t + ":" + r;\n      }, t.prototype.checkDims = function (t, r) {\n        if (!(t < this.nRows && r < this.nCols)) throw new Error("row and/or col specified outside of matrix dimensions");\n      }, t.prototype.set = function (t, r, e) {\n        this.checkDims(t, r);\n        var n = this.makeKey(t, r);\n        this.entries.has(n) ? this.entries.get(n).value = e : this.entries.set(n, {\n          value: e,\n          row: t,\n          col: r\n        });\n      }, t.prototype.get = function (t, r, e) {\n        void 0 === e && (e = 0), this.checkDims(t, r);\n        var n = this.makeKey(t, r);\n        return this.entries.has(n) ? this.entries.get(n).value : e;\n      }, t.prototype.getAll = function (t) {\n        void 0 === t && (t = !0);\n        var r = [];\n        return this.entries.forEach(function (t) {\n          r.push(t);\n        }), t && r.sort(function (t, r) {\n          return t.row === r.row ? t.col - r.col : t.row - r.row;\n        }), r;\n      }, t.prototype.getDims = function () {\n        return [this.nRows, this.nCols];\n      }, t.prototype.getRows = function () {\n        return Array.from(this.entries, function (t) {\n          var r = i(t, 2);\n          r[0];\n          return r[1].row;\n        });\n      }, t.prototype.getCols = function () {\n        return Array.from(this.entries, function (t) {\n          var r = i(t, 2);\n          r[0];\n          return r[1].col;\n        });\n      }, t.prototype.getValues = function () {\n        return Array.from(this.entries, function (t) {\n          var r = i(t, 2);\n          r[0];\n          return r[1].value;\n        });\n      }, t.prototype.forEach = function (t) {\n        this.entries.forEach(function (r) {\n          return t(r.value, r.row, r.col);\n        });\n      }, t.prototype.map = function (r) {\n        var e = [];\n        this.entries.forEach(function (t) {\n          e.push(r(t.value, t.row, t.col));\n        });\n        var n = [this.nRows, this.nCols];\n        return new t(this.getRows(), this.getCols(), e, n);\n      }, t.prototype.toArray = function () {\n        var t = this,\n            r = a.empty(this.nRows).map(function () {\n          return a.zeros(t.nCols);\n        });\n        return this.entries.forEach(function (t) {\n          r[t.row][t.col] = t.value;\n        }), r;\n      }, t;\n    }();\n\n    r.SparseMatrix = h, r.transpose = function (t) {\n      var r = [],\n          e = [],\n          n = [];\n      t.forEach(function (t, i, o) {\n        r.push(i), e.push(o), n.push(t);\n      });\n      var i = [t.nCols, t.nRows];\n      return new h(e, r, n, i);\n    }, r.identity = function (t) {\n      for (var r = i(t, 1)[0], e = new h([], [], [], t), n = 0; n < r; n++) e.set(n, n, 1);\n\n      return e;\n    }, r.pairwiseMultiply = function (t, r) {\n      return l(t, r, function (t, r) {\n        return t * r;\n      });\n    }, r.add = function (t, r) {\n      return l(t, r, function (t, r) {\n        return t + r;\n      });\n    }, r.subtract = function (t, r) {\n      return l(t, r, function (t, r) {\n        return t - r;\n      });\n    }, r.maximum = function (t, r) {\n      return l(t, r, function (t, r) {\n        return t > r ? t : r;\n      });\n    }, r.multiplyScalar = function (t, r) {\n      return t.map(function (t) {\n        return t * r;\n      });\n    }, r.eliminateZeros = function (t) {\n      for (var r = new Set(), e = t.getValues(), n = t.getRows(), i = t.getCols(), o = 0; o < e.length; o++) 0 === e[o] && r.add(o);\n\n      var s = function (t, e) {\n        return !r.has(e);\n      },\n          a = e.filter(s),\n          u = n.filter(s),\n          l = i.filter(s);\n\n      return new h(u, l, a, t.getDims());\n    }, r.normalize = function (t, r) {\n      var e, n;\n      void 0 === r && (r = "l2");\n      var i = u[r],\n          s = new Map();\n      t.forEach(function (t, r, e) {\n        var n = s.get(r) || [];\n        n.push(e), s.set(r, n);\n      });\n\n      var a = new h([], [], [], t.getDims()),\n          l = function (r) {\n        for (var e = s.get(r).sort(), n = e.map(function (e) {\n          return t.get(r, e);\n        }), o = i(n), h = 0; h < o.length; h++) a.set(r, e[h], o[h]);\n      };\n\n      try {\n        for (var c = o(s.keys()), f = c.next(); !f.done; f = c.next()) l(f.value);\n      } catch (t) {\n        e = {\n          error: t\n        };\n      } finally {\n        try {\n          f && !f.done && (n = c.return) && n.call(c);\n        } finally {\n          if (e) throw e.error;\n        }\n      }\n\n      return a;\n    };\n    var u = ((n = {}).max = function (t) {\n      for (var r = -1 / 0, e = 0; e < t.length; e++) r = t[e] > r ? t[e] : r;\n\n      return t.map(function (t) {\n        return t / r;\n      });\n    }, n.l1 = function (t) {\n      for (var r = 0, e = 0; e < t.length; e++) r += t[e];\n\n      return t.map(function (t) {\n        return t / r;\n      });\n    }, n.l2 = function (t) {\n      for (var r = 0, e = 0; e < t.length; e++) r += Math.pow(t[e], 2);\n\n      return t.map(function (t) {\n        return Math.sqrt(Math.pow(t, 2) / r);\n      });\n    }, n);\n\n    function l(t, r, e) {\n      for (var n = new Set(), i = [], o = [], s = [], a = function (n, a) {\n        i.push(n), o.push(a);\n        var h = e(t.get(n, a), r.get(n, a));\n        s.push(h);\n      }, u = t.getValues(), l = t.getRows(), c = t.getCols(), f = 0; f < u.length; f++) {\n        var m = (d = l[f]) + ":" + (w = c[f]);\n        n.add(m), a(d, w);\n      }\n\n      var g = r.getValues(),\n          p = r.getRows(),\n          v = r.getCols();\n\n      for (f = 0; f < g.length; f++) {\n        var d, w;\n        m = (d = p[f]) + ":" + (w = v[f]);\n        n.has(m) || a(d, w);\n      }\n\n      var y = [t.nRows, t.nCols];\n      return new h(i, o, s, y);\n    }\n\n    r.getCSR = function (t) {\n      var r = [];\n      t.forEach(function (t, e, n) {\n        r.push({\n          value: t,\n          row: e,\n          col: n\n        });\n      }), r.sort(function (t, r) {\n        return t.row === r.row ? t.col - r.col : t.row - r.row;\n      });\n\n      for (var e = [], n = [], i = [], o = -1, s = 0; s < r.length; s++) {\n        var a = r[s],\n            h = a.row,\n            u = a.col,\n            l = a.value;\n        h !== o && (o = h, i.push(s)), e.push(u), n.push(l);\n      }\n\n      return {\n        indices: e,\n        values: n,\n        indptr: i\n      };\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = this && this.__read || function (t, r) {\n      var e = "function" == typeof Symbol && t[Symbol.iterator];\n      if (!e) return t;\n      var n,\n          i,\n          o = e.call(t),\n          s = [];\n\n      try {\n        for (; (void 0 === r || r-- > 0) && !(n = o.next()).done;) s.push(n.value);\n      } catch (t) {\n        i = {\n          error: t\n        };\n      } finally {\n        try {\n          n && !n.done && (e = o.return) && e.call(o);\n        } finally {\n          if (i) throw i.error;\n        }\n      }\n\n      return s;\n    },\n        i = this && this.__spread || function () {\n      for (var t = [], r = 0; r < arguments.length; r++) t = t.concat(n(arguments[r]));\n\n      return t;\n    },\n        o = this && this.__values || function (t) {\n      var r = "function" == typeof Symbol && t[Symbol.iterator],\n          e = 0;\n      return r ? r.call(t) : {\n        next: function () {\n          return t && e >= t.length && (t = void 0), {\n            value: t && t[e++],\n            done: !t\n          };\n        }\n      };\n    },\n        s = this && this.__importStar || function (t) {\n      if (t && t.__esModule) return t;\n      var r = {};\n      if (null != t) for (var e in t) Object.hasOwnProperty.call(t, e) && (r[e] = t[e]);\n      return r.default = t, r;\n    };\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n\n    var a = s(e(1)),\n        h = function () {\n      return function (t, r, e, n) {\n        this.hyperplanes = t, this.offsets = r, this.children = e, this.indices = n;\n      };\n    }();\n\n    function u(t, r, e, n) {\n      for (var i = r, o = 0; o < e.length; o++) i += t[o] * e[o];\n\n      return 0 === i ? a.tauRandInt(2, n) : i > 0 ? 0 : 1;\n    }\n\n    r.FlatTree = h, r.makeForest = function (t, r, e, n) {\n      var o = Math.max(10, r);\n      return a.range(e).map(function (r, e) {\n        return function (t, r, e, n) {\n          void 0 === r && (r = 30);\n          var i = a.range(t.length);\n          return function t(r, e, n, i, o) {\n            if (void 0 === n && (n = 30), e.length > n) {\n              var s = function (t, r, e) {\n                var n = t[0].length,\n                    i = a.tauRandInt(r.length, e),\n                    o = a.tauRandInt(r.length, e);\n                o = (o += i === o ? 1 : 0) % r.length;\n\n                for (var s = r[i], h = r[o], u = 0, l = a.zeros(n), c = 0; c < l.length; c++) l[c] = t[s][c] - t[h][c], u -= l[c] * (t[s][c] + t[h][c]) / 2;\n\n                for (var f = 0, m = 0, g = a.zeros(r.length), c = 0; c < r.length; c++) {\n                  for (var p = u, v = 0; v < n; v++) p += l[v] * t[r[c]][v];\n\n                  0 === p ? (g[c] = a.tauRandInt(2, e), 0 === g[c] ? f += 1 : m += 1) : p > 0 ? (g[c] = 0, f += 1) : (g[c] = 1, m += 1);\n                }\n\n                var d = a.zeros(f),\n                    w = a.zeros(m);\n\n                for (var c in f = 0, m = 0, a.range(g.length)) 0 === g[c] ? (d[f] = r[c], f += 1) : (w[m] = r[c], m += 1);\n\n                return {\n                  indicesLeft: d,\n                  indicesRight: w,\n                  hyperplane: l,\n                  offset: u\n                };\n              }(r, e, o),\n                  h = s.indicesLeft,\n                  u = s.indicesRight,\n                  l = s.hyperplane,\n                  c = s.offset,\n                  f = t(r, h, n, i + 1, o),\n                  m = t(r, u, n, i + 1, o),\n                  g = {\n                leftChild: f,\n                rightChild: m,\n                isLeaf: !1,\n                hyperplane: l,\n                offset: c\n              };\n\n              return g;\n            }\n\n            var g = {\n              indices: e,\n              isLeaf: !0\n            };\n            return g;\n          }(t, i, r, e, n);\n        }(t, o, e, n);\n      }).map(function (t) {\n        return function (t, r) {\n          var e = function t(r) {\n            return r.isLeaf ? 1 : 1 + t(r.leftChild) + t(r.rightChild);\n          }(t),\n              n = function t(r) {\n            return r.isLeaf ? 1 : t(r.leftChild) + t(r.rightChild);\n          }(t),\n              o = a.range(e).map(function () {\n            return a.zeros(t.hyperplane ? t.hyperplane.length : 0);\n          }),\n              s = a.zeros(e),\n              u = a.range(e).map(function () {\n            return [-1, -1];\n          }),\n              l = a.range(n).map(function () {\n            return a.range(r).map(function () {\n              return -1;\n            });\n          });\n\n          return function t(r, e, n, o, s, a, h) {\n            var u;\n            if (r.isLeaf) return o[a][0] = -h, (u = s[h]).splice.apply(u, i([0, r.indices.length], r.indices)), {\n              nodeNum: a,\n              leafNum: h += 1\n            };\n            e[a] = r.hyperplane, n[a] = r.offset, o[a][0] = a + 1;\n            var l = a,\n                c = t(r.leftChild, e, n, o, s, a + 1, h);\n            return a = c.nodeNum, h = c.leafNum, o[l][1] = a + 1, {\n              nodeNum: (c = t(r.rightChild, e, n, o, s, a + 1, h)).nodeNum,\n              leafNum: c.leafNum\n            };\n          }(t, o, s, u, l, 0, 0), new h(o, s, u, l);\n        }(t, o);\n      });\n    }, r.makeLeafArray = function (t) {\n      var r, e;\n\n      if (t.length > 0) {\n        var n = [];\n\n        try {\n          for (var s = o(t), a = s.next(); !a.done; a = s.next()) {\n            var h = a.value;\n            n.push.apply(n, i(h.indices));\n          }\n        } catch (t) {\n          r = {\n            error: t\n          };\n        } finally {\n          try {\n            a && !a.done && (e = s.return) && e.call(s);\n          } finally {\n            if (r) throw r.error;\n          }\n        }\n\n        return n;\n      }\n\n      return [[-1]];\n    }, r.searchFlatTree = function (t, r, e) {\n      for (var n = 0; r.children[n][0] > 0;) n = 0 === u(r.hyperplanes[n], r.offsets[n], t, e) ? r.children[n][0] : r.children[n][1];\n\n      var i = -1 * r.children[n][0];\n      return r.indices[i];\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n    var n = e(6);\n    r.UMAP = n.UMAP;\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = this && this.__awaiter || function (t, r, e, n) {\n      return new (e || (e = Promise))(function (i, o) {\n        function s(t) {\n          try {\n            h(n.next(t));\n          } catch (t) {\n            o(t);\n          }\n        }\n\n        function a(t) {\n          try {\n            h(n.throw(t));\n          } catch (t) {\n            o(t);\n          }\n        }\n\n        function h(t) {\n          t.done ? i(t.value) : new e(function (r) {\n            r(t.value);\n          }).then(s, a);\n        }\n\n        h((n = n.apply(t, r || [])).next());\n      });\n    },\n        i = this && this.__generator || function (t, r) {\n      var e,\n          n,\n          i,\n          o,\n          s = {\n        label: 0,\n        sent: function () {\n          if (1 & i[0]) throw i[1];\n          return i[1];\n        },\n        trys: [],\n        ops: []\n      };\n      return o = {\n        next: a(0),\n        throw: a(1),\n        return: a(2)\n      }, "function" == typeof Symbol && (o[Symbol.iterator] = function () {\n        return this;\n      }), o;\n\n      function a(o) {\n        return function (a) {\n          return function (o) {\n            if (e) throw new TypeError("Generator is already executing.");\n\n            for (; s;) try {\n              if (e = 1, n && (i = 2 & o[0] ? n.return : o[0] ? n.throw || ((i = n.return) && i.call(n), 0) : n.next) && !(i = i.call(n, o[1])).done) return i;\n\n              switch (n = 0, i && (o = [2 & o[0], i.value]), o[0]) {\n                case 0:\n                case 1:\n                  i = o;\n                  break;\n\n                case 4:\n                  return s.label++, {\n                    value: o[1],\n                    done: !1\n                  };\n\n                case 5:\n                  s.label++, n = o[1], o = [0];\n                  continue;\n\n                case 7:\n                  o = s.ops.pop(), s.trys.pop();\n                  continue;\n\n                default:\n                  if (!(i = (i = s.trys).length > 0 && i[i.length - 1]) && (6 === o[0] || 2 === o[0])) {\n                    s = 0;\n                    continue;\n                  }\n\n                  if (3 === o[0] && (!i || o[1] > i[0] && o[1] < i[3])) {\n                    s.label = o[1];\n                    break;\n                  }\n\n                  if (6 === o[0] && s.label < i[1]) {\n                    s.label = i[1], i = o;\n                    break;\n                  }\n\n                  if (i && s.label < i[2]) {\n                    s.label = i[2], s.ops.push(o);\n                    break;\n                  }\n\n                  i[2] && s.ops.pop(), s.trys.pop();\n                  continue;\n              }\n\n              o = r.call(t, s);\n            } catch (t) {\n              o = [6, t], n = 0;\n            } finally {\n              e = i = 0;\n            }\n\n            if (5 & o[0]) throw o[1];\n            return {\n              value: o[0] ? o[1] : void 0,\n              done: !0\n            };\n          }([o, a]);\n        };\n      }\n    },\n        o = this && this.__read || function (t, r) {\n      var e = "function" == typeof Symbol && t[Symbol.iterator];\n      if (!e) return t;\n      var n,\n          i,\n          o = e.call(t),\n          s = [];\n\n      try {\n        for (; (void 0 === r || r-- > 0) && !(n = o.next()).done;) s.push(n.value);\n      } catch (t) {\n        i = {\n          error: t\n        };\n      } finally {\n        try {\n          n && !n.done && (e = o.return) && e.call(o);\n        } finally {\n          if (i) throw i.error;\n        }\n      }\n\n      return s;\n    },\n        s = this && this.__spread || function () {\n      for (var t = [], r = 0; r < arguments.length; r++) t = t.concat(o(arguments[r]));\n\n      return t;\n    },\n        a = this && this.__importStar || function (t) {\n      if (t && t.__esModule) return t;\n      var r = {};\n      if (null != t) for (var e in t) Object.hasOwnProperty.call(t, e) && (r[e] = t[e]);\n      return r.default = t, r;\n    },\n        h = this && this.__importDefault || function (t) {\n      return t && t.__esModule ? t : {\n        default: t\n      };\n    };\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n\n    var u = a(e(2)),\n        l = a(e(3)),\n        c = a(e(7)),\n        f = a(e(4)),\n        m = a(e(1)),\n        g = h(e(8)),\n        p = function () {\n      function t(t) {\n        void 0 === t && (t = {});\n        var r = this;\n        this.learningRate = 1, this.localConnectivity = 1, this.minDist = .1, this.nComponents = 2, this.nEpochs = 0, this.nNeighbors = 15, this.negativeSampleRate = 5, this.random = Math.random, this.repulsionStrength = 1, this.setOpMixRatio = 1, this.spread = 1, this.transformQueueSize = 4, this.targetMetric = "categorical", this.targetWeight = .5, this.targetNNeighbors = this.nNeighbors, this.distanceFn = v, this.isInitialized = !1, this.rpForest = [], this.embedding = [], this.optimizationState = new d();\n\n        var e = function (e) {\n          void 0 !== t[e] && (r[e] = t[e]);\n        };\n\n        e("distanceFn"), e("learningRate"), e("localConnectivity"), e("minDist"), e("nComponents"), e("nEpochs"), e("nNeighbors"), e("negativeSampleRate"), e("random"), e("repulsionStrength"), e("setOpMixRatio"), e("spread"), e("transformQueueSize");\n      }\n\n      return t.prototype.fit = function (t) {\n        return this.initializeFit(t), this.optimizeLayout(), this.embedding;\n      }, t.prototype.fitAsync = function (t, r) {\n        return void 0 === r && (r = function () {\n          return !0;\n        }), n(this, void 0, void 0, function () {\n          return i(this, function (e) {\n            switch (e.label) {\n              case 0:\n                return this.initializeFit(t), [4, this.optimizeLayoutAsync(r)];\n\n              case 1:\n                return e.sent(), [2, this.embedding];\n            }\n          });\n        });\n      }, t.prototype.setSupervisedProjection = function (t, r) {\n        void 0 === r && (r = {}), this.Y = t, this.targetMetric = r.targetMetric || this.targetMetric, this.targetWeight = r.targetWeight || this.targetWeight, this.targetNNeighbors = r.targetNNeighbors || this.targetNNeighbors;\n      }, t.prototype.setPrecomputedKNN = function (t, r) {\n        this.knnIndices = t, this.knnDistances = r;\n      }, t.prototype.initializeFit = function (t) {\n        if (t.length <= this.nNeighbors) throw new Error("Not enough data points (" + t.length + ") to create nNeighbors: " + this.nNeighbors + ".  Add more data points or adjust the configuration.");\n        if (this.X === t && this.isInitialized) return this.getNEpochs();\n\n        if (this.X = t, !this.knnIndices && !this.knnDistances) {\n          var r = this.nearestNeighbors(t);\n          this.knnIndices = r.knnIndices, this.knnDistances = r.knnDistances;\n        }\n\n        this.graph = this.fuzzySimplicialSet(t, this.nNeighbors, this.setOpMixRatio), this.makeSearchFns(), this.searchGraph = this.makeSearchGraph(t), this.processGraphForSupervisedProjection();\n        var e = this.initializeSimplicialSetEmbedding(),\n            n = e.head,\n            i = e.tail,\n            o = e.epochsPerSample;\n        return this.optimizationState.head = n, this.optimizationState.tail = i, this.optimizationState.epochsPerSample = o, this.initializeOptimization(), this.prepareForOptimizationLoop(), this.isInitialized = !0, this.getNEpochs();\n      }, t.prototype.makeSearchFns = function () {\n        var t = c.makeInitializations(this.distanceFn),\n            r = t.initFromTree,\n            e = t.initFromRandom;\n        this.initFromTree = r, this.initFromRandom = e, this.search = c.makeInitializedNNSearch(this.distanceFn);\n      }, t.prototype.makeSearchGraph = function (t) {\n        for (var r = this.knnIndices, e = this.knnDistances, n = [t.length, t.length], i = new l.SparseMatrix([], [], [], n), o = 0; o < r.length; o++) for (var s = r[o], a = e[o], h = 0; h < s.length; h++) {\n          var u = s[h],\n              c = a[h];\n          c > 0 && i.set(o, u, c);\n        }\n\n        var f = l.transpose(i);\n        return l.maximum(i, f);\n      }, t.prototype.transform = function (t) {\n        var r = this,\n            e = this.X;\n        if (void 0 === e || 0 === e.length) throw new Error("No data has been fit.");\n        var n = Math.floor(this.nNeighbors * this.transformQueueSize);\n        n = Math.min(e.length, n);\n        var i = c.initializeSearch(this.rpForest, e, t, n, this.initFromRandom, this.initFromTree, this.random),\n            o = this.search(e, this.searchGraph, i, t),\n            s = u.deheapSort(o),\n            a = s.indices,\n            h = s.weights;\n        a = a.map(function (t) {\n          return t.slice(0, r.nNeighbors);\n        }), h = h.map(function (t) {\n          return t.slice(0, r.nNeighbors);\n        });\n        var f = Math.max(0, this.localConnectivity - 1),\n            g = this.smoothKNNDistance(h, this.nNeighbors, f),\n            p = g.sigmas,\n            v = g.rhos,\n            d = this.computeMembershipStrengths(a, h, p, v),\n            w = d.rows,\n            y = d.cols,\n            b = d.vals,\n            M = [t.length, e.length],\n            x = new l.SparseMatrix(w, y, b, M),\n            E = l.normalize(x, "l1"),\n            R = l.getCSR(E),\n            k = t.length,\n            z = S(m.reshape2d(R.indices, k, this.nNeighbors), m.reshape2d(R.values, k, this.nNeighbors), this.embedding),\n            N = this.nEpochs ? this.nEpochs / 3 : x.nRows <= 1e4 ? 100 : 30,\n            A = x.getValues().reduce(function (t, r) {\n          return r > t ? r : t;\n        }, 0);\n        x = x.map(function (t) {\n          return t < A / N ? 0 : t;\n        }), x = l.eliminateZeros(x);\n\n        var V = this.makeEpochsPerSample(x.getValues(), N),\n            C = x.getRows(),\n            _ = x.getCols();\n\n        return this.assignOptimizationStateParameters({\n          headEmbedding: z,\n          tailEmbedding: this.embedding,\n          head: C,\n          tail: _,\n          currentEpoch: 0,\n          nEpochs: N,\n          nVertices: x.getDims()[1],\n          epochsPerSample: V\n        }), this.prepareForOptimizationLoop(), this.optimizeLayout();\n      }, t.prototype.processGraphForSupervisedProjection = function () {\n        var t = this.Y,\n            r = this.X;\n\n        if (t) {\n          if (t.length !== r.length) throw new Error("Length of X and y must be equal");\n\n          if ("categorical" === this.targetMetric) {\n            var e = this.targetWeight < 1 ? 1 / (1 - this.targetWeight) * 2.5 : 1e12;\n            this.graph = this.categoricalSimplicialSetIntersection(this.graph, t, e);\n          }\n        }\n      }, t.prototype.step = function () {\n        var t = this.optimizationState.currentEpoch;\n        return t < this.getNEpochs() && this.optimizeLayoutStep(t), this.optimizationState.currentEpoch;\n      }, t.prototype.getEmbedding = function () {\n        return this.embedding;\n      }, t.prototype.nearestNeighbors = function (t) {\n        var r,\n            e = this.distanceFn,\n            n = this.nNeighbors,\n            i = c.makeNNDescent(e, this.random),\n            o = 5 + Math.floor(.5 === (r = Math.pow(t.length, .5) / 20) ? 0 : Math.round(r)),\n            s = Math.max(5, Math.floor(Math.round(function (t) {\n          return Math.log(t) / Math.log(2);\n        }(t.length))));\n        this.rpForest = f.makeForest(t, n, o, this.random);\n        var a = i(t, f.makeLeafArray(this.rpForest), n, s);\n        return {\n          knnIndices: a.indices,\n          knnDistances: a.weights\n        };\n      }, t.prototype.fuzzySimplicialSet = function (t, r, e) {\n        void 0 === e && (e = 1);\n        var n = this.knnIndices,\n            i = void 0 === n ? [] : n,\n            o = this.knnDistances,\n            s = void 0 === o ? [] : o,\n            a = this.localConnectivity,\n            h = this.smoothKNNDistance(s, r, a),\n            u = h.sigmas,\n            c = h.rhos,\n            f = this.computeMembershipStrengths(i, s, u, c),\n            m = f.rows,\n            g = f.cols,\n            p = f.vals,\n            v = [t.length, t.length],\n            d = new l.SparseMatrix(m, g, p, v),\n            w = l.transpose(d),\n            y = l.pairwiseMultiply(d, w),\n            b = l.subtract(l.add(d, w), y),\n            M = l.multiplyScalar(b, e),\n            x = l.multiplyScalar(y, 1 - e);\n        return l.add(M, x);\n      }, t.prototype.categoricalSimplicialSetIntersection = function (t, r, e, n) {\n        void 0 === n && (n = 1);\n        var i = M(t, r, n, e);\n        return x(i = l.eliminateZeros(i));\n      }, t.prototype.smoothKNNDistance = function (t, r, e, n, i) {\n        void 0 === e && (e = 1), void 0 === n && (n = 64), void 0 === i && (i = 1);\n\n        for (var o = Math.log(r) / Math.log(2) * i, s = m.zeros(t.length), a = m.zeros(t.length), h = 0; h < t.length; h++) {\n          var u = 0,\n              l = 1 / 0,\n              c = 1,\n              f = t[h],\n              g = f.filter(function (t) {\n            return t > 0;\n          });\n\n          if (g.length >= e) {\n            var p = Math.floor(e),\n                v = e - p;\n            p > 0 ? (s[h] = g[p - 1], v > 1e-5 && (s[h] += v * (g[p] - g[p - 1]))) : s[h] = v * g[0];\n          } else g.length > 0 && (s[h] = m.max(g));\n\n          for (var d = 0; d < n; d++) {\n            for (var w = 0, y = 1; y < t[h].length; y++) {\n              var b = t[h][y] - s[h];\n              w += b > 0 ? Math.exp(-b / c) : 1;\n            }\n\n            if (Math.abs(w - o) < 1e-5) break;\n            w > o ? c = (u + (l = c)) / 2 : (u = c, l === 1 / 0 ? c *= 2 : c = (u + l) / 2);\n          }\n\n          if (a[h] = c, s[h] > 0) {\n            var M = m.mean(f);\n            a[h] < .001 * M && (a[h] = .001 * M);\n          } else {\n            var x = m.mean(t.map(m.mean));\n            a[h] < .001 * x && (a[h] = .001 * x);\n          }\n        }\n\n        return {\n          sigmas: a,\n          rhos: s\n        };\n      }, t.prototype.computeMembershipStrengths = function (t, r, e, n) {\n        for (var i = t.length, o = t[0].length, s = m.zeros(i * o), a = m.zeros(i * o), h = m.zeros(i * o), u = 0; u < i; u++) for (var l = 0; l < o; l++) {\n          var c = 0;\n          -1 !== t[u][l] && (c = t[u][l] === u ? 0 : r[u][l] - n[u] <= 0 ? 1 : Math.exp(-(r[u][l] - n[u]) / e[u]), s[u * o + l] = u, a[u * o + l] = t[u][l], h[u * o + l] = c);\n        }\n\n        return {\n          rows: s,\n          cols: a,\n          vals: h\n        };\n      }, t.prototype.initializeSimplicialSetEmbedding = function () {\n        for (var t = this, r = this.getNEpochs(), e = this.nComponents, n = this.graph.getValues(), i = 0, o = 0; o < n.length; o++) {\n          var s = n[o];\n          i < n[o] && (i = s);\n        }\n\n        var a = this.graph.map(function (t) {\n          return t < i / r ? 0 : t;\n        });\n        this.embedding = m.zeros(a.nRows).map(function () {\n          return m.zeros(e).map(function () {\n            return 20 * m.tauRand(t.random) - 10;\n          });\n        });\n        var h = [],\n            u = [],\n            l = [],\n            c = a.getAll();\n\n        for (o = 0; o < c.length; o++) {\n          var f = c[o];\n          f.value && (h.push(f.value), l.push(f.row), u.push(f.col));\n        }\n\n        return {\n          head: u,\n          tail: l,\n          epochsPerSample: this.makeEpochsPerSample(h, r)\n        };\n      }, t.prototype.makeEpochsPerSample = function (t, r) {\n        var e = m.filled(t.length, -1),\n            n = m.max(t),\n            i = t.map(function (t) {\n          return t / n * r;\n        });\n        return i.forEach(function (t, n) {\n          t > 0 && (e[n] = r / i[n]);\n        }), e;\n      }, t.prototype.assignOptimizationStateParameters = function (t) {\n        Object.assign(this.optimizationState, t);\n      }, t.prototype.prepareForOptimizationLoop = function () {\n        var t = this.repulsionStrength,\n            r = this.learningRate,\n            e = this.negativeSampleRate,\n            n = this.optimizationState,\n            i = n.epochsPerSample,\n            o = n.headEmbedding,\n            a = n.tailEmbedding,\n            h = o[0].length,\n            u = o.length === a.length,\n            l = i.map(function (t) {\n          return t / e;\n        }),\n            c = s(l),\n            f = s(i);\n        this.assignOptimizationStateParameters({\n          epochOfNextSample: f,\n          epochOfNextNegativeSample: c,\n          epochsPerNegativeSample: l,\n          moveOther: u,\n          initialAlpha: r,\n          alpha: r,\n          gamma: t,\n          dim: h\n        });\n      }, t.prototype.initializeOptimization = function () {\n        var t = this.embedding,\n            r = this.embedding,\n            e = this.optimizationState,\n            n = e.head,\n            i = e.tail,\n            o = e.epochsPerSample,\n            s = this.getNEpochs(),\n            a = this.graph.nCols,\n            h = b(this.spread, this.minDist),\n            u = h.a,\n            l = h.b;\n        this.assignOptimizationStateParameters({\n          headEmbedding: t,\n          tailEmbedding: r,\n          head: n,\n          tail: i,\n          epochsPerSample: o,\n          a: u,\n          b: l,\n          nEpochs: s,\n          nVertices: a\n        });\n      }, t.prototype.optimizeLayoutStep = function (t) {\n        for (var r = this.optimizationState, e = r.head, n = r.tail, i = r.headEmbedding, o = r.tailEmbedding, s = r.epochsPerSample, a = r.epochOfNextSample, h = r.epochOfNextNegativeSample, u = r.epochsPerNegativeSample, l = r.moveOther, c = r.initialAlpha, f = r.alpha, g = r.gamma, p = r.a, v = r.b, d = r.dim, b = r.nEpochs, M = r.nVertices, x = 0; x < s.length; x++) if (!(a[x] > t)) {\n          var S = e[x],\n              E = n[x],\n              R = i[S],\n              k = o[E],\n              z = y(R, k),\n              N = 0;\n          z > 0 && (N = -2 * p * v * Math.pow(z, v - 1), N /= p * Math.pow(z, v) + 1);\n\n          for (var A = 0; A < d; A++) {\n            var V = w(N * (R[A] - k[A]), 4);\n            R[A] += V * f, l && (k[A] += -V * f);\n          }\n\n          a[x] += s[x];\n\n          for (var C = Math.floor((t - h[x]) / u[x]), _ = 0; _ < C; _++) {\n            var P = m.tauRandInt(M, this.random),\n                j = o[P],\n                I = y(R, j),\n                O = 0;\n            if (I > 0) O = 2 * g * v, O /= (.001 + I) * (p * Math.pow(I, v) + 1);else if (S === P) continue;\n\n            for (A = 0; A < d; A++) {\n              V = 4;\n              O > 0 && (V = w(O * (R[A] - j[A]), 4)), R[A] += V * f;\n            }\n          }\n\n          h[x] += C * u[x];\n        }\n\n        return r.alpha = c * (1 - t / b), r.currentEpoch += 1, i;\n      }, t.prototype.optimizeLayoutAsync = function (t) {\n        var r = this;\n        return void 0 === t && (t = function () {\n          return !0;\n        }), new Promise(function (e, o) {\n          var s = function () {\n            return n(r, void 0, void 0, function () {\n              var r, n, a, h, u, l;\n              return i(this, function (i) {\n                try {\n                  if (r = this.optimizationState, n = r.nEpochs, a = r.currentEpoch, this.embedding = this.optimizeLayoutStep(a), h = this.optimizationState.currentEpoch, u = !1 === t(h), l = h === n, u || l) return [2, e(l)];\n                  setTimeout(function () {\n                    return s();\n                  }, 0);\n                } catch (t) {\n                  o(t);\n                }\n\n                return [2];\n              });\n            });\n          };\n\n          setTimeout(function () {\n            return s();\n          }, 0);\n        });\n      }, t.prototype.optimizeLayout = function (t) {\n        void 0 === t && (t = function () {\n          return !0;\n        });\n\n        for (var r = !1, e = []; !r;) {\n          var n = this.optimizationState,\n              i = n.nEpochs,\n              o = n.currentEpoch;\n          e = this.optimizeLayoutStep(o);\n          var s = this.optimizationState.currentEpoch,\n              a = !1 === t(s);\n          r = s === i || a;\n        }\n\n        return e;\n      }, t.prototype.getNEpochs = function () {\n        var t = this.graph;\n        if (this.nEpochs > 0) return this.nEpochs;\n        var r = t.nRows;\n        return r <= 2500 ? 500 : r <= 5e3 ? 400 : r <= 7500 ? 300 : 200;\n      }, t;\n    }();\n\n    function v(t, r) {\n      for (var e = 0, n = 0; n < t.length; n++) e += Math.pow(t[n] - r[n], 2);\n\n      return Math.sqrt(e);\n    }\n\n    r.UMAP = p, r.euclidean = v, r.cosine = function (t, r) {\n      for (var e = 0, n = 0, i = 0, o = 0; o < t.length; o++) e += t[o] * r[o], n += Math.pow(t[o], 2), i += Math.pow(r[o], 2);\n\n      return 0 === n && 0 === i ? 0 : 0 === n || 0 === i ? 1 : 1 - e / Math.sqrt(n * i);\n    };\n\n    var d = function () {\n      return function () {\n        this.currentEpoch = 0, this.headEmbedding = [], this.tailEmbedding = [], this.head = [], this.tail = [], this.epochsPerSample = [], this.epochOfNextSample = [], this.epochOfNextNegativeSample = [], this.epochsPerNegativeSample = [], this.moveOther = !0, this.initialAlpha = 1, this.alpha = 1, this.gamma = 1, this.a = 1.5769434603113077, this.b = .8950608779109733, this.dim = 2, this.nEpochs = 500, this.nVertices = 0;\n      };\n    }();\n\n    function w(t, r) {\n      return t > r ? r : t < -r ? -r : t;\n    }\n\n    function y(t, r) {\n      for (var e = 0, n = 0; n < t.length; n++) e += Math.pow(t[n] - r[n], 2);\n\n      return e;\n    }\n\n    function b(t, r) {\n      var e = m.linear(0, 3 * t, 300).map(function (t) {\n        return t < r ? 1 : t;\n      }),\n          n = m.zeros(e.length).map(function (n, i) {\n        return e[i] >= r ? Math.exp(-(e[i] - r) / t) : n;\n      }),\n          i = {\n        x: e,\n        y: n\n      },\n          s = {\n        damping: 1.5,\n        initialValues: [.5, .5],\n        gradientDifference: .1,\n        maxIterations: 100,\n        errorTolerance: .01\n      },\n          a = g.default(i, function (t) {\n        var r = o(t, 2),\n            e = r[0],\n            n = r[1];\n        return function (t) {\n          return 1 / (1 + e * Math.pow(t, 2 * n));\n        };\n      }, s).parameterValues,\n          h = o(a, 2);\n      return {\n        a: h[0],\n        b: h[1]\n      };\n    }\n\n    function M(t, r, e, n) {\n      return void 0 === e && (e = 1), void 0 === n && (n = 5), t.map(function (t, i, o) {\n        return -1 === r[i] || -1 === r[o] ? t * Math.exp(-e) : r[i] !== r[o] ? t * Math.exp(-n) : t;\n      });\n    }\n\n    function x(t) {\n      t = l.normalize(t, "max");\n      var r = l.transpose(t),\n          e = l.pairwiseMultiply(r, t);\n      return t = l.add(t, l.subtract(r, e)), l.eliminateZeros(t);\n    }\n\n    function S(t, r, e) {\n      for (var n = m.zeros(t.length).map(function (t) {\n        return m.zeros(e[0].length);\n      }), i = 0; i < t.length; i++) for (var o = 0; o < t[0].length; o++) for (var s = 0; s < e[0].length; s++) {\n        var a = t[i][o];\n        n[i][s] += r[i][o] * e[a][s];\n      }\n\n      return n;\n    }\n\n    r.findABParams = b, r.fastIntersection = M, r.resetLocalConnectivity = x, r.initTransform = S;\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = this && this.__values || function (t) {\n      var r = "function" == typeof Symbol && t[Symbol.iterator],\n          e = 0;\n      return r ? r.call(t) : {\n        next: function () {\n          return t && e >= t.length && (t = void 0), {\n            value: t && t[e++],\n            done: !t\n          };\n        }\n      };\n    },\n        i = this && this.__importStar || function (t) {\n      if (t && t.__esModule) return t;\n      var r = {};\n      if (null != t) for (var e in t) Object.hasOwnProperty.call(t, e) && (r[e] = t[e]);\n      return r.default = t, r;\n    };\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n    var o = i(e(2)),\n        s = i(e(3)),\n        a = i(e(4)),\n        h = i(e(1));\n    r.makeNNDescent = function (t, r) {\n      return function (e, n, i, s, a, u, l, c) {\n        void 0 === s && (s = 10), void 0 === a && (a = 50), void 0 === u && (u = .001), void 0 === l && (l = .5), void 0 === c && (c = !0);\n\n        for (var f = e.length, m = o.makeHeap(e.length, i), g = 0; g < e.length; g++) for (var p = o.rejectionSample(i, e.length, r), v = 0; v < p.length; v++) {\n          var d = t(e[g], e[p[v]]);\n          o.heapPush(m, g, d, p[v], 1), o.heapPush(m, p[v], d, g, 1);\n        }\n\n        if (c) for (var w = 0; w < n.length; w++) for (g = 0; g < n[w].length && !(n[w][g] < 0); g++) for (v = g + 1; v < n[w].length && !(n[w][v] < 0); v++) d = t(e[n[w][g]], e[n[w][v]]), o.heapPush(m, n[w][g], d, n[w][v], 1), o.heapPush(m, n[w][v], d, n[w][g], 1);\n\n        for (w = 0; w < s; w++) {\n          var y = o.buildCandidates(m, f, i, a, r),\n              b = 0;\n\n          for (g = 0; g < f; g++) for (v = 0; v < a; v++) {\n            var M = Math.floor(y[0][g][v]);\n            if (!(M < 0 || h.tauRand(r) < l)) for (var x = 0; x < a; x++) {\n              var S = Math.floor(y[0][g][x]),\n                  E = y[2][g][v],\n                  R = y[2][g][x];\n              S < 0 || !E && !R || (d = t(e[M], e[S]), b += o.heapPush(m, M, d, S, 1), b += o.heapPush(m, S, d, M, 1));\n            }\n          }\n\n          if (b <= u * i * e.length) break;\n        }\n\n        return o.deheapSort(m);\n      };\n    }, r.makeInitializations = function (t) {\n      return {\n        initFromRandom: function (r, e, n, i, s) {\n          for (var a = 0; a < n.length; a++) for (var u = h.rejectionSample(r, e.length, s), l = 0; l < u.length; l++) if (!(u[l] < 0)) {\n            var c = t(e[u[l]], n[a]);\n            o.heapPush(i, a, c, u[l], 1);\n          }\n        },\n        initFromTree: function (r, e, n, i, s) {\n          for (var h = 0; h < n.length; h++) for (var u = a.searchFlatTree(n[h], r, s), l = 0; l < u.length; l++) {\n            if (u[l] < 0) return;\n            var c = t(e[u[l]], n[h]);\n            o.heapPush(i, h, c, u[l], 1);\n          }\n        }\n      };\n    }, r.makeInitializedNNSearch = function (t) {\n      return function (r, e, i, a) {\n        for (var h, u, l = s.getCSR(e), c = l.indices, f = l.indptr, m = 0; m < a.length; m++) for (var g = new Set(i[0][m]);;) {\n          var p = o.smallestFlagged(i, m);\n          if (-1 === p) break;\n          var v = c.slice(f[p], f[p + 1]);\n\n          try {\n            for (var d = n(v), w = d.next(); !w.done; w = d.next()) {\n              var y = w.value;\n\n              if (y !== p && -1 !== y && !g.has(y)) {\n                var b = t(r[y], a[m]);\n                o.uncheckedHeapPush(i, m, b, y, 1), g.add(y);\n              }\n            }\n          } catch (t) {\n            h = {\n              error: t\n            };\n          } finally {\n            try {\n              w && !w.done && (u = d.return) && u.call(d);\n            } finally {\n              if (h) throw h.error;\n            }\n          }\n        }\n\n        return i;\n      };\n    }, r.initializeSearch = function (t, r, e, i, s, a, h) {\n      var u,\n          l,\n          c = o.makeHeap(e.length, i);\n      if (s(i, r, e, c, h), t) try {\n        for (var f = n(t), m = f.next(); !m.done; m = f.next()) a(m.value, r, e, c, h);\n      } catch (t) {\n        u = {\n          error: t\n        };\n      } finally {\n        try {\n          m && !m.done && (l = f.return) && l.call(f);\n        } finally {\n          if (u) throw u.error;\n        }\n      }\n      return c;\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = e(9);\n\n    function i(t, r, e) {\n      var n = 0;\n      const i = e(r);\n\n      for (var o = 0; o < t.x.length; o++) n += Math.abs(t.y[o] - i(t.x[o]));\n\n      return n;\n    }\n\n    function o(t, r, e, i, o) {\n      var s = n.Matrix.eye(r.length).mul(e * i * i),\n          a = t.x.length,\n          h = new Array(a);\n      const u = o(r);\n\n      for (var l = 0; l < a; l++) h[l] = u(t.x[l]);\n\n      var c = function (t, r, e, i, o) {\n        const s = e.length,\n              a = t.x.length;\n\n        for (var h = new Array(s), u = 0; u < s; u++) {\n          h[u] = new Array(a);\n          var l = e.concat();\n          l[u] += i;\n\n          for (var c = o(l), f = 0; f < a; f++) h[u][f] = r[f] - c(t.x[f]);\n        }\n\n        return new n.Matrix(h);\n      }(t, h, r, i, o),\n          f = function (t, r) {\n        const e = t.x.length;\n\n        for (var i = new Array(e), o = 0; o < e; o++) i[o] = t.y[o] - r[o];\n\n        return new n.Matrix([i]);\n      }(t, h).transposeView(),\n          m = n.inverse(s.add(c.mmul(c.transposeView())));\n\n      return (r = (r = new n.Matrix([r])).sub(m.mmul(c).mmul(f).mul(i).transposeView())).to1DArray();\n    }\n\n    t.exports = function (t, r, e = {}) {\n      let {\n        maxIterations: n = 100,\n        gradientDifference: s = .1,\n        damping: a = 0,\n        errorTolerance: h = .01,\n        initialValues: u\n      } = e;\n      if (a <= 0) throw new Error("The damping option must be a positive number");\n      if (!t.x || !t.y) throw new Error("The data parameter must have x and y elements");\n      if (!Array.isArray(t.x) || t.x.length < 2 || !Array.isArray(t.y) || t.y.length < 2) throw new Error("The data parameter elements must be an array with more than 2 points");\n      if (t.x.length !== t.y.length) throw new Error("The data parameter elements must have the same size");\n      var l = u || new Array(r.length).fill(1);\n      if (!Array.isArray(l)) throw new Error("initialValues must be an array");\n\n      for (var c = i(t, l, r), f = c <= h, m = 0; m < n && !f; m++) f = (c = i(t, l = o(t, l, a, s, r), r)) <= h;\n\n      return {\n        parameterValues: l,\n        parameterError: c,\n        iterations: m\n      };\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    e.r(r);\n    var n = e(0),\n        i = e.n(n);\n\n    var o = function (t) {\n      if (!i()(t)) throw new TypeError("input must be an array");\n      if (0 === t.length) throw new TypeError("input must not be empty");\n\n      for (var r = t[0], e = 1; e < t.length; e++) t[e] > r && (r = t[e]);\n\n      return r;\n    };\n\n    var s = function (t) {\n      if (!i()(t)) throw new TypeError("input must be an array");\n      if (0 === t.length) throw new TypeError("input must not be empty");\n\n      for (var r = t[0], e = 1; e < t.length; e++) t[e] < r && (r = t[e]);\n\n      return r;\n    };\n\n    var a = function (t) {\n      var r,\n          e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\n      if (!i()(t)) throw new TypeError("input must be an array");\n      if (0 === t.length) throw new TypeError("input must not be empty");\n\n      if (void 0 !== e.output) {\n        if (!i()(e.output)) throw new TypeError("output option must be an array if specified");\n        r = e.output;\n      } else r = new Array(t.length);\n\n      var n = s(t),\n          a = o(t);\n      if (n === a) throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");\n      var h = e.min,\n          u = void 0 === h ? e.autoMinMax ? n : 0 : h,\n          l = e.max,\n          c = void 0 === l ? e.autoMinMax ? a : 1 : l;\n      if (u >= c) throw new RangeError("min option must be smaller than max option");\n\n      for (var f = (c - u) / (a - n), m = 0; m < t.length; m++) r[m] = (t[m] - n) * f + u;\n\n      return r;\n    };\n\n    class h {\n      constructor(t) {\n        var r,\n            e,\n            n,\n            i,\n            o,\n            s,\n            a,\n            h,\n            u,\n            l = (t = j.checkMatrix(t)).clone(),\n            c = l.rows,\n            f = l.columns,\n            m = new Array(c),\n            g = 1;\n\n        for (r = 0; r < c; r++) m[r] = r;\n\n        for (h = new Array(c), e = 0; e < f; e++) {\n          for (r = 0; r < c; r++) h[r] = l.get(r, e);\n\n          for (r = 0; r < c; r++) {\n            for (u = Math.min(r, e), o = 0, n = 0; n < u; n++) o += l.get(r, n) * h[n];\n\n            h[r] -= o, l.set(r, e, h[r]);\n          }\n\n          for (i = e, r = e + 1; r < c; r++) Math.abs(h[r]) > Math.abs(h[i]) && (i = r);\n\n          if (i !== e) {\n            for (n = 0; n < f; n++) s = l.get(i, n), l.set(i, n, l.get(e, n)), l.set(e, n, s);\n\n            a = m[i], m[i] = m[e], m[e] = a, g = -g;\n          }\n\n          if (e < c && 0 !== l.get(e, e)) for (r = e + 1; r < c; r++) l.set(r, e, l.get(r, e) / l.get(e, e));\n        }\n\n        this.LU = l, this.pivotVector = m, this.pivotSign = g;\n      }\n\n      isSingular() {\n        for (var t = this.LU, r = t.columns, e = 0; e < r; e++) if (0 === t[e][e]) return !0;\n\n        return !1;\n      }\n\n      solve(t) {\n        t = _.checkMatrix(t);\n        var r = this.LU;\n        if (r.rows !== t.rows) throw new Error("Invalid matrix dimensions");\n        if (this.isSingular()) throw new Error("LU matrix is singular");\n        var e,\n            n,\n            i,\n            o = t.columns,\n            s = t.subMatrixRow(this.pivotVector, 0, o - 1),\n            a = r.columns;\n\n        for (i = 0; i < a; i++) for (e = i + 1; e < a; e++) for (n = 0; n < o; n++) s[e][n] -= s[i][n] * r[e][i];\n\n        for (i = a - 1; i >= 0; i--) {\n          for (n = 0; n < o; n++) s[i][n] /= r[i][i];\n\n          for (e = 0; e < i; e++) for (n = 0; n < o; n++) s[e][n] -= s[i][n] * r[e][i];\n        }\n\n        return s;\n      }\n\n      get determinant() {\n        var t = this.LU;\n        if (!t.isSquare()) throw new Error("Matrix must be square");\n\n        for (var r = this.pivotSign, e = t.columns, n = 0; n < e; n++) r *= t[n][n];\n\n        return r;\n      }\n\n      get lowerTriangularMatrix() {\n        for (var t = this.LU, r = t.rows, e = t.columns, n = new _(r, e), i = 0; i < r; i++) for (var o = 0; o < e; o++) n[i][o] = i > o ? t[i][o] : i === o ? 1 : 0;\n\n        return n;\n      }\n\n      get upperTriangularMatrix() {\n        for (var t = this.LU, r = t.rows, e = t.columns, n = new _(r, e), i = 0; i < r; i++) for (var o = 0; o < e; o++) n[i][o] = i <= o ? t[i][o] : 0;\n\n        return n;\n      }\n\n      get pivotPermutationVector() {\n        return this.pivotVector.slice();\n      }\n\n    }\n\n    function u(t, r) {\n      var e = 0;\n      return Math.abs(t) > Math.abs(r) ? (e = r / t, Math.abs(t) * Math.sqrt(1 + e * e)) : 0 !== r ? (e = t / r, Math.abs(r) * Math.sqrt(1 + e * e)) : 0;\n    }\n\n    function l(t, r, e) {\n      for (var n = new Array(t), i = 0; i < t; i++) {\n        n[i] = new Array(r);\n\n        for (var o = 0; o < r; o++) n[i][o] = e;\n      }\n\n      return n;\n    }\n\n    class c {\n      constructor(t, r = {}) {\n        var e = (t = j.checkMatrix(t)).rows,\n            n = t.columns;\n        const {\n          computeLeftSingularVectors: i = !0,\n          computeRightSingularVectors: o = !0,\n          autoTranspose: s = !1\n        } = r;\n        var a,\n            h = Boolean(i),\n            c = Boolean(o),\n            f = !1;\n        if (e < n) {\n          if (s) {\n            e = (a = t.transpose()).rows, n = a.columns, f = !0;\n            var m = h;\n            h = c, c = m;\n          } else a = t.clone(), console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");\n        } else a = t.clone();\n        var g = Math.min(e, n),\n            p = Math.min(e + 1, n),\n            v = new Array(p),\n            d = l(e, g, 0),\n            w = l(n, n, 0),\n            y = new Array(n),\n            b = new Array(e),\n            M = new Array(p);\n\n        for (let t = 0; t < p; t++) M[t] = t;\n\n        var x = Math.min(e - 1, n),\n            S = Math.max(0, Math.min(n - 2, e)),\n            E = Math.max(x, S);\n\n        for (let t = 0; t < E; t++) {\n          if (t < x) {\n            v[t] = 0;\n\n            for (let r = t; r < e; r++) v[t] = u(v[t], a[r][t]);\n\n            if (0 !== v[t]) {\n              a[t][t] < 0 && (v[t] = -v[t]);\n\n              for (let r = t; r < e; r++) a[r][t] /= v[t];\n\n              a[t][t] += 1;\n            }\n\n            v[t] = -v[t];\n          }\n\n          for (let r = t + 1; r < n; r++) {\n            if (t < x && 0 !== v[t]) {\n              let n = 0;\n\n              for (let i = t; i < e; i++) n += a[i][t] * a[i][r];\n\n              n = -n / a[t][t];\n\n              for (let i = t; i < e; i++) a[i][r] += n * a[i][t];\n            }\n\n            y[r] = a[t][r];\n          }\n\n          if (h && t < x) for (let r = t; r < e; r++) d[r][t] = a[r][t];\n\n          if (t < S) {\n            y[t] = 0;\n\n            for (let r = t + 1; r < n; r++) y[t] = u(y[t], y[r]);\n\n            if (0 !== y[t]) {\n              y[t + 1] < 0 && (y[t] = 0 - y[t]);\n\n              for (let r = t + 1; r < n; r++) y[r] /= y[t];\n\n              y[t + 1] += 1;\n            }\n\n            if (y[t] = -y[t], t + 1 < e && 0 !== y[t]) {\n              for (let r = t + 1; r < e; r++) b[r] = 0;\n\n              for (let r = t + 1; r < e; r++) for (let e = t + 1; e < n; e++) b[r] += y[e] * a[r][e];\n\n              for (let r = t + 1; r < n; r++) {\n                let n = -y[r] / y[t + 1];\n\n                for (let i = t + 1; i < e; i++) a[i][r] += n * b[i];\n              }\n            }\n\n            if (c) for (let r = t + 1; r < n; r++) w[r][t] = y[r];\n          }\n        }\n\n        let R = Math.min(n, e + 1);\n\n        if (x < n && (v[x] = a[x][x]), e < R && (v[R - 1] = 0), S + 1 < R && (y[S] = a[S][R - 1]), y[R - 1] = 0, h) {\n          for (let t = x; t < g; t++) {\n            for (let r = 0; r < e; r++) d[r][t] = 0;\n\n            d[t][t] = 1;\n          }\n\n          for (let t = x - 1; t >= 0; t--) if (0 !== v[t]) {\n            for (let r = t + 1; r < g; r++) {\n              let n = 0;\n\n              for (let i = t; i < e; i++) n += d[i][t] * d[i][r];\n\n              n = -n / d[t][t];\n\n              for (let i = t; i < e; i++) d[i][r] += n * d[i][t];\n            }\n\n            for (let r = t; r < e; r++) d[r][t] = -d[r][t];\n\n            d[t][t] = 1 + d[t][t];\n\n            for (let r = 0; r < t - 1; r++) d[r][t] = 0;\n          } else {\n            for (let r = 0; r < e; r++) d[r][t] = 0;\n\n            d[t][t] = 1;\n          }\n        }\n\n        if (c) for (let t = n - 1; t >= 0; t--) {\n          if (t < S && 0 !== y[t]) for (let r = t + 1; r < n; r++) {\n            let e = 0;\n\n            for (let i = t + 1; i < n; i++) e += w[i][t] * w[i][r];\n\n            e = -e / w[t + 1][t];\n\n            for (let i = t + 1; i < n; i++) w[i][r] += e * w[i][t];\n          }\n\n          for (let r = 0; r < n; r++) w[r][t] = 0;\n\n          w[t][t] = 1;\n        }\n\n        for (var k = R - 1, z = Number.EPSILON; R > 0;) {\n          let t, r;\n\n          for (t = R - 2; t >= -1 && -1 !== t; t--) {\n            const r = Number.MIN_VALUE + z * Math.abs(v[t] + Math.abs(v[t + 1]));\n\n            if (Math.abs(y[t]) <= r || Number.isNaN(y[t])) {\n              y[t] = 0;\n              break;\n            }\n          }\n\n          if (t === R - 2) r = 4;else {\n            let e;\n\n            for (e = R - 1; e >= t && e !== t; e--) {\n              let r = (e !== R ? Math.abs(y[e]) : 0) + (e !== t + 1 ? Math.abs(y[e - 1]) : 0);\n\n              if (Math.abs(v[e]) <= z * r) {\n                v[e] = 0;\n                break;\n              }\n            }\n\n            e === t ? r = 3 : e === R - 1 ? r = 1 : (r = 2, t = e);\n          }\n\n          switch (t++, r) {\n            case 1:\n              {\n                let r = y[R - 2];\n                y[R - 2] = 0;\n\n                for (let e = R - 2; e >= t; e--) {\n                  let i = u(v[e], r),\n                      o = v[e] / i,\n                      s = r / i;\n                  if (v[e] = i, e !== t && (r = -s * y[e - 1], y[e - 1] = o * y[e - 1]), c) for (let t = 0; t < n; t++) i = o * w[t][e] + s * w[t][R - 1], w[t][R - 1] = -s * w[t][e] + o * w[t][R - 1], w[t][e] = i;\n                }\n\n                break;\n              }\n\n            case 2:\n              {\n                let r = y[t - 1];\n                y[t - 1] = 0;\n\n                for (let n = t; n < R; n++) {\n                  let i = u(v[n], r),\n                      o = v[n] / i,\n                      s = r / i;\n                  if (v[n] = i, r = -s * y[n], y[n] = o * y[n], h) for (let r = 0; r < e; r++) i = o * d[r][n] + s * d[r][t - 1], d[r][t - 1] = -s * d[r][n] + o * d[r][t - 1], d[r][n] = i;\n                }\n\n                break;\n              }\n\n            case 3:\n              {\n                const r = Math.max(Math.abs(v[R - 1]), Math.abs(v[R - 2]), Math.abs(y[R - 2]), Math.abs(v[t]), Math.abs(y[t])),\n                      i = v[R - 1] / r,\n                      o = v[R - 2] / r,\n                      s = y[R - 2] / r,\n                      a = v[t] / r,\n                      l = y[t] / r,\n                      f = ((o + i) * (o - i) + s * s) / 2,\n                      m = i * s * (i * s);\n                let g = 0;\n                0 === f && 0 === m || (g = m / (f + (g = f < 0 ? 0 - Math.sqrt(f * f + m) : Math.sqrt(f * f + m))));\n                let p = (a + i) * (a - i) + g,\n                    b = a * l;\n\n                for (let r = t; r < R - 1; r++) {\n                  let i = u(p, b);\n                  0 === i && (i = Number.MIN_VALUE);\n                  let o = p / i,\n                      s = b / i;\n                  if (r !== t && (y[r - 1] = i), p = o * v[r] + s * y[r], y[r] = o * y[r] - s * v[r], b = s * v[r + 1], v[r + 1] = o * v[r + 1], c) for (let t = 0; t < n; t++) i = o * w[t][r] + s * w[t][r + 1], w[t][r + 1] = -s * w[t][r] + o * w[t][r + 1], w[t][r] = i;\n                  if (0 === (i = u(p, b)) && (i = Number.MIN_VALUE), o = p / i, s = b / i, v[r] = i, p = o * y[r] + s * v[r + 1], v[r + 1] = -s * y[r] + o * v[r + 1], b = s * y[r + 1], y[r + 1] = o * y[r + 1], h && r < e - 1) for (let t = 0; t < e; t++) i = o * d[t][r] + s * d[t][r + 1], d[t][r + 1] = -s * d[t][r] + o * d[t][r + 1], d[t][r] = i;\n                }\n\n                y[R - 2] = p, 1;\n                break;\n              }\n\n            case 4:\n              if (v[t] <= 0 && (v[t] = v[t] < 0 ? -v[t] : 0, c)) for (let r = 0; r <= k; r++) w[r][t] = -w[r][t];\n\n              for (; t < k && !(v[t] >= v[t + 1]);) {\n                let r = v[t];\n                if (v[t] = v[t + 1], v[t + 1] = r, c && t < n - 1) for (let e = 0; e < n; e++) r = w[e][t + 1], w[e][t + 1] = w[e][t], w[e][t] = r;\n                if (h && t < e - 1) for (let n = 0; n < e; n++) r = d[n][t + 1], d[n][t + 1] = d[n][t], d[n][t] = r;\n                t++;\n              }\n\n              0, R--;\n          }\n        }\n\n        if (f) {\n          var N = w;\n          w = d, d = N;\n        }\n\n        this.m = e, this.n = n, this.s = v, this.U = d, this.V = w;\n      }\n\n      solve(t) {\n        var r = t,\n            e = this.threshold,\n            n = this.s.length,\n            i = _.zeros(n, n);\n\n        for (let t = 0; t < n; t++) Math.abs(this.s[t]) <= e ? i[t][t] = 0 : i[t][t] = 1 / this.s[t];\n\n        var o = this.U,\n            s = this.rightSingularVectors,\n            a = s.mmul(i),\n            h = s.rows,\n            u = o.length,\n            l = _.zeros(h, u);\n\n        for (let t = 0; t < h; t++) for (let r = 0; r < u; r++) {\n          let e = 0;\n\n          for (let i = 0; i < n; i++) e += a[t][i] * o[r][i];\n\n          l[t][r] = e;\n        }\n\n        return l.mmul(r);\n      }\n\n      solveForDiagonal(t) {\n        return this.solve(_.diag(t));\n      }\n\n      inverse() {\n        var t = this.V,\n            r = this.threshold,\n            e = t.length,\n            n = t[0].length,\n            i = new _(e, this.s.length);\n\n        for (let o = 0; o < e; o++) for (let e = 0; e < n; e++) Math.abs(this.s[e]) > r ? i[o][e] = t[o][e] / this.s[e] : i[o][e] = 0;\n\n        var o = this.U,\n            s = o.length,\n            a = o[0].length,\n            h = new _(e, s);\n\n        for (let t = 0; t < e; t++) for (let r = 0; r < s; r++) {\n          let e = 0;\n\n          for (let n = 0; n < a; n++) e += i[t][n] * o[r][n];\n\n          h[t][r] = e;\n        }\n\n        return h;\n      }\n\n      get condition() {\n        return this.s[0] / this.s[Math.min(this.m, this.n) - 1];\n      }\n\n      get norm2() {\n        return this.s[0];\n      }\n\n      get rank() {\n        for (var t = Math.max(this.m, this.n) * this.s[0] * Number.EPSILON, r = 0, e = this.s, n = 0, i = e.length; n < i; n++) e[n] > t && r++;\n\n        return r;\n      }\n\n      get diagonal() {\n        return this.s;\n      }\n\n      get threshold() {\n        return Number.EPSILON / 2 * Math.max(this.m, this.n) * this.s[0];\n      }\n\n      get leftSingularVectors() {\n        return _.isMatrix(this.U) || (this.U = new _(this.U)), this.U;\n      }\n\n      get rightSingularVectors() {\n        return _.isMatrix(this.V) || (this.V = new _(this.V)), this.V;\n      }\n\n      get diagonalMatrix() {\n        return _.diag(this.s);\n      }\n\n    }\n\n    function f(t, r, e) {\n      var n = e ? t.rows : t.rows - 1;\n      if (r < 0 || r > n) throw new RangeError("Row index out of range");\n    }\n\n    function m(t, r, e) {\n      var n = e ? t.columns : t.columns - 1;\n      if (r < 0 || r > n) throw new RangeError("Column index out of range");\n    }\n\n    function g(t, r) {\n      if (r.to1DArray && (r = r.to1DArray()), r.length !== t.columns) throw new RangeError("vector size must be the same as the number of columns");\n      return r;\n    }\n\n    function p(t, r) {\n      if (r.to1DArray && (r = r.to1DArray()), r.length !== t.rows) throw new RangeError("vector size must be the same as the number of rows");\n      return r;\n    }\n\n    function v(t, r, e) {\n      return {\n        row: d(t, r),\n        column: w(t, e)\n      };\n    }\n\n    function d(t, r) {\n      if ("object" != typeof r) throw new TypeError("unexpected type for row indices");\n      if (r.some(r => r < 0 || r >= t.rows)) throw new RangeError("row indices are out of range");\n      return Array.isArray(r) || (r = Array.from(r)), r;\n    }\n\n    function w(t, r) {\n      if ("object" != typeof r) throw new TypeError("unexpected type for column indices");\n      if (r.some(r => r < 0 || r >= t.columns)) throw new RangeError("column indices are out of range");\n      return Array.isArray(r) || (r = Array.from(r)), r;\n    }\n\n    function y(t, r, e, n, i) {\n      if (5 !== arguments.length) throw new RangeError("expected 4 arguments");\n      if (b("startRow", r), b("endRow", e), b("startColumn", n), b("endColumn", i), r > e || n > i || r < 0 || r >= t.rows || e < 0 || e >= t.rows || n < 0 || n >= t.columns || i < 0 || i >= t.columns) throw new RangeError("Submatrix indices are out of range");\n    }\n\n    function b(t, r) {\n      if ("number" != typeof r) throw new TypeError(`${t} must be a number`);\n    }\n\n    class M extends C() {\n      constructor(t, r, e) {\n        super(), this.matrix = t, this.rows = r, this.columns = e;\n      }\n\n      static get [Symbol.species]() {\n        return _;\n      }\n\n    }\n\n    class x extends M {\n      constructor(t) {\n        super(t, t.columns, t.rows);\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(r, t, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(r, t);\n      }\n\n    }\n\n    class S extends M {\n      constructor(t, r) {\n        super(t, 1, t.columns), this.row = r;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(this.row, r, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(this.row, r);\n      }\n\n    }\n\n    class E extends M {\n      constructor(t, r, e, n, i) {\n        y(t, r, e, n, i), super(t, e - r + 1, i - n + 1), this.startRow = r, this.startColumn = n;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(this.startRow + t, this.startColumn + r, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(this.startRow + t, this.startColumn + r);\n      }\n\n    }\n\n    class R extends M {\n      constructor(t, r, e) {\n        var n = v(t, r, e);\n        super(t, n.row.length, n.column.length), this.rowIndices = n.row, this.columnIndices = n.column;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(this.rowIndices[t], this.columnIndices[r], e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(this.rowIndices[t], this.columnIndices[r]);\n      }\n\n    }\n\n    class k extends M {\n      constructor(t, r) {\n        super(t, (r = d(t, r)).length, t.columns), this.rowIndices = r;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(this.rowIndices[t], r, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(this.rowIndices[t], r);\n      }\n\n    }\n\n    class z extends M {\n      constructor(t, r) {\n        r = w(t, r), super(t, t.rows, r.length), this.columnIndices = r;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(t, this.columnIndices[r], e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(t, this.columnIndices[r]);\n      }\n\n    }\n\n    class N extends M {\n      constructor(t, r) {\n        super(t, t.rows, 1), this.column = r;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(t, this.column, e), this;\n      }\n\n      get(t) {\n        return this.matrix.get(t, this.column);\n      }\n\n    }\n\n    class A extends M {\n      constructor(t) {\n        super(t, t.rows, t.columns);\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(this.rows - t - 1, r, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(this.rows - t - 1, r);\n      }\n\n    }\n\n    class V extends M {\n      constructor(t) {\n        super(t, t.rows, t.columns);\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(t, this.columns - r - 1, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(t, this.columns - r - 1);\n      }\n\n    }\n\n    function C(t) {\n      void 0 === t && (t = Object);\n\n      class r extends t {\n        static get [Symbol.species]() {\n          return this;\n        }\n\n        static from1DArray(t, r, e) {\n          if (t * r !== e.length) throw new RangeError("Data length does not match given dimensions");\n\n          for (var n = new this(t, r), i = 0; i < t; i++) for (var o = 0; o < r; o++) n.set(i, o, e[i * r + o]);\n\n          return n;\n        }\n\n        static rowVector(t) {\n          for (var r = new this(1, t.length), e = 0; e < t.length; e++) r.set(0, e, t[e]);\n\n          return r;\n        }\n\n        static columnVector(t) {\n          for (var r = new this(t.length, 1), e = 0; e < t.length; e++) r.set(e, 0, t[e]);\n\n          return r;\n        }\n\n        static empty(t, r) {\n          return new this(t, r);\n        }\n\n        static zeros(t, r) {\n          return this.empty(t, r).fill(0);\n        }\n\n        static ones(t, r) {\n          return this.empty(t, r).fill(1);\n        }\n\n        static rand(t, r, e) {\n          void 0 === e && (e = Math.random);\n\n          for (var n = this.empty(t, r), i = 0; i < t; i++) for (var o = 0; o < r; o++) n.set(i, o, e());\n\n          return n;\n        }\n\n        static randInt(t, r, e, n) {\n          void 0 === e && (e = 1e3), void 0 === n && (n = Math.random);\n\n          for (var i = this.empty(t, r), o = 0; o < t; o++) for (var s = 0; s < r; s++) {\n            var a = Math.floor(n() * e);\n            i.set(o, s, a);\n          }\n\n          return i;\n        }\n\n        static eye(t, r, e) {\n          void 0 === r && (r = t), void 0 === e && (e = 1);\n\n          for (var n = Math.min(t, r), i = this.zeros(t, r), o = 0; o < n; o++) i.set(o, o, e);\n\n          return i;\n        }\n\n        static diag(t, r, e) {\n          var n = t.length;\n          void 0 === r && (r = n), void 0 === e && (e = r);\n\n          for (var i = Math.min(n, r, e), o = this.zeros(r, e), s = 0; s < i; s++) o.set(s, s, t[s]);\n\n          return o;\n        }\n\n        static min(t, r) {\n          t = this.checkMatrix(t), r = this.checkMatrix(r);\n\n          for (var e = t.rows, n = t.columns, i = new this(e, n), o = 0; o < e; o++) for (var s = 0; s < n; s++) i.set(o, s, Math.min(t.get(o, s), r.get(o, s)));\n\n          return i;\n        }\n\n        static max(t, r) {\n          t = this.checkMatrix(t), r = this.checkMatrix(r);\n\n          for (var e = t.rows, n = t.columns, i = new this(e, n), o = 0; o < e; o++) for (var s = 0; s < n; s++) i.set(o, s, Math.max(t.get(o, s), r.get(o, s)));\n\n          return i;\n        }\n\n        static checkMatrix(t) {\n          return r.isMatrix(t) ? t : new this(t);\n        }\n\n        static isMatrix(t) {\n          return null != t && "Matrix" === t.klass;\n        }\n\n        get size() {\n          return this.rows * this.columns;\n        }\n\n        apply(t) {\n          if ("function" != typeof t) throw new TypeError("callback must be a function");\n\n          for (var r = this.rows, e = this.columns, n = 0; n < r; n++) for (var i = 0; i < e; i++) t.call(this, n, i);\n\n          return this;\n        }\n\n        to1DArray() {\n          for (var t = new Array(this.size), r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) t[r * this.columns + e] = this.get(r, e);\n\n          return t;\n        }\n\n        to2DArray() {\n          for (var t = new Array(this.rows), r = 0; r < this.rows; r++) {\n            t[r] = new Array(this.columns);\n\n            for (var e = 0; e < this.columns; e++) t[r][e] = this.get(r, e);\n          }\n\n          return t;\n        }\n\n        isRowVector() {\n          return 1 === this.rows;\n        }\n\n        isColumnVector() {\n          return 1 === this.columns;\n        }\n\n        isVector() {\n          return 1 === this.rows || 1 === this.columns;\n        }\n\n        isSquare() {\n          return this.rows === this.columns;\n        }\n\n        isSymmetric() {\n          if (this.isSquare()) {\n            for (var t = 0; t < this.rows; t++) for (var r = 0; r <= t; r++) if (this.get(t, r) !== this.get(r, t)) return !1;\n\n            return !0;\n          }\n\n          return !1;\n        }\n\n        set(t, r, e) {\n          throw new Error("set method is unimplemented");\n        }\n\n        get(t, r) {\n          throw new Error("get method is unimplemented");\n        }\n\n        repeat(t, r) {\n          t = t || 1, r = r || 1;\n\n          for (var e = new this.constructor[Symbol.species](this.rows * t, this.columns * r), n = 0; n < t; n++) for (var i = 0; i < r; i++) e.setSubMatrix(this, this.rows * n, this.columns * i);\n\n          return e;\n        }\n\n        fill(t) {\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, t);\n\n          return this;\n        }\n\n        neg() {\n          return this.mulS(-1);\n        }\n\n        getRow(t) {\n          f(this, t);\n\n          for (var r = new Array(this.columns), e = 0; e < this.columns; e++) r[e] = this.get(t, e);\n\n          return r;\n        }\n\n        getRowVector(t) {\n          return this.constructor.rowVector(this.getRow(t));\n        }\n\n        setRow(t, r) {\n          f(this, t), r = g(this, r);\n\n          for (var e = 0; e < this.columns; e++) this.set(t, e, r[e]);\n\n          return this;\n        }\n\n        swapRows(t, r) {\n          f(this, t), f(this, r);\n\n          for (var e = 0; e < this.columns; e++) {\n            var n = this.get(t, e);\n            this.set(t, e, this.get(r, e)), this.set(r, e, n);\n          }\n\n          return this;\n        }\n\n        getColumn(t) {\n          m(this, t);\n\n          for (var r = new Array(this.rows), e = 0; e < this.rows; e++) r[e] = this.get(e, t);\n\n          return r;\n        }\n\n        getColumnVector(t) {\n          return this.constructor.columnVector(this.getColumn(t));\n        }\n\n        setColumn(t, r) {\n          m(this, t), r = p(this, r);\n\n          for (var e = 0; e < this.rows; e++) this.set(e, t, r[e]);\n\n          return this;\n        }\n\n        swapColumns(t, r) {\n          m(this, t), m(this, r);\n\n          for (var e = 0; e < this.rows; e++) {\n            var n = this.get(e, t);\n            this.set(e, t, this.get(e, r)), this.set(e, r, n);\n          }\n\n          return this;\n        }\n\n        addRowVector(t) {\n          t = g(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) + t[e]);\n\n          return this;\n        }\n\n        subRowVector(t) {\n          t = g(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) - t[e]);\n\n          return this;\n        }\n\n        mulRowVector(t) {\n          t = g(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) * t[e]);\n\n          return this;\n        }\n\n        divRowVector(t) {\n          t = g(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) / t[e]);\n\n          return this;\n        }\n\n        addColumnVector(t) {\n          t = p(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) + t[r]);\n\n          return this;\n        }\n\n        subColumnVector(t) {\n          t = p(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) - t[r]);\n\n          return this;\n        }\n\n        mulColumnVector(t) {\n          t = p(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) * t[r]);\n\n          return this;\n        }\n\n        divColumnVector(t) {\n          t = p(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) / t[r]);\n\n          return this;\n        }\n\n        mulRow(t, r) {\n          f(this, t);\n\n          for (var e = 0; e < this.columns; e++) this.set(t, e, this.get(t, e) * r);\n\n          return this;\n        }\n\n        mulColumn(t, r) {\n          m(this, t);\n\n          for (var e = 0; e < this.rows; e++) this.set(e, t, this.get(e, t) * r);\n\n          return this;\n        }\n\n        max() {\n          for (var t = this.get(0, 0), r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.get(r, e) > t && (t = this.get(r, e));\n\n          return t;\n        }\n\n        maxIndex() {\n          for (var t = this.get(0, 0), r = [0, 0], e = 0; e < this.rows; e++) for (var n = 0; n < this.columns; n++) this.get(e, n) > t && (t = this.get(e, n), r[0] = e, r[1] = n);\n\n          return r;\n        }\n\n        min() {\n          for (var t = this.get(0, 0), r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.get(r, e) < t && (t = this.get(r, e));\n\n          return t;\n        }\n\n        minIndex() {\n          for (var t = this.get(0, 0), r = [0, 0], e = 0; e < this.rows; e++) for (var n = 0; n < this.columns; n++) this.get(e, n) < t && (t = this.get(e, n), r[0] = e, r[1] = n);\n\n          return r;\n        }\n\n        maxRow(t) {\n          f(this, t);\n\n          for (var r = this.get(t, 0), e = 1; e < this.columns; e++) this.get(t, e) > r && (r = this.get(t, e));\n\n          return r;\n        }\n\n        maxRowIndex(t) {\n          f(this, t);\n\n          for (var r = this.get(t, 0), e = [t, 0], n = 1; n < this.columns; n++) this.get(t, n) > r && (r = this.get(t, n), e[1] = n);\n\n          return e;\n        }\n\n        minRow(t) {\n          f(this, t);\n\n          for (var r = this.get(t, 0), e = 1; e < this.columns; e++) this.get(t, e) < r && (r = this.get(t, e));\n\n          return r;\n        }\n\n        minRowIndex(t) {\n          f(this, t);\n\n          for (var r = this.get(t, 0), e = [t, 0], n = 1; n < this.columns; n++) this.get(t, n) < r && (r = this.get(t, n), e[1] = n);\n\n          return e;\n        }\n\n        maxColumn(t) {\n          m(this, t);\n\n          for (var r = this.get(0, t), e = 1; e < this.rows; e++) this.get(e, t) > r && (r = this.get(e, t));\n\n          return r;\n        }\n\n        maxColumnIndex(t) {\n          m(this, t);\n\n          for (var r = this.get(0, t), e = [0, t], n = 1; n < this.rows; n++) this.get(n, t) > r && (r = this.get(n, t), e[0] = n);\n\n          return e;\n        }\n\n        minColumn(t) {\n          m(this, t);\n\n          for (var r = this.get(0, t), e = 1; e < this.rows; e++) this.get(e, t) < r && (r = this.get(e, t));\n\n          return r;\n        }\n\n        minColumnIndex(t) {\n          m(this, t);\n\n          for (var r = this.get(0, t), e = [0, t], n = 1; n < this.rows; n++) this.get(n, t) < r && (r = this.get(n, t), e[0] = n);\n\n          return e;\n        }\n\n        diag() {\n          for (var t = Math.min(this.rows, this.columns), r = new Array(t), e = 0; e < t; e++) r[e] = this.get(e, e);\n\n          return r;\n        }\n\n        sum(t) {\n          switch (t) {\n            case "row":\n              return function (t) {\n                for (var r = _.zeros(t.rows, 1), e = 0; e < t.rows; ++e) for (var n = 0; n < t.columns; ++n) r.set(e, 0, r.get(e, 0) + t.get(e, n));\n\n                return r;\n              }(this);\n\n            case "column":\n              return function (t) {\n                for (var r = _.zeros(1, t.columns), e = 0; e < t.rows; ++e) for (var n = 0; n < t.columns; ++n) r.set(0, n, r.get(0, n) + t.get(e, n));\n\n                return r;\n              }(this);\n\n            default:\n              return function (t) {\n                for (var r = 0, e = 0; e < t.rows; e++) for (var n = 0; n < t.columns; n++) r += t.get(e, n);\n\n                return r;\n              }(this);\n          }\n        }\n\n        mean() {\n          return this.sum() / this.size;\n        }\n\n        prod() {\n          for (var t = 1, r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) t *= this.get(r, e);\n\n          return t;\n        }\n\n        norm(t = "frobenius") {\n          var r = 0;\n          if ("max" === t) return this.max();\n\n          if ("frobenius" === t) {\n            for (var e = 0; e < this.rows; e++) for (var n = 0; n < this.columns; n++) r += this.get(e, n) * this.get(e, n);\n\n            return Math.sqrt(r);\n          }\n\n          throw new RangeError(`unknown norm type: ${t}`);\n        }\n\n        cumulativeSum() {\n          for (var t = 0, r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) t += this.get(r, e), this.set(r, e, t);\n\n          return this;\n        }\n\n        dot(t) {\n          r.isMatrix(t) && (t = t.to1DArray());\n          var e = this.to1DArray();\n          if (e.length !== t.length) throw new RangeError("vectors do not have the same size");\n\n          for (var n = 0, i = 0; i < e.length; i++) n += e[i] * t[i];\n\n          return n;\n        }\n\n        mmul(t) {\n          t = this.constructor.checkMatrix(t), this.columns !== t.rows && console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");\n\n          for (var r = this.rows, e = this.columns, n = t.columns, i = new this.constructor[Symbol.species](r, n), o = new Array(e), s = 0; s < n; s++) {\n            for (var a = 0; a < e; a++) o[a] = t.get(a, s);\n\n            for (var h = 0; h < r; h++) {\n              var u = 0;\n\n              for (a = 0; a < e; a++) u += this.get(h, a) * o[a];\n\n              i.set(h, s, u);\n            }\n          }\n\n          return i;\n        }\n\n        strassen2x2(t) {\n          var r = new this.constructor[Symbol.species](2, 2);\n          const e = this.get(0, 0),\n                n = t.get(0, 0),\n                i = this.get(0, 1),\n                o = t.get(0, 1),\n                s = this.get(1, 0),\n                a = t.get(1, 0),\n                h = this.get(1, 1),\n                u = t.get(1, 1),\n                l = (e + h) * (n + u),\n                c = (s + h) * n,\n                f = e * (o - u),\n                m = h * (a - n),\n                g = (e + i) * u,\n                p = l + m - g + (i - h) * (a + u),\n                v = f + g,\n                d = c + m,\n                w = l - c + f + (s - e) * (n + o);\n          return r.set(0, 0, p), r.set(0, 1, v), r.set(1, 0, d), r.set(1, 1, w), r;\n        }\n\n        strassen3x3(t) {\n          var r = new this.constructor[Symbol.species](3, 3);\n\n          const e = this.get(0, 0),\n                n = this.get(0, 1),\n                i = this.get(0, 2),\n                o = this.get(1, 0),\n                s = this.get(1, 1),\n                a = this.get(1, 2),\n                h = this.get(2, 0),\n                u = this.get(2, 1),\n                l = this.get(2, 2),\n                c = t.get(0, 0),\n                f = t.get(0, 1),\n                m = t.get(0, 2),\n                g = t.get(1, 0),\n                p = t.get(1, 1),\n                v = t.get(1, 2),\n                d = t.get(2, 0),\n                w = t.get(2, 1),\n                y = t.get(2, 2),\n                b = (e - o) * (-f + p),\n                M = (-e + o + s) * (c - f + p),\n                x = (o + s) * (-c + f),\n                S = e * c,\n                E = (-e + h + u) * (c - m + v),\n                R = (-e + h) * (m - v),\n                k = (h + u) * (-c + m),\n                z = (-i + u + l) * (p + d - w),\n                N = (i - l) * (p - w),\n                A = i * d,\n                V = (u + l) * (-d + w),\n                C = (-i + s + a) * (v + d - y),\n                _ = (i - a) * (v - y),\n                P = (s + a) * (-d + y),\n                j = S + A + n * g,\n                I = (e + n + i - o - s - u - l) * p + M + x + S + z + A + V,\n                O = S + E + k + (e + n + i - s - a - h - u) * v + A + C + P,\n                D = b + s * (-c + f + g - p - v - d + y) + M + S + A + C + _,\n                L = b + M + x + S + a * w,\n                T = A + C + _ + P + o * m,\n                F = S + E + R + u * (-c + m + g - p - v - d + w) + z + N + A,\n                q = z + N + A + V + h * f,\n                U = S + E + R + k + l * y;\n\n          return r.set(0, 0, j), r.set(0, 1, I), r.set(0, 2, O), r.set(1, 0, D), r.set(1, 1, L), r.set(1, 2, T), r.set(2, 0, F), r.set(2, 1, q), r.set(2, 2, U), r;\n        }\n\n        mmulStrassen(t) {\n          var e = this.clone(),\n              n = e.rows,\n              i = e.columns,\n              o = t.rows,\n              s = t.columns;\n\n          function a(t, e, n) {\n            var i = t.rows,\n                o = t.columns;\n            if (i === e && o === n) return t;\n            var s = r.zeros(e, n);\n            return s = s.setSubMatrix(t, 0, 0);\n          }\n\n          i !== o && console.warn(`Multiplying ${n} x ${i} and ${o} x ${s} matrix: dimensions do not match.`);\n          var h = Math.max(n, o),\n              u = Math.max(i, s);\n          return function t(e, n, i, o) {\n            if (i <= 512 || o <= 512) return e.mmul(n);\n            i % 2 == 1 && o % 2 == 1 ? (e = a(e, i + 1, o + 1), n = a(n, i + 1, o + 1)) : i % 2 == 1 ? (e = a(e, i + 1, o), n = a(n, i + 1, o)) : o % 2 == 1 && (e = a(e, i, o + 1), n = a(n, i, o + 1));\n            var s = parseInt(e.rows / 2, 10),\n                h = parseInt(e.columns / 2, 10),\n                u = e.subMatrix(0, s - 1, 0, h - 1),\n                l = n.subMatrix(0, s - 1, 0, h - 1),\n                c = e.subMatrix(0, s - 1, h, e.columns - 1),\n                f = n.subMatrix(0, s - 1, h, n.columns - 1),\n                m = e.subMatrix(s, e.rows - 1, 0, h - 1),\n                g = n.subMatrix(s, n.rows - 1, 0, h - 1),\n                p = e.subMatrix(s, e.rows - 1, h, e.columns - 1),\n                v = n.subMatrix(s, n.rows - 1, h, n.columns - 1),\n                d = t(r.add(u, p), r.add(l, v), s, h),\n                w = t(r.add(m, p), l, s, h),\n                y = t(u, r.sub(f, v), s, h),\n                b = t(p, r.sub(g, l), s, h),\n                M = t(r.add(u, c), v, s, h),\n                x = t(r.sub(m, u), r.add(l, f), s, h),\n                S = t(r.sub(c, p), r.add(g, v), s, h),\n                E = r.add(d, b);\n            E.sub(M), E.add(S);\n            var R = r.add(y, M),\n                k = r.add(w, b),\n                z = r.sub(d, w);\n            z.add(y), z.add(x);\n            var N = r.zeros(2 * E.rows, 2 * E.columns);\n            return (N = (N = (N = (N = N.setSubMatrix(E, 0, 0)).setSubMatrix(R, E.rows, 0)).setSubMatrix(k, 0, E.columns)).setSubMatrix(z, E.rows, E.columns)).subMatrix(0, i - 1, 0, o - 1);\n          }(e = a(e, h, u), t = a(t, h, u), h, u);\n        }\n\n        scaleRows(t, r) {\n          if ((t = void 0 === t ? 0 : t) >= (r = void 0 === r ? 1 : r)) throw new RangeError("min should be strictly smaller than max");\n\n          for (var e = this.constructor.empty(this.rows, this.columns), n = 0; n < this.rows; n++) {\n            var i = a(this.getRow(n), {\n              min: t,\n              max: r\n            });\n            e.setRow(n, i);\n          }\n\n          return e;\n        }\n\n        scaleColumns(t, r) {\n          if ((t = void 0 === t ? 0 : t) >= (r = void 0 === r ? 1 : r)) throw new RangeError("min should be strictly smaller than max");\n\n          for (var e = this.constructor.empty(this.rows, this.columns), n = 0; n < this.columns; n++) {\n            var i = a(this.getColumn(n), {\n              min: t,\n              max: r\n            });\n            e.setColumn(n, i);\n          }\n\n          return e;\n        }\n\n        kroneckerProduct(t) {\n          t = this.constructor.checkMatrix(t);\n\n          for (var r = this.rows, e = this.columns, n = t.rows, i = t.columns, o = new this.constructor[Symbol.species](r * n, e * i), s = 0; s < r; s++) for (var a = 0; a < e; a++) for (var h = 0; h < n; h++) for (var u = 0; u < i; u++) o[n * s + h][i * a + u] = this.get(s, a) * t.get(h, u);\n\n          return o;\n        }\n\n        transpose() {\n          for (var t = new this.constructor[Symbol.species](this.columns, this.rows), r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) t.set(e, r, this.get(r, e));\n\n          return t;\n        }\n\n        sortRows(t) {\n          void 0 === t && (t = e);\n\n          for (var r = 0; r < this.rows; r++) this.setRow(r, this.getRow(r).sort(t));\n\n          return this;\n        }\n\n        sortColumns(t) {\n          void 0 === t && (t = e);\n\n          for (var r = 0; r < this.columns; r++) this.setColumn(r, this.getColumn(r).sort(t));\n\n          return this;\n        }\n\n        subMatrix(t, r, e, n) {\n          y(this, t, r, e, n);\n\n          for (var i = new this.constructor[Symbol.species](r - t + 1, n - e + 1), o = t; o <= r; o++) for (var s = e; s <= n; s++) i[o - t][s - e] = this.get(o, s);\n\n          return i;\n        }\n\n        subMatrixRow(t, r, e) {\n          if (void 0 === r && (r = 0), void 0 === e && (e = this.columns - 1), r > e || r < 0 || r >= this.columns || e < 0 || e >= this.columns) throw new RangeError("Argument out of range");\n\n          for (var n = new this.constructor[Symbol.species](t.length, e - r + 1), i = 0; i < t.length; i++) for (var o = r; o <= e; o++) {\n            if (t[i] < 0 || t[i] >= this.rows) throw new RangeError(`Row index out of range: ${t[i]}`);\n            n.set(i, o - r, this.get(t[i], o));\n          }\n\n          return n;\n        }\n\n        subMatrixColumn(t, r, e) {\n          if (void 0 === r && (r = 0), void 0 === e && (e = this.rows - 1), r > e || r < 0 || r >= this.rows || e < 0 || e >= this.rows) throw new RangeError("Argument out of range");\n\n          for (var n = new this.constructor[Symbol.species](e - r + 1, t.length), i = 0; i < t.length; i++) for (var o = r; o <= e; o++) {\n            if (t[i] < 0 || t[i] >= this.columns) throw new RangeError(`Column index out of range: ${t[i]}`);\n            n.set(o - r, i, this.get(o, t[i]));\n          }\n\n          return n;\n        }\n\n        setSubMatrix(t, r, e) {\n          y(this, r, r + (t = this.constructor.checkMatrix(t)).rows - 1, e, e + t.columns - 1);\n\n          for (var n = 0; n < t.rows; n++) for (var i = 0; i < t.columns; i++) this[r + n][e + i] = t.get(n, i);\n\n          return this;\n        }\n\n        selection(t, r) {\n          for (var e = v(this, t, r), n = new this.constructor[Symbol.species](t.length, r.length), i = 0; i < e.row.length; i++) for (var o = e.row[i], s = 0; s < e.column.length; s++) {\n            var a = e.column[s];\n            n[i][s] = this.get(o, a);\n          }\n\n          return n;\n        }\n\n        trace() {\n          for (var t = Math.min(this.rows, this.columns), r = 0, e = 0; e < t; e++) r += this.get(e, e);\n\n          return r;\n        }\n\n        transposeView() {\n          return new x(this);\n        }\n\n        rowView(t) {\n          return f(this, t), new S(this, t);\n        }\n\n        columnView(t) {\n          return m(this, t), new N(this, t);\n        }\n\n        flipRowView() {\n          return new A(this);\n        }\n\n        flipColumnView() {\n          return new V(this);\n        }\n\n        subMatrixView(t, r, e, n) {\n          return new E(this, t, r, e, n);\n        }\n\n        selectionView(t, r) {\n          return new R(this, t, r);\n        }\n\n        rowSelectionView(t) {\n          return new k(this, t);\n        }\n\n        columnSelectionView(t) {\n          return new z(this, t);\n        }\n\n        det() {\n          var t, r, e, n, i, o;\n          if (this.isSquare()) return 2 === this.columns ? (t = this.get(0, 0), r = this.get(0, 1), e = this.get(1, 0), t * this.get(1, 1) - r * e) : 3 === this.columns ? (n = this.selectionView([1, 2], [1, 2]), i = this.selectionView([1, 2], [0, 2]), o = this.selectionView([1, 2], [0, 1]), t = this.get(0, 0), r = this.get(0, 1), e = this.get(0, 2), t * n.det() - r * i.det() + e * o.det()) : new h(this).determinant;\n          throw Error("Determinant can only be calculated for a square matrix.");\n        }\n\n        pseudoInverse(t) {\n          void 0 === t && (t = Number.EPSILON);\n\n          for (var r = new c(this, {\n            autoTranspose: !0\n          }), e = r.leftSingularVectors, n = r.rightSingularVectors, i = r.diagonal, o = 0; o < i.length; o++) Math.abs(i[o]) > t ? i[o] = 1 / i[o] : i[o] = 0;\n\n          return i = this.constructor[Symbol.species].diag(i), n.mmul(i.mmul(e.transposeView()));\n        }\n\n        clone() {\n          for (var t = new this.constructor[Symbol.species](this.rows, this.columns), r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) t.set(r, e, this.get(r, e));\n\n          return t;\n        }\n\n      }\n\n      function e(t, r) {\n        return t - r;\n      }\n\n      r.prototype.klass = "Matrix", r.random = r.rand, r.diagonal = r.diag, r.prototype.diagonal = r.prototype.diag, r.identity = r.eye, r.prototype.negate = r.prototype.neg, r.prototype.tensorProduct = r.prototype.kroneckerProduct, r.prototype.determinant = r.prototype.det;\n      var n,\n          i = "\\n(function %name%(matrix, %args%) {\\n    var newMatrix = new this[Symbol.species](matrix);\\n    return newMatrix.%name%(%args%);\\n})\\n",\n          o = eval;\n\n      for (var s of [["+", "add"], ["-", "sub", "subtract"], ["*", "mul", "multiply"], ["/", "div", "divide"], ["%", "mod", "modulus"], ["&", "and"], ["|", "or"], ["^", "xor"], ["<<", "leftShift"], [">>", "signPropagatingRightShift"], [">>>", "rightShift", "zeroFillRightShift"]]) {\n        var u = o($("\\n(function %name%(value) {\\n    if (typeof value === \'number\') return this.%name%S(value);\\n    return this.%name%M(value);\\n})\\n", {\n          name: s[1],\n          op: s[0]\n        })),\n            l = o($("\\n(function %name%S(value) {\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, this.get(i, j) %op% value);\\n        }\\n    }\\n    return this;\\n})\\n", {\n          name: `${s[1]}S`,\n          op: s[0]\n        })),\n            d = o($("\\n(function %name%M(matrix) {\\n    matrix = this.constructor.checkMatrix(matrix);\\n    if (this.rows !== matrix.rows ||\\n        this.columns !== matrix.columns) {\\n        throw new RangeError(\'Matrices dimensions must be equal\');\\n    }\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, this.get(i, j) %op% matrix.get(i, j));\\n        }\\n    }\\n    return this;\\n})\\n", {\n          name: `${s[1]}M`,\n          op: s[0]\n        })),\n            w = o($("\\n(function %name%(matrix, value) {\\n    var newMatrix = new this[Symbol.species](matrix);\\n    return newMatrix.%name%(value);\\n})\\n", {\n          name: s[1]\n        }));\n\n        for (n = 1; n < s.length; n++) r.prototype[s[n]] = u, r.prototype[`${s[n]}S`] = l, r.prototype[`${s[n]}M`] = d, r[s[n]] = w;\n      }\n\n      var b = [["~", "not"]];\n\n      for (var M of (["abs", "acos", "acosh", "asin", "asinh", "atan", "atanh", "cbrt", "ceil", "clz32", "cos", "cosh", "exp", "expm1", "floor", "fround", "log", "log1p", "log10", "log2", "round", "sign", "sin", "sinh", "sqrt", "tan", "tanh", "trunc"].forEach(function (t) {\n        b.push([`Math.${t}`, t]);\n      }), b)) {\n        var C = o($("\\n(function %name%() {\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, %method%(this.get(i, j)));\\n        }\\n    }\\n    return this;\\n})\\n", {\n          name: M[1],\n          method: M[0]\n        })),\n            P = o($("\\n(function %name%(matrix) {\\n    var newMatrix = new this[Symbol.species](matrix);\\n    return newMatrix.%name%();\\n})\\n", {\n          name: M[1]\n        }));\n\n        for (n = 1; n < M.length; n++) r.prototype[M[n]] = C, r[M[n]] = P;\n      }\n\n      for (var j of [["Math.pow", 1, "pow"]]) {\n        var I = "arg0";\n\n        for (n = 1; n < j[1]; n++) I += `, arg${n}`;\n\n        if (1 !== j[1]) {\n          var O = o($("\\n(function %name%(%args%) {\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, %method%(this.get(i, j), %args%));\\n        }\\n    }\\n    return this;\\n})\\n", {\n            name: j[2],\n            method: j[0],\n            args: I\n          })),\n              D = o($(i, {\n            name: j[2],\n            args: I\n          }));\n\n          for (n = 2; n < j.length; n++) r.prototype[j[n]] = O, r[j[n]] = D;\n        } else {\n          var L = {\n            name: j[2],\n            args: I,\n            method: j[0]\n          },\n              T = o($("\\n(function %name%(value) {\\n    if (typeof value === \'number\') return this.%name%S(value);\\n    return this.%name%M(value);\\n})\\n", L)),\n              F = o($("\\n(function %name%S(value) {\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, %method%(this.get(i, j), value));\\n        }\\n    }\\n    return this;\\n})\\n", L)),\n              q = o($("\\n(function %name%M(matrix) {\\n    matrix = this.constructor.checkMatrix(matrix);\\n    if (this.rows !== matrix.rows ||\\n        this.columns !== matrix.columns) {\\n        throw new RangeError(\'Matrices dimensions must be equal\');\\n    }\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, %method%(this.get(i, j), matrix.get(i, j)));\\n        }\\n    }\\n    return this;\\n})\\n", L)),\n              U = o($("\\n(function %name%(matrix, %args%) {\\n    var newMatrix = new this[Symbol.species](matrix);\\n    return newMatrix.%name%(%args%);\\n})\\n", L));\n\n          for (n = 2; n < j.length; n++) r.prototype[j[n]] = T, r.prototype[`${j[n]}M`] = q, r.prototype[`${j[n]}S`] = F, r[j[n]] = U;\n        }\n      }\n\n      function $(t, r) {\n        for (var e in r) t = t.replace(new RegExp(`%${e}%`, "g"), r[e]);\n\n        return t;\n      }\n\n      return r;\n    }\n\n    class _ extends C(Array) {\n      constructor(t, r) {\n        var e;\n        if (1 === arguments.length && "number" == typeof t) return new Array(t);\n        if (_.isMatrix(t)) return t.clone();\n\n        if (Number.isInteger(t) && t > 0) {\n          if (super(t), !(Number.isInteger(r) && r > 0)) throw new TypeError("nColumns must be a positive integer");\n\n          for (e = 0; e < t; e++) this[e] = new Array(r);\n        } else {\n          if (!Array.isArray(t)) throw new TypeError("First argument must be a positive number or an array");\n          {\n            const n = t;\n            if (t = n.length, "number" != typeof (r = n[0].length) || 0 === r) throw new TypeError("Data must be a 2D array with at least one element");\n\n            for (super(t), e = 0; e < t; e++) {\n              if (n[e].length !== r) throw new RangeError("Inconsistent array dimensions");\n              this[e] = [].concat(n[e]);\n            }\n          }\n        }\n\n        return this.rows = t, this.columns = r, this;\n      }\n\n      set(t, r, e) {\n        return this[t][r] = e, this;\n      }\n\n      get(t, r) {\n        return this[t][r];\n      }\n\n      removeRow(t) {\n        if (f(this, t), 1 === this.rows) throw new RangeError("A matrix cannot have less than one row");\n        return this.splice(t, 1), this.rows -= 1, this;\n      }\n\n      addRow(t, r) {\n        return void 0 === r && (r = t, t = this.rows), f(this, t, !0), r = g(this, r), this.splice(t, 0, r), this.rows += 1, this;\n      }\n\n      removeColumn(t) {\n        if (m(this, t), 1 === this.columns) throw new RangeError("A matrix cannot have less than one column");\n\n        for (var r = 0; r < this.rows; r++) this[r].splice(t, 1);\n\n        return this.columns -= 1, this;\n      }\n\n      addColumn(t, r) {\n        void 0 === r && (r = t, t = this.columns), m(this, t, !0), r = p(this, r);\n\n        for (var e = 0; e < this.rows; e++) this[e].splice(t, 0, r[e]);\n\n        return this.columns += 1, this;\n      }\n\n    }\n\n    class P extends C() {\n      constructor(t, r = {}) {\n        const {\n          rows: e = 1\n        } = r;\n        if (t.length % e != 0) throw new Error("the data length is not divisible by the number of rows");\n        super(), this.rows = e, this.columns = t.length / e, this.data = t;\n      }\n\n      set(t, r, e) {\n        var n = this._calculateIndex(t, r);\n\n        return this.data[n] = e, this;\n      }\n\n      get(t, r) {\n        var e = this._calculateIndex(t, r);\n\n        return this.data[e];\n      }\n\n      _calculateIndex(t, r) {\n        return t * this.columns + r;\n      }\n\n      static get [Symbol.species]() {\n        return _;\n      }\n\n    }\n\n    class j extends C() {\n      constructor(t) {\n        super(), this.data = t, this.rows = t.length, this.columns = t[0].length;\n      }\n\n      set(t, r, e) {\n        return this.data[t][r] = e, this;\n      }\n\n      get(t, r) {\n        return this.data[t][r];\n      }\n\n      static get [Symbol.species]() {\n        return _;\n      }\n\n    }\n\n    function I(t, r) {\n      if (Array.isArray(t)) return t[0] && Array.isArray(t[0]) ? new j(t) : new P(t, r);\n      throw new Error("the argument is not an array");\n    }\n\n    class O {\n      constructor(t) {\n        var r,\n            e,\n            n,\n            i,\n            o = (t = j.checkMatrix(t)).clone(),\n            s = t.rows,\n            a = t.columns,\n            h = new Array(a);\n\n        for (n = 0; n < a; n++) {\n          var l = 0;\n\n          for (r = n; r < s; r++) l = u(l, o.get(r, n));\n\n          if (0 !== l) {\n            for (o.get(n, n) < 0 && (l = -l), r = n; r < s; r++) o.set(r, n, o.get(r, n) / l);\n\n            for (o.set(n, n, o.get(n, n) + 1), e = n + 1; e < a; e++) {\n              for (i = 0, r = n; r < s; r++) i += o.get(r, n) * o.get(r, e);\n\n              for (i = -i / o.get(n, n), r = n; r < s; r++) o.set(r, e, o.get(r, e) + i * o.get(r, n));\n            }\n          }\n\n          h[n] = -l;\n        }\n\n        this.QR = o, this.Rdiag = h;\n      }\n\n      solve(t) {\n        t = _.checkMatrix(t);\n        var r = this.QR,\n            e = r.rows;\n        if (t.rows !== e) throw new Error("Matrix row dimensions must agree");\n        if (!this.isFullRank()) throw new Error("Matrix is rank deficient");\n        var n,\n            i,\n            o,\n            s,\n            a = t.columns,\n            h = t.clone(),\n            u = r.columns;\n\n        for (o = 0; o < u; o++) for (i = 0; i < a; i++) {\n          for (s = 0, n = o; n < e; n++) s += r[n][o] * h[n][i];\n\n          for (s = -s / r[o][o], n = o; n < e; n++) h[n][i] += s * r[n][o];\n        }\n\n        for (o = u - 1; o >= 0; o--) {\n          for (i = 0; i < a; i++) h[o][i] /= this.Rdiag[o];\n\n          for (n = 0; n < o; n++) for (i = 0; i < a; i++) h[n][i] -= h[o][i] * r[n][o];\n        }\n\n        return h.subMatrix(0, u - 1, 0, a - 1);\n      }\n\n      isFullRank() {\n        for (var t = this.QR.columns, r = 0; r < t; r++) if (0 === this.Rdiag[r]) return !1;\n\n        return !0;\n      }\n\n      get upperTriangularMatrix() {\n        var t,\n            r,\n            e = this.QR,\n            n = e.columns,\n            i = new _(n, n);\n\n        for (t = 0; t < n; t++) for (r = 0; r < n; r++) i[t][r] = t < r ? e[t][r] : t === r ? this.Rdiag[t] : 0;\n\n        return i;\n      }\n\n      get orthogonalMatrix() {\n        var t,\n            r,\n            e,\n            n,\n            i = this.QR,\n            o = i.rows,\n            s = i.columns,\n            a = new _(o, s);\n\n        for (e = s - 1; e >= 0; e--) {\n          for (t = 0; t < o; t++) a[t][e] = 0;\n\n          for (a[e][e] = 1, r = e; r < s; r++) if (0 !== i[e][e]) {\n            for (n = 0, t = e; t < o; t++) n += i[t][e] * a[t][r];\n\n            for (n = -n / i[e][e], t = e; t < o; t++) a[t][r] += n * i[t][e];\n          }\n        }\n\n        return a;\n      }\n\n    }\n\n    function D(t, r = !1) {\n      return t = j.checkMatrix(t), r ? new c(t).inverse() : L(t, _.eye(t.rows));\n    }\n\n    function L(t, r, e = !1) {\n      return t = j.checkMatrix(t), r = j.checkMatrix(r), e ? new c(t).solve(r) : t.isSquare() ? new h(t).solve(r) : new O(t).solve(r);\n    }\n\n    function T(t, r) {\n      for (var e = [], n = 0; n < t; n++) n !== r && e.push(n);\n\n      return e;\n    }\n\n    function F(t, r, e, n = 1e-9, i = 1e-9) {\n      if (t > i) return new Array(r.rows + 1).fill(0);\n\n      for (var o = r.addRow(e, [0]), s = 0; s < o.rows; s++) Math.abs(o.get(s, 0)) < n && o.set(s, 0, 0);\n\n      return o.to1DArray();\n    }\n\n    function q(t, r = {}) {\n      const {\n        thresholdValue: e = 1e-9,\n        thresholdError: n = 1e-9\n      } = r;\n\n      for (var i = t.rows, s = new _(i, i), a = 0; a < i; a++) {\n        var h = _.columnVector(t.getRow(a)),\n            u = t.subMatrixRow(T(i, a)).transposeView(),\n            l = new c(u).solve(h),\n            f = o(_.sub(h, u.mmul(l)).abs().to1DArray());\n\n        s.setRow(a, F(f, l, a, e, n));\n      }\n\n      return s;\n    }\n\n    class U {\n      constructor(t, r = {}) {\n        const {\n          assumeSymmetric: e = !1\n        } = r;\n        if (!(t = j.checkMatrix(t)).isSquare()) throw new Error("Matrix is not a square matrix");\n        var n,\n            i,\n            o = t.columns,\n            s = l(o, o, 0),\n            a = new Array(o),\n            h = new Array(o),\n            c = t;\n\n        if (!!e || t.isSymmetric()) {\n          for (n = 0; n < o; n++) for (i = 0; i < o; i++) s[n][i] = c.get(n, i);\n\n          !function (t, r, e, n) {\n            var i, o, s, a, h, u, l, c;\n\n            for (h = 0; h < t; h++) e[h] = n[t - 1][h];\n\n            for (a = t - 1; a > 0; a--) {\n              for (c = 0, s = 0, u = 0; u < a; u++) c += Math.abs(e[u]);\n\n              if (0 === c) for (r[a] = e[a - 1], h = 0; h < a; h++) e[h] = n[a - 1][h], n[a][h] = 0, n[h][a] = 0;else {\n                for (u = 0; u < a; u++) e[u] /= c, s += e[u] * e[u];\n\n                for (i = e[a - 1], o = Math.sqrt(s), i > 0 && (o = -o), r[a] = c * o, s -= i * o, e[a - 1] = i - o, h = 0; h < a; h++) r[h] = 0;\n\n                for (h = 0; h < a; h++) {\n                  for (i = e[h], n[h][a] = i, o = r[h] + n[h][h] * i, u = h + 1; u <= a - 1; u++) o += n[u][h] * e[u], r[u] += n[u][h] * i;\n\n                  r[h] = o;\n                }\n\n                for (i = 0, h = 0; h < a; h++) r[h] /= s, i += r[h] * e[h];\n\n                for (l = i / (s + s), h = 0; h < a; h++) r[h] -= l * e[h];\n\n                for (h = 0; h < a; h++) {\n                  for (i = e[h], o = r[h], u = h; u <= a - 1; u++) n[u][h] -= i * r[u] + o * e[u];\n\n                  e[h] = n[a - 1][h], n[a][h] = 0;\n                }\n              }\n              e[a] = s;\n            }\n\n            for (a = 0; a < t - 1; a++) {\n              if (n[t - 1][a] = n[a][a], n[a][a] = 1, 0 !== (s = e[a + 1])) {\n                for (u = 0; u <= a; u++) e[u] = n[u][a + 1] / s;\n\n                for (h = 0; h <= a; h++) {\n                  for (o = 0, u = 0; u <= a; u++) o += n[u][a + 1] * n[u][h];\n\n                  for (u = 0; u <= a; u++) n[u][h] -= o * e[u];\n                }\n              }\n\n              for (u = 0; u <= a; u++) n[u][a + 1] = 0;\n            }\n\n            for (h = 0; h < t; h++) e[h] = n[t - 1][h], n[t - 1][h] = 0;\n\n            n[t - 1][t - 1] = 1, r[0] = 0;\n          }(o, h, a, s), function (t, r, e, n) {\n            var i, o, s, a, h, l, c, f, m, g, p, v, d, w, y, b;\n\n            for (s = 1; s < t; s++) r[s - 1] = r[s];\n\n            r[t - 1] = 0;\n            var M = 0,\n                x = 0,\n                S = Number.EPSILON;\n\n            for (l = 0; l < t; l++) {\n              for (x = Math.max(x, Math.abs(e[l]) + Math.abs(r[l])), c = l; c < t && !(Math.abs(r[c]) <= S * x);) c++;\n\n              if (c > l) {\n                0;\n\n                do {\n                  for (1, i = e[l], f = (e[l + 1] - i) / (2 * r[l]), m = u(f, 1), f < 0 && (m = -m), e[l] = r[l] / (f + m), e[l + 1] = r[l] * (f + m), g = e[l + 1], o = i - e[l], s = l + 2; s < t; s++) e[s] -= o;\n\n                  for (M += o, f = e[c], v = p = 1, d = p, w = r[l + 1], y = 0, b = 0, s = c - 1; s >= l; s--) for (d = v, v = p, b = y, i = p * r[s], o = p * f, m = u(f, r[s]), r[s + 1] = y * m, y = r[s] / m, f = (p = f / m) * e[s] - y * i, e[s + 1] = o + y * (p * i + y * e[s]), h = 0; h < t; h++) o = n[h][s + 1], n[h][s + 1] = y * n[h][s] + p * o, n[h][s] = p * n[h][s] - y * o;\n\n                  f = -y * b * d * w * r[l] / g, r[l] = y * f, e[l] = p * f;\n                } while (Math.abs(r[l]) > S * x);\n              }\n\n              e[l] = e[l] + M, r[l] = 0;\n            }\n\n            for (s = 0; s < t - 1; s++) {\n              for (h = s, f = e[s], a = s + 1; a < t; a++) e[a] < f && (h = a, f = e[a]);\n\n              if (h !== s) for (e[h] = e[s], e[s] = f, a = 0; a < t; a++) f = n[a][s], n[a][s] = n[a][h], n[a][h] = f;\n            }\n          }(o, h, a, s);\n        } else {\n          var f = l(o, o, 0),\n              m = new Array(o);\n\n          for (i = 0; i < o; i++) for (n = 0; n < o; n++) f[n][i] = c.get(n, i);\n\n          !function (t, r, e, n) {\n            var i,\n                o,\n                s,\n                a,\n                h,\n                u,\n                l,\n                c = t - 1;\n\n            for (u = 1; u <= c - 1; u++) {\n              for (l = 0, a = u; a <= c; a++) l += Math.abs(r[a][u - 1]);\n\n              if (0 !== l) {\n                for (s = 0, a = c; a >= u; a--) e[a] = r[a][u - 1] / l, s += e[a] * e[a];\n\n                for (o = Math.sqrt(s), e[u] > 0 && (o = -o), s -= e[u] * o, e[u] = e[u] - o, h = u; h < t; h++) {\n                  for (i = 0, a = c; a >= u; a--) i += e[a] * r[a][h];\n\n                  for (i /= s, a = u; a <= c; a++) r[a][h] -= i * e[a];\n                }\n\n                for (a = 0; a <= c; a++) {\n                  for (i = 0, h = c; h >= u; h--) i += e[h] * r[a][h];\n\n                  for (i /= s, h = u; h <= c; h++) r[a][h] -= i * e[h];\n                }\n\n                e[u] = l * e[u], r[u][u - 1] = l * o;\n              }\n            }\n\n            for (a = 0; a < t; a++) for (h = 0; h < t; h++) n[a][h] = a === h ? 1 : 0;\n\n            for (u = c - 1; u >= 1; u--) if (0 !== r[u][u - 1]) {\n              for (a = u + 1; a <= c; a++) e[a] = r[a][u - 1];\n\n              for (h = u; h <= c; h++) {\n                for (o = 0, a = u; a <= c; a++) o += e[a] * n[a][h];\n\n                for (o = o / e[u] / r[u][u - 1], a = u; a <= c; a++) n[a][h] += o * e[a];\n              }\n            }\n          }(o, f, m, s), function (t, r, e, n, i) {\n            var o,\n                s,\n                a,\n                h,\n                u,\n                l,\n                c,\n                f,\n                m,\n                g,\n                p,\n                v,\n                d,\n                w,\n                y,\n                b = t - 1,\n                M = t - 1,\n                x = Number.EPSILON,\n                S = 0,\n                E = 0,\n                R = 0,\n                k = 0,\n                z = 0,\n                N = 0,\n                A = 0,\n                V = 0;\n\n            for (o = 0; o < t; o++) for ((o < 0 || o > M) && (e[o] = i[o][o], r[o] = 0), s = Math.max(o - 1, 0); s < t; s++) E += Math.abs(i[o][s]);\n\n            for (; b >= 0;) {\n              for (h = b; h > 0 && (0 === (N = Math.abs(i[h - 1][h - 1]) + Math.abs(i[h][h])) && (N = E), !(Math.abs(i[h][h - 1]) < x * N));) h--;\n\n              if (h === b) i[b][b] = i[b][b] + S, e[b] = i[b][b], r[b] = 0, b--, V = 0;else if (h === b - 1) {\n                if (c = i[b][b - 1] * i[b - 1][b], R = (i[b - 1][b - 1] - i[b][b]) / 2, k = R * R + c, A = Math.sqrt(Math.abs(k)), i[b][b] = i[b][b] + S, i[b - 1][b - 1] = i[b - 1][b - 1] + S, f = i[b][b], k >= 0) {\n                  for (A = R >= 0 ? R + A : R - A, e[b - 1] = f + A, e[b] = e[b - 1], 0 !== A && (e[b] = f - c / A), r[b - 1] = 0, r[b] = 0, f = i[b][b - 1], N = Math.abs(f) + Math.abs(A), R = f / N, k = A / N, z = Math.sqrt(R * R + k * k), R /= z, k /= z, s = b - 1; s < t; s++) A = i[b - 1][s], i[b - 1][s] = k * A + R * i[b][s], i[b][s] = k * i[b][s] - R * A;\n\n                  for (o = 0; o <= b; o++) A = i[o][b - 1], i[o][b - 1] = k * A + R * i[o][b], i[o][b] = k * i[o][b] - R * A;\n\n                  for (o = 0; o <= M; o++) A = n[o][b - 1], n[o][b - 1] = k * A + R * n[o][b], n[o][b] = k * n[o][b] - R * A;\n                } else e[b - 1] = f + R, e[b] = f + R, r[b - 1] = A, r[b] = -A;\n\n                b -= 2, V = 0;\n              } else {\n                if (f = i[b][b], m = 0, c = 0, h < b && (m = i[b - 1][b - 1], c = i[b][b - 1] * i[b - 1][b]), 10 === V) {\n                  for (S += f, o = 0; o <= b; o++) i[o][o] -= f;\n\n                  N = Math.abs(i[b][b - 1]) + Math.abs(i[b - 1][b - 2]), f = m = .75 * N, c = -.4375 * N * N;\n                }\n\n                if (30 === V && (N = (N = (m - f) / 2) * N + c) > 0) {\n                  for (N = Math.sqrt(N), m < f && (N = -N), N = f - c / ((m - f) / 2 + N), o = 0; o <= b; o++) i[o][o] -= N;\n\n                  S += N, f = m = c = .964;\n                }\n\n                for (V += 1, u = b - 2; u >= h && (A = i[u][u], R = ((z = f - A) * (N = m - A) - c) / i[u + 1][u] + i[u][u + 1], k = i[u + 1][u + 1] - A - z - N, z = i[u + 2][u + 1], N = Math.abs(R) + Math.abs(k) + Math.abs(z), R /= N, k /= N, z /= N, u !== h) && !(Math.abs(i[u][u - 1]) * (Math.abs(k) + Math.abs(z)) < x * (Math.abs(R) * (Math.abs(i[u - 1][u - 1]) + Math.abs(A) + Math.abs(i[u + 1][u + 1]))));) u--;\n\n                for (o = u + 2; o <= b; o++) i[o][o - 2] = 0, o > u + 2 && (i[o][o - 3] = 0);\n\n                for (a = u; a <= b - 1 && (w = a !== b - 1, a !== u && (R = i[a][a - 1], k = i[a + 1][a - 1], z = w ? i[a + 2][a - 1] : 0, 0 !== (f = Math.abs(R) + Math.abs(k) + Math.abs(z)) && (R /= f, k /= f, z /= f)), 0 !== f); a++) if (N = Math.sqrt(R * R + k * k + z * z), R < 0 && (N = -N), 0 !== N) {\n                  for (a !== u ? i[a][a - 1] = -N * f : h !== u && (i[a][a - 1] = -i[a][a - 1]), f = (R += N) / N, m = k / N, A = z / N, k /= R, z /= R, s = a; s < t; s++) R = i[a][s] + k * i[a + 1][s], w && (R += z * i[a + 2][s], i[a + 2][s] = i[a + 2][s] - R * A), i[a][s] = i[a][s] - R * f, i[a + 1][s] = i[a + 1][s] - R * m;\n\n                  for (o = 0; o <= Math.min(b, a + 3); o++) R = f * i[o][a] + m * i[o][a + 1], w && (R += A * i[o][a + 2], i[o][a + 2] = i[o][a + 2] - R * z), i[o][a] = i[o][a] - R, i[o][a + 1] = i[o][a + 1] - R * k;\n\n                  for (o = 0; o <= M; o++) R = f * n[o][a] + m * n[o][a + 1], w && (R += A * n[o][a + 2], n[o][a + 2] = n[o][a + 2] - R * z), n[o][a] = n[o][a] - R, n[o][a + 1] = n[o][a + 1] - R * k;\n                }\n              }\n            }\n\n            if (0 === E) return;\n\n            for (b = t - 1; b >= 0; b--) if (R = e[b], 0 === (k = r[b])) for (h = b, i[b][b] = 1, o = b - 1; o >= 0; o--) {\n              for (c = i[o][o] - R, z = 0, s = h; s <= b; s++) z += i[o][s] * i[s][b];\n\n              if (r[o] < 0) A = c, N = z;else if (h = o, 0 === r[o] ? i[o][b] = 0 !== c ? -z / c : -z / (x * E) : (f = i[o][o + 1], m = i[o + 1][o], k = (e[o] - R) * (e[o] - R) + r[o] * r[o], l = (f * N - A * z) / k, i[o][b] = l, i[o + 1][b] = Math.abs(f) > Math.abs(A) ? (-z - c * l) / f : (-N - m * l) / A), l = Math.abs(i[o][b]), x * l * l > 1) for (s = o; s <= b; s++) i[s][b] = i[s][b] / l;\n            } else if (k < 0) for (h = b - 1, Math.abs(i[b][b - 1]) > Math.abs(i[b - 1][b]) ? (i[b - 1][b - 1] = k / i[b][b - 1], i[b - 1][b] = -(i[b][b] - R) / i[b][b - 1]) : (y = $(0, -i[b - 1][b], i[b - 1][b - 1] - R, k), i[b - 1][b - 1] = y[0], i[b - 1][b] = y[1]), i[b][b - 1] = 0, i[b][b] = 1, o = b - 2; o >= 0; o--) {\n              for (g = 0, p = 0, s = h; s <= b; s++) g += i[o][s] * i[s][b - 1], p += i[o][s] * i[s][b];\n\n              if (c = i[o][o] - R, r[o] < 0) A = c, z = g, N = p;else if (h = o, 0 === r[o] ? (y = $(-g, -p, c, k), i[o][b - 1] = y[0], i[o][b] = y[1]) : (f = i[o][o + 1], m = i[o + 1][o], v = (e[o] - R) * (e[o] - R) + r[o] * r[o] - k * k, d = 2 * (e[o] - R) * k, 0 === v && 0 === d && (v = x * E * (Math.abs(c) + Math.abs(k) + Math.abs(f) + Math.abs(m) + Math.abs(A))), y = $(f * z - A * g + k * p, f * N - A * p - k * g, v, d), i[o][b - 1] = y[0], i[o][b] = y[1], Math.abs(f) > Math.abs(A) + Math.abs(k) ? (i[o + 1][b - 1] = (-g - c * i[o][b - 1] + k * i[o][b]) / f, i[o + 1][b] = (-p - c * i[o][b] - k * i[o][b - 1]) / f) : (y = $(-z - m * i[o][b - 1], -N - m * i[o][b], A, k), i[o + 1][b - 1] = y[0], i[o + 1][b] = y[1])), l = Math.max(Math.abs(i[o][b - 1]), Math.abs(i[o][b])), x * l * l > 1) for (s = o; s <= b; s++) i[s][b - 1] = i[s][b - 1] / l, i[s][b] = i[s][b] / l;\n            }\n\n            for (o = 0; o < t; o++) if (o < 0 || o > M) for (s = o; s < t; s++) n[o][s] = i[o][s];\n\n            for (s = t - 1; s >= 0; s--) for (o = 0; o <= M; o++) {\n              for (A = 0, a = 0; a <= Math.min(s, M); a++) A += n[o][a] * i[a][s];\n\n              n[o][s] = A;\n            }\n          }(o, h, a, s, f);\n        }\n\n        this.n = o, this.e = h, this.d = a, this.V = s;\n      }\n\n      get realEigenvalues() {\n        return this.d;\n      }\n\n      get imaginaryEigenvalues() {\n        return this.e;\n      }\n\n      get eigenvectorMatrix() {\n        return _.isMatrix(this.V) || (this.V = new _(this.V)), this.V;\n      }\n\n      get diagonalMatrix() {\n        var t,\n            r,\n            e = this.n,\n            n = this.e,\n            i = this.d,\n            o = new _(e, e);\n\n        for (t = 0; t < e; t++) {\n          for (r = 0; r < e; r++) o[t][r] = 0;\n\n          o[t][t] = i[t], n[t] > 0 ? o[t][t + 1] = n[t] : n[t] < 0 && (o[t][t - 1] = n[t]);\n        }\n\n        return o;\n      }\n\n    }\n\n    function $(t, r, e, n) {\n      var i, o;\n      return Math.abs(e) > Math.abs(n) ? [(t + (i = n / e) * r) / (o = e + i * n), (r - i * t) / o] : [((i = e / n) * t + r) / (o = n + i * e), (i * r - t) / o];\n    }\n\n    class Q {\n      constructor(t) {\n        if (!(t = j.checkMatrix(t)).isSymmetric()) throw new Error("Matrix is not symmetric");\n        var r,\n            e,\n            n,\n            i = t,\n            o = i.rows,\n            s = new _(o, o),\n            a = !0;\n\n        for (e = 0; e < o; e++) {\n          var h = s[e],\n              u = 0;\n\n          for (n = 0; n < e; n++) {\n            var l = s[n],\n                c = 0;\n\n            for (r = 0; r < n; r++) c += l[r] * h[r];\n\n            h[n] = c = (i.get(e, n) - c) / s[n][n], u += c * c;\n          }\n\n          for (a &= (u = i.get(e, e) - u) > 0, s[e][e] = Math.sqrt(Math.max(u, 0)), n = e + 1; n < o; n++) s[e][n] = 0;\n        }\n\n        if (!a) throw new Error("Matrix is not positive definite");\n        this.L = s;\n      }\n\n      solve(t) {\n        t = j.checkMatrix(t);\n        var r = this.L,\n            e = r.rows;\n        if (t.rows !== e) throw new Error("Matrix dimensions do not match");\n        var n,\n            i,\n            o,\n            s = t.columns,\n            a = t.clone();\n\n        for (o = 0; o < e; o++) for (i = 0; i < s; i++) {\n          for (n = 0; n < o; n++) a[o][i] -= a[n][i] * r[o][n];\n\n          a[o][i] /= r[o][o];\n        }\n\n        for (o = e - 1; o >= 0; o--) for (i = 0; i < s; i++) {\n          for (n = o + 1; n < e; n++) a[o][i] -= a[n][i] * r[n][o];\n\n          a[o][i] /= r[o][o];\n        }\n\n        return a;\n      }\n\n      get lowerTriangularMatrix() {\n        return this.L;\n      }\n\n    }\n\n    e.d(r, "default", function () {\n      return _;\n    }), e.d(r, "Matrix", function () {\n      return _;\n    }), e.d(r, "abstractMatrix", function () {\n      return C;\n    }), e.d(r, "wrap", function () {\n      return I;\n    }), e.d(r, "WrapperMatrix2D", function () {\n      return j;\n    }), e.d(r, "WrapperMatrix1D", function () {\n      return P;\n    }), e.d(r, "solve", function () {\n      return L;\n    }), e.d(r, "inverse", function () {\n      return D;\n    }), e.d(r, "linearDependencies", function () {\n      return q;\n    }), e.d(r, "SingularValueDecomposition", function () {\n      return c;\n    }), e.d(r, "SVD", function () {\n      return c;\n    }), e.d(r, "EigenvalueDecomposition", function () {\n      return U;\n    }), e.d(r, "EVD", function () {\n      return U;\n    }), e.d(r, "CholeskyDecomposition", function () {\n      return Q;\n    }), e.d(r, "CHO", function () {\n      return Q;\n    }), e.d(r, "LuDecomposition", function () {\n      return h;\n    }), e.d(r, "LU", function () {\n      return h;\n    }), e.d(r, "QrDecomposition", function () {\n      return O;\n    }), e.d(r, "QR", function () {\n      return O;\n    });\n  }]);\n});',ed=function(){var e;self.onmessage=function(t){switch(t.data.task){case"create":i=t.data.umapUrl,o=t.data.config,importScripts(i),e=new self.UMAP(o);break;case"fit":self.postMessage((n=t.data.data,(r=t.data.labels)&&e.setSupervisedProjection(r),e.fit(n)));break;case"transform":self.postMessage(function(t){return e.transform(t)}(t.data.data));break;default:self.postMessage({error:new Error("Unknown or no task specified")})}var n,r,i,o}},td="#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D uDataTex;\nuniform sampler2D uColorMapTex;\nuniform float uColorMapTexRes;\nuniform float uColorMapSize;\nuniform float uMinValue;\nuniform float uMaxValue;\n\nin vec2 vTextureCoord;\n\nout vec4 outColor;\n\nvec4 toColor(float value) {\n  float halfTexel = 0.5 / uColorMapTexRes;\n\n  // Normalize value\n  float normValue = clamp(\n    (value - uMinValue) / (uMaxValue - uMinValue),\n    0.0,\n    1.0\n  );\n\n  // Linear index into the colormap, e.g., 5 means the 5th color\n  float linIdx = max(normValue * uColorMapSize, float(value > 0.0));\n\n  // Texture index into the colormap texture\n  vec2 colorTexIndex = vec2(\n    (mod(linIdx, uColorMapTexRes) / uColorMapTexRes) + halfTexel,\n    (floor(linIdx / uColorMapTexRes) / uColorMapTexRes) + halfTexel\n  );\n\n  return texture(uColorMapTex, colorTexIndex);\n}\n\nvoid main() {\n  outColor = toColor(texture(uDataTex, vTextureCoord).r);\n}\n",nd="#version 300 es\n\nprecision mediump float;\n\n// From PIXI\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nout vec2 vTextureCoord;\n\nvoid main() {\n  gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n  vTextureCoord = aTextureCoord;\n}\n",rd=[],id=function(e){var n=Math.max(2,Math.ceil(Math.sqrt(e.length))),r=new Float32Array(4*Math.pow(n,2));return e.forEach((function(e,t){r[4*t]=e[0],r[4*t+1]=e[1],r[4*t+2]=e[2],r[4*t+3]=e[3]})),[t.Texture.fromBuffer(r,n,n),n]},od=function(e){switch(e){case 1:return[1,1,1,1,1];case 2:return[2,1,2,1.5,1.25];case 3:return[3,1,3,2,1.35];case 4:case 5:return[4,2,2,1,1.25];case 6:case 7:return[6,2,3,1.5,1.5];case 8:return[8,2,4,2,1.7];case 9:default:return[9,3,3,1,1.5]}},ad=function(){var e=i(u.mark((function e(n,r){var i,o,a,s,c,l,f,h,p,d,g,m,v,y,w,x,S,k,M,E,O,A,P,j,C,_,I,R,T=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=T.length>2&&void 0!==T[2]?T[2]:{},o=i.innerPadding,a=void 0===o?2:o,s=i.outerPadding,c=void 0===s?2:s,l=i.backgroundColor,f=void 0===l?0:l,h=i.maxNumberOfRepresentatives,p=void 0===h?9:h,d=Math.min(p,n.length),g=od(d),m=b(g,4),v=m[0],y=m[1],w=m[2],x=m[3],e.next=5,r(n.slice(0,v));case 5:return S=e.sent,k=1,E=M=1/x,O=new t.Graphics,A=-1/0,S.forEach((function(e){A=Math.max(A,e.width,e.height)})),P=A,j=A*E,C=A*(k/w),_=A*(M/y),S.forEach((function(e,n){var r=Qn(e),i=r instanceof t.Texture;i&&(r=new t.Sprite(r));var o=Math.floor(n/w),s=n%w,u=r.width/r.height<E,l=u?C/r.width:_/r.height;(l>1||i)&&(r.width*=l,r.height*=l);var f=i?s:s+.5,h=i?o:o+.5;if(r.x=f*C+s*a+c,r.y=h*_+o*a+c,i){var p=u?r.width:r.height;r.x-=u?0:(r.width-p)/2,r.y-=u?(r.height-p)/2:0}O.addChild(r);var d=new t.Graphics;d.beginFill(16711680,.5).drawRect(s*C+s*a+c,o*_+o*a+c,C,_).endFill(),r.mask=d,O.addChild(d)})),I=P+(w-1)*a+2*c,R=j+(y-1)*a+2*c,O.beginFill(f).drawRect(0,0,I,R).endFill(),O.pivot.x=I/2,O.pivot.y=R/2,e.abrupt("return",O);case 23:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),sd=function(){var e=i(u.mark((function e(t){var n,r,i,o,a,s,c,l,f,h,p,d=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]?d[1]:{},r=n.width,i=void 0===r?128:r,o=n.height,a=void 0===o?128:o,s=n.color,c=void 0===s?"black":s,l=n.background,f=void 0===l?null:l,"<"===(h="string"==typeof t||t instanceof String?t:(new XMLSerializer).serializeToString(t))[0]){e.next=9;break}return e.next=5,fetch(h);case 5:return p=e.sent,e.next=8,p.text();case 8:h=e.sent;case 9:return e.abrupt("return",new Promise((function(e,t){var n=new Image,r=[c&&"color: ".concat(c),f&&"background: ".concat(f)].filter((function(e){return e})),o='style="'.concat(r.join("; "),'"'),s=[i&&'width="'.concat(i,'"'),a&&'height="'.concat(a,'"')].filter((function(e){return e})).join(" "),u=(h=h.slice(h.indexOf("<svg"))).indexOf(">"),l=h.slice(0,u+1),p=l.indexOf('width="');if(p>=0){var d=l.indexOf('"',p+7);l=l.slice(0,p)+l.slice(d+1)}var g=l.indexOf('height="');if(g>=0){var m=l.indexOf('"',g+8);l=l.slice(0,g)+l.slice(m+1)}var v=l.indexOf('style="');if(v>=0){var y=l.indexOf('"',v+7);l=l.slice(0,v)+l.slice(y+1)}h=[[l.slice(0,5),s,o,l.slice(5)].join(" "),h.slice(u+1)].join("");var b="data:image/svg+xml;base64,".concat(btoa(unescape(encodeURIComponent(h))));n.onload=function(){e(n)},n.onerror=function(e){e.message="SVG Renderer: Could not render SVG as an image.",t(e)},n.src=b})));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ud=function(e){return function(t){return Promise.all(t.map((function(t){return sd(t,e)})))}};function cd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ld(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cd(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fd(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pd=function(){var e=i(u.mark((function e(t,n){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Wp(t,n),e.next=3,r.whenInit;case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),dd=function(){var e=i(u.mark((function e(t,n,r){var i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Wp(t),e.next=3,i.importState(n,r);case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();e.createD3Renderer=function(e,t){var n=ud(t);return function(t){return n(t.map((function(t){var n=e(t);return Se(n.node)?n.node():n})))}},e.createDbscan=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.distanceFunction,n=void 0===t?null:t,r=e.maxDistance,i=void 0===r?null:r,o=e.minPoints,a=void 0===o?2:o,s=e.valueGetter,u=void 0===s?null:s,c=e.postProcessing,l=void 0===c?null:c,f=[];return u&&f.push(Pr("(() => { self.valueGetter = ".concat(u.toString(),"; })();"))),n&&f.push(Pr("(() => { self.distanceFunction = ".concat(n.toString(),"; })();"))),l&&f.push(Pr("(() => { self.postProcessing = ".concat(l.toString(),"; })();"))),function(e){return new Promise((function(t,n){var r=at(Qp);r.onmessage=function(e){e.data.error?n(e.data.error):t(e.data),r.terminate()},r.postMessage({maxDistance:i,minPoints:a,items:e,scripts:f})}))}},e.createImage=lr,e.createImageRenderer=function(){return function(e){return Promise.all(e.map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(n,r){var i=new Image;t&&(i.crossOrigin="Anonymous"),i.onload=function(){n(i)},i.onerror=function(t){console.error("Could't load ".concat(e)),r(t)},i.src=e}))}(e,!0)})))}},e.createKmeans=jr,e.createLibrary=Wp,e.createLibraryAsync=pd,e.createLibraryFromState=dd,e.createMatrixCoverAggregator=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mean";return function(t){return new Promise((function(n,r){var i=at(Zp);i.onmessage=function(e){e.data.error?r(e.data.error):n(e.data.newSrc),i.terminate()},i.postMessage({items:t,aggregator:e})}))}},e.createMatrixPreviewAggregator=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mean";return function(t){var n=t.map((function(t){return new Promise((function(n,r){var i=at(Kp);i.onmessage=function(e){e.data.error?r(e.data.error):n(e.data.newSrc),i.terminate()},i.postMessage({src:t.src,aggregagtor:e})}))}));return Promise.all(n).catch((function(e){console.error("Matrix preview aggregation failed",e)}))}},e.createMatrixRenderer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.colorMap,r=void 0===n?rd:n,o=e.domain,a=void 0===o?[0,1]:o,s=e.shape,c=new t.Geometry;c.addAttribute("aVertexPosition",[-1,-1,1,-1,1,1,-1,1],2),c.addAttribute("aTextureCoord",[0,0,1,0,1,1,0,1],2),c.addIndex([0,1,2,0,3,2]);var l=id(r),f=b(l,2),h=f[0],p=f[1],d=r.length-1,g=[],m=function(){var e=i(u.mark((function e(n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(n.map(function(){var e=i(u.mark((function e(n){var r,i,o,l,f,m,v,y,w;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s||n.shape,i=b(r,2),o=i[0],l=i[1],f=function(e){var n=new _n(new Float32Array(e),{width:l,height:o,internalFormat:"R32F",format:"RED",type:"FLOAT"});return new t.Texture(new t.BaseTexture(n,{scaleMode:t.SCALE_MODES.NEAREST}))},m=new t.UniformGroup({uColorMapTex:h,uColorMapTexRes:p,uColorMapSize:d,uMinValue:a[0],uMaxValue:a[1],uDataTex:f(n.data)}),g.push(m),v=t.Shader.from(nd,td,m),y=new t.State,(w=new t.Mesh(c,v,y)).width=l,w.height=o,e.abrupt("return",w);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return m.setColorMap=function(e){var t=id(e),n=b(t,2),r=n[0],i=n[1];g.forEach((function(e){var t=e.uniforms;t.uColorMapTex=r,t.uColorMapTexRes=i}))},m.setDomain=function(e){g.forEach((function(t){var n=t.uniforms;n.uMinValue=e[0],n.uMaxValue=e[1]}))},m.clear=function(){g=[]},m.renderer=m,m},e.createObservablePlotRenderer=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=ud(n);return function(i){return r(i.map((function(r){return e.plot(hd({marks:t(r)},n))})))}},e.createRepresentativeAggregator=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.distanceFunction,r=void 0===n?null:n,i=t.initialization,o=void 0===i?"kmpp":i,a=t.maxIterations,s=void 0===a?null:a,u=t.valueGetter,c=void 0===u?null:u,l=function(e,t){var n,r,i=(n=t[0].length,r=Array(n).fill().map((function(e,t){return"s += (v[".concat(t,"] - w[").concat(t,"]) ** 2;")})).join(" "),new Function("v","w","let s = 0; ".concat(r," return s;"))),o=Array(e.centroids.length).fill(),a=Array(e.centroids.length).fill(1/0);return t.forEach((function(t,n){var r=e.idxs[n],s=i(t,e.centroids[r]);s<a[r]&&(a[r]=s,o[r]=n)})),{selectedItemIdxs:o}},f=jr(e,{distanceFunction:r,initialization:o,maxIterations:s,valueGetter:c,postProcessing:l});return function(t){return t.length<=e?Promise.resolve(t.map((function(e){return e.src}))):f(t).then((function(e){return e.postProcessing.selectedItemIdxs.map((function(e){return t[e].src}))}))}},e.createRepresentativeRenderer=function(e,t){var n=function(n){return Promise.all(n.map((function(n){return ad(n,e,t)})))};return n.scaler=function(e){return od(e.items.length)[4]},n},e.createSvgRenderer=ud,e.createUmap=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.padding,r=void 0===n?.1:n,i=zn(),o=zn(),a=Pr(Jp.replace("window","self")),s=at(ed);s.postMessage({task:"create",config:e,umapUrl:a});var u=1/0,c=1/0,l=-1/0,f=-1/0,h=function(e){e.forEach((function(e){u=e[0]<u?e[0]:u,c=e[1]<c?e[1]:c,l=e[0]>l?e[0]:l,f=e[1]>f?e[1]:f}));var t=(l-u)*r,n=(f-c)*r;return i.domain([u-t,l+t]),o.domain([c-n,f+n]),e},p=function(e){return[i(e[0]),o(e[1])]},d=function(){s.terminate()},g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return u=1/0,c=1/0,l=-1/0,f=-1/0,new Promise((function(n){s.onmessage=function(e){n(h(e.data))},s.postMessage({task:"fit",data:e,labels:t})}))},m=function(e){return s?new Promise((function(t){s.onmessage=function(e){t(e.data.map(p))},s.postMessage({task:"transform",data:e})})):Promise.reject(new Error("You need to fit data first!"))};return{destroy:d,fit:g,transform:m}},e.createVegaLiteRenderer=function(e){var t=e.baseSpec,n=e.vega,r=e.vegaLite;return function(e){return Promise.all(e.map((function(e){var i=Object.prototype.hasOwnProperty.call(e,"values")?e.values:e,o=Object.prototype.hasOwnProperty.call(e,"itemSpec")?e.itemSpec:{},a=ld(ld(ld({},t),o),{},{data:{values:i}});return new n.View(n.parse(r.compile(a).spec),{renderer:"none"}).toCanvas()})))}},e.default=Wp,e.deserializeState=Rn,e.serializeState=tr,Object.defineProperty(e,"__esModule",{value:!0})}));
